<html><body bgcolor="#e0e0e0"><head><title>queries/xrayimage.py</title></head><pre><font face="Lucida,Courier New"><font color="#a02030"># ----------------------------------------------------------------------------</font>
<font color="#a02030">#  CLASSES: nightly</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Test Case:  xrayimage.py</font>
<font color="#a02030">#  Tests:      queries     - xray imagel</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Programmer: Eric Brugger</font>
<font color="#a02030">#  Date:       July 13, 2010</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Modifications:</font>
<font color="#a02030">#    Kathleen Bonnell, Thu Jul 14 10:44:55 PDT 2011</font>
<font color="#a02030">#    Change most of code to use python dictionary to pass query parameters.</font>
<font color="#a02030">#    First call to 'Query' still tests old-style argument passing.</font>
<font color="#a02030">#    Second call to 'Query' creates a Python dictionary from scratch and</font>
<font color="#a02030">#    uses that.  Prior to third call to Query, retrieve default dictionary via</font>
<font color="#a02030">#    GetQueryParameters.  All subsequent calls to Query modify that dictionary </font>
<font color="#a02030">#    object as necessary and pass it.</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Kathleen Biagas, Wed Oct 17 14:25:05 PDT 2012</font>
<font color="#a02030">#    Show usage of new 'up_vector' parameter.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Tue Jun 14 10:02:21 PDT 2022</font>
<font color="#a02030">#    Change tests to reflect new ability to send output directory to query.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Wed Jun 15 16:43:34 PDT 2022</font>
<font color="#a02030">#    Added tests for new blueprint output.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Wed Jul 20 13:54:06 PDT 2022</font>
<font color="#a02030">#    Added query output msg tests and tests for query errors.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Thu Sep  8 16:29:06 PDT 2022</font>
<font color="#a02030">#    Added new tests for blueprint output metadata.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Tue Sep 27 10:52:59 PDT 2022</font>
<font color="#a02030">#    Changed names of most output files to reflect new naming conventions.</font>
<font color="#a02030">#    Added tests for filenames, all output types, and result messages.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Fri Sep 30 15:54:40 PDT 2022</font>
<font color="#a02030">#    Changed location of temp output files.</font>
<font color="#a02030">#    os.remove is gone.</font>
<font color="#a02030">#    tmp/baddir is gone, replaced.</font>
<font color="#a02030">#    These changes were made so the tests no longer crash on windows.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Tue Nov 15 14:54:35 PST 2022</font>
<font color="#a02030">#    Added new tests for additional blueprint output metadata as well as</font>
<font color="#a02030">#    imaging plane topologies.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Tue Nov 22 14:56:04 PST 2022</font>
<font color="#a02030">#    Updated numbering on later tests.</font>
<font color="#a02030">#    Reorganized blueprint tests so they use a function. That function also</font>
<font color="#a02030">#    uses new and old query calls, doubling the number of blueprint tests.</font>
<font color="#a02030">#    It also tests energy group bin output for hdf5.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Mon Nov 28 15:38:25 PST 2022</font>
<font color="#a02030">#    Renamed energy group bins to energy group bounds.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Wed Nov 30 10:41:17 PST 2022</font>
<font color="#a02030">#    Added tests for always positive detector height and width in blueprint</font>
<font color="#a02030">#    metadata.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Wed Nov 30 17:43:48 PST 2022</font>
<font color="#a02030">#    Added tests for piping the units through the query.</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Justin Privitera, Wed Oct 12 11:38:11 PDT 2022</font>
<font color="#a02030">#    Changed output type for many tests since bmp output type is removed.</font>
<font color="#a02030">#</font>
<font color="#a02030"># ----------------------------------------------------------------------------</font>

<font color="#C00000">import</font> <font color="#000000">os</font>
<font color="#C00000">import</font> <font color="#000000">conduit</font>
<font color="#C00000">import</font> <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">blueprint</font>
<font color="#C00000">import</font> <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">relay</font>

<font color="#a02030">#</font>
<font color="#a02030"># Test a single block structured grid with scalars.</font>
<font color="#a02030">#</font>
<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">"curv3d.silo"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"d"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030"># old style argument passing</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#008000">"."</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#008000">"d"</font><font color="#4000C0">,</font> <font color="#008000">"p"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>


<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#008000">"current"</font><font color="#4000C0">,</font><font color="#008000">"queries"</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#008000">"current"</font><font color="#4000C0">,</font><font color="#008000">"queries"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">out_base</font> <font color="#4000C0">=</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#008000">"current"</font><font color="#4000C0">,</font><font color="#008000">"queries"</font><font color="#4000C0">,</font><font color="#008000">"xrayimage"</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">"output.png"</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">"xrayimage00.png"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"xrayimage00"</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"xrayimage01"</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Test a multi block structured grid with an array variable.</font>
<font color="#a02030">#</font>
<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"d1"</font><font color="#4000C0">,</font> <font color="#008000">'recenter(d, "zonal")'</font><font color="#4000C0">)</font>
<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"p1"</font><font color="#4000C0">,</font> <font color="#008000">'recenter(p, "zonal")'</font><font color="#4000C0">)</font>

<font color="#000000">DefineArrayExpression</font><font color="#4000C0">(</font><font color="#008000">"da"</font><font color="#4000C0">,</font> <font color="#008000">"array_compose(d1,d1)"</font><font color="#4000C0">)</font>
<font color="#000000">DefineArrayExpression</font><font color="#4000C0">(</font><font color="#008000">"pa"</font><font color="#4000C0">,</font> <font color="#008000">"array_compose(p1,p1)"</font><font color="#4000C0">)</font>

<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">"multi_curv3d.silo"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"d"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030">#create our own dictionary</font>
<font color="#000000">params</font> <font color="#4000C0">=</font> <font color="#000000">dict</font><font color="#4000C0">(</font><font color="#000000">output_type</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#000000">output_dir</font><font color="#4000C0">=</font><font color="#008000">"."</font><font color="#4000C0">,</font> <font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#000000">origin</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.0</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">up_vector</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">theta</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">phi</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">width</font> <font color="#4000C0">=</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#000000">height</font><font color="#4000C0">=</font><font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#000000">image_size</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">vars</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#008000">"da"</font><font color="#4000C0">,</font> <font color="#008000">"pa"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">"output.00.png"</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">"xrayimage02.png"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">"output.01.png"</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">"xrayimage03.png"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"xrayimage02"</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"xrayimage03"</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"xrayimage04"</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Test a 2d structured grid with scalars.</font>
<font color="#a02030">#</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">"curv2d.silo"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"d"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030">#retreive default query parameters</font>
<font color="#000000">params</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryParameters</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">)</font>
<font color="#a02030">#modify as necessary</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'image_size'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">)</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'divide_emis_by_absorb'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'width'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">10.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'height'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">10.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'vars'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">"d"</font><font color="#4000C0">,</font> <font color="#008000">"p"</font><font color="#4000C0">)</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">"output.png"</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">"xrayimage05.png"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"xrayimage05"</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"xrayimage06"</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'theta'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">90</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'phi'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font>  <font color="#0080C0">0</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">"output.png"</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">"xrayimage07.png"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"xrayimage07"</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"xrayimage08"</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Test an unstructured grid with scalars.</font>
<font color="#a02030">#</font>
<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"u1"</font><font color="#4000C0">,</font> <font color="#008000">'recenter(((u+10.)*0.01), "zonal")'</font><font color="#4000C0">)</font>
<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"v1"</font><font color="#4000C0">,</font> <font color="#008000">'recenter(((v+10.)*0.01*matvf(mat1,1)), "zonal")'</font><font color="#4000C0">)</font>
<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"v2"</font><font color="#4000C0">,</font> <font color="#008000">'recenter(((v+10.)*0.01*matvf(mat1,2)), "zonal")'</font><font color="#4000C0">)</font>
<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"v3"</font><font color="#4000C0">,</font> <font color="#008000">'recenter(((v+10.)*0.01*matvf(mat1,3)), "zonal")'</font><font color="#4000C0">)</font>
<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"v4"</font><font color="#4000C0">,</font> <font color="#008000">'recenter(((v+10.)*0.01*matvf(mat1,4)), "zonal")'</font><font color="#4000C0">)</font>
<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"w1"</font><font color="#4000C0">,</font> <font color="#008000">'recenter(((w+10.)*0.01), "zonal")'</font><font color="#4000C0">)</font>

<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">"globe.silo"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"u"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030"># Do tets.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'theta'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'phi'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'width'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">1.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'height'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">1.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'vars'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">"w1"</font><font color="#4000C0">,</font> <font color="#008000">"v1"</font><font color="#4000C0">)</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">"output.png"</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">"xrayimage09.png"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"xrayimage09"</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"xrayimage10"</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'theta'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">90</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'width'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">4.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'height'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">4.</font>

<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">"output.png"</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">"xrayimage11.png"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"xrayimage11"</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"xrayimage12"</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#a02030"># Do pyramids.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'theta'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'vars'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">"w1"</font><font color="#4000C0">,</font> <font color="#008000">"v2"</font><font color="#4000C0">)</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">"output.png"</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">"xrayimage13.png"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"xrayimage13"</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"xrayimage14"</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'theta'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">90</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">"output.png"</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">"xrayimage15.png"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"xrayimage15"</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"xrayimage16"</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#a02030"># Do wedges.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'theta'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'width'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">8.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'height'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">8.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'vars'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">"w1"</font><font color="#4000C0">,</font> <font color="#008000">"v3"</font><font color="#4000C0">)</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">"output.png"</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">"xrayimage17.png"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"xrayimage17"</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>


<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"xrayimage18"</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'theta'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">90</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'width'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">20.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'height'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">20.</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">"output.png"</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">"xrayimage19.png"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"xrayimage19"</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"xrayimage20"</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#a02030"># Do hexes.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'theta'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'vars'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">"w1"</font><font color="#4000C0">,</font> <font color="#008000">"v4"</font><font color="#4000C0">)</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">"output.png"</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">"xrayimage21.png"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"xrayimage21"</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"xrayimage22"</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">'theta'</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">90</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">"output.png"</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">"xrayimage23.png"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"xrayimage23"</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"xrayimage24"</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Test with perspective.</font>
<font color="#a02030">#</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">"multi_curv3d.silo"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"d"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">params</font> <font color="#4000C0">=</font> <font color="#000000">dict</font><font color="#4000C0">(</font><font color="#000000">output_type</font><font color="#4000C0">=</font><font color="#008000">"png"</font><font color="#4000C0">,</font> <font color="#000000">output_dir</font><font color="#4000C0">=</font><font color="#008000">"."</font><font color="#4000C0">,</font> <font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#000000">focus</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">15.0</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">view_up</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0.</font><font color="#4000C0">,</font> <font color="#0080C0">1.</font><font color="#4000C0">,</font> <font color="#0080C0">0.</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">normal</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0.</font><font color="#4000C0">,</font> <font color="#0080C0">0.</font><font color="#4000C0">,</font> <font color="#0080C0">1.</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">view_angle</font><font color="#4000C0">=</font><font color="#0080C0">30.</font><font color="#4000C0">,</font> <font color="#000000">parallel_scale</font> <font color="#4000C0">=</font> <font color="#0080C0">16.0078</font><font color="#4000C0">,</font> <font color="#000000">near_plane</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">32.0156</font><font color="#4000C0">,</font> <font color="#000000">far_plane</font> <font color="#4000C0">=</font> <font color="#0080C0">32.0156</font><font color="#4000C0">,</font> <font color="#000000">image_pan</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0.</font><font color="#4000C0">,</font> <font color="#0080C0">0.</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">image_zoom</font> <font color="#4000C0">=</font> <font color="#0080C0">2.4</font><font color="#4000C0">,</font> <font color="#000000">perspective</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#000000">image_size</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">vars</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#008000">"d"</font><font color="#4000C0">,</font> <font color="#008000">"p"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">"output.png"</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">"xrayimage25.png"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"xrayimage25"</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"xrayimage26"</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Test with background intensities.</font>
<font color="#a02030">#</font>
<font color="#000000">DefineArrayExpression</font><font color="#4000C0">(</font><font color="#008000">"wa"</font><font color="#4000C0">,</font> <font color="#008000">"array_compose(w1,w1)"</font><font color="#4000C0">)</font>
<font color="#000000">DefineArrayExpression</font><font color="#4000C0">(</font><font color="#008000">"va"</font><font color="#4000C0">,</font> <font color="#008000">"array_compose(v4,v4)"</font><font color="#4000C0">)</font>

<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">"globe.silo"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"u"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">params</font> <font color="#4000C0">=</font> <font color="#000000">dict</font><font color="#4000C0">(</font><font color="#000000">output_type</font><font color="#4000C0">=</font><font color="#008000">"png"</font><font color="#4000C0">,</font> <font color="#000000">output_dir</font><font color="#4000C0">=</font><font color="#008000">"."</font><font color="#4000C0">,</font> <font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#000000">theta</font><font color="#4000C0">=</font><font color="#0080C0">90.</font><font color="#4000C0">,</font> <font color="#000000">phi</font><font color="#4000C0">=</font><font color="#0080C0">0.</font><font color="#4000C0">,</font> <font color="#000000">width</font><font color="#4000C0">=</font><font color="#0080C0">20.</font><font color="#4000C0">,</font> <font color="#000000">height</font><font color="#4000C0">=</font><font color="#0080C0">20.</font><font color="#4000C0">,</font> <font color="#000000">image_size</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">vars</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#008000">"wa"</font><font color="#4000C0">,</font> <font color="#008000">"va"</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">background_intensities</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0.05</font><font color="#4000C0">,</font> <font color="#0080C0">0.1</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">"output.00.png"</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">"xrayimage27.png"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">"output.01.png"</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">"xrayimage28.png"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"xrayimage27"</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"xrayimage28"</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"xrayimage29"</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030"># </font>
<font color="#a02030"># test setting output directory</font>
<font color="#a02030"># </font>
<font color="#000000">outdir_set</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"run_dir"</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">"testdir"</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">)</font>

<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">"curv3d.silo"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"d"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030"># old style argument passing</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#008000">"png"</font><font color="#4000C0">,</font> <font color="#000000">outdir_set</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#008000">"d"</font><font color="#4000C0">,</font> <font color="#008000">"p"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font> <font color="#4000C0">+</font> <font color="#008000">"/output.png"</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font> <font color="#008000">"xrayimage30.png"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"xrayimage30"</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"xrayimage31"</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">"curv3d.silo"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># test blueprint output</font>
<font color="#a02030">#</font>

<font color="#000000">conduit_dir_hdf5</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">,</font> <font color="#008000">"hdf5"</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_hdf5</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_hdf5</font><font color="#4000C0">)</font>
<font color="#000000">conduit_dir_json</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">,</font> <font color="#008000">"json"</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_json</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_json</font><font color="#4000C0">)</font>
<font color="#000000">conduit_dir_yaml</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">,</font> <font color="#008000">"yaml"</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_yaml</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_yaml</font><font color="#4000C0">)</font>
<font color="#000000">conduit_dir_imaging_planes</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">,</font> <font color="#008000">"imaging_planes"</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_imaging_planes</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_imaging_planes</font><font color="#4000C0">)</font>
<font color="#000000">conduit_dir_detector_dims</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">,</font> <font color="#008000">"detector_dims"</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_detector_dims</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_detector_dims</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">setup_bp_test</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">"curv3d.silo"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"d"</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">test_bp_state_xray_view</font><font color="#4000C0">(</font><font color="#000000">testname</font><font color="#4000C0">,</font> <font color="#000000">xrayout</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">normalx</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_view/normal/x"</font><font color="#4000C0">]</font>
    <font color="#000000">normaly</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_view/normal/y"</font><font color="#4000C0">]</font>
    <font color="#000000">normalz</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_view/normal/z"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_view_Normal"</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#000000">normalx</font><font color="#4000C0">,</font> <font color="#000000">normaly</font><font color="#4000C0">,</font> <font color="#000000">normalz</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">)</font>

    <font color="#000000">focusx</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_view/focus/x"</font><font color="#4000C0">]</font>
    <font color="#000000">focusy</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_view/focus/y"</font><font color="#4000C0">]</font>
    <font color="#000000">focusz</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_view/focus/z"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_view_Focus"</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#000000">focusx</font><font color="#4000C0">,</font> <font color="#000000">focusy</font><font color="#4000C0">,</font> <font color="#000000">focusz</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">2.5</font><font color="#4000C0">,</font><font color="#0080C0">10</font><font color="#4000C0">]</font><font color="#4000C0">)</font>

    <font color="#000000">viewUpx</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_view/viewUp/x"</font><font color="#4000C0">]</font>
    <font color="#000000">viewUpy</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_view/viewUp/y"</font><font color="#4000C0">]</font>
    <font color="#000000">viewUpz</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_view/viewUp/z"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_view_ViewUp"</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#000000">viewUpx</font><font color="#4000C0">,</font> <font color="#000000">viewUpy</font><font color="#4000C0">,</font> <font color="#000000">viewUpz</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">,</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">)</font>

    <font color="#000000">viewAngle</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_view/viewAngle"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_view_ViewAngle"</font><font color="#4000C0">,</font> <font color="#000000">viewAngle</font><font color="#4000C0">,</font> <font color="#0080C0">30</font><font color="#4000C0">)</font>

    <font color="#000000">parallelScale</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_view/parallelScale"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_view_ParallelScale"</font><font color="#4000C0">,</font> <font color="#000000">parallelScale</font><font color="#4000C0">,</font> <font color="#0080C0">5</font><font color="#4000C0">)</font>

    <font color="#000000">nearPlane</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_view/nearPlane"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_view_NearPlane"</font><font color="#4000C0">,</font> <font color="#000000">nearPlane</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">100</font><font color="#4000C0">)</font>

    <font color="#000000">farPlane</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_view/farPlane"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_view_FarPlane"</font><font color="#4000C0">,</font> <font color="#000000">farPlane</font><font color="#4000C0">,</font> <font color="#0080C0">100</font><font color="#4000C0">)</font>

    <font color="#000000">imagePanx</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_view/imagePan/x"</font><font color="#4000C0">]</font>
    <font color="#000000">imagePany</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_view/imagePan/y"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_view_ImagePan"</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#000000">imagePanx</font><font color="#4000C0">,</font> <font color="#000000">imagePany</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">)</font>

    <font color="#000000">imageZoom</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_view/imageZoom"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_view_ImageZoom"</font><font color="#4000C0">,</font> <font color="#000000">imageZoom</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

    <font color="#000000">perspective</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_view/perspective"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_view_Perspective"</font><font color="#4000C0">,</font> <font color="#000000">perspective</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font>

    <font color="#000000">perspectiveStr</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_view/perspectiveStr"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_view_PerspectiveStr"</font><font color="#4000C0">,</font> <font color="#000000">perspectiveStr</font><font color="#4000C0">,</font> <font color="#008000">"parallel"</font><font color="#4000C0">)</font>

<font color="#000000">UNITS_OFF</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
<font color="#000000">UNITS_ON</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>

<font color="#C00000">def</font> <font color="#000000">test_bp_state_xray_query</font><font color="#4000C0">(</font><font color="#000000">testname</font><font color="#4000C0">,</font> <font color="#000000">xrayout</font><font color="#4000C0">,</font> <font color="#000000">units</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">divideEmisByAbsorb</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_query/divideEmisByAbsorb"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_query_DivideEmisByAbsorb"</font><font color="#4000C0">,</font> <font color="#000000">divideEmisByAbsorb</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

    <font color="#000000">divideEmisByAbsorbStr</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_query/divideEmisByAbsorbStr"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_query_DivideEmisByAbsorbStr"</font><font color="#4000C0">,</font> <font color="#000000">divideEmisByAbsorbStr</font><font color="#4000C0">,</font> <font color="#008000">"yes"</font><font color="#4000C0">)</font>

    <font color="#000000">numXPixels</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_query/numXPixels"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_query_NumXPixels"</font><font color="#4000C0">,</font> <font color="#000000">numXPixels</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">)</font>

    <font color="#000000">numYPixels</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_query/numYPixels"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_query_NumYPixels"</font><font color="#4000C0">,</font> <font color="#000000">numYPixels</font><font color="#4000C0">,</font> <font color="#0080C0">200</font><font color="#4000C0">)</font>

    <font color="#000000">numBins</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_query/numBins"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_query_NumBins"</font><font color="#4000C0">,</font> <font color="#000000">numBins</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

    <font color="#000000">absVarName</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_query/absVarName"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_query_AbsVarName"</font><font color="#4000C0">,</font> <font color="#000000">absVarName</font><font color="#4000C0">,</font> <font color="#008000">"d"</font><font color="#4000C0">)</font>

    <font color="#000000">emisVarName</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_query/emisVarName"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_query_EmisVarName"</font><font color="#4000C0">,</font> <font color="#000000">emisVarName</font><font color="#4000C0">,</font> <font color="#008000">"p"</font><font color="#4000C0">)</font>

    <font color="#000000">absUnits</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_query/absUnits"</font><font color="#4000C0">]</font>
    <font color="#000000">emisUnits</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_query/emisUnits"</font><font color="#4000C0">]</font>

    <font color="#C00000">if</font> <font color="#4000C0">(</font><font color="#000000">units</font> <font color="#4000C0">==</font> <font color="#000000">UNITS_ON</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_query_AbsUnits"</font><font color="#4000C0">,</font> <font color="#000000">absUnits</font><font color="#4000C0">,</font> <font color="#008000">"abs units"</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_query_EmisUnits"</font><font color="#4000C0">,</font> <font color="#000000">emisUnits</font><font color="#4000C0">,</font> <font color="#008000">"emis units"</font><font color="#4000C0">)</font>
    <font color="#C00000">else</font><font color="#4000C0">:</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_query_AbsUnits"</font><font color="#4000C0">,</font> <font color="#000000">absUnits</font><font color="#4000C0">,</font> <font color="#008000">"no units provided"</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_query_EmisUnits"</font><font color="#4000C0">,</font> <font color="#000000">emisUnits</font><font color="#4000C0">,</font> <font color="#008000">"no units provided"</font><font color="#4000C0">)</font>

<font color="#000000">NO_ENERGY_GROUP_BOUNDS</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
<font color="#000000">ENERGY_GROUP_BOUNDS_MISMATCH</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
<font color="#000000">ENERGY_GROUP_BOUNDS</font> <font color="#4000C0">=</font> <font color="#0080C0">2</font>

<font color="#C00000">def</font> <font color="#000000">test_bp_state_xray_data</font><font color="#4000C0">(</font><font color="#000000">testname</font><font color="#4000C0">,</font> <font color="#000000">xrayout</font><font color="#4000C0">,</font> <font color="#000000">bin_state</font> <font color="#4000C0">=</font> <font color="#000000">NO_ENERGY_GROUP_BOUNDS</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">spatial_coords_x</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_data/image_coords/x"</font><font color="#4000C0">]</font>
    <font color="#000000">spatial_coords_y</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_data/image_coords/y"</font><font color="#4000C0">]</font>
    <font color="#000000">energy_group_bounds</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_data/image_coords/z"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_data_SpatialExtents0"</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#000000">spatial_coords_x</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">spatial_coords_y</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_data_SpatialExtents1"</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#000000">spatial_coords_x</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">spatial_coords_y</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#0080C0">0.05</font><font color="#4000C0">,</font> <font color="#0080C0">0.05</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_data_SpatialExtents2"</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#000000">spatial_coords_x</font><font color="#4000C0">[</font><font color="#0080C0">2</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">spatial_coords_y</font><font color="#4000C0">[</font><font color="#0080C0">2</font><font color="#4000C0">]</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#0080C0">0.1</font><font color="#4000C0">,</font> <font color="#0080C0">0.1</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_data_SpatialExtents3"</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#000000">spatial_coords_x</font><font color="#4000C0">[</font><font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">spatial_coords_y</font><font color="#4000C0">[</font><font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#0080C0">15.0</font><font color="#4000C0">,</font> <font color="#0080C0">10.0</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#C00000">if</font> <font color="#4000C0">(</font><font color="#000000">bin_state</font> <font color="#4000C0">==</font> <font color="#000000">NO_ENERGY_GROUP_BOUNDS</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_data_EnergyGroupBounds"</font><font color="#4000C0">,</font> <font color="#000000">energy_group_bounds</font><font color="#4000C0">,</font> <font color="#008000">"Energy group bounds not provided."</font><font color="#4000C0">)</font>
    <font color="#C00000">elif</font> <font color="#4000C0">(</font><font color="#000000">bin_state</font> <font color="#4000C0">==</font> <font color="#000000">ENERGY_GROUP_BOUNDS_MISMATCH</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">baseline_string</font> <font color="#4000C0">=</font> <font color="#008000">"Energy group bounds size mismatch: provided 3 bounds, but 2 in query results."</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_data_EnergyGroupBounds"</font><font color="#4000C0">,</font> <font color="#000000">energy_group_bounds</font><font color="#4000C0">,</font> <font color="#000000">baseline_string</font><font color="#4000C0">)</font>
    <font color="#C00000">elif</font> <font color="#4000C0">(</font><font color="#000000">bin_state</font> <font color="#4000C0">==</font> <font color="#000000">ENERGY_GROUP_BOUNDS</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_data_EnergyGroupBounds"</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#000000">energy_group_bounds</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">energy_group_bounds</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#0080C0">3.7</font><font color="#4000C0">,</font> <font color="#0080C0">4.2</font><font color="#4000C0">]</font><font color="#4000C0">)</font>

    <font color="#000000">detectorWidth</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_data/detectorWidth"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_data_DetectorWidth"</font><font color="#4000C0">,</font> <font color="#000000">detectorWidth</font><font color="#4000C0">,</font> <font color="#0080C0">15</font><font color="#4000C0">)</font>

    <font color="#000000">detectorHeight</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_data/detectorHeight"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_data_DetectorHeight"</font><font color="#4000C0">,</font> <font color="#000000">detectorHeight</font><font color="#4000C0">,</font> <font color="#0080C0">10</font><font color="#4000C0">)</font>

    <font color="#000000">intensityMax</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_data/intensityMax"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_data_IntensityMax"</font><font color="#4000C0">,</font> <font color="#000000">intensityMax</font><font color="#4000C0">,</font> <font color="#0080C0">0.24153</font><font color="#4000C0">)</font>

    <font color="#000000">intensityMin</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_data/intensityMin"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_data_IntensityMin"</font><font color="#4000C0">,</font> <font color="#000000">intensityMin</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font>

    <font color="#000000">pathLengthMax</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_data/pathLengthMax"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_data_PathLengthMax"</font><font color="#4000C0">,</font> <font color="#000000">pathLengthMax</font><font color="#4000C0">,</font> <font color="#0080C0">148.67099</font><font color="#4000C0">)</font>

    <font color="#000000">pathLengthMin</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_data/pathLengthMin"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_data_PathLengthMin"</font><font color="#4000C0">,</font> <font color="#000000">pathLengthMin</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">test_bp_state</font><font color="#4000C0">(</font><font color="#000000">testname</font><font color="#4000C0">,</font> <font color="#000000">conduit_db</font><font color="#4000C0">,</font> <font color="#000000">bin_state</font> <font color="#4000C0">=</font> <font color="#000000">NO_ENERGY_GROUP_BOUNDS</font><font color="#4000C0">,</font> <font color="#000000">units</font> <font color="#4000C0">=</font> <font color="#000000">UNITS_OFF</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">xrayout</font> <font color="#4000C0">=</font> <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">Node</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">relay</font><font color="#4000C0">.</font><font color="#000000">io</font><font color="#4000C0">.</font><font color="#000000">blueprint</font><font color="#4000C0">.</font><font color="#000000">load_mesh</font><font color="#4000C0">(</font><font color="#000000">xrayout</font><font color="#4000C0">,</font> <font color="#000000">conduit_db</font><font color="#4000C0">)</font>

    <font color="#000000">time</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/time"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_Time"</font><font color="#4000C0">,</font> <font color="#000000">time</font><font color="#4000C0">,</font> <font color="#0080C0">4.8</font><font color="#4000C0">)</font>

    <font color="#000000">cycle</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/cycle"</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_Cycle"</font><font color="#4000C0">,</font> <font color="#000000">cycle</font><font color="#4000C0">,</font> <font color="#0080C0">48</font><font color="#4000C0">)</font>

    <font color="#000000">test_bp_state_xray_view</font><font color="#4000C0">(</font><font color="#000000">testname</font><font color="#4000C0">,</font> <font color="#000000">xrayout</font><font color="#4000C0">)</font>
    <font color="#000000">test_bp_state_xray_query</font><font color="#4000C0">(</font><font color="#000000">testname</font><font color="#4000C0">,</font> <font color="#000000">xrayout</font><font color="#4000C0">,</font> <font color="#000000">units</font><font color="#4000C0">)</font>
    <font color="#000000">test_bp_state_xray_data</font><font color="#4000C0">(</font><font color="#000000">testname</font><font color="#4000C0">,</font> <font color="#000000">xrayout</font><font color="#4000C0">,</font> <font color="#000000">bin_state</font><font color="#4000C0">)</font>

    <font color="#000000">xunits</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/coordsets/image_coords/units/x"</font><font color="#4000C0">]</font>
    <font color="#000000">yunits</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/coordsets/image_coords/units/y"</font><font color="#4000C0">]</font>
    <font color="#000000">zunits</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/coordsets/image_coords/units/z"</font><font color="#4000C0">]</font>

    <font color="#000000">intensityUnits</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/fields/intensities/units"</font><font color="#4000C0">]</font>
    <font color="#000000">pathLengthUnits</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/fields/path_length/units"</font><font color="#4000C0">]</font>

    <font color="#C00000">if</font> <font color="#4000C0">(</font><font color="#000000">units</font> <font color="#4000C0">==</font> <font color="#000000">UNITS_ON</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_XUnits"</font><font color="#4000C0">,</font> <font color="#000000">xunits</font><font color="#4000C0">,</font> <font color="#008000">"cm"</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_YUnits"</font><font color="#4000C0">,</font> <font color="#000000">yunits</font><font color="#4000C0">,</font> <font color="#008000">"cm"</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_ZUnits"</font><font color="#4000C0">,</font> <font color="#000000">zunits</font><font color="#4000C0">,</font> <font color="#008000">"kev"</font><font color="#4000C0">)</font>

        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_IntensityUnits"</font><font color="#4000C0">,</font> <font color="#000000">intensityUnits</font><font color="#4000C0">,</font> <font color="#008000">"intensity units"</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_PathLengthUnits"</font><font color="#4000C0">,</font> <font color="#000000">pathLengthUnits</font><font color="#4000C0">,</font> <font color="#008000">"path length metadata"</font><font color="#4000C0">)</font>
    <font color="#C00000">else</font><font color="#4000C0">:</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_XUnits"</font><font color="#4000C0">,</font> <font color="#000000">xunits</font><font color="#4000C0">,</font> <font color="#008000">"no units provided"</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_YUnits"</font><font color="#4000C0">,</font> <font color="#000000">yunits</font><font color="#4000C0">,</font> <font color="#008000">"no units provided"</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_ZUnits"</font><font color="#4000C0">,</font> <font color="#000000">zunits</font><font color="#4000C0">,</font> <font color="#008000">"no units provided"</font><font color="#4000C0">)</font>

        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_IntensityUnits"</font><font color="#4000C0">,</font> <font color="#000000">intensityUnits</font><font color="#4000C0">,</font> <font color="#008000">"no units provided"</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_PathLengthUnits"</font><font color="#4000C0">,</font> <font color="#000000">pathLengthUnits</font><font color="#4000C0">,</font> <font color="#008000">"no info provided"</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">blueprint_test</font><font color="#4000C0">(</font><font color="#000000">output_type</font><font color="#4000C0">,</font> <font color="#000000">outdir</font><font color="#4000C0">,</font> <font color="#000000">testtextnumber</font><font color="#4000C0">,</font> <font color="#000000">testname</font><font color="#4000C0">,</font> <font color="#000000">hdf5</font> <font color="#4000C0">=</font> <font color="#C00000">False</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">for</font> <font color="#000000">i</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">2</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">setup_bp_test</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

        <font color="#a02030"># run query and test the output message</font>
        <font color="#C00000">if</font> <font color="#4000C0">(</font><font color="#000000">i</font> <font color="#4000C0">==</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
            <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#000000">output_type</font><font color="#4000C0">,</font> <font color="#000000">outdir</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">200</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#008000">"d"</font><font color="#4000C0">,</font> <font color="#008000">"p"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
        <font color="#C00000">elif</font> <font color="#4000C0">(</font><font color="#000000">i</font> <font color="#4000C0">==</font> <font color="#0080C0">1</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
            <font color="#000000">params</font> <font color="#4000C0">=</font> <font color="#000000">dict</font><font color="#4000C0">(</font><font color="#4000C0">)</font> <font color="#a02030"># GetQueryParameters("XRay Image")</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"output_type"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">output_type</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"output_dir"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">outdir</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"divide_emis_by_absorb"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font><font color="#4000C0">;</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"origin"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.0</font><font color="#4000C0">)</font><font color="#4000C0">;</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"theta"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font><font color="#4000C0">;</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"phi"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font><font color="#4000C0">;</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"width"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">10.</font><font color="#4000C0">;</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"height"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">10.</font><font color="#4000C0">;</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"image_size"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">200</font><font color="#4000C0">)</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"vars"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">"d"</font><font color="#4000C0">,</font> <font color="#008000">"p"</font><font color="#4000C0">)</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"spatial_units"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">"cm"</font><font color="#4000C0">;</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"energy_units"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">"kev"</font><font color="#4000C0">;</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"abs_units"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">"abs units"</font><font color="#4000C0">;</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"emis_units"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">"emis units"</font><font color="#4000C0">;</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"intensity_units"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">"intensity units"</font><font color="#4000C0">;</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"path_length_units"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">"path length metadata"</font><font color="#4000C0">;</font>
            <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>
        <font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"xrayimage"</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">testtextnumber</font> <font color="#4000C0">+</font> <font color="#000000">i</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">"curv3d.silo"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

        <font color="#a02030"># test opening the bp output and visualizing in visit</font>
        <font color="#000000">conduit_db</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">outdir</font><font color="#4000C0">,</font> <font color="#008000">"output.root"</font><font color="#4000C0">)</font>
        <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">conduit_db</font><font color="#4000C0">)</font>
        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"mesh_image_topo/intensities"</font><font color="#4000C0">)</font>
        <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">i</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">conduit_db</font><font color="#4000C0">)</font>

    <font color="#C00000">if</font> <font color="#4000C0">(</font><font color="#000000">hdf5</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">units</font> <font color="#4000C0">=</font> <font color="#000000">UNITS_OFF</font> <font color="#C00000">if</font> <font color="#000000">i</font> <font color="#4000C0">==</font> <font color="#0080C0">0</font> <font color="#C00000">else</font> <font color="#000000">UNITS_ON</font>
        <font color="#000000">test_bp_state</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">i</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">conduit_db</font><font color="#4000C0">,</font> <font color="#000000">NO_ENERGY_GROUP_BOUNDS</font><font color="#4000C0">,</font> <font color="#000000">units</font><font color="#4000C0">)</font> <font color="#a02030"># no bounds</font>
        <font color="#000000">setup_bp_test</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#000000">output_type</font><font color="#4000C0">,</font> <font color="#000000">outdir</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">200</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#008000">"d"</font><font color="#4000C0">,</font> <font color="#008000">"p"</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">,</font><font color="#0080C0">2</font><font color="#4000C0">,</font><font color="#0080C0">3</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
        <font color="#000000">test_bp_state</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">i</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">conduit_db</font><font color="#4000C0">,</font> <font color="#000000">ENERGY_GROUP_BOUNDS_MISMATCH</font><font color="#4000C0">,</font> <font color="#000000">UNITS_OFF</font><font color="#4000C0">)</font> <font color="#a02030"># bounds mismatch</font>
        <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#000000">output_type</font><font color="#4000C0">,</font> <font color="#000000">outdir</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">200</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#008000">"d"</font><font color="#4000C0">,</font> <font color="#008000">"p"</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#0080C0">3.7</font><font color="#4000C0">,</font> <font color="#0080C0">4.2</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
        <font color="#000000">test_bp_state</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">i</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">conduit_db</font><font color="#4000C0">,</font> <font color="#000000">ENERGY_GROUP_BOUNDS</font><font color="#4000C0">,</font> <font color="#000000">UNITS_OFF</font><font color="#4000C0">)</font> <font color="#a02030"># bounds</font>
        <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">"curv3d.silo"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">blueprint_test</font><font color="#4000C0">(</font><font color="#008000">"hdf5"</font><font color="#4000C0">,</font> <font color="#000000">conduit_dir_hdf5</font><font color="#4000C0">,</font> <font color="#0080C0">32</font><font color="#4000C0">,</font> <font color="#008000">"Blueprint_HDF5_X_Ray_Output"</font><font color="#4000C0">,</font> <font color="#C00000">True</font><font color="#4000C0">)</font>
<font color="#000000">blueprint_test</font><font color="#4000C0">(</font><font color="#008000">"json"</font><font color="#4000C0">,</font> <font color="#000000">conduit_dir_json</font><font color="#4000C0">,</font> <font color="#0080C0">34</font><font color="#4000C0">,</font> <font color="#008000">"Blueprint_JSON_X_Ray_Output"</font><font color="#4000C0">,</font> <font color="#C00000">False</font><font color="#4000C0">)</font>
<font color="#000000">blueprint_test</font><font color="#4000C0">(</font><font color="#008000">"yaml"</font><font color="#4000C0">,</font> <font color="#000000">conduit_dir_yaml</font><font color="#4000C0">,</font> <font color="#0080C0">36</font><font color="#4000C0">,</font> <font color="#008000">"Blueprint_YAML_X_Ray_Output"</font><font color="#4000C0">,</font> <font color="#C00000">False</font><font color="#4000C0">)</font>

<font color="#a02030"># test detector height and width are always positive in blueprint output</font>

<font color="#000000">setup_bp_test</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">params</font> <font color="#4000C0">=</font> <font color="#000000">dict</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"image_size"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">400</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">)</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"output_type"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">"hdf5"</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"output_dir"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">conduit_dir_detector_dims</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"focus"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">)</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"perspective"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"near_plane"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">50.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"far_plane"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">50.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"vars"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">"d"</font><font color="#4000C0">,</font> <font color="#008000">"p"</font><font color="#4000C0">)</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"energy_group_bounds"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#0080C0">3.7</font><font color="#4000C0">,</font> <font color="#0080C0">4.2</font><font color="#4000C0">]</font><font color="#4000C0">;</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"parallel_scale"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">5.</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">"curv3d.silo"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">conduit_db</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_detector_dims</font><font color="#4000C0">,</font> <font color="#008000">"output.root"</font><font color="#4000C0">)</font>
<font color="#000000">xrayout</font> <font color="#4000C0">=</font> <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">Node</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">relay</font><font color="#4000C0">.</font><font color="#000000">io</font><font color="#4000C0">.</font><font color="#000000">blueprint</font><font color="#4000C0">.</font><font color="#000000">load_mesh</font><font color="#4000C0">(</font><font color="#000000">xrayout</font><font color="#4000C0">,</font> <font color="#000000">conduit_db</font><font color="#4000C0">)</font>

<font color="#000000">detectorWidth</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_data/detectorWidth"</font><font color="#4000C0">]</font>
<font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">"Blueprint_Positive_DetectorWidth"</font><font color="#4000C0">,</font> <font color="#000000">detectorWidth</font><font color="#4000C0">,</font> <font color="#0080C0">22.3932263237838</font><font color="#4000C0">)</font>

<font color="#000000">detectorHeight</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">"domain_000000/state/xray_data/detectorHeight"</font><font color="#4000C0">]</font>
<font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">"Blueprint_Positive_DetectorHeight"</font><font color="#4000C0">,</font> <font color="#000000">detectorHeight</font><font color="#4000C0">,</font> <font color="#0080C0">16.7949192423103</font><font color="#4000C0">)</font>

<font color="#a02030"># test imaging plane topos</font>

<font color="#000000">setup_bp_test</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">params</font> <font color="#4000C0">=</font> <font color="#000000">dict</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"image_size"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">400</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">)</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"output_dir"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">conduit_dir_imaging_planes</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"output_type"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">"hdf5"</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"focus"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">)</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"perspective"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"near_plane"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">50.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"far_plane"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">50.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"vars"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">"d"</font><font color="#4000C0">,</font> <font color="#008000">"p"</font><font color="#4000C0">)</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"parallel_scale"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">5.</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">conduit_db</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_imaging_planes</font><font color="#4000C0">,</font> <font color="#008000">"output.root"</font><font color="#4000C0">)</font>

<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">conduit_db</font><font color="#4000C0">)</font>

<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"mesh_far_plane_topo/far_plane_field"</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"mesh_view_plane_topo/view_plane_field"</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"mesh_near_plane_topo/near_plane_field"</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">SetActivePlots</font><font color="#4000C0">(</font><font color="#0080C0">4</font><font color="#4000C0">)</font>
<font color="#000000">PseudocolorAtts</font> <font color="#4000C0">=</font> <font color="#000000">PseudocolorAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">PseudocolorAtts</font><font color="#4000C0">.</font><font color="#000000">invertColorTable</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
<font color="#000000">PseudocolorAtts</font><font color="#4000C0">.</font><font color="#000000">opacityType</font> <font color="#4000C0">=</font> <font color="#000000">PseudocolorAtts</font><font color="#4000C0">.</font><font color="#000000">FullyOpaque</font>  <font color="#a02030"># ColorTable, FullyOpaque, Constant, Ramp, VariableRange</font>
<font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">PseudocolorAtts</font><font color="#4000C0">)</font>

<font color="#000000">View3DAtts</font> <font color="#4000C0">=</font> <font color="#000000">View3DAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">viewNormal</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#4000C0">-</font><font color="#0080C0">0.519145</font><font color="#4000C0">,</font> <font color="#0080C0">0.199692</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">0.831031</font><font color="#4000C0">)</font>
<font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">focus</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10</font><font color="#4000C0">)</font>
<font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">viewUp</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#4000C0">-</font><font color="#0080C0">0.0954901</font><font color="#4000C0">,</font> <font color="#0080C0">0.952683</font><font color="#4000C0">,</font> <font color="#0080C0">0.288577</font><font color="#4000C0">)</font>
<font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">viewAngle</font> <font color="#4000C0">=</font> <font color="#0080C0">30</font>
<font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">parallelScale</font> <font color="#4000C0">=</font> <font color="#0080C0">58.6531</font>
<font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">nearPlane</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">117.306</font>
<font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">farPlane</font> <font color="#4000C0">=</font> <font color="#0080C0">117.306</font>
<font color="#000000">SetView3D</font><font color="#4000C0">(</font><font color="#000000">View3DAtts</font><font color="#4000C0">)</font>

<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"Blueprint_HDF5_Imaging_Planes"</font><font color="#4000C0">)</font>

<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">"curv3d.silo"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">conduit_db</font><font color="#4000C0">)</font>

<font color="#a02030"># </font>
<font color="#a02030"># test catching failures</font>
<font color="#a02030"># </font>

<font color="#a02030"># write to dir that does not exist</font>

<font color="#000000">dir_dne</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">,</font> <font color="#008000">"doesnotexist"</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">dir_dne</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rmdir</font><font color="#4000C0">(</font><font color="#000000">dir_dne</font><font color="#4000C0">)</font>

<font color="#000000">setup_bp_test</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#008000">"hdf5"</font><font color="#4000C0">,</font> <font color="#000000">dir_dne</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#008000">"d"</font><font color="#4000C0">,</font> <font color="#008000">"p"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"xrayimage38"</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">"curv3d.silo"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#a02030"># os.chmod does not work on windows</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">platform</font><font color="#4000C0">.</font><font color="#000000">system</font><font color="#4000C0">(</font><font color="#4000C0">)</font> <font color="#4000C0">==</font> <font color="#008000">"Windows"</font><font color="#4000C0">:</font>
    <font color="#a02030"># write to dir w/ read only permissions</font>

    <font color="#000000">outdir_bad</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">,</font> <font color="#008000">"baddir"</font><font color="#4000C0">)</font>
    <font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">outdir_bad</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">outdir_bad</font><font color="#4000C0">)</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">chmod</font><font color="#4000C0">(</font><font color="#000000">outdir_bad</font><font color="#4000C0">,</font> <font color="#0080C0">0o444</font><font color="#4000C0">)</font>

    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">"curv3d.silo"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"d"</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#008000">"hdf5"</font><font color="#4000C0">,</font> <font color="#000000">outdir_bad</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#008000">"d"</font><font color="#4000C0">,</font> <font color="#008000">"p"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#a02030"># strip out two lines that make the test machine dependent</font>
    <font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#008000">'\n'</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#4000C0">[</font><font color="#000000">line</font> <font color="#C00000">if</font> <font color="#000000">line</font><font color="#4000C0">[</font><font color="#4000C0">:</font><font color="#0080C0">4</font><font color="#4000C0">]</font> <font color="#4000C0">!=</font> <font color="#008000">"file"</font> <font color="#C00000">else</font> <font color="#008000">''</font> <font color="#C00000">for</font> <font color="#000000">line</font> <font color="#C00000">in</font> <font color="#000000">s</font><font color="#4000C0">.</font><font color="#000000">split</font><font color="#4000C0">(</font><font color="#008000">'\n'</font><font color="#4000C0">)</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#008000">'\n'</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#4000C0">[</font><font color="#000000">line</font> <font color="#C00000">if</font> <font color="#000000">line</font><font color="#4000C0">[</font><font color="#4000C0">:</font><font color="#0080C0">4</font><font color="#4000C0">]</font> <font color="#4000C0">!=</font> <font color="#008000">"line"</font> <font color="#C00000">else</font> <font color="#008000">''</font> <font color="#C00000">for</font> <font color="#000000">line</font> <font color="#C00000">in</font> <font color="#000000">s</font><font color="#4000C0">.</font><font color="#000000">split</font><font color="#4000C0">(</font><font color="#008000">'\n'</font><font color="#4000C0">)</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"xrayimage39"</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">"curv3d.silo"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#a02030"># </font>
<font color="#a02030"># Test filenames and output types</font>
<font color="#a02030"># </font>

<font color="#000000">setup_bp_test</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"d1"</font><font color="#4000C0">,</font> <font color="#008000">'recenter(d, "zonal")'</font><font color="#4000C0">)</font>
<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"p1"</font><font color="#4000C0">,</font> <font color="#008000">'recenter(p, "zonal")'</font><font color="#4000C0">)</font>

<font color="#000000">DefineArrayExpression</font><font color="#4000C0">(</font><font color="#008000">"da"</font><font color="#4000C0">,</font> <font color="#008000">"array_compose(d1,d1)"</font><font color="#4000C0">)</font>
<font color="#000000">DefineArrayExpression</font><font color="#4000C0">(</font><font color="#008000">"pa"</font><font color="#4000C0">,</font> <font color="#008000">"array_compose(p1,p1)"</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">query_variety</font><font color="#4000C0">(</font><font color="#000000">otype</font><font color="#4000C0">,</font> <font color="#000000">scheme</font><font color="#4000C0">,</font> <font color="#000000">thevars</font><font color="#4000C0">,</font> <font color="#000000">outdir</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">SetQueryFloatFormat</font><font color="#4000C0">(</font><font color="#008000">"%g"</font><font color="#4000C0">)</font>
    <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font>
        <font color="#000000">background_intensity</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
        <font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
        <font color="#000000">far_plane</font><font color="#4000C0">=</font><font color="#0080C0">20</font><font color="#4000C0">,</font>
        <font color="#000000">filename_scheme</font><font color="#4000C0">=</font><font color="#000000">scheme</font><font color="#4000C0">,</font>
        <font color="#000000">family_files</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#a02030"># this is to test that family_files is ignored when filename_scheme is set</font>
        <font color="#000000">focus</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
        <font color="#000000">image_pan</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
        <font color="#000000">image_size</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">3</font><font color="#4000C0">,</font> <font color="#0080C0">3</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
        <font color="#000000">image_zoom</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font>
        <font color="#000000">near_plane</font><font color="#4000C0">=</font><font color="#4000C0">-</font><font color="#0080C0">20</font><font color="#4000C0">,</font>
        <font color="#000000">normal</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
        <font color="#000000">output_dir</font><font color="#4000C0">=</font><font color="#000000">outdir</font><font color="#4000C0">,</font>
        <font color="#000000">output_ray_bounds</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
        <font color="#000000">output_type</font><font color="#4000C0">=</font><font color="#000000">otype</font><font color="#4000C0">,</font>
        <font color="#000000">parallel_scale</font><font color="#4000C0">=</font><font color="#0080C0">10</font><font color="#4000C0">,</font>
        <font color="#000000">perspective</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
        <font color="#000000">view_angle</font><font color="#4000C0">=</font><font color="#0080C0">30</font><font color="#4000C0">,</font>
        <font color="#000000">view_up</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
        <font color="#000000">vars</font><font color="#4000C0">=</font><font color="#000000">thevars</font><font color="#4000C0">)</font>
    <font color="#C00000">return</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">query_family_backwards_compat</font><font color="#4000C0">(</font><font color="#000000">family</font><font color="#4000C0">,</font> <font color="#000000">thevars</font><font color="#4000C0">,</font> <font color="#000000">outdir</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">SetQueryFloatFormat</font><font color="#4000C0">(</font><font color="#008000">"%g"</font><font color="#4000C0">)</font>
    <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font>
        <font color="#000000">background_intensity</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
        <font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
        <font color="#000000">far_plane</font><font color="#4000C0">=</font><font color="#0080C0">20</font><font color="#4000C0">,</font>
        <font color="#000000">family_files</font><font color="#4000C0">=</font><font color="#000000">family</font><font color="#4000C0">,</font>
        <font color="#000000">focus</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
        <font color="#000000">image_pan</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
        <font color="#000000">image_size</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">3</font><font color="#4000C0">,</font> <font color="#0080C0">3</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
        <font color="#000000">image_zoom</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font>
        <font color="#000000">near_plane</font><font color="#4000C0">=</font><font color="#4000C0">-</font><font color="#0080C0">20</font><font color="#4000C0">,</font>
        <font color="#000000">normal</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
        <font color="#000000">output_dir</font><font color="#4000C0">=</font><font color="#000000">outdir</font><font color="#4000C0">,</font>
        <font color="#000000">output_ray_bounds</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
        <font color="#000000">output_type</font><font color="#4000C0">=</font><font color="#008000">"png"</font><font color="#4000C0">,</font>
        <font color="#000000">parallel_scale</font><font color="#4000C0">=</font><font color="#0080C0">10</font><font color="#4000C0">,</font>
        <font color="#000000">perspective</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
        <font color="#000000">view_angle</font><font color="#4000C0">=</font><font color="#0080C0">30</font><font color="#4000C0">,</font>
        <font color="#000000">view_up</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
        <font color="#000000">vars</font><font color="#4000C0">=</font><font color="#000000">thevars</font><font color="#4000C0">)</font>
    <font color="#C00000">return</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">output_types</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#008000">"jpeg"</font><font color="#4000C0">,</font> <font color="#008000">"png"</font><font color="#4000C0">,</font> <font color="#008000">"tif"</font><font color="#4000C0">,</font> <font color="#008000">"bof"</font><font color="#4000C0">,</font> <font color="#008000">"bov"</font><font color="#4000C0">,</font> <font color="#008000">"json"</font><font color="#4000C0">,</font> <font color="#008000">"hdf5"</font><font color="#4000C0">,</font> <font color="#008000">"yaml"</font><font color="#4000C0">]</font>
<font color="#000000">filename_schemes</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#008000">"family"</font><font color="#4000C0">,</font> <font color="#008000">"family"</font><font color="#4000C0">,</font> <font color="#008000">"cycle"</font><font color="#4000C0">,</font> <font color="#008000">"none"</font><font color="#4000C0">]</font>
<font color="#000000">family_options</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">]</font>
<font color="#000000">vars_options</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#4000C0">(</font><font color="#008000">"d"</font><font color="#4000C0">,</font> <font color="#008000">"p"</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#008000">"da"</font><font color="#4000C0">,</font> <font color="#008000">"pa"</font><font color="#4000C0">)</font><font color="#4000C0">]</font>

<font color="#000000">info</font> <font color="#4000C0">=</font> <font color="#008000">""</font>
<font color="#C00000">for</font> <font color="#000000">i</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">output_types</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">outdir_set_otype</font> <font color="#4000C0">=</font> <font color="#000000">outdir_set</font> <font color="#4000C0">+</font> <font color="#008000">"_"</font> <font color="#4000C0">+</font> <font color="#000000">output_types</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font>
    <font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">outdir_set_otype</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">outdir_set_otype</font><font color="#4000C0">)</font>
    <font color="#C00000">if</font> <font color="#000000">output_types</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font> <font color="#4000C0">==</font> <font color="#008000">"jpeg"</font><font color="#4000C0">:</font>
        <font color="#a02030"># create a dummy file to test the file familying</font>
        <font color="#000000">open</font><font color="#4000C0">(</font><font color="#000000">outdir_set_otype</font> <font color="#4000C0">+</font> <font color="#008000">"/output.0000.jpg"</font><font color="#4000C0">,</font> <font color="#008000">'w'</font><font color="#4000C0">)</font><font color="#4000C0">.</font><font color="#000000">close</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">info</font> <font color="#4000C0">=</font> <font color="#008000">""</font>
    <font color="#C00000">for</font> <font color="#000000">j</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">filename_schemes</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#C00000">for</font> <font color="#000000">k</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">vars_options</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
            <font color="#000000">info</font> <font color="#4000C0">+=</font> <font color="#000000">query_variety</font><font color="#4000C0">(</font><font color="#000000">output_types</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">filename_schemes</font><font color="#4000C0">[</font><font color="#000000">j</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">vars_options</font><font color="#4000C0">[</font><font color="#000000">k</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">outdir_set_otype</font><font color="#4000C0">)</font>
    <font color="#000000">info</font> <font color="#4000C0">+=</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">listdir</font><font color="#4000C0">(</font><font color="#000000">outdir_set_otype</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"Test_filenames_for_"</font> <font color="#4000C0">+</font> <font color="#000000">output_types</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font> <font color="#4000C0">+</font> <font color="#008000">"_outputs"</font><font color="#4000C0">,</font> <font color="#000000">info</font><font color="#4000C0">)</font>

<font color="#a02030"># test backwards compatibility with family_files option</font>
<font color="#C00000">for</font> <font color="#000000">i</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">family_options</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">outdir_set_family</font> <font color="#4000C0">=</font> <font color="#000000">outdir_set</font> <font color="#4000C0">+</font> <font color="#008000">"_family_"</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">family_options</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">outdir_set_family</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">outdir_set_family</font><font color="#4000C0">)</font>
    <font color="#000000">info</font> <font color="#4000C0">=</font> <font color="#008000">""</font>
    <font color="#C00000">for</font> <font color="#000000">j</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">vars_options</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">info</font> <font color="#4000C0">+=</font> <font color="#000000">query_family_backwards_compat</font><font color="#4000C0">(</font><font color="#000000">family_options</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">vars_options</font><font color="#4000C0">[</font><font color="#000000">j</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">outdir_set_family</font><font color="#4000C0">)</font>
    <font color="#000000">info</font> <font color="#4000C0">+=</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">listdir</font><font color="#4000C0">(</font><font color="#000000">outdir_set_family</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"Test_filenames_for_family"</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">family_options</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font><font color="#4000C0">)</font> <font color="#4000C0">+</font> <font color="#008000">"_outputs"</font><font color="#4000C0">,</font> <font color="#000000">info</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Test that we get decent error messages for common cases</font>
<font color="#a02030">#</font>
<font color="#C00000">import</font> <font color="#000000">numpy</font>

<font color="#000000">nporig</font> <font color="#4000C0">=</font> <font color="#000000">numpy</font><font color="#4000C0">.</font><font color="#000000">array</font><font color="#4000C0">(</font><font color="#4000C0">[</font><font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.0</font><font color="#4000C0">]</font><font color="#4000C0">)</font>

<font color="#000000">params</font> <font color="#4000C0">=</font> <font color="#000000">dict</font><font color="#4000C0">(</font><font color="#000000">output_type</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#000000">output_dir</font><font color="#4000C0">=</font><font color="#008000">"."</font><font color="#4000C0">,</font> <font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font> \
    <font color="#000000">origin</font><font color="#4000C0">=</font><font color="#000000">nporig</font><font color="#4000C0">,</font> <font color="#000000">up_vector</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">theta</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">phi</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font> \
    <font color="#000000">width</font> <font color="#4000C0">=</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#000000">height</font><font color="#4000C0">=</font><font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#000000">image_size</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">vars</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#008000">"da"</font><font color="#4000C0">,</font> <font color="#008000">"pa"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#C00000">try</font><font color="#4000C0">:</font>
    <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>
<font color="#C00000">except</font> <font color="#4000C0">(</font><font color="#000000">visit</font><font color="#4000C0">.</font><font color="#000000">VisItException</font><font color="#4000C0">,</font> <font color="#000000">VisItException</font><font color="#4000C0">)</font> <font color="#C00000">as</font> <font color="#000000">e</font><font color="#4000C0">:</font>
    <font color="#C00000">if</font> <font color="#008000">'"origin"'</font> <font color="#C00000">in</font> <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">args</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font> <font color="#C00000">and</font> <font color="#008000">"position 4"</font> <font color="#C00000">in</font> <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">args</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font> <font color="#C00000">and</font> <font color="#008000">"type numpy.ndarray"</font> <font color="#C00000">in</font> <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">args</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">:</font>
        <font color="#000000">TestPOA</font><font color="#4000C0">(</font><font color="#008000">'detect and warn numpy array as query param'</font><font color="#4000C0">)</font>
    <font color="#C00000">else</font><font color="#4000C0">:</font>
        <font color="#000000">TestFOA</font><font color="#4000C0">(</font><font color="#008000">'detect and warn numpy array as query param'</font><font color="#4000C0">,</font> <font color="#000000">LINE</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#C00000">pass</font>
<font color="#C00000">except</font><font color="#4000C0">:</font>
    <font color="#000000">TestFOA</font><font color="#4000C0">(</font><font color="#008000">'detect and warn numpy array as query param'</font><font color="#4000C0">,</font> <font color="#000000">LINE</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#C00000">pass</font>

<font color="#000000">params</font> <font color="#4000C0">=</font> <font color="#000000">dict</font><font color="#4000C0">(</font><font color="#000000">output_type</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#000000">output_dir</font><font color="#4000C0">=</font><font color="#008000">"."</font><font color="#4000C0">,</font> <font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font> \
    <font color="#000000">origin</font><font color="#4000C0">=</font><font color="#000000">nporig</font><font color="#4000C0">.</font><font color="#000000">tolist</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">up_vector</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">theta</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">phi</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font> \
    <font color="#000000">width</font> <font color="#4000C0">=</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#000000">height</font><font color="#4000C0">=</font><font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#000000">image_size</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">vars</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#008000">"da"</font><font color="#4000C0">,</font> <font color="#008000">"pa"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#C00000">try</font><font color="#4000C0">:</font>
    <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"XRay Image"</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>
    <font color="#000000">TestPOA</font><font color="#4000C0">(</font><font color="#008000">'numpy array converted to list works as query param'</font><font color="#4000C0">)</font>
<font color="#C00000">except</font><font color="#4000C0">:</font>
    <font color="#000000">TestFOA</font><font color="#4000C0">(</font><font color="#008000">'numpy array converted to list works as query param'</font><font color="#4000C0">,</font> <font color="#000000">LINE</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#C00000">pass</font>

<font color="#000000">Exit</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000"></font></font></pre></body></html>