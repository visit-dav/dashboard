<html><body bgcolor="#e0e0e0"><head><title>queries/flatten.py</title></head><pre><font face="Lucida,Courier New"><font color="#a02030"># ----------------------------------------------------------------------------</font>
<font color="#a02030">#  MODES: serial parallel</font>
<font color="#a02030">#  CLASSES: nightly</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Test Case:  flatten.py</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Tests:      Tests CLI Flatten() function</font>
<font color="#a02030">#              (which is avtFlattenQuery underneath)</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Programmer: Christopher Laganella</font>
<font color="#a02030">#  Date:       Fri Feb  4 17:07:24 EST 2022</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Modifications:</font>
<font color="#a02030">#</font>
<font color="#a02030"># ----------------------------------------------------------------------------</font>
<font color="#C00000">try</font><font color="#4000C0">:</font>
    <font color="#C00000">import</font> <font color="#000000">numpy</font> <font color="#C00000">as</font> <font color="#000000">np</font>
    <font color="#000000">haveNumpy</font> <font color="#4000C0">=</font> <font color="#C00000">True</font>
<font color="#C00000">except</font><font color="#4000C0">:</font>
    <font color="#000000">haveNumpy</font> <font color="#4000C0">=</font> <font color="#C00000">False</font>

<font color="#C00000">import</font> <font color="#000000">os</font>

<font color="#a02030"># NOTE: The following few functions are useful for running this test</font>
<font color="#a02030">#  script through the regular visit CLI</font>
<font color="#a02030"># def silo_data_path(name):</font>
<font color="#a02030">#     return os.path.join("/home/cdl/Development/visit/visit/data/silo_hdf5_test_data",</font>
<font color="#a02030">#         name)</font>

<font color="#a02030"># def Exit():</font>
<font color="#a02030">#     exit()</font>

<font color="#a02030"># def TestSection(name):</font>
<font color="#a02030">#     print(name)</font>

<font color="#a02030"># def TestText(baseline_file, value):</font>
<font color="#a02030">#     print("Loading up baseline file %s" % os.path.abspath(baseline_file))</font>

<font color="#a02030"># def TestValueEQ(name, v0, v1):</font>
<font color="#a02030">#     assert v0 == v1, str(name) + ": " + str(v0) + " != " + str(v1)</font>

<font color="#a02030"># def TestValueIN(name, d, k):</font>
<font color="#a02030">#     assert k in d, str(name) + ": " + str(v0) + " !in " + str(v1)</font>

<font color="#000000">n</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
<font color="#000000">basicTestCases</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font>
    <font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">'rect2d.silo'</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#008000">'quadmesh2d'</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
    <font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">'rect3d.silo'</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#008000">'quadmesh3d'</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
    <font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">'curv2d.silo'</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#008000">'curvmesh2d'</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
    <font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">'curv3d.silo'</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#008000">'curvmesh3d'</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
    <font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">'ucd2d.silo'</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#008000">'ucdmesh2d'</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
    <font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">'ucd3d.silo'</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#008000">'ucdmesh3d'</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
<font color="#4000C0">)</font>


<font color="#C00000">def</font> <font color="#000000">load_text</font><font color="#4000C0">(</font><font color="#000000">name</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">fname</font> <font color="#4000C0">=</font> <font color="#000000">name</font> <font color="#4000C0">+</font> <font color="#008000">'.txt'</font>
    <font color="#000000">print</font><font color="#4000C0">(</font><font color="#008000">"Loading up current file %s"</font> <font color="#4000C0">%</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">abspath</font><font color="#4000C0">(</font><font color="#000000">fname</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#C00000">with</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#000000">fname</font><font color="#4000C0">)</font> <font color="#C00000">as</font> <font color="#000000">f</font><font color="#4000C0">:</font>
        <font color="#C00000">return</font> <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">read</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">define_mesh_expressions</font><font color="#4000C0">(</font><font color="#000000">mesh_name</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"nid"</font><font color="#4000C0">,</font> <font color="#008000">"nodeid({})"</font><font color="#4000C0">.</font><font color="#000000">format</font><font color="#4000C0">(</font><font color="#000000">mesh_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"zid"</font><font color="#4000C0">,</font> <font color="#008000">"zoneid({})"</font><font color="#4000C0">.</font><font color="#000000">format</font><font color="#4000C0">(</font><font color="#000000">mesh_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">DefineVectorExpression</font><font color="#4000C0">(</font><font color="#008000">"vec_nid"</font><font color="#4000C0">,</font> <font color="#008000">"{-nid,nid,-nid}"</font><font color="#4000C0">)</font>
    <font color="#000000">DefineVectorExpression</font><font color="#4000C0">(</font><font color="#008000">"vec_zid"</font><font color="#4000C0">,</font> <font color="#008000">"{-zid,zid,-zid}"</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">test_basic_table</font><font color="#4000C0">(</font><font color="#000000">table</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">data</font> <font color="#4000C0">=</font> <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">asarray</font><font color="#4000C0">(</font><font color="#000000">table</font><font color="#4000C0">)</font>
    <font color="#000000">ncol</font> <font color="#4000C0">=</font> <font color="#000000">data</font><font color="#4000C0">.</font><font color="#000000">shape</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">"NumCols"</font><font color="#4000C0">,</font> <font color="#000000">ncol</font><font color="#4000C0">,</font> <font color="#0080C0">6</font><font color="#4000C0">)</font>

    <font color="#000000">badCol0</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">1</font>
    <font color="#000000">badCol1</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">1</font>
    <font color="#000000">badCol2</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">1</font>
    <font color="#000000">badCol3</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">1</font>
    <font color="#000000">badCol4</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">1</font>
    <font color="#000000">badCol5</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">1</font>
    <font color="#000000">nrow</font> <font color="#4000C0">=</font> <font color="#000000">data</font><font color="#4000C0">.</font><font color="#000000">shape</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font>
    <font color="#C00000">for</font> <font color="#000000">i</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">nrow</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">badCol0</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">1</font> <font color="#C00000">if</font> <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">isclose</font><font color="#4000C0">(</font><font color="#000000">data</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">,</font>  <font color="#000000">i</font><font color="#4000C0">)</font> <font color="#C00000">and</font> <font color="#000000">badCol0</font> <font color="#4000C0">&lt;</font> <font color="#0080C0">0</font> <font color="#C00000">else</font> <font color="#000000">i</font>
        <font color="#000000">badCol1</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">1</font> <font color="#C00000">if</font> <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">isclose</font><font color="#4000C0">(</font><font color="#000000">data</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#000000">i</font><font color="#4000C0">)</font> <font color="#C00000">and</font> <font color="#000000">badCol1</font> <font color="#4000C0">&lt;</font> <font color="#0080C0">0</font> <font color="#C00000">else</font> <font color="#000000">i</font>
        <font color="#000000">badCol2</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">1</font> <font color="#C00000">if</font> <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">isclose</font><font color="#4000C0">(</font><font color="#000000">data</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">,</font> <font color="#0080C0">2</font><font color="#4000C0">]</font><font color="#4000C0">,</font>  <font color="#000000">i</font><font color="#4000C0">)</font> <font color="#C00000">and</font> <font color="#000000">badCol2</font> <font color="#4000C0">&lt;</font> <font color="#0080C0">0</font> <font color="#C00000">else</font> <font color="#000000">i</font>
        <font color="#000000">badCol3</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">1</font> <font color="#C00000">if</font> <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">isclose</font><font color="#4000C0">(</font><font color="#000000">data</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">,</font> <font color="#0080C0">3</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#000000">i</font><font color="#4000C0">)</font> <font color="#C00000">and</font> <font color="#000000">badCol3</font> <font color="#4000C0">&lt;</font> <font color="#0080C0">0</font> <font color="#C00000">else</font> <font color="#000000">i</font>
        <font color="#000000">badCol4</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">1</font> <font color="#C00000">if</font> <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">isclose</font><font color="#4000C0">(</font><font color="#000000">data</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">,</font> <font color="#0080C0">4</font><font color="#4000C0">]</font><font color="#4000C0">,</font>  <font color="#000000">i</font><font color="#4000C0">)</font> <font color="#C00000">and</font> <font color="#000000">badCol4</font> <font color="#4000C0">&lt;</font> <font color="#0080C0">0</font> <font color="#C00000">else</font> <font color="#000000">i</font>
        <font color="#a02030"># All the of the basic tests should be 1 domain</font>
        <font color="#000000">badCol5</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">1</font> <font color="#C00000">if</font> <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">isclose</font><font color="#4000C0">(</font><font color="#000000">data</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">,</font> <font color="#0080C0">5</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font> <font color="#C00000">and</font> <font color="#000000">badCol5</font> <font color="#4000C0">&lt;</font> <font color="#0080C0">0</font> <font color="#C00000">else</font> <font color="#000000">i</font>

    <font color="#C00000">if</font> <font color="#000000">badCol0</font> <font color="#4000C0">&gt;</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">:</font>
        <font color="#C00000">global</font> <font color="#000000">n</font>
        <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">savetxt</font><font color="#4000C0">(</font><font color="#008000">"table%d.csv"</font> <font color="#4000C0">%</font> <font color="#000000">n</font><font color="#4000C0">,</font> <font color="#000000">data</font><font color="#4000C0">,</font> <font color="#000000">delimiter</font><font color="#4000C0">=</font><font color="#008000">','</font><font color="#4000C0">)</font>
        <font color="#000000">n</font> <font color="#4000C0">=</font> <font color="#000000">n</font> <font color="#4000C0">+</font> <font color="#0080C0">1</font>

    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">"TestDataCol0"</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#000000">badCol0</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">"TestDataCol1"</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#000000">badCol1</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">"TestDataCol2"</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#000000">badCol2</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">"TestDataCol3"</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#000000">badCol3</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">"TestDataCol4"</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#000000">badCol4</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">run_basic_test</font><font color="#4000C0">(</font><font color="#000000">db_name</font><font color="#4000C0">,</font> <font color="#000000">mesh_name</font><font color="#4000C0">,</font> <font color="#000000">test_type</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">db_name</font><font color="#4000C0">)</font>
    <font color="#000000">define_mesh_expressions</font><font color="#4000C0">(</font><font color="#000000">mesh_name</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">'Mesh'</font><font color="#4000C0">,</font> <font color="#000000">mesh_name</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">vars</font> <font color="#4000C0">=</font> <font color="#000000">tuple</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#C00000">if</font> <font color="#000000">test_type</font> <font color="#4000C0">==</font> <font color="#008000">'nz'</font> <font color="#C00000">or</font> <font color="#000000">test_type</font> <font color="#4000C0">==</font> <font color="#008000">'zn'</font><font color="#4000C0">:</font>
        <font color="#000000">vars</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">'nid'</font><font color="#4000C0">,</font> <font color="#008000">'zid'</font><font color="#4000C0">,</font> <font color="#008000">'vec_nid'</font><font color="#4000C0">,</font> <font color="#008000">'vec_zid'</font><font color="#4000C0">)</font>
    <font color="#C00000">elif</font> <font color="#008000">'n'</font> <font color="#C00000">in</font> <font color="#000000">test_type</font><font color="#4000C0">:</font>
        <font color="#000000">vars</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">'nid'</font><font color="#4000C0">,</font> <font color="#008000">'vec_nid'</font><font color="#4000C0">)</font>
    <font color="#C00000">elif</font> <font color="#008000">'z'</font> <font color="#C00000">in</font> <font color="#000000">test_type</font><font color="#4000C0">:</font>
        <font color="#000000">vars</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">'zid'</font><font color="#4000C0">,</font> <font color="#008000">'vec_zid'</font><font color="#4000C0">)</font>

    <font color="#000000">expect_node_table</font> <font color="#4000C0">=</font> <font color="#008000">'n'</font> <font color="#C00000">in</font> <font color="#000000">test_type</font>
    <font color="#000000">expect_zone_table</font> <font color="#4000C0">=</font> <font color="#008000">'z'</font> <font color="#C00000">in</font> <font color="#000000">test_type</font>

    <font color="#000000">tables</font> <font color="#4000C0">=</font> <font color="#000000">Flatten</font><font color="#4000C0">(</font><font color="#000000">vars</font><font color="#4000C0">,</font> <font color="#000000">nodeIds</font><font color="#4000C0">=</font><font color="#000000">expect_node_table</font><font color="#4000C0">,</font>
        <font color="#000000">zoneIds</font><font color="#4000C0">=</font><font color="#000000">expect_zone_table</font><font color="#4000C0">,</font> <font color="#000000">nodeIJK</font><font color="#4000C0">=</font><font color="#C00000">False</font><font color="#4000C0">,</font> <font color="#000000">zoneIJK</font><font color="#4000C0">=</font><font color="#C00000">False</font><font color="#4000C0">)</font>

    <font color="#000000">have_node_table</font> <font color="#4000C0">=</font> <font color="#008000">'nodeTable'</font> <font color="#C00000">in</font> <font color="#000000">tables</font>
    <font color="#C00000">if</font> <font color="#000000">expect_node_table</font><font color="#4000C0">:</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">"ShouldHaveNodeTable"</font><font color="#4000C0">,</font> <font color="#000000">have_node_table</font><font color="#4000C0">,</font> <font color="#C00000">True</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueIN</font><font color="#4000C0">(</font><font color="#008000">"ShouldHaveNodeColumnNames"</font><font color="#4000C0">,</font> <font color="#000000">tables</font><font color="#4000C0">,</font> <font color="#008000">'nodeColumnNames'</font><font color="#4000C0">)</font>
        <font color="#000000">column_names</font> <font color="#4000C0">=</font> <font color="#000000">tables</font><font color="#4000C0">[</font><font color="#008000">'nodeColumnNames'</font><font color="#4000C0">]</font>
        <font color="#a02030"># print(column_names)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">'NodeCol0Name'</font><font color="#4000C0">,</font> <font color="#000000">column_names</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">'nid'</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">'NodeCol1Name'</font><font color="#4000C0">,</font> <font color="#000000">column_names</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">'vec_nid/c0'</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">'NodeCol2Name'</font><font color="#4000C0">,</font> <font color="#000000">column_names</font><font color="#4000C0">[</font><font color="#0080C0">2</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">'vec_nid/c1'</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">'NodeCol3Name'</font><font color="#4000C0">,</font> <font color="#000000">column_names</font><font color="#4000C0">[</font><font color="#0080C0">3</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">'vec_nid/c2'</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">'NodeCol4Name'</font><font color="#4000C0">,</font> <font color="#000000">column_names</font><font color="#4000C0">[</font><font color="#0080C0">4</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">'nodeIds'</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">'NodeCol5Name'</font><font color="#4000C0">,</font> <font color="#000000">column_names</font><font color="#4000C0">[</font><font color="#0080C0">5</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">'nodeDomains'</font><font color="#4000C0">)</font>
        <font color="#000000">test_basic_table</font><font color="#4000C0">(</font><font color="#000000">tables</font><font color="#4000C0">[</font><font color="#008000">'nodeTable'</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#C00000">else</font><font color="#4000C0">:</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">"ShouldNotHaveNodeTable"</font><font color="#4000C0">,</font> <font color="#000000">have_node_table</font><font color="#4000C0">,</font> <font color="#C00000">False</font><font color="#4000C0">)</font>

    <font color="#000000">have_zone_table</font> <font color="#4000C0">=</font> <font color="#008000">'zoneTable'</font> <font color="#C00000">in</font> <font color="#000000">tables</font>
    <font color="#C00000">if</font> <font color="#000000">expect_zone_table</font><font color="#4000C0">:</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">"ShouldHaveZoneTable"</font><font color="#4000C0">,</font> <font color="#000000">have_zone_table</font><font color="#4000C0">,</font> <font color="#C00000">True</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueIN</font><font color="#4000C0">(</font><font color="#008000">"ShouldHaveZoneColumnNames"</font><font color="#4000C0">,</font> <font color="#000000">tables</font><font color="#4000C0">,</font> <font color="#008000">'zoneColumnNames'</font><font color="#4000C0">)</font>
        <font color="#000000">column_names</font> <font color="#4000C0">=</font> <font color="#000000">tables</font><font color="#4000C0">[</font><font color="#008000">'zoneColumnNames'</font><font color="#4000C0">]</font>
        <font color="#a02030"># print(column_names)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">'ZoneCol0Name'</font><font color="#4000C0">,</font> <font color="#000000">column_names</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">'zid'</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">'ZoneCol1Name'</font><font color="#4000C0">,</font> <font color="#000000">column_names</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">'vec_zid/c0'</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">'ZoneCol2Name'</font><font color="#4000C0">,</font> <font color="#000000">column_names</font><font color="#4000C0">[</font><font color="#0080C0">2</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">'vec_zid/c1'</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">'ZoneCol3Name'</font><font color="#4000C0">,</font> <font color="#000000">column_names</font><font color="#4000C0">[</font><font color="#0080C0">3</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">'vec_zid/c2'</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">'ZoneCol4Name'</font><font color="#4000C0">,</font> <font color="#000000">column_names</font><font color="#4000C0">[</font><font color="#0080C0">4</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">'zoneIds'</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">'ZoneCol5Name'</font><font color="#4000C0">,</font> <font color="#000000">column_names</font><font color="#4000C0">[</font><font color="#0080C0">5</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">'zoneDomains'</font><font color="#4000C0">)</font>
        <font color="#000000">test_basic_table</font><font color="#4000C0">(</font><font color="#000000">tables</font><font color="#4000C0">[</font><font color="#008000">'zoneTable'</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#C00000">else</font><font color="#4000C0">:</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">"ShouldNotHaveZoneTable"</font><font color="#4000C0">,</font> <font color="#000000">have_zone_table</font><font color="#4000C0">,</font> <font color="#C00000">False</font><font color="#4000C0">)</font>

    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">db_name</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">test_box</font><font color="#4000C0">(</font><font color="#000000">forceNoShm</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">db_name</font> <font color="#4000C0">=</font> <font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">'multi_rect2d.silo'</font><font color="#4000C0">)</font>
    <font color="#000000">mesh_name</font> <font color="#4000C0">=</font> <font color="#008000">'mesh1'</font>

    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">db_name</font><font color="#4000C0">)</font>
    <font color="#000000">define_mesh_expressions</font><font color="#4000C0">(</font><font color="#000000">mesh_name</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">'Mesh'</font><font color="#4000C0">,</font> <font color="#000000">mesh_name</font><font color="#4000C0">)</font>
    <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">'Box'</font><font color="#4000C0">)</font>
    <font color="#000000">opts</font> <font color="#4000C0">=</font> <font color="#000000">GetOperatorOptions</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">)</font>
    <font color="#000000">opts</font><font color="#4000C0">.</font><font color="#000000">maxy</font> <font color="#4000C0">=</font> <font color="#0080C0">0.1</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">opts</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">vars</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">'vec_nid'</font><font color="#4000C0">,</font> <font color="#008000">'vec_zid'</font><font color="#4000C0">)</font>
    <font color="#000000">tables</font> <font color="#4000C0">=</font> <font color="#000000">Flatten</font><font color="#4000C0">(</font><font color="#000000">vars</font><font color="#4000C0">,</font> <font color="#000000">nodeIds</font><font color="#4000C0">=</font><font color="#C00000">True</font><font color="#4000C0">,</font>
        <font color="#000000">zoneIds</font><font color="#4000C0">=</font><font color="#C00000">True</font><font color="#4000C0">,</font> <font color="#000000">nodeIJK</font><font color="#4000C0">=</font><font color="#C00000">False</font><font color="#4000C0">,</font> <font color="#000000">zoneIJK</font><font color="#4000C0">=</font><font color="#C00000">False</font><font color="#4000C0">,</font>
        <font color="#000000">forceNoSharedMemory</font><font color="#4000C0">=</font><font color="#000000">forceNoShm</font><font color="#4000C0">)</font>

    <font color="#000000">TestValueIN</font><font color="#4000C0">(</font><font color="#008000">'ShouldHaveNodeColumnNames'</font><font color="#4000C0">,</font> <font color="#000000">tables</font><font color="#4000C0">,</font> <font color="#008000">'nodeColumnNames'</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueIN</font><font color="#4000C0">(</font><font color="#008000">'ShouldHaveNodeTable'</font><font color="#4000C0">,</font> <font color="#000000">tables</font><font color="#4000C0">,</font> <font color="#008000">'nodeTable'</font><font color="#4000C0">)</font>
    <font color="#000000">nodeTable</font> <font color="#4000C0">=</font> <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">asarray</font><font color="#4000C0">(</font><font color="#000000">tables</font><font color="#4000C0">[</font><font color="#008000">'nodeTable'</font><font color="#4000C0">]</font><font color="#4000C0">)</font>

    <font color="#000000">TestValueIN</font><font color="#4000C0">(</font><font color="#008000">'ShouldHaveZoneColumnNames'</font><font color="#4000C0">,</font> <font color="#000000">tables</font><font color="#4000C0">,</font> <font color="#008000">'zoneColumnNames'</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueIN</font><font color="#4000C0">(</font><font color="#008000">'ShouldHaveZoneTable'</font><font color="#4000C0">,</font> <font color="#000000">tables</font><font color="#4000C0">,</font> <font color="#008000">'zoneTable'</font><font color="#4000C0">)</font>
    <font color="#000000">zoneTable</font> <font color="#4000C0">=</font> <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">asarray</font><font color="#4000C0">(</font><font color="#000000">tables</font><font color="#4000C0">[</font><font color="#008000">'zoneTable'</font><font color="#4000C0">]</font><font color="#4000C0">)</font>

    <font color="#000000">ntName</font> <font color="#4000C0">=</font> <font color="#008000">'multi_rect2d_box_nodes'</font>
    <font color="#000000">ztName</font> <font color="#4000C0">=</font> <font color="#008000">'multi_rect2d_box_zones'</font>
    <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">savetxt</font><font color="#4000C0">(</font><font color="#000000">ntName</font><font color="#4000C0">+</font><font color="#008000">'.txt'</font><font color="#4000C0">,</font> <font color="#000000">nodeTable</font><font color="#4000C0">,</font> <font color="#000000">delimiter</font><font color="#4000C0">=</font><font color="#008000">','</font><font color="#4000C0">,</font>
        <font color="#000000">header</font><font color="#4000C0">=</font><font color="#008000">','</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">tables</font><font color="#4000C0">[</font><font color="#008000">'nodeColumnNames'</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">savetxt</font><font color="#4000C0">(</font><font color="#000000">ztName</font><font color="#4000C0">+</font><font color="#008000">'.txt'</font><font color="#4000C0">,</font> <font color="#000000">zoneTable</font><font color="#4000C0">,</font> <font color="#000000">delimiter</font><font color="#4000C0">=</font><font color="#008000">','</font><font color="#4000C0">,</font>
        <font color="#000000">header</font><font color="#4000C0">=</font><font color="#008000">','</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">tables</font><font color="#4000C0">[</font><font color="#008000">'zoneColumnNames'</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#000000">ntName</font><font color="#4000C0">,</font> <font color="#000000">load_text</font><font color="#4000C0">(</font><font color="#000000">ntName</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#000000">ztName</font><font color="#4000C0">,</font> <font color="#000000">load_text</font><font color="#4000C0">(</font><font color="#000000">ztName</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">db_name</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">test_tensor</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">'NoiseWithTensor'</font><font color="#4000C0">)</font>
    <font color="#000000">db_name</font> <font color="#4000C0">=</font> <font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">'noise.silo'</font><font color="#4000C0">)</font>
    <font color="#000000">mesh_name</font> <font color="#4000C0">=</font> <font color="#008000">'Mesh'</font>

    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">db_name</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">'Mesh'</font><font color="#4000C0">,</font> <font color="#000000">mesh_name</font><font color="#4000C0">)</font>

    <font color="#a02030"># Only want a small section for the csv file</font>
    <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">'Box'</font><font color="#4000C0">)</font>
    <font color="#000000">opts</font> <font color="#4000C0">=</font> <font color="#000000">GetOperatorOptions</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">)</font>
    <font color="#000000">opts</font><font color="#4000C0">.</font><font color="#000000">minx</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">10.0</font>
    <font color="#000000">opts</font><font color="#4000C0">.</font><font color="#000000">maxx</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">9.0</font>
    <font color="#000000">opts</font><font color="#4000C0">.</font><font color="#000000">miny</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">10.0</font>
    <font color="#000000">opts</font><font color="#4000C0">.</font><font color="#000000">maxy</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">9.0</font>
    <font color="#000000">opts</font><font color="#4000C0">.</font><font color="#000000">minz</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">10.0</font>
    <font color="#000000">opts</font><font color="#4000C0">.</font><font color="#000000">maxz</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">9.0</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">opts</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">vars</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">'hardyglobal'</font><font color="#4000C0">,</font> <font color="#008000">'grad_tensor'</font><font color="#4000C0">)</font>
    <font color="#000000">tables</font> <font color="#4000C0">=</font> <font color="#000000">Flatten</font><font color="#4000C0">(</font><font color="#000000">vars</font><font color="#4000C0">,</font> <font color="#000000">nodeIds</font><font color="#4000C0">=</font><font color="#C00000">True</font><font color="#4000C0">,</font> <font color="#000000">zoneIds</font><font color="#4000C0">=</font><font color="#C00000">False</font><font color="#4000C0">,</font>
                        <font color="#000000">nodeIJK</font><font color="#4000C0">=</font><font color="#C00000">False</font><font color="#4000C0">,</font> <font color="#000000">zoneIJK</font><font color="#4000C0">=</font><font color="#C00000">False</font><font color="#4000C0">)</font>

    <font color="#000000">TestValueIN</font><font color="#4000C0">(</font><font color="#008000">'ShouldHaveNodeColumnNames'</font><font color="#4000C0">,</font> <font color="#000000">tables</font><font color="#4000C0">,</font> <font color="#008000">'nodeColumnNames'</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueIN</font><font color="#4000C0">(</font><font color="#008000">'ShouldHaveNodeTable'</font><font color="#4000C0">,</font> <font color="#000000">tables</font><font color="#4000C0">,</font> <font color="#008000">'nodeTable'</font><font color="#4000C0">)</font>
    <font color="#000000">nodeTable</font> <font color="#4000C0">=</font> <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">asarray</font><font color="#4000C0">(</font><font color="#000000">tables</font><font color="#4000C0">[</font><font color="#008000">'nodeTable'</font><font color="#4000C0">]</font><font color="#4000C0">)</font>

    <font color="#000000">ntName</font> <font color="#4000C0">=</font> <font color="#008000">'noise_nodes'</font>
    <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">savetxt</font><font color="#4000C0">(</font><font color="#000000">ntName</font><font color="#4000C0">+</font><font color="#008000">'.txt'</font><font color="#4000C0">,</font> <font color="#000000">nodeTable</font><font color="#4000C0">,</font> <font color="#000000">delimiter</font><font color="#4000C0">=</font><font color="#008000">','</font><font color="#4000C0">,</font>
        <font color="#000000">header</font><font color="#4000C0">=</font><font color="#008000">','</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">tables</font><font color="#4000C0">[</font><font color="#008000">'nodeColumnNames'</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#000000">ntName</font><font color="#4000C0">,</font> <font color="#000000">load_text</font><font color="#4000C0">(</font><font color="#000000">ntName</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">db_name</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">test_ijk</font><font color="#4000C0">(</font><font color="#000000">do3d</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">db_name</font> <font color="#4000C0">=</font> <font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">'rect3d.silo'</font><font color="#4000C0">)</font> <font color="#C00000">if</font> <font color="#000000">do3d</font> <font color="#C00000">else</font> <font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">'rect2d.silo'</font><font color="#4000C0">)</font>
    <font color="#000000">mesh_name</font> <font color="#4000C0">=</font> <font color="#008000">'quadmesh3d'</font> <font color="#C00000">if</font> <font color="#000000">do3d</font> <font color="#C00000">else</font> <font color="#008000">'quadmesh2d'</font>

    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">db_name</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">'Mesh'</font><font color="#4000C0">,</font> <font color="#000000">mesh_name</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">vars</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">'d'</font><font color="#4000C0">,</font><font color="#4000C0">)</font>
    <font color="#000000">tables</font> <font color="#4000C0">=</font> <font color="#000000">Flatten</font><font color="#4000C0">(</font><font color="#000000">vars</font><font color="#4000C0">,</font> <font color="#000000">nodeIds</font><font color="#4000C0">=</font><font color="#C00000">False</font><font color="#4000C0">,</font> <font color="#000000">zoneIds</font><font color="#4000C0">=</font><font color="#C00000">False</font><font color="#4000C0">,</font> <font color="#000000">nodeIJK</font><font color="#4000C0">=</font><font color="#C00000">True</font><font color="#4000C0">,</font> <font color="#000000">zoneIJK</font><font color="#4000C0">=</font><font color="#C00000">True</font><font color="#4000C0">)</font>

    <font color="#000000">TestValueIN</font><font color="#4000C0">(</font><font color="#008000">'ShouldHaveNodeColumnNames'</font><font color="#4000C0">,</font> <font color="#000000">tables</font><font color="#4000C0">,</font> <font color="#008000">'nodeColumnNames'</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueIN</font><font color="#4000C0">(</font><font color="#008000">'ShouldHaveNodeTable'</font><font color="#4000C0">,</font> <font color="#000000">tables</font><font color="#4000C0">,</font> <font color="#008000">'nodeTable'</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueIN</font><font color="#4000C0">(</font><font color="#008000">'ShouldHaveZoneColumnNames'</font><font color="#4000C0">,</font> <font color="#000000">tables</font><font color="#4000C0">,</font> <font color="#008000">'zoneColumnNames'</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueIN</font><font color="#4000C0">(</font><font color="#008000">'ShouldHaveZoneTable'</font><font color="#4000C0">,</font> <font color="#000000">tables</font><font color="#4000C0">,</font> <font color="#008000">'zoneTable'</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test rect2D and rect3D nodes</font>
    <font color="#000000">nodeTable</font> <font color="#4000C0">=</font> <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">asarray</font><font color="#4000C0">(</font><font color="#000000">tables</font><font color="#4000C0">[</font><font color="#008000">'nodeTable'</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#000000">row</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">1</font>
    <font color="#000000">dims</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">31</font><font color="#4000C0">,</font> <font color="#0080C0">41</font><font color="#4000C0">,</font> <font color="#0080C0">31</font><font color="#4000C0">)</font> <font color="#C00000">if</font> <font color="#000000">do3d</font> <font color="#C00000">else</font> <font color="#4000C0">(</font><font color="#0080C0">31</font><font color="#4000C0">,</font> <font color="#0080C0">41</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#C00000">for</font> <font color="#000000">k</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">dims</font><font color="#4000C0">[</font><font color="#0080C0">2</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">knxny</font> <font color="#4000C0">=</font> <font color="#000000">k</font> <font color="#4000C0">*</font> <font color="#000000">dims</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font> <font color="#4000C0">*</font> <font color="#000000">dims</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font>
        <font color="#C00000">for</font> <font color="#000000">j</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">dims</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
            <font color="#000000">jnx</font> <font color="#4000C0">=</font> <font color="#000000">j</font> <font color="#4000C0">*</font> <font color="#000000">dims</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font>
            <font color="#C00000">for</font> <font color="#000000">i</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">dims</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
                <font color="#000000">id</font> <font color="#4000C0">=</font> <font color="#000000">knxny</font> <font color="#4000C0">+</font> <font color="#000000">jnx</font> <font color="#4000C0">+</font> <font color="#000000">i</font>
                <font color="#000000">iok</font> <font color="#4000C0">=</font> <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">isclose</font><font color="#4000C0">(</font><font color="#000000">nodeTable</font><font color="#4000C0">[</font><font color="#000000">id</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">i</font><font color="#4000C0">)</font>
                <font color="#000000">jok</font> <font color="#4000C0">=</font> <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">isclose</font><font color="#4000C0">(</font><font color="#000000">nodeTable</font><font color="#4000C0">[</font><font color="#000000">id</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">j</font><font color="#4000C0">)</font>
                <font color="#000000">kok</font> <font color="#4000C0">=</font> <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">isclose</font><font color="#4000C0">(</font><font color="#000000">nodeTable</font><font color="#4000C0">[</font><font color="#000000">id</font><font color="#4000C0">,</font> <font color="#0080C0">2</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">k</font><font color="#4000C0">)</font>
                <font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#4000C0">(</font><font color="#000000">iok</font> <font color="#C00000">and</font> <font color="#000000">jok</font> <font color="#C00000">and</font> <font color="#000000">kok</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
                    <font color="#000000">print</font><font color="#4000C0">(</font><font color="#008000">'(%d,%d,%d)'</font> <font color="#4000C0">%</font> <font color="#4000C0">(</font><font color="#000000">i</font><font color="#4000C0">,</font> <font color="#000000">j</font><font color="#4000C0">,</font> <font color="#000000">k</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
                    <font color="#000000">print</font><font color="#4000C0">(</font><font color="#008000">'(%g,%g,%g)'</font> <font color="#4000C0">%</font> <font color="#4000C0">(</font><font color="#000000">nodeTable</font><font color="#4000C0">[</font><font color="#000000">id</font><font color="#4000C0">,</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">nodeTable</font><font color="#4000C0">[</font><font color="#000000">id</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">nodeTable</font><font color="#4000C0">[</font><font color="#000000">id</font><font color="#4000C0">,</font><font color="#0080C0">2</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
                    <font color="#000000">row</font> <font color="#4000C0">=</font> <font color="#000000">id</font>
                    <font color="#C00000">break</font>
            <font color="#C00000">if</font> <font color="#000000">row</font> <font color="#4000C0">&gt;</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">:</font>
                <font color="#C00000">break</font>
        <font color="#C00000">if</font> <font color="#000000">row</font> <font color="#4000C0">&gt;</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">:</font>
            <font color="#C00000">break</font>

    <font color="#C00000">if</font> <font color="#000000">row</font> <font color="#4000C0">&gt;</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">:</font>
        <font color="#000000">baseline_name</font> <font color="#4000C0">=</font> <font color="#008000">'NodeIJK3D'</font> <font color="#C00000">if</font> <font color="#000000">do3d</font> <font color="#C00000">else</font> <font color="#008000">'NodeIJK2D'</font>
        <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">savetxt</font><font color="#4000C0">(</font><font color="#000000">baseline_name</font> <font color="#4000C0">+</font> <font color="#008000">'.txt'</font><font color="#4000C0">,</font> <font color="#000000">nodeTable</font><font color="#4000C0">,</font> <font color="#000000">delimiter</font><font color="#4000C0">=</font><font color="#008000">','</font><font color="#4000C0">,</font>
            <font color="#000000">header</font><font color="#4000C0">=</font><font color="#008000">','</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">tables</font><font color="#4000C0">[</font><font color="#008000">'nodeColumnNames'</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">'NodeInvalidRow'</font><font color="#4000C0">,</font> <font color="#000000">row</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test rect2D and rect3D zones</font>
    <font color="#000000">zoneTable</font> <font color="#4000C0">=</font> <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">asarray</font><font color="#4000C0">(</font><font color="#000000">tables</font><font color="#4000C0">[</font><font color="#008000">'zoneTable'</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#000000">row</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">1</font>
    <font color="#000000">dims</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">30</font><font color="#4000C0">,</font> <font color="#0080C0">40</font><font color="#4000C0">,</font> <font color="#0080C0">30</font><font color="#4000C0">)</font> <font color="#C00000">if</font> <font color="#000000">do3d</font> <font color="#C00000">else</font> <font color="#4000C0">(</font><font color="#0080C0">30</font><font color="#4000C0">,</font> <font color="#0080C0">40</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#C00000">for</font> <font color="#000000">k</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">dims</font><font color="#4000C0">[</font><font color="#0080C0">2</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">knxny</font> <font color="#4000C0">=</font> <font color="#000000">k</font> <font color="#4000C0">*</font> <font color="#000000">dims</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font> <font color="#4000C0">*</font> <font color="#000000">dims</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font>
        <font color="#C00000">for</font> <font color="#000000">j</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">dims</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
            <font color="#000000">jnx</font> <font color="#4000C0">=</font> <font color="#000000">j</font> <font color="#4000C0">*</font> <font color="#000000">dims</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font>
            <font color="#C00000">for</font> <font color="#000000">i</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">dims</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
                <font color="#000000">id</font> <font color="#4000C0">=</font> <font color="#000000">knxny</font> <font color="#4000C0">+</font> <font color="#000000">jnx</font> <font color="#4000C0">+</font> <font color="#000000">i</font>
                <font color="#a02030"># NOTE: Column 0 is 'd'</font>
                <font color="#000000">iok</font> <font color="#4000C0">=</font> <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">isclose</font><font color="#4000C0">(</font><font color="#000000">zoneTable</font><font color="#4000C0">[</font><font color="#000000">id</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">i</font><font color="#4000C0">)</font>
                <font color="#000000">jok</font> <font color="#4000C0">=</font> <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">isclose</font><font color="#4000C0">(</font><font color="#000000">zoneTable</font><font color="#4000C0">[</font><font color="#000000">id</font><font color="#4000C0">,</font> <font color="#0080C0">2</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">j</font><font color="#4000C0">)</font>
                <font color="#000000">kok</font> <font color="#4000C0">=</font> <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">isclose</font><font color="#4000C0">(</font><font color="#000000">zoneTable</font><font color="#4000C0">[</font><font color="#000000">id</font><font color="#4000C0">,</font> <font color="#0080C0">3</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">k</font><font color="#4000C0">)</font>
                <font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#4000C0">(</font><font color="#000000">iok</font> <font color="#C00000">and</font> <font color="#000000">jok</font> <font color="#C00000">and</font> <font color="#000000">kok</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
                    <font color="#000000">print</font><font color="#4000C0">(</font><font color="#008000">'(%d,%d,%d)'</font> <font color="#4000C0">%</font> <font color="#4000C0">(</font><font color="#000000">i</font><font color="#4000C0">,</font> <font color="#000000">j</font><font color="#4000C0">,</font> <font color="#000000">k</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
                    <font color="#000000">print</font><font color="#4000C0">(</font><font color="#008000">'(%g,%g,%g)'</font> <font color="#4000C0">%</font> <font color="#4000C0">(</font><font color="#000000">zoneTable</font><font color="#4000C0">[</font><font color="#000000">id</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">zoneTable</font><font color="#4000C0">[</font><font color="#000000">id</font><font color="#4000C0">,</font><font color="#0080C0">2</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">zoneTable</font><font color="#4000C0">[</font><font color="#000000">id</font><font color="#4000C0">,</font><font color="#0080C0">3</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
                    <font color="#000000">row</font> <font color="#4000C0">=</font> <font color="#000000">id</font>
                    <font color="#C00000">break</font>
            <font color="#C00000">if</font> <font color="#000000">row</font> <font color="#4000C0">&gt;</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">:</font>
                <font color="#C00000">break</font>
        <font color="#C00000">if</font> <font color="#000000">row</font> <font color="#4000C0">&gt;</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">:</font>
            <font color="#C00000">break</font>

    <font color="#C00000">if</font> <font color="#000000">row</font> <font color="#4000C0">&gt;</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">:</font>
        <font color="#000000">baseline_name</font> <font color="#4000C0">=</font> <font color="#008000">'ZoneIJK3D'</font> <font color="#C00000">if</font> <font color="#000000">do3d</font> <font color="#C00000">else</font> <font color="#008000">'ZoneIJK2D'</font>
        <font color="#000000">np</font><font color="#4000C0">.</font><font color="#000000">savetxt</font><font color="#4000C0">(</font><font color="#000000">baseline_name</font> <font color="#4000C0">+</font> <font color="#008000">'.txt'</font><font color="#4000C0">,</font> <font color="#000000">zoneTable</font><font color="#4000C0">,</font> <font color="#000000">delimiter</font><font color="#4000C0">=</font><font color="#008000">','</font><font color="#4000C0">,</font>
            <font color="#000000">header</font><font color="#4000C0">=</font><font color="#008000">','</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">tables</font><font color="#4000C0">[</font><font color="#008000">'zoneColumnNames'</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">'ZoneInvalidRow'</font><font color="#4000C0">,</font> <font color="#000000">row</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">)</font>

    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">db_name</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">test_node_data</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">for</font> <font color="#000000">case</font> <font color="#C00000">in</font> <font color="#000000">basicTestCases</font><font color="#4000C0">:</font>
        <font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#000000">case</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font> <font color="#4000C0">+</font> <font color="#008000">'_'</font> <font color="#4000C0">+</font> <font color="#008000">'NodeData'</font><font color="#4000C0">)</font>
        <font color="#000000">run_basic_test</font><font color="#4000C0">(</font><font color="#000000">case</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">case</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">'n'</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">test_zone_data</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">for</font> <font color="#000000">case</font> <font color="#C00000">in</font> <font color="#000000">basicTestCases</font><font color="#4000C0">:</font>
        <font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#000000">case</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font> <font color="#4000C0">+</font> <font color="#008000">'_'</font> <font color="#4000C0">+</font> <font color="#008000">'ZoneData'</font><font color="#4000C0">)</font>
        <font color="#000000">run_basic_test</font><font color="#4000C0">(</font><font color="#000000">case</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">case</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">'z'</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">test_both</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">for</font> <font color="#000000">case</font> <font color="#C00000">in</font> <font color="#000000">basicTestCases</font><font color="#4000C0">:</font>
        <font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#000000">case</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font> <font color="#4000C0">+</font> <font color="#008000">'_'</font> <font color="#4000C0">+</font> <font color="#008000">'BothData'</font><font color="#4000C0">)</font>
        <font color="#000000">run_basic_test</font><font color="#4000C0">(</font><font color="#000000">case</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">case</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">'nz'</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">test_box_selection</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#a02030"># These test verify that the Query operates on</font>
    <font color="#a02030">#   the actual data and not the original</font>
    <font color="#a02030"># A second test is used to test the non shared</font>
    <font color="#a02030">#   memory implementation since the data is small.</font>
    <font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">'BoxSelection'</font><font color="#4000C0">)</font>
    <font color="#000000">test_box</font><font color="#4000C0">(</font><font color="#C00000">False</font><font color="#4000C0">)</font>
    <font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">'BoxSelectionNoSharedMemory'</font><font color="#4000C0">)</font>
    <font color="#000000">test_box</font><font color="#4000C0">(</font><font color="#C00000">True</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">test_ijks</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">'IJKs2D'</font><font color="#4000C0">)</font>
    <font color="#000000">test_ijk</font><font color="#4000C0">(</font><font color="#C00000">False</font><font color="#4000C0">)</font>
    <font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">'IJKs3D'</font><font color="#4000C0">)</font>
    <font color="#000000">test_ijk</font><font color="#4000C0">(</font><font color="#C00000">True</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">test_all</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">test_node_data</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">test_zone_data</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">test_both</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">test_box_selection</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">test_tensor</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">test_ijks</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#C00000">if</font> <font color="#000000">haveNumpy</font><font color="#4000C0">:</font>
    <font color="#000000">test_all</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Exit</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000"></font></font></pre></body></html>