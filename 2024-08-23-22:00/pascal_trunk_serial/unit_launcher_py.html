<html><body bgcolor="#e0e0e0"><head><title>unit/launcher.py</title></head><pre><font face="Lucida,Courier New"><font color="#a02030"># ----------------------------------------------------------------------------</font>
<font color="#a02030">#  CLASSES: nightly</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Test Case:  launcher.py</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Tests:      This script tests internallauncher&#x27;s transformation of visit</font>
<font color="#a02030">#              command line arguments into parallel launch arguments.</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Brad Whitlock, Tue Sep 11 12:31:34 PDT 2012</font>
<font color="#a02030">#</font>
<font color="#a02030"># Modifications:</font>
<font color="#a02030">#   Brad Whitlock, Fri Dec  7 09:08:22 PST 2012</font>
<font color="#a02030">#   I added a little more filtering of the launcher output to replace the host</font>
<font color="#a02030">#   with $HOST now that the noloopback case will always use the real host</font>
<font color="#a02030">#   name instead of 127.0.0.1 for parallel engine launches.</font>
<font color="#a02030">#</font>
<font color="#a02030"># ----------------------------------------------------------------------------</font>
<font color="#C00000">import</font> <font color="#000000">os</font>
<font color="#C00000">import</font> <font color="#000000">socket</font>
<font color="#C00000">import</font> <font color="#000000">subprocess</font>
<font color="#C00000">import</font> <font color="#000000">getpass</font>

<font color="#a02030"># The launch cases we want to test.</font>
<font color="#000000">launch_cases</font> <font color="#4000C0">=</font> <font color="#4000C0">{</font>
<font color="#008000">&quot;aprun&quot;</font>          <font color="#4000C0">:</font> <font color="#4000C0">[</font><font color="#008000">&quot;-nn&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;1&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
<font color="#008000">&quot;bsub&quot;</font>           <font color="#4000C0">:</font> <font color="#4000C0">[</font><font color="#008000">&quot;-p&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;pbatch&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-t&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;30:00&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-la&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-arg1 -arg2&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
<font color="#008000">&quot;bsub/mpirun&quot;</font>    <font color="#4000C0">:</font> <font color="#4000C0">[</font><font color="#008000">&quot;-p&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;pbatch&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-t&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;30:00&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-la&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-arg1 -arg2&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-sla&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-arg3 -arg4&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
<font color="#008000">&quot;dmpirun&quot;</font>        <font color="#4000C0">:</font> <font color="#4000C0">[</font><font color="#008000">&quot;-b&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;bdivp&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
<font color="#008000">&quot;ibrun&quot;</font>          <font color="#4000C0">:</font> <font color="#4000C0">[</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
<font color="#008000">&quot;mpirun&quot;</font>         <font color="#4000C0">:</font> <font color="#4000C0">[</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
<font color="#008000">&quot;msub/aprun&quot;</font>     <font color="#4000C0">:</font> <font color="#4000C0">[</font><font color="#008000">&quot;-nn&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;1&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-sla&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-arg1 -arg2&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-hw-pre&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;startx&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-hw-post&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;stopx&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
<font color="#008000">&quot;msub/ibrun&quot;</font>     <font color="#4000C0">:</font> <font color="#4000C0">[</font><font color="#008000">&quot;-hw-pre&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;startx&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-hw-post&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;stopx&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
<font color="#008000">&quot;msub/mpiexec&quot;</font>   <font color="#4000C0">:</font> <font color="#4000C0">[</font><font color="#008000">&quot;-slpre&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;echo &#x27;slprecommand&#x27;&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-slpost&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;echo &#x27;slpostcommand&#x27;&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-sla&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-arg1 -arg2&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-machinefile&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;machine.txt&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-hw-pre&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;startx&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-hw-post&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;stopx&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
<font color="#008000">&quot;msub/mpirun&quot;</font>    <font color="#4000C0">:</font> <font color="#4000C0">[</font><font color="#008000">&quot;-sla&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-arg1 -arg2&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-machinefile&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;machine.txt&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-hw-pre&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;startx&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-hw-post&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;stopx&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
<font color="#008000">&quot;msub/srun&quot;</font>      <font color="#4000C0">:</font> <font color="#4000C0">[</font><font color="#008000">&quot;-sla&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-arg1 -arg2&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-hw-pre&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;startx&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-hw-post&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;stopx&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
<font color="#008000">&quot;poe&quot;</font>            <font color="#4000C0">:</font> <font color="#4000C0">[</font><font color="#008000">&quot;-nn&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;1&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-p&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;pbatch&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
<font color="#008000">&quot;prun&quot;</font>           <font color="#4000C0">:</font> <font color="#4000C0">[</font><font color="#008000">&quot;-nn&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;1&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-p&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;pbatch&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
<font color="#008000">&quot;psub&quot;</font>           <font color="#4000C0">:</font> <font color="#4000C0">[</font><font color="#008000">&quot;-n&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;JOB_NAME&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-p&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;pbatch&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-b&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;bdivp&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-t&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;30:00&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-expedite&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-slpre&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;echo &#x27;pre command&#x27;&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-slpost&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;echo &#x27;post command&#x27;&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
<font color="#008000">&quot;psub/mpirun&quot;</font>    <font color="#4000C0">:</font> <font color="#4000C0">[</font><font color="#008000">&quot;-nn&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;1&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-n&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;JOB_NAME&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-p&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;pbatch&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-b&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;bdivp&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-t&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;30:00&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-expedite&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-slpre&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;echo &#x27;pre command&#x27;&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-slpost&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;echo &#x27;post command&#x27;&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
<font color="#008000">&quot;psub/srun&quot;</font>      <font color="#4000C0">:</font> <font color="#4000C0">[</font><font color="#008000">&quot;-nn&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;1&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-n&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;JOB_NAME&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-p&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;pbatch&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-b&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;bdivp&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-t&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;30:00&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-expedite&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-slpre&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;echo &#x27;pre command&#x27;&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-slpost&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;echo &#x27;post command&#x27;&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font>


<font color="#008000">&quot;salloc&quot;</font>         <font color="#4000C0">:</font> <font color="#4000C0">[</font><font color="#008000">&quot;-p&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;pbatch&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-t&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;30:00&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-nn&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;1&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
<font color="#008000">&quot;sbatch&quot;</font>         <font color="#4000C0">:</font> <font color="#4000C0">[</font><font color="#008000">&quot;-p&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;pbatch&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-b&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;bdivp&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-nn&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;1&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
<font color="#008000">&quot;sbatch/aprun&quot;</font>   <font color="#4000C0">:</font> <font color="#4000C0">[</font><font color="#008000">&quot;-p&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;pbatch&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-b&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;bdivp&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-nn&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;1&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-sla&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-arg1 -arg2&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
<font color="#008000">&quot;srun&quot;</font>           <font color="#4000C0">:</font> <font color="#4000C0">[</font><font color="#008000">&quot;-nn&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;1&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-p&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;pbatch&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-b&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;bdivp&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-n&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;JOB_NAME&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-t&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;30:00&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
<font color="#008000">&quot;yod&quot;</font>            <font color="#4000C0">:</font> <font color="#4000C0">[</font><font color="#4000C0">]</font><font color="#4000C0">}</font>

<font color="#a02030"># Some debugger arguments.</font>
<font color="#000000">debuggers</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#4000C0">[</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#008000">&quot;-totalview&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;engine_par&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#008000">&quot;-valgrind&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;engine_par&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#008000">&quot;-strace&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;engine_par&quot;</font><font color="#4000C0">]</font><font color="#4000C0">]</font>

<font color="#a02030"># Get the launcher command for new versions of VisIt.</font>
<font color="#C00000">def</font> <font color="#000000">GetLauncherCommand</font><font color="#4000C0">(</font><font color="#000000">args</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">p</font> <font color="#4000C0">=</font> <font color="#000000">subprocess</font><font color="#4000C0">.</font><font color="#000000">Popen</font><font color="#4000C0">(</font><font color="#000000">args</font><font color="#4000C0">,</font> <font color="#000000">stdin</font><font color="#4000C0">=</font><font color="#000000">subprocess</font><font color="#4000C0">.</font><font color="#000000">PIPE</font><font color="#4000C0">,</font> <font color="#000000">stdout</font><font color="#4000C0">=</font><font color="#000000">subprocess</font><font color="#4000C0">.</font><font color="#000000">PIPE</font><font color="#4000C0">,</font> <font color="#000000">stderr</font><font color="#4000C0">=</font><font color="#000000">subprocess</font><font color="#4000C0">.</font><font color="#000000">PIPE</font><font color="#4000C0">,</font> <font color="#000000">universal_newlines</font><font color="#4000C0">=</font><font color="#C00000">True</font><font color="#4000C0">)</font>
    <font color="#000000">stdout</font><font color="#4000C0">,</font> <font color="#000000">stderr</font> <font color="#4000C0">=</font> <font color="#000000">p</font><font color="#4000C0">.</font><font color="#000000">communicate</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">ru</font> <font color="#4000C0">=</font> <font color="#000000">stdout</font><font color="#4000C0">.</font><font color="#000000">find</font><font color="#4000C0">(</font><font color="#008000">&quot;RUN USING&quot;</font><font color="#4000C0">)</font>
    <font color="#C00000">if</font> <font color="#000000">ru</font> <font color="#4000C0">!=</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">:</font>
        <font color="#000000">cmd</font> <font color="#4000C0">=</font> <font color="#000000">stdout</font><font color="#4000C0">[</font><font color="#000000">ru</font> <font color="#4000C0">+</font> <font color="#0080C0">11</font><font color="#4000C0">:</font><font color="#4000C0">-</font><font color="#0080C0">2</font><font color="#4000C0">]</font>
    <font color="#C00000">else</font><font color="#4000C0">:</font>
        <font color="#000000">cmd</font> <font color="#4000C0">=</font> <font color="#000000">stdout</font>
    <font color="#C00000">return</font> <font color="#000000">cmd</font>

<font color="#C00000">def</font> <font color="#000000">FilterLauncherOutput</font><font color="#4000C0">(</font><font color="#000000">text</font><font color="#4000C0">,</font> <font color="#000000">replacements</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">for</font> <font color="#000000">k</font> <font color="#C00000">in</font> <font color="#000000">list</font><font color="#4000C0">(</font><font color="#000000">replacements</font><font color="#4000C0">.</font><font color="#000000">keys</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">text</font> <font color="#4000C0">=</font> <font color="#000000">text</font><font color="#4000C0">.</font><font color="#000000">replace</font><font color="#4000C0">(</font><font color="#000000">k</font><font color="#4000C0">,</font> <font color="#000000">replacements</font><font color="#4000C0">[</font><font color="#000000">k</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#C00000">return</font> <font color="#000000">text</font>

<font color="#C00000">def</font> <font color="#000000">FilterHostName</font><font color="#4000C0">(</font><font color="#000000">text</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">host</font> <font color="#4000C0">=</font> <font color="#000000">text</font><font color="#4000C0">.</font><font color="#000000">find</font><font color="#4000C0">(</font><font color="#008000">&quot;-host&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">port</font> <font color="#4000C0">=</font> <font color="#000000">text</font><font color="#4000C0">.</font><font color="#000000">find</font><font color="#4000C0">(</font><font color="#008000">&quot;-port&quot;</font><font color="#4000C0">)</font>
    <font color="#C00000">if</font> <font color="#000000">host</font> <font color="#4000C0">!=</font> <font color="#4000C0">-</font><font color="#0080C0">1</font> <font color="#C00000">and</font> <font color="#000000">port</font> <font color="#4000C0">!=</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">:</font>
        <font color="#C00000">return</font> <font color="#000000">text</font><font color="#4000C0">[</font><font color="#4000C0">:</font><font color="#000000">host</font> <font color="#4000C0">+</font> <font color="#0080C0">6</font><font color="#4000C0">]</font> <font color="#4000C0">+</font> <font color="#008000">&quot;$HOST &quot;</font> <font color="#4000C0">+</font> <font color="#000000">text</font><font color="#4000C0">[</font><font color="#000000">port</font><font color="#4000C0">:</font><font color="#4000C0">]</font>
    <font color="#C00000">return</font> <font color="#000000">text</font>

<font color="#C00000">def</font> <font color="#000000">hostname</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">return</font> <font color="#000000">socket</font><font color="#4000C0">.</font><font color="#000000">gethostname</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">nodename</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">return</font> <font color="#000000">hostname</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">.</font><font color="#000000">split</font><font color="#4000C0">(</font><font color="#008000">&quot;.&quot;</font><font color="#4000C0">)</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font>

<font color="#C00000">def</font> <font color="#000000">sectorname</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">nodename</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#C00000">for</font> <font color="#000000">d</font> <font color="#C00000">in</font> <font color="#008000">&quot;0123456789&quot;</font><font color="#4000C0">:</font>
        <font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">s</font><font color="#4000C0">.</font><font color="#000000">replace</font><font color="#4000C0">(</font><font color="#000000">d</font><font color="#4000C0">,</font> <font color="#008000">&quot;&quot;</font><font color="#4000C0">)</font>
    <font color="#C00000">return</font> <font color="#000000">s</font>

<font color="#C00000">def</font> <font color="#000000">FormatLauncherOutput</font><font color="#4000C0">(</font><font color="#000000">cmd</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">tmpvisit</font> <font color="#4000C0">=</font> <font color="#000000">cmd</font><font color="#4000C0">.</font><font color="#000000">find</font><font color="#4000C0">(</font><font color="#008000">&quot;/tmp/visit&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">text</font> <font color="#4000C0">=</font> <font color="#008000">&quot;&quot;</font>
    <font color="#C00000">if</font> <font color="#000000">tmpvisit</font> <font color="#4000C0">==</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">:</font>
        <font color="#000000">text</font> <font color="#4000C0">=</font> <font color="#000000">cmd</font>
    <font color="#C00000">else</font><font color="#4000C0">:</font>
        <font color="#a02030"># The launcher made a script. Get the contents of the script.</font>
        <font color="#000000">index</font> <font color="#4000C0">=</font> <font color="#000000">tmpvisit</font>
        <font color="#C00000">try</font><font color="#4000C0">:</font>
            <font color="#C00000">while</font> <font color="#000000">cmd</font><font color="#4000C0">[</font><font color="#000000">index</font><font color="#4000C0">]</font> <font color="#4000C0">!=</font> <font color="#008000">&#x27;\n&#x27;</font><font color="#4000C0">:</font>
                <font color="#000000">index</font> <font color="#4000C0">=</font> <font color="#000000">index</font> <font color="#4000C0">+</font> <font color="#0080C0">1</font>
            <font color="#000000">filename</font> <font color="#4000C0">=</font> <font color="#000000">cmd</font><font color="#4000C0">[</font><font color="#000000">tmpvisit</font><font color="#4000C0">:</font><font color="#000000">index</font><font color="#4000C0">]</font>
        <font color="#C00000">except</font><font color="#4000C0">:</font>
            <font color="#000000">filename</font> <font color="#4000C0">=</font> <font color="#000000">cmd</font><font color="#4000C0">[</font><font color="#000000">tmpvisit</font><font color="#4000C0">:</font><font color="#4000C0">]</font>

        <font color="#000000">cmd</font> <font color="#4000C0">=</font> <font color="#000000">cmd</font><font color="#4000C0">.</font><font color="#000000">replace</font><font color="#4000C0">(</font><font color="#000000">filename</font><font color="#4000C0">,</font> <font color="#008000">&quot;$LAUNCHSCRIPT&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">text</font> <font color="#4000C0">=</font> <font color="#000000">text</font> <font color="#4000C0">+</font> <font color="#000000">cmd</font>

        <font color="#C00000">try</font><font color="#4000C0">:</font>
            <font color="#000000">lines</font> <font color="#4000C0">=</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#000000">filename</font><font color="#4000C0">,</font> <font color="#008000">&quot;rt&quot;</font><font color="#4000C0">)</font><font color="#4000C0">.</font><font color="#000000">readlines</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
            <font color="#000000">text</font> <font color="#4000C0">=</font> <font color="#000000">text</font> <font color="#4000C0">+</font> <font color="#008000">&#x27;\n\nContents of $LAUNCHSCRIPT:\n&#x27;</font>
            <font color="#C00000">for</font> <font color="#000000">line</font> <font color="#C00000">in</font> <font color="#000000">lines</font><font color="#4000C0">:</font>
                <font color="#000000">text</font> <font color="#4000C0">=</font> <font color="#000000">text</font> <font color="#4000C0">+</font> <font color="#000000">line</font>
            <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">unlink</font><font color="#4000C0">(</font><font color="#000000">filename</font><font color="#4000C0">)</font>
        <font color="#C00000">except</font><font color="#4000C0">:</font>
            <font color="#C00000">pass</font>

    <font color="#C00000">return</font> <font color="#000000">text</font>


<font color="#a02030"># For each launcher</font>
<font color="#000000">i</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
<font color="#000000">keys</font> <font color="#4000C0">=</font> <font color="#000000">list</font><font color="#4000C0">(</font><font color="#000000">launch_cases</font><font color="#4000C0">.</font><font color="#000000">keys</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">keys</font><font color="#4000C0">.</font><font color="#000000">sort</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#C00000">for</font> <font color="#000000">k</font> <font color="#C00000">in</font> <font color="#000000">keys</font><font color="#4000C0">:</font>
    <font color="#a02030"># Test the launcher with each debugger.</font>
    <font color="#000000">j</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
    <font color="#000000">text</font> <font color="#4000C0">=</font> <font color="#008000">&quot;&quot;</font>
    <font color="#C00000">for</font> <font color="#000000">j</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">debuggers</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">np</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#4000C0">]</font>
        <font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#008000">&quot;-np&quot;</font> <font color="#C00000">in</font> <font color="#000000">launch_cases</font><font color="#4000C0">[</font><font color="#000000">k</font><font color="#4000C0">]</font><font color="#4000C0">:</font>
            <font color="#000000">np</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#008000">&quot;-np&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;8&quot;</font><font color="#4000C0">]</font>
        <font color="#000000">args</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#008000">&quot;-engine&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-norun&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;engine_par&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-l&quot;</font><font color="#4000C0">,</font> <font color="#000000">k</font><font color="#4000C0">]</font> <font color="#4000C0">+</font> <font color="#000000">np</font> <font color="#4000C0">+</font> <font color="#000000">launch_cases</font><font color="#4000C0">[</font><font color="#000000">k</font><font color="#4000C0">]</font> <font color="#4000C0">+</font> <font color="#4000C0">[</font><font color="#008000">&quot;-host&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;127.0.0.1&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-port&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;5600&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">+</font> <font color="#000000">debuggers</font><font color="#4000C0">[</font><font color="#000000">j</font><font color="#4000C0">]</font>

        <font color="#a02030"># Come up with a visit command</font>
        <font color="#000000">cmd</font> <font color="#4000C0">=</font> <font color="#008000">&quot;&quot;</font>
        <font color="#C00000">for</font> <font color="#000000">a</font> <font color="#C00000">in</font> <font color="#000000">args</font><font color="#4000C0">:</font>
            <font color="#C00000">if</font> <font color="#008000">&quot; &quot;</font> <font color="#C00000">in</font> <font color="#000000">a</font><font color="#4000C0">:</font>
                <font color="#000000">cmd</font> <font color="#4000C0">=</font> <font color="#000000">cmd</font> <font color="#4000C0">+</font> <font color="#008000">&#x27;&quot;%s&quot; &#x27;</font> <font color="#4000C0">%</font> <font color="#000000">a</font>
            <font color="#C00000">else</font><font color="#4000C0">:</font>
                <font color="#000000">cmd</font> <font color="#4000C0">=</font> <font color="#000000">cmd</font> <font color="#4000C0">+</font> <font color="#000000">a</font> <font color="#4000C0">+</font> <font color="#008000">&#x27; &#x27;</font>

        <font color="#a02030"># Run the launcher and get the output.</font>
        <font color="#000000">visitdir</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;top_dir&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font><font color="#008000">&quot;src&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">visittestdir</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;top_dir&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font><font color="#008000">&quot;test&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">visit</font> <font color="#4000C0">=</font>  <font color="#000000">visit_bin_path</font><font color="#4000C0">(</font><font color="#008000">&quot;visit&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">output</font> <font color="#4000C0">=</font> <font color="#000000">FormatLauncherOutput</font><font color="#4000C0">(</font><font color="#000000">GetLauncherCommand</font><font color="#4000C0">(</font><font color="#4000C0">[</font><font color="#000000">visit</font><font color="#4000C0">]</font> <font color="#4000C0">+</font> <font color="#000000">args</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
        <font color="#a02030"># filter the run dir, since there are multiple variants for nightly tests</font>
        <font color="#a02030"># (serial, par, etc)</font>
        <font color="#000000">output</font> <font color="#4000C0">=</font> <font color="#000000">FilterLauncherOutput</font><font color="#4000C0">(</font><font color="#000000">output</font><font color="#4000C0">,</font> <font color="#4000C0">{</font><font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;run_dir&quot;</font><font color="#4000C0">]</font><font color="#4000C0">:</font> <font color="#008000">&quot;$VISIT_TEST_DIR&quot;</font><font color="#4000C0">}</font><font color="#4000C0">)</font>
        <font color="#000000">output</font> <font color="#4000C0">=</font> <font color="#000000">FilterLauncherOutput</font><font color="#4000C0">(</font><font color="#000000">output</font><font color="#4000C0">,</font> <font color="#4000C0">{</font><font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;result_dir&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">:</font> <font color="#008000">&quot;$VISIT_TEST_DIR&quot;</font><font color="#4000C0">}</font><font color="#4000C0">)</font>
        <font color="#a02030"># Filter out visitdir and some related directories.</font>
        <font color="#000000">output</font> <font color="#4000C0">=</font> <font color="#000000">FilterLauncherOutput</font><font color="#4000C0">(</font><font color="#000000">output</font><font color="#4000C0">,</font> <font color="#4000C0">{</font><font color="#000000">visit_bin_path</font><font color="#4000C0">(</font><font color="#4000C0">)</font> <font color="#4000C0">:</font> <font color="#008000">&quot;$VISIT_EXE_DIR&quot;</font><font color="#4000C0">}</font><font color="#4000C0">)</font>
        <font color="#000000">output</font> <font color="#4000C0">=</font> <font color="#000000">FilterLauncherOutput</font><font color="#4000C0">(</font><font color="#000000">output</font><font color="#4000C0">,</font> <font color="#4000C0">{</font><font color="#000000">visit_bin_path</font><font color="#4000C0">(</font><font color="#008000">&quot;..&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;exe&quot;</font><font color="#4000C0">)</font> <font color="#4000C0">:</font> <font color="#008000">&quot;$VISIT_EXE_DIR&quot;</font><font color="#4000C0">}</font><font color="#4000C0">)</font>
        <font color="#000000">output</font> <font color="#4000C0">=</font> <font color="#000000">FilterLauncherOutput</font><font color="#4000C0">(</font><font color="#000000">output</font><font color="#4000C0">,</font> <font color="#4000C0">{</font><font color="#000000">visittestdir</font> <font color="#4000C0">:</font> <font color="#008000">&quot;$VISIT_TEST_DIR&quot;</font><font color="#4000C0">}</font><font color="#4000C0">)</font>
        <font color="#000000">output</font> <font color="#4000C0">=</font> <font color="#000000">FilterLauncherOutput</font><font color="#4000C0">(</font><font color="#000000">output</font><font color="#4000C0">,</font> <font color="#4000C0">{</font><font color="#000000">visit_bin_path</font><font color="#4000C0">(</font><font color="#008000">&quot;..&quot;</font><font color="#4000C0">)</font> <font color="#4000C0">:</font> <font color="#008000">&quot;$VISITDIR&quot;</font><font color="#4000C0">}</font><font color="#4000C0">)</font>
        <font color="#000000">output</font> <font color="#4000C0">=</font> <font color="#000000">FilterLauncherOutput</font><font color="#4000C0">(</font><font color="#000000">output</font><font color="#4000C0">,</font> <font color="#4000C0">{</font><font color="#000000">visitdir</font> <font color="#4000C0">:</font> <font color="#008000">&quot;$VISITDIR&quot;</font><font color="#4000C0">}</font><font color="#4000C0">)</font>
        <font color="#a02030"># special case filter to resolve csh vs bash env differences</font>
        <font color="#000000">bash_case</font>   <font color="#4000C0">=</font> <font color="#008000">&quot;ulimit -c 0 ;&quot;</font>
        <font color="#000000">bash_case</font>  <font color="#4000C0">+=</font> <font color="#008000">&quot; LIBPATH=$VISITDIR/lib ;&quot;</font>
        <font color="#000000">bash_case</font>  <font color="#4000C0">+=</font> <font color="#008000">&quot; export LIBPATH ;&quot;</font>
        <font color="#000000">bash_case</font>  <font color="#4000C0">+=</font> <font color="#008000">&quot; LD_LIBRARY_PATH=$VISITDIR/lib ;&quot;</font>
        <font color="#000000">bash_case</font>  <font color="#4000C0">+=</font> <font color="#008000">&quot; export LD_LIBRARY_PATH&quot;</font>

        <font color="#000000">csh_case</font>  <font color="#4000C0">=</font> <font color="#008000">&quot;limit coredumpsize 0 ;&quot;</font>
        <font color="#000000">csh_case</font> <font color="#4000C0">+=</font> <font color="#008000">&quot; setenv LIBPATH $VISITDIR/lib ;&quot;</font>
        <font color="#000000">csh_case</font> <font color="#4000C0">+=</font> <font color="#008000">&quot; setenv LD_LIBRARY_PATH $VISITDIR/lib&quot;</font>
        <font color="#000000">shell_filter</font> <font color="#4000C0">=</font> <font color="#4000C0">{</font><font color="#000000">bash_case</font> <font color="#4000C0">:</font> <font color="#000000">csh_case</font><font color="#4000C0">}</font>
        <font color="#000000">output</font> <font color="#4000C0">=</font> <font color="#000000">FilterLauncherOutput</font><font color="#4000C0">(</font><font color="#000000">output</font><font color="#4000C0">,</font> <font color="#000000">shell_filter</font><font color="#4000C0">)</font>
        <font color="#a02030"># Filter out $HOME.</font>
        <font color="#C00000">try</font><font color="#4000C0">:</font>
            <font color="#000000">output</font> <font color="#4000C0">=</font> <font color="#000000">FilterLauncherOutput</font><font color="#4000C0">(</font><font color="#000000">output</font><font color="#4000C0">,</font> <font color="#4000C0">{</font><font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">environ</font><font color="#4000C0">[</font><font color="#008000">&quot;HOME&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">:</font> <font color="#008000">&quot;$HOME&quot;</font><font color="#4000C0">}</font><font color="#4000C0">)</font>
        <font color="#C00000">except</font><font color="#4000C0">:</font>
            <font color="#C00000">pass</font>

        <font color="#000000">cdcmd</font> <font color="#4000C0">=</font> <font color="#008000">&quot;cd $VISIT_TEST_DIR&quot;</font>

        <font color="#a02030"># Filter out some other stuff.</font>
        <font color="#000000">replacements</font> <font color="#4000C0">=</font> <font color="#4000C0">{</font><font color="#000000">getpass</font><font color="#4000C0">.</font><font color="#000000">getuser</font><font color="#4000C0">(</font><font color="#4000C0">)</font> <font color="#4000C0">:</font> <font color="#008000">&quot;$USER&quot;</font><font color="#4000C0">,</font>
                        <font color="#000000">Version</font><font color="#4000C0">(</font><font color="#4000C0">)</font>         <font color="#4000C0">:</font> <font color="#008000">&quot;$VERSION&quot;</font><font color="#4000C0">,</font>
                        <font color="#008000">&quot;linux-intel&quot;</font>     <font color="#4000C0">:</font> <font color="#008000">&quot;$PLATFORM&quot;</font><font color="#4000C0">,</font>
                        <font color="#008000">&quot;linux-x86_64&quot;</font>    <font color="#4000C0">:</font> <font color="#008000">&quot;$PLATFORM&quot;</font><font color="#4000C0">,</font>
                        <font color="#008000">&quot;darwin-i386&quot;</font>     <font color="#4000C0">:</font> <font color="#008000">&quot;$PLATFORM&quot;</font><font color="#4000C0">,</font>
                        <font color="#008000">&quot;darwin-x86_64&quot;</font>   <font color="#4000C0">:</font> <font color="#008000">&quot;$PLATFORM&quot;</font><font color="#4000C0">}</font>

        <font color="#000000">output</font> <font color="#4000C0">=</font> <font color="#000000">FilterLauncherOutput</font><font color="#4000C0">(</font><font color="#000000">output</font><font color="#4000C0">,</font> <font color="#000000">replacements</font><font color="#4000C0">)</font>

        <font color="#000000">output</font> <font color="#4000C0">=</font> <font color="#000000">FilterHostName</font><font color="#4000C0">(</font><font color="#000000">output</font><font color="#4000C0">)</font>

        <font color="#a02030"># Do the test</font>
        <font color="#000000">text</font> <font color="#4000C0">=</font> <font color="#000000">text</font> <font color="#4000C0">+</font> <font color="#008000">&quot;=&quot;</font><font color="#4000C0">*</font><font color="#0080C0">80</font> <font color="#4000C0">+</font> <font color="#008000">&quot;\n&quot;</font>
        <font color="#000000">text</font> <font color="#4000C0">=</font> <font color="#000000">text</font> <font color="#4000C0">+</font> <font color="#008000">&quot;CASE: %s\n\nINPUT: visit %s\n\nRESULTS:\n&quot;</font> <font color="#4000C0">%</font> <font color="#4000C0">(</font><font color="#000000">k</font> <font color="#4000C0">+</font> <font color="#008000">&quot; &quot;</font> <font color="#4000C0">+</font> <font color="#008000">&quot; &quot;</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">debuggers</font><font color="#4000C0">[</font><font color="#000000">j</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">cmd</font><font color="#4000C0">[</font><font color="#4000C0">:</font><font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
        <font color="#000000">text</font> <font color="#4000C0">=</font> <font color="#000000">text</font> <font color="#4000C0">+</font> <font color="#000000">output</font> <font color="#4000C0">+</font> <font color="#008000">&quot;\n&quot;</font><font color="#4000C0">*</font><font color="#0080C0">2</font>

    <font color="#000000">name</font> <font color="#4000C0">=</font> <font color="#000000">k</font><font color="#4000C0">.</font><font color="#000000">replace</font><font color="#4000C0">(</font><font color="#008000">&quot;/&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;_&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#000000">name</font><font color="#4000C0">,</font> <font color="#000000">text</font><font color="#4000C0">)</font>
    <font color="#000000">i</font> <font color="#4000C0">=</font> <font color="#000000">i</font> <font color="#4000C0">+</font> <font color="#0080C0">1</font>

<font color="#000000">Exit</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000"></font></font></pre></body></html>