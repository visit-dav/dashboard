<html><body bgcolor="#e0e0e0"><head><title>hybrid/cinema-c.py</title></head><pre><font face="Lucida,Courier New"><font color="#a02030"># ----------------------------------------------------------------------------</font>
<font color="#a02030">#  CLASSES: nightly</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Test Case:  cinema-a.py</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Tests:      Tests various aspects of "visit -cinema".</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Notes:      </font>
<font color="#a02030">#</font>
<font color="#a02030">#  Programmer: Brad Whitlock</font>
<font color="#a02030">#  Date:       Thu Feb 15 16:37:20 PST 2018</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Modifications:</font>
<font color="#a02030">#    Kathleen Biagas, Tue Jun 11 11:44:14 PDT 2019</font>
<font color="#a02030">#    Pass '-noconfig' to generated command line in GenerateCinema.</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Kathleen Biagas, Tue Apr 13 2021</font>
<font color="#a02030">#    Port to python-3. Fix for Windows: Use abs_path for short_wave.visit,</font>
<font color="#a02030">#    use 'repr(db)' when writing script file to preserve '\' escapes.</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Kathleen Biagas, Tue Sep 14 09:51:45 PDT 2021</font>
<font color="#a02030">#    Added call to CloseComputeEngine to GenerateCinema method, since the</font>
<font color="#a02030">#    cinema script launches its own. Prevents a hang when run in parallel.</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Kathleen Biagas, Tue Sep 21 17:22:58 PDT 2021</font>
<font color="#a02030">#    Removed CloseComputeEngine, it prevented the non-cinema-generation parts</font>
<font color="#a02030">#    of the test from running in parallel.  If the nightlies use srun,</font>
<font color="#a02030">#    add "--overlap" srun option.  This allows cinema test to succeed in</font>
<font color="#a02030">#    parallel with recent changes to slurm.</font>
<font color="#a02030">#</font>
<font color="#a02030"># ----------------------------------------------------------------------------</font>

<font color="#C00000">import</font> <font color="#000000">math</font><font color="#4000C0">,</font> <font color="#000000">os</font><font color="#4000C0">,</font> <font color="#000000">string</font><font color="#4000C0">,</font> <font color="#000000">subprocess</font><font color="#4000C0">,</font> <font color="#000000">zlib</font>

<font color="#C00000">def</font> <font color="#000000">GenerateCinema</font><font color="#4000C0">(</font><font color="#000000">cinemaArgs</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">args</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"visit_bin"</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">"-noconfig"</font><font color="#4000C0">,</font> <font color="#008000">"-cinema"</font><font color="#4000C0">]</font> <font color="#4000C0">+</font> <font color="#000000">cinemaArgs</font>
    <font color="#C00000">if</font> <font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"parallel"</font><font color="#4000C0">]</font><font color="#4000C0">:</font>
        <font color="#000000">args</font> <font color="#4000C0">=</font> <font color="#000000">args</font> <font color="#4000C0">+</font> <font color="#4000C0">[</font><font color="#008000">"-np"</font><font color="#4000C0">,</font> <font color="#008000">"2"</font><font color="#4000C0">,</font> <font color="#008000">"-l"</font><font color="#4000C0">,</font> <font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"parallel_launch"</font><font color="#4000C0">]</font><font color="#4000C0">]</font>
        <font color="#C00000">if</font> <font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"parallel_launch"</font><font color="#4000C0">]</font> <font color="#4000C0">==</font> <font color="#008000">"srun"</font><font color="#4000C0">:</font>
            <font color="#000000">args</font> <font color="#4000C0">=</font> <font color="#000000">args</font> <font color="#4000C0">+</font> <font color="#4000C0">[</font><font color="#008000">"-la"</font><font color="#4000C0">,</font> <font color="#008000">"--overlap"</font><font color="#4000C0">]</font>
    <font color="#000000">p</font> <font color="#4000C0">=</font> <font color="#000000">subprocess</font><font color="#4000C0">.</font><font color="#000000">check_output</font><font color="#4000C0">(</font><font color="#000000">args</font><font color="#4000C0">)</font>
    <font color="#C00000">return</font> <font color="#000000">p</font>

<font color="#C00000">def</font> <font color="#000000">GetFileList</font><font color="#4000C0">(</font><font color="#000000">path0</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">def</font> <font color="#000000">gfl</font><font color="#4000C0">(</font><font color="#000000">path</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">outfiles</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#4000C0">]</font>
        <font color="#000000">files</font> <font color="#4000C0">=</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">listdir</font><font color="#4000C0">(</font><font color="#000000">path</font><font color="#4000C0">)</font>
        <font color="#C00000">for</font> <font color="#000000">f</font> <font color="#C00000">in</font> <font color="#000000">sorted</font><font color="#4000C0">(</font><font color="#000000">files</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
            <font color="#000000">fpath</font> <font color="#4000C0">=</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">path</font><font color="#4000C0">,</font> <font color="#000000">f</font><font color="#4000C0">)</font>
            <font color="#C00000">if</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">fpath</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
                <font color="#000000">outfiles</font> <font color="#4000C0">=</font> <font color="#000000">outfiles</font> <font color="#4000C0">+</font> <font color="#000000">gfl</font><font color="#4000C0">(</font><font color="#000000">fpath</font><font color="#4000C0">)</font>
            <font color="#C00000">else</font><font color="#4000C0">:</font>
                <font color="#000000">outfiles</font> <font color="#4000C0">=</font> <font color="#000000">outfiles</font> <font color="#4000C0">+</font> <font color="#4000C0">[</font><font color="#000000">fpath</font><font color="#4000C0">[</font><font color="#000000">lpath0</font><font color="#4000C0">+</font><font color="#0080C0">1</font><font color="#4000C0">:</font><font color="#4000C0">]</font><font color="#4000C0">]</font>
        <font color="#C00000">return</font> <font color="#000000">outfiles</font>
    <font color="#000000">lpath0</font> <font color="#4000C0">=</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">path0</font><font color="#4000C0">)</font>
    <font color="#C00000">return</font> <font color="#000000">gfl</font><font color="#4000C0">(</font><font color="#000000">path0</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">ListToString</font><font color="#4000C0">(</font><font color="#000000">files</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#008000">""</font>
    <font color="#C00000">for</font> <font color="#000000">f</font> <font color="#C00000">in</font> <font color="#000000">files</font><font color="#4000C0">:</font>
        <font color="#000000">s</font> <font color="#4000C0">+=</font> <font color="#000000">f</font>
        <font color="#000000">s</font> <font color="#4000C0">+=</font> <font color="#008000">"\n"</font>
    <font color="#C00000">return</font> <font color="#000000">s</font>

<font color="#C00000">def</font> <font color="#000000">GetFile</font><font color="#4000C0">(</font><font color="#000000">manyfilenames</font><font color="#4000C0">,</font> <font color="#000000">filename</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">for</font> <font color="#000000">f</font> <font color="#C00000">in</font> <font color="#000000">manyfilenames</font><font color="#4000C0">:</font>
        <font color="#C00000">if</font> <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">find</font><font color="#4000C0">(</font><font color="#000000">filename</font><font color="#4000C0">)</font> <font color="#4000C0">!=</font> <font color="#0080C0">0</font><font color="#4000C0">:</font>
            <font color="#C00000">return</font> <font color="#000000">f</font>
    <font color="#C00000">return</font> <font color="#008000">""</font>

<font color="#C00000">def</font> <font color="#000000">ReadTextFile</font><font color="#4000C0">(</font><font color="#000000">filename</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">lines</font> <font color="#4000C0">=</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#000000">filename</font><font color="#4000C0">,</font> <font color="#008000">"rt"</font><font color="#4000C0">)</font><font color="#4000C0">.</font><font color="#000000">readlines</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#008000">""</font>
    <font color="#C00000">for</font> <font color="#000000">line</font> <font color="#C00000">in</font> <font color="#000000">lines</font><font color="#4000C0">:</font>
        <font color="#000000">s</font> <font color="#4000C0">+=</font> <font color="#000000">line</font>
    <font color="#C00000">return</font> <font color="#000000">s</font>

<font color="#C00000">def</font> <font color="#000000">write_setup_plot</font><font color="#4000C0">(</font><font color="#000000">f</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'AddPlot("Pseudocolor", "pressure")\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'AddOperator("Clip")\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'clip = GetOperatorOptions(0)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'clip.plane1Normal = (0,0,1)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'clip.plane1Origin = (0,0,2.5)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'SetOperatorOptions(clip)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'AddPlot("Pseudocolor", "pressure", 1, 1)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'clip.plane1Normal = (0,0,-1)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'SetOperatorOptions(clip)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'DrawPlots()\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a = GetAnnotationAttributes()\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a.axes3D.visible = 0\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a.axes3D.bboxFlag = 0\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a.axes3D.triadFlag = 0\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a.legendInfoFlag = 0\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a.databaseInfoFlag = 0\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a.userInfoFlag = 0\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a.backgroundColor=(0,0,0,255)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a.backgroundMode=a.Solid\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'SetAnnotationAttributes(a)\n'</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">test_Z_file</font><font color="#4000C0">(</font><font color="#000000">testname</font><font color="#4000C0">,</font> <font color="#000000">varname</font><font color="#4000C0">,</font> <font color="#000000">imagefilename</font><font color="#4000C0">,</font> <font color="#000000">domask</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#008000">"""
    Decompress a float32 buffer, make a BOV file from it, and plot it.
    """</font>
    <font color="#000000">cbytes</font> <font color="#4000C0">=</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#000000">imagefilename</font><font color="#4000C0">,</font> <font color="#008000">"rb"</font><font color="#4000C0">)</font><font color="#4000C0">.</font><font color="#000000">read</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">fbytes</font> <font color="#4000C0">=</font> <font color="#000000">zlib</font><font color="#4000C0">.</font><font color="#000000">decompress</font><font color="#4000C0">(</font><font color="#000000">cbytes</font><font color="#4000C0">)</font>
    <font color="#000000">datfile</font> <font color="#4000C0">=</font> <font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">".dat"</font>
    <font color="#000000">bovfile</font> <font color="#4000C0">=</font> <font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">".bov"</font>
    <font color="#000000">f</font> <font color="#4000C0">=</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#000000">datfile</font><font color="#4000C0">,</font> <font color="#008000">"wb"</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#000000">fbytes</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">close</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">imagesize</font> <font color="#4000C0">=</font> <font color="#000000">int</font><font color="#4000C0">(</font><font color="#000000">math</font><font color="#4000C0">.</font><font color="#000000">sqrt</font><font color="#4000C0">(</font><font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">fbytes</font><font color="#4000C0">)</font><font color="#4000C0">/</font><font color="#0080C0">4</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">f</font> <font color="#4000C0">=</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#000000">bovfile</font><font color="#4000C0">,</font> <font color="#008000">"wt"</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">"TIME: 0\n"</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">"DATA_FILE: %s\n"</font> <font color="#4000C0">%</font> <font color="#000000">datfile</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">"DATA_SIZE: %d %d 1\n"</font> <font color="#4000C0">%</font> <font color="#4000C0">(</font><font color="#000000">imagesize</font><font color="#4000C0">,</font> <font color="#000000">imagesize</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">"DATA_FORMAT: FLOAT\n"</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">"VARIABLE: %s\n"</font> <font color="#4000C0">%</font> <font color="#000000">varname</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">"DATA_ENDIAN: LITTLE\n"</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">"CENTERING: zonal\n"</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">"BRICK_ORIGIN: 0 0 0\n"</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">"BRICK_SIZE: 1 1 1\n"</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">close</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">bovfile</font><font color="#4000C0">)</font>
    <font color="#C00000">if</font> <font color="#000000">domask</font><font color="#4000C0">:</font>
        <font color="#a02030"># Mask out values larger than 255 so we can see the values.</font>
        <font color="#a02030"># I'd mask on Z but I don't want to do cmfe.</font>
        <font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"maskvar"</font><font color="#4000C0">,</font> <font color="#008000">"if(gt(%s, 255), 0., %s)"</font> <font color="#4000C0">%</font> <font color="#4000C0">(</font><font color="#000000">varname</font><font color="#4000C0">,</font><font color="#000000">varname</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"maskvar"</font><font color="#4000C0">)</font>
    <font color="#C00000">else</font><font color="#4000C0">:</font>
        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#000000">varname</font><font color="#4000C0">)</font>
    <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">"Transform"</font><font color="#4000C0">)</font>
    <font color="#000000">t</font> <font color="#4000C0">=</font> <font color="#000000">TransformAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">t</font><font color="#4000C0">.</font><font color="#000000">doScale</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">t</font><font color="#4000C0">.</font><font color="#000000">scaleY</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">1</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">t</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">ResetView</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">v</font> <font color="#4000C0">=</font> <font color="#000000">GetView2D</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">v</font><font color="#4000C0">.</font><font color="#000000">viewportCoords</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">,</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">SetView2D</font><font color="#4000C0">(</font><font color="#000000">v</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_"</font> <font color="#4000C0">+</font> <font color="#000000">varname</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">bovfile</font><font color="#4000C0">)</font>

    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">unlink</font><font color="#4000C0">(</font><font color="#000000">datfile</font><font color="#4000C0">)</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">unlink</font><font color="#4000C0">(</font><font color="#000000">bovfile</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">test_composite</font><font color="#4000C0">(</font><font color="#000000">testname</font><font color="#4000C0">,</font> <font color="#000000">imagepath</font><font color="#4000C0">,</font> <font color="#000000">scalars</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#008000">"""
    Make test images for a composite image.
    """</font>
    <font color="#000000">img0</font> <font color="#4000C0">=</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">imagepath</font><font color="#4000C0">,</font> <font color="#008000">"image=0.png"</font><font color="#4000C0">)</font>
    <font color="#000000">img1</font> <font color="#4000C0">=</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">imagepath</font><font color="#4000C0">,</font> <font color="#008000">"image=1.Z"</font><font color="#4000C0">)</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">img0</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Truecolor"</font><font color="#4000C0">,</font> <font color="#008000">"color"</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">ResetView</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">v</font> <font color="#4000C0">=</font> <font color="#000000">GetView2D</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">v</font><font color="#4000C0">.</font><font color="#000000">viewportCoords</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">,</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">SetView2D</font><font color="#4000C0">(</font><font color="#000000">v</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">"_lum"</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">img0</font><font color="#4000C0">)</font>

    <font color="#000000">test_Z_file</font><font color="#4000C0">(</font><font color="#000000">testname</font><font color="#4000C0">,</font> <font color="#008000">"z"</font><font color="#4000C0">,</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">imagepath</font><font color="#4000C0">,</font> <font color="#008000">"image=1.Z"</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font>
    <font color="#000000">idx</font> <font color="#4000C0">=</font> <font color="#0080C0">2</font>
    <font color="#C00000">for</font> <font color="#000000">s</font> <font color="#C00000">in</font> <font color="#000000">scalars</font><font color="#4000C0">:</font>
        <font color="#000000">test_Z_file</font><font color="#4000C0">(</font><font color="#000000">testname</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">,</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">imagepath</font><font color="#4000C0">,</font> <font color="#008000">"image=%d.Z"</font> <font color="#4000C0">%</font> <font color="#000000">idx</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
        <font color="#000000">idx</font> <font color="#4000C0">=</font> <font color="#000000">idx</font> <font color="#4000C0">+</font> <font color="#0080C0">1</font>

<font color="#C00000">def</font> <font color="#000000">test2</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">"Cinema spec C static camera"</font><font color="#4000C0">)</font>
    <font color="#000000">f</font> <font color="#4000C0">=</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#008000">"test2.py"</font><font color="#4000C0">,</font> <font color="#008000">"wt"</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'OpenDatabase(%s)\n'</font> <font color="#4000C0">%</font> <font color="#000000">repr</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">write_setup_plot</font><font color="#4000C0">(</font><font color="#000000">f</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v = GetView3D()\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.viewNormal = (-0.569392, 0.672931, 0.472183)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.focus = (5, 0.353448, 2.5)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.viewUp = (0.562941, 0.737756, -0.372577)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.viewAngle = 30\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.parallelScale = 5.6009\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.nearPlane = -11.2018\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.farPlane = 11.2018\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.imagePan = (0.0431021, 0.0442006)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.imageZoom = 1.06444\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.perspective = 1\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.eyeAngle = 2\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.centerOfRotationSet = 0\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.centerOfRotation = (5, 0.353448, 2.5)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.axis3DScaleFlag = 0\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.axis3DScales = (1, 1, 1)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.shear = (0, 0, 1)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.windowValid = 1\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'SetView3D(v)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">close</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">cdb</font> <font color="#4000C0">=</font> <font color="#008000">"test2.cdb"</font>
    <font color="#000000">scalars</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">"pressure"</font><font color="#4000C0">,</font> <font color="#008000">"v"</font><font color="#4000C0">)</font>
    <font color="#000000">sz</font> <font color="#4000C0">=</font> <font color="#008000">"%dx%d"</font> <font color="#4000C0">%</font> <font color="#4000C0">(</font><font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"width"</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"height"</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#000000">args</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#008000">"-specification"</font><font color="#4000C0">,</font> <font color="#008000">"C"</font><font color="#4000C0">,</font> <font color="#008000">"-docomposite"</font><font color="#4000C0">,</font> <font color="#008000">"-scriptfile"</font><font color="#4000C0">,</font> <font color="#008000">"test2.py"</font><font color="#4000C0">,</font> <font color="#008000">"-output"</font><font color="#4000C0">,</font> <font color="#000000">cdb</font><font color="#4000C0">,</font> <font color="#008000">"-format"</font><font color="#4000C0">,</font> <font color="#008000">"png"</font><font color="#4000C0">,</font> <font color="#008000">"-geometry"</font><font color="#4000C0">,</font> <font color="#000000">sz</font><font color="#4000C0">,</font> <font color="#008000">"-camera"</font><font color="#4000C0">,</font> <font color="#008000">"static"</font><font color="#4000C0">,</font> <font color="#008000">"-var"</font><font color="#4000C0">,</font> <font color="#000000">scalars</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">"-var"</font><font color="#4000C0">,</font> <font color="#000000">scalars</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">]</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"cinema_2_00"</font><font color="#4000C0">,</font> <font color="#000000">ListToString</font><font color="#4000C0">(</font><font color="#000000">args</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#000000">output</font> <font color="#4000C0">=</font> <font color="#000000">GenerateCinema</font><font color="#4000C0">(</font><font color="#000000">args</font><font color="#4000C0">)</font>

    <font color="#000000">files</font> <font color="#4000C0">=</font> <font color="#000000">GetFileList</font><font color="#4000C0">(</font><font color="#000000">cdb</font><font color="#4000C0">)</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"cinema_2_01"</font><font color="#4000C0">,</font> <font color="#000000">ListToString</font><font color="#4000C0">(</font><font color="#000000">files</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#000000">json</font> <font color="#4000C0">=</font> <font color="#000000">ReadTextFile</font><font color="#4000C0">(</font><font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">cdb</font><font color="#4000C0">,</font> <font color="#000000">GetFile</font><font color="#4000C0">(</font><font color="#000000">files</font><font color="#4000C0">,</font> <font color="#008000">"info.json"</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"cinema_2_02"</font><font color="#4000C0">,</font> <font color="#000000">json</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test a couple of composite images</font>
    <font color="#000000">test_composite</font><font color="#4000C0">(</font><font color="#008000">"cinema_2_03"</font><font color="#4000C0">,</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">cdb</font><font color="#4000C0">,</font> <font color="#008000">"image"</font><font color="#4000C0">,</font><font color="#008000">"time=3"</font><font color="#4000C0">,</font><font color="#008000">"vis=0"</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">scalars</font><font color="#4000C0">)</font>
    <font color="#000000">test_composite</font><font color="#4000C0">(</font><font color="#008000">"cinema_2_04"</font><font color="#4000C0">,</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">cdb</font><font color="#4000C0">,</font> <font color="#008000">"image"</font><font color="#4000C0">,</font><font color="#008000">"time=3"</font><font color="#4000C0">,</font><font color="#008000">"vis=1"</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">scalars</font><font color="#4000C0">)</font>


<font color="#C00000">def</font> <font color="#000000">test3</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">"Cinema spec C phi-theta camera"</font><font color="#4000C0">)</font>
    <font color="#000000">f</font> <font color="#4000C0">=</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#008000">"test3.py"</font><font color="#4000C0">,</font> <font color="#008000">"wt"</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'OpenDatabase(%s)\n'</font> <font color="#4000C0">%</font> <font color="#000000">repr</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">write_setup_plot</font><font color="#4000C0">(</font><font color="#000000">f</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">close</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">cdb</font> <font color="#4000C0">=</font> <font color="#008000">"test3.cdb"</font>
    <font color="#000000">scalars</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">"pressure"</font><font color="#4000C0">,</font> <font color="#008000">"v"</font><font color="#4000C0">)</font>
    <font color="#000000">sz</font> <font color="#4000C0">=</font> <font color="#008000">"%dx%d"</font> <font color="#4000C0">%</font> <font color="#4000C0">(</font><font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"width"</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"height"</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#000000">args</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#008000">"-specification"</font><font color="#4000C0">,</font> <font color="#008000">"C"</font><font color="#4000C0">,</font> <font color="#008000">"-docomposite"</font><font color="#4000C0">,</font> <font color="#008000">"-scriptfile"</font><font color="#4000C0">,</font> <font color="#008000">"test3.py"</font><font color="#4000C0">,</font> <font color="#008000">"-output"</font><font color="#4000C0">,</font> <font color="#000000">cdb</font><font color="#4000C0">,</font> <font color="#008000">"-format"</font><font color="#4000C0">,</font> <font color="#008000">"png"</font><font color="#4000C0">,</font> <font color="#008000">"-geometry"</font><font color="#4000C0">,</font> <font color="#000000">sz</font><font color="#4000C0">,</font> <font color="#008000">"-camera"</font><font color="#4000C0">,</font> <font color="#008000">"phi-theta"</font><font color="#4000C0">,</font> <font color="#008000">"-phi"</font><font color="#4000C0">,</font> <font color="#008000">"6"</font><font color="#4000C0">,</font> <font color="#008000">"-theta"</font><font color="#4000C0">,</font> <font color="#008000">"5"</font><font color="#4000C0">,</font> <font color="#008000">"-var"</font><font color="#4000C0">,</font> <font color="#000000">scalars</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">"-var"</font><font color="#4000C0">,</font> <font color="#000000">scalars</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">]</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"cinema_3_00"</font><font color="#4000C0">,</font> <font color="#000000">ListToString</font><font color="#4000C0">(</font><font color="#000000">args</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#000000">output</font> <font color="#4000C0">=</font> <font color="#000000">GenerateCinema</font><font color="#4000C0">(</font><font color="#000000">args</font><font color="#4000C0">)</font>

    <font color="#000000">files</font> <font color="#4000C0">=</font> <font color="#000000">GetFileList</font><font color="#4000C0">(</font><font color="#000000">cdb</font><font color="#4000C0">)</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"cinema_3_01"</font><font color="#4000C0">,</font> <font color="#000000">ListToString</font><font color="#4000C0">(</font><font color="#000000">files</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#000000">json</font> <font color="#4000C0">=</font> <font color="#000000">ReadTextFile</font><font color="#4000C0">(</font><font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">cdb</font><font color="#4000C0">,</font> <font color="#000000">GetFile</font><font color="#4000C0">(</font><font color="#000000">files</font><font color="#4000C0">,</font> <font color="#008000">"info.json"</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"cinema_3_02"</font><font color="#4000C0">,</font> <font color="#000000">json</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test a couple of composite images</font>
    <font color="#000000">test_composite</font><font color="#4000C0">(</font><font color="#008000">"cinema_3_03"</font><font color="#4000C0">,</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">cdb</font><font color="#4000C0">,</font> <font color="#008000">"image"</font><font color="#4000C0">,</font><font color="#008000">"phi=0"</font><font color="#4000C0">,</font><font color="#008000">"theta=0"</font><font color="#4000C0">,</font><font color="#008000">"time=0"</font><font color="#4000C0">,</font><font color="#008000">"vis=0"</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">scalars</font><font color="#4000C0">)</font>
    <font color="#000000">test_composite</font><font color="#4000C0">(</font><font color="#008000">"cinema_3_04"</font><font color="#4000C0">,</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">cdb</font><font color="#4000C0">,</font> <font color="#008000">"image"</font><font color="#4000C0">,</font><font color="#008000">"phi=0"</font><font color="#4000C0">,</font><font color="#008000">"theta=0"</font><font color="#4000C0">,</font><font color="#008000">"time=0"</font><font color="#4000C0">,</font><font color="#008000">"vis=1"</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">scalars</font><font color="#4000C0">)</font>
    <font color="#000000">test_composite</font><font color="#4000C0">(</font><font color="#008000">"cinema_3_05"</font><font color="#4000C0">,</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">cdb</font><font color="#4000C0">,</font> <font color="#008000">"image"</font><font color="#4000C0">,</font><font color="#008000">"phi=3"</font><font color="#4000C0">,</font><font color="#008000">"theta=1"</font><font color="#4000C0">,</font><font color="#008000">"time=0"</font><font color="#4000C0">,</font><font color="#008000">"vis=0"</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">scalars</font><font color="#4000C0">)</font>
    <font color="#000000">test_composite</font><font color="#4000C0">(</font><font color="#008000">"cinema_3_06"</font><font color="#4000C0">,</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">cdb</font><font color="#4000C0">,</font> <font color="#008000">"image"</font><font color="#4000C0">,</font><font color="#008000">"phi=3"</font><font color="#4000C0">,</font><font color="#008000">"theta=1"</font><font color="#4000C0">,</font><font color="#008000">"time=0"</font><font color="#4000C0">,</font><font color="#008000">"vis=1"</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">scalars</font><font color="#4000C0">)</font>


<font color="#C00000">def</font> <font color="#000000">MakeShortWave</font><font color="#4000C0">(</font><font color="#000000">incr</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">db</font> <font color="#4000C0">=</font> <font color="#000000">abs_path</font><font color="#4000C0">(</font><font color="#008000">"short_wave.visit"</font><font color="#4000C0">)</font>
    <font color="#000000">f</font> <font color="#4000C0">=</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">,</font> <font color="#008000">"wt"</font><font color="#4000C0">)</font>
    <font color="#C00000">for</font> <font color="#000000">i</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">700</font><font color="#4000C0">,</font> <font color="#000000">incr</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">"wave%04d.silo"</font> <font color="#4000C0">%</font> <font color="#000000">i</font><font color="#4000C0">)</font> <font color="#4000C0">+</font> <font color="#008000">"\n"</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">close</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#C00000">return</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">abspath</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">main</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">test2</font><font color="#4000C0">(</font><font color="#000000">MakeShortWave</font><font color="#4000C0">(</font><font color="#0080C0">100</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">test3</font><font color="#4000C0">(</font><font color="#000000">MakeShortWave</font><font color="#4000C0">(</font><font color="#0080C0">500</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">main</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Exit</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000"></font></font></pre></body></html>