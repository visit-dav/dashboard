<html><body bgcolor="#e0e0e0"><head><title>unit/compiler_warnings.py</title></head><pre><font face="Lucida,Courier New"><font color="#a02030"># ----------------------------------------------------------------------------</font>
<font color="#a02030">#  CLASSES: nightly</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Test Case:  compiler_warnings.py</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Tests:      changes in compiler warnings</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Mark C. Miller, Sun Jul 13 21:45:49 PDT 2014</font>
<font color="#a02030"># ----------------------------------------------------------------------------</font>
<font color="#C00000">import</font> <font color="#000000">time</font><font color="#4000C0">,</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">,</font> <font color="#000000">json</font><font color="#4000C0">,</font> <font color="#000000">subprocess</font>

<font color="#C00000">def</font> <font color="#000000">ShouldSkip</font><font color="#4000C0">(</font><font color="#000000">srcfile</font><font color="#4000C0">,</font> <font color="#000000">msg</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">srcfile_tmp</font> <font color="#4000C0">=</font> <font color="#008000">&quot;global skip list&quot;</font>
    <font color="#C00000">if</font> <font color="#000000">srcfile</font> <font color="#C00000">in</font> <font color="#000000">skip_list</font><font color="#4000C0">:</font>
        <font color="#000000">srcfile_tmp</font> <font color="#4000C0">=</font> <font color="#000000">srcfile</font>
    <font color="#C00000">for</font> <font color="#000000">skipmsg</font> <font color="#C00000">in</font> <font color="#000000">skip_list</font><font color="#4000C0">[</font><font color="#000000">srcfile_tmp</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">:</font>
        <font color="#000000">minlen</font> <font color="#4000C0">=</font> <font color="#000000">min</font><font color="#4000C0">(</font><font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">skipmsg</font><font color="#4000C0">)</font><font color="#4000C0">,</font><font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">msg</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
        <font color="#C00000">if</font> <font color="#000000">msg</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">:</font><font color="#000000">minlen</font><font color="#4000C0">]</font> <font color="#4000C0">==</font> <font color="#000000">skipmsg</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">:</font><font color="#000000">minlen</font><font color="#4000C0">]</font><font color="#4000C0">:</font>
            <font color="#C00000">return</font> <font color="#0080C0">1</font>
    <font color="#C00000">return</font> <font color="#0080C0">0</font>

<font color="#000000">data_dir</font> <font color="#4000C0">=</font> <font color="#000000">test_root_path</font><font color="#4000C0">(</font><font color="#008000">&quot;..&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;data&quot;</font><font color="#4000C0">)</font>
<font color="#000000">src_dir</font> <font color="#4000C0">=</font> <font color="#000000">test_root_path</font><font color="#4000C0">(</font><font color="#008000">&quot;..&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;src&quot;</font><font color="#4000C0">)</font>
<font color="#000000">tpb_dir</font> <font color="#4000C0">=</font> <font color="#000000">test_root_path</font><font color="#4000C0">(</font><font color="#008000">&quot;..&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;src&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;third_party_builtin&quot;</font><font color="#4000C0">)</font>
<font color="#000000">qtssh_dir</font> <font color="#4000C0">=</font> <font color="#000000">test_root_path</font><font color="#4000C0">(</font><font color="#008000">&quot;..&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;src&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;tools&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;qtssh&quot;</font><font color="#4000C0">)</font>

<font color="#a02030"># skip this test if we don&#x27;t have the make.err file</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">exists</font><font color="#4000C0">(</font><font color="#000000">test_root_path</font><font color="#4000C0">(</font><font color="#008000">&quot;..&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;make.err&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">Exit</font><font color="#4000C0">(</font><font color="#0080C0">116</font><font color="#4000C0">)</font>

<font color="#a02030"># To reduce noise, only run this test on Sunday evenings</font>
<font color="#a02030"># regressiontest script stuffs a line of the form &quot;DAY_OF_WEEK=Sunday&quot;</font>
<font color="#a02030"># into first line of make.err</font>
<font color="#000000">mfile</font> <font color="#4000C0">=</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#000000">test_root_path</font><font color="#4000C0">(</font><font color="#008000">&quot;..&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;make.err&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">shouldSkip</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
<font color="#C00000">for</font> <font color="#000000">line</font> <font color="#C00000">in</font> <font color="#000000">mfile</font><font color="#4000C0">:</font>
    <font color="#C00000">if</font> <font color="#008000">&quot;DAY_OF_WEEK=Sunday&quot;</font> <font color="#C00000">in</font> <font color="#000000">line</font><font color="#4000C0">:</font>
        <font color="#000000">shouldSkip</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
        <font color="#C00000">break</font>
<font color="#000000">mfile</font><font color="#4000C0">.</font><font color="#000000">close</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#000000">shouldSkip</font><font color="#4000C0">:</font>
    <font color="#000000">Exit</font><font color="#4000C0">(</font><font color="#0080C0">116</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Read per-file skip list and zero any line numbers</font>
<font color="#a02030"># We allow line numbers there so that easy cut-n-paste</font>
<font color="#a02030"># can be used to populate skip list</font>
<font color="#a02030">#</font>
<font color="#000000">skip_list</font> <font color="#4000C0">=</font> <font color="#4000C0">{</font><font color="#4000C0">}</font>
<font color="#C00000">try</font><font color="#4000C0">:</font>
    <font color="#000000">skip_list</font> <font color="#4000C0">=</font> <font color="#000000">json</font><font color="#4000C0">.</font><font color="#000000">load</font><font color="#4000C0">(</font><font color="#000000">open</font><font color="#4000C0">(</font><font color="#000000">test_root_path</font><font color="#4000C0">(</font><font color="#008000">&quot;tests&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;unit&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;compiler_warnings_skips.json&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#C00000">except</font><font color="#4000C0">:</font>
    <font color="#C00000">pass</font>
<font color="#C00000">for</font> <font color="#000000">s</font> <font color="#C00000">in</font> <font color="#000000">skip_list</font><font color="#4000C0">:</font>
    <font color="#C00000">for</font> <font color="#000000">l</font> <font color="#C00000">in</font> <font color="#000000">skip_list</font><font color="#4000C0">[</font><font color="#000000">s</font><font color="#4000C0">]</font><font color="#4000C0">:</font>
        <font color="#C00000">for</font> <font color="#000000">m</font> <font color="#C00000">in</font> <font color="#000000">skip_list</font><font color="#4000C0">[</font><font color="#000000">s</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#000000">l</font><font color="#4000C0">]</font><font color="#4000C0">:</font>
            <font color="#000000">skip_list</font><font color="#4000C0">[</font><font color="#000000">s</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#000000">l</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#000000">m</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
        <font color="#C00000">if</font> <font color="#000000">l</font> <font color="#4000C0">==</font> <font color="#0080C0">0</font><font color="#4000C0">:</font>
            <font color="#C00000">continue</font>
        <font color="#000000">skip_list</font><font color="#4000C0">[</font><font color="#000000">s</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">skip_list</font><font color="#4000C0">[</font><font color="#000000">s</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#000000">l</font><font color="#4000C0">]</font><font color="#4000C0">;</font>
        <font color="#C00000">del</font> <font color="#000000">skip_list</font><font color="#4000C0">[</font><font color="#000000">s</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#000000">l</font><font color="#4000C0">]</font>


<font color="#a02030">#</font>
<font color="#a02030"># Examine warning messages in make output, building a single, large dictionary</font>
<font color="#a02030"># spanning all source files that produced warnings.</font>
<font color="#a02030">#   </font>
<font color="#000000">mfile</font> <font color="#4000C0">=</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#000000">test_root_path</font><font color="#4000C0">(</font><font color="#008000">&quot;..&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;make.err&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">warning_counts</font> <font color="#4000C0">=</font><font color="#4000C0">{</font><font color="#4000C0">}</font>
<font color="#000000">warning_messages</font> <font color="#4000C0">=</font> <font color="#4000C0">{</font><font color="#4000C0">}</font>
<font color="#C00000">for</font> <font color="#000000">line</font> <font color="#C00000">in</font> <font color="#000000">mfile</font><font color="#4000C0">:</font>
    <font color="#C00000">if</font> <font color="#008000">&quot;warning&quot;</font> <font color="#C00000">in</font> <font color="#000000">line</font><font color="#4000C0">.</font><font color="#000000">lower</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>

        <font color="#a02030"># get name of file generating warning</font>
        <font color="#000000">line</font> <font color="#4000C0">=</font> <font color="#000000">line</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">:</font><font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">]</font> <font color="#a02030"># remove trailing newline</font>
        <font color="#000000">warnline</font> <font color="#4000C0">=</font> <font color="#000000">line</font><font color="#4000C0">.</font><font color="#000000">partition</font><font color="#4000C0">(</font><font color="#008000">&quot;:&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">warnfile1</font> <font color="#4000C0">=</font> <font color="#000000">warnline</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font>
        <font color="#000000">warnfile2</font> <font color="#4000C0">=</font> <font color="#000000">warnfile1</font><font color="#4000C0">.</font><font color="#000000">partition</font><font color="#4000C0">(</font><font color="#008000">&quot;]&quot;</font><font color="#4000C0">)</font>
        <font color="#C00000">if</font> <font color="#000000">warnfile2</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font> <font color="#4000C0">==</font> <font color="#008000">&quot;]&quot;</font><font color="#4000C0">:</font>
            <font color="#000000">warnfile</font> <font color="#4000C0">=</font> <font color="#000000">warnfile2</font><font color="#4000C0">[</font><font color="#0080C0">2</font><font color="#4000C0">]</font><font color="#4000C0">.</font><font color="#000000">replace</font><font color="#4000C0">(</font><font color="#008000">&quot; &quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;&quot;</font><font color="#4000C0">)</font>
        <font color="#C00000">else</font><font color="#4000C0">:</font>
            <font color="#000000">warnfile</font> <font color="#4000C0">=</font> <font color="#000000">warnfile2</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font>

        <font color="#C00000">if</font> <font color="#000000">warnfile</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">:</font><font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">src_dir</font><font color="#4000C0">)</font><font color="#4000C0">:</font><font color="#0080C0">1</font><font color="#4000C0">]</font> <font color="#4000C0">!=</font> <font color="#000000">src_dir</font><font color="#4000C0">:</font>
            <font color="#C00000">continue</font> <font color="#a02030"># ignore files not in our src dir, not our code</font>
        <font color="#C00000">if</font> <font color="#000000">warnfile</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">:</font><font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">tpb_dir</font><font color="#4000C0">)</font><font color="#4000C0">:</font><font color="#0080C0">1</font><font color="#4000C0">]</font> <font color="#4000C0">==</font> <font color="#000000">tpb_dir</font><font color="#4000C0">:</font>
            <font color="#C00000">continue</font> <font color="#a02030"># ignore files in third_party_builtin, not our code</font>
        <font color="#C00000">if</font> <font color="#000000">warnfile</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">:</font><font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">data_dir</font><font color="#4000C0">)</font><font color="#4000C0">:</font><font color="#0080C0">1</font><font color="#4000C0">]</font> <font color="#4000C0">==</font> <font color="#000000">data_dir</font><font color="#4000C0">:</font>
            <font color="#C00000">continue</font> <font color="#a02030"># ignore files in data dir, not relevant to VisIt for users</font>
        <font color="#C00000">if</font> <font color="#000000">warnfile</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">:</font><font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">qtssh_dir</font><font color="#4000C0">)</font><font color="#4000C0">:</font><font color="#0080C0">1</font><font color="#4000C0">]</font> <font color="#4000C0">==</font> <font color="#000000">qtssh_dir</font><font color="#4000C0">:</font>
            <font color="#C00000">continue</font> <font color="#a02030"># ignore files in qtssh dir, not our code </font>

        <font color="#000000">src_file</font> <font color="#4000C0">=</font> <font color="#000000">warnfile</font><font color="#4000C0">[</font><font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">src_dir</font><font color="#4000C0">)</font><font color="#4000C0">+</font><font color="#0080C0">1</font><font color="#4000C0">:</font><font color="#4000C0">:</font><font color="#0080C0">1</font><font color="#4000C0">]</font>
        <font color="#C00000">if</font> <font color="#000000">warnline</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font> <font color="#4000C0">==</font> <font color="#008000">&quot;:&quot;</font> <font color="#C00000">and</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">exists</font><font color="#4000C0">(</font><font color="#000000">warnfile</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
            <font color="#000000">msginfo</font> <font color="#4000C0">=</font> <font color="#000000">warnline</font><font color="#4000C0">[</font><font color="#0080C0">2</font><font color="#4000C0">]</font><font color="#4000C0">.</font><font color="#000000">partition</font><font color="#4000C0">(</font><font color="#008000">&quot;:&quot;</font><font color="#4000C0">)</font>
            <font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">msginfo</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">.</font><font color="#000000">isdigit</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
                <font color="#C00000">continue</font> <font color="#a02030"># probably a garbled message in make.err</font>
            <font color="#000000">lineno</font> <font color="#4000C0">=</font> <font color="#000000">int</font><font color="#4000C0">(</font><font color="#000000">msginfo</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
            <font color="#000000">rawmsg</font> <font color="#4000C0">=</font> <font color="#000000">msginfo</font><font color="#4000C0">[</font><font color="#0080C0">2</font><font color="#4000C0">]</font>
            <font color="#000000">idx</font> <font color="#4000C0">=</font> <font color="#000000">rawmsg</font><font color="#4000C0">.</font><font color="#000000">find</font><font color="#4000C0">(</font><font color="#008000">&quot;warning&quot;</font><font color="#4000C0">)</font>
            <font color="#C00000">if</font> <font color="#000000">idx</font> <font color="#4000C0">&gt;</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">:</font>
                <font color="#000000">msg</font> <font color="#4000C0">=</font> <font color="#000000">rawmsg</font><font color="#4000C0">[</font><font color="#000000">idx</font><font color="#4000C0">:</font><font color="#4000C0">:</font><font color="#0080C0">1</font><font color="#4000C0">]</font>
            <font color="#C00000">else</font><font color="#4000C0">:</font>
                <font color="#000000">msg</font> <font color="#4000C0">=</font> <font color="#000000">rawmsg</font>
            <font color="#C00000">if</font> <font color="#000000">msg</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">:</font><font color="#000000">len</font><font color="#4000C0">(</font><font color="#008000">&quot;warning: &quot;</font><font color="#4000C0">)</font><font color="#4000C0">]</font> <font color="#4000C0">==</font> <font color="#008000">&quot;warning: &quot;</font><font color="#4000C0">:</font>
                <font color="#000000">msg</font> <font color="#4000C0">=</font> <font color="#000000">msg</font><font color="#4000C0">[</font><font color="#000000">len</font><font color="#4000C0">(</font><font color="#008000">&quot;warning: &quot;</font><font color="#4000C0">)</font><font color="#4000C0">:</font><font color="#4000C0">:</font><font color="#0080C0">1</font><font color="#4000C0">]</font>
            <font color="#000000">msg_ascii</font> <font color="#4000C0">=</font> <font color="#000000">msg</font><font color="#4000C0">.</font><font color="#000000">decode</font><font color="#4000C0">(</font><font color="#008000">&#x27;unicode_escape&#x27;</font><font color="#4000C0">)</font><font color="#4000C0">.</font><font color="#000000">encode</font><font color="#4000C0">(</font><font color="#008000">&#x27;ascii&#x27;</font><font color="#4000C0">,</font><font color="#008000">&#x27;ignore&#x27;</font><font color="#4000C0">)</font>
            <font color="#000000">msg</font> <font color="#4000C0">=</font> <font color="#000000">msg_ascii</font>

            <font color="#C00000">if</font> <font color="#000000">ShouldSkip</font><font color="#4000C0">(</font><font color="#000000">src_file</font><font color="#4000C0">,</font> <font color="#000000">msg</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
                <font color="#C00000">continue</font>

            <font color="#C00000">if</font> <font color="#000000">src_file</font> <font color="#C00000">in</font> <font color="#000000">warning_counts</font><font color="#4000C0">:</font>
                <font color="#000000">warning_counts</font><font color="#4000C0">[</font><font color="#000000">src_file</font><font color="#4000C0">]</font> <font color="#4000C0">+=</font> <font color="#0080C0">1</font>
                <font color="#C00000">if</font> <font color="#000000">lineno</font> <font color="#C00000">in</font> <font color="#000000">warning_messages</font><font color="#4000C0">[</font><font color="#000000">src_file</font><font color="#4000C0">]</font><font color="#4000C0">:</font>
                    <font color="#C00000">if</font> <font color="#000000">msg</font> <font color="#C00000">in</font> <font color="#000000">warning_messages</font><font color="#4000C0">[</font><font color="#000000">src_file</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#000000">lineno</font><font color="#4000C0">]</font><font color="#4000C0">:</font>
                        <font color="#000000">warning_messages</font><font color="#4000C0">[</font><font color="#000000">src_file</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#000000">lineno</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#000000">msg</font><font color="#4000C0">]</font> <font color="#4000C0">+=</font> <font color="#0080C0">1</font>
                    <font color="#C00000">else</font><font color="#4000C0">:</font>
                        <font color="#000000">warning_messages</font><font color="#4000C0">[</font><font color="#000000">src_file</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#000000">lineno</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#000000">msg</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
                <font color="#C00000">else</font><font color="#4000C0">:</font>
                    <font color="#000000">warning_messages</font><font color="#4000C0">[</font><font color="#000000">src_file</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#000000">lineno</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">{</font><font color="#000000">msg</font><font color="#4000C0">:</font><font color="#0080C0">1</font><font color="#4000C0">}</font>
            <font color="#C00000">else</font><font color="#4000C0">:</font>
                <font color="#000000">warning_counts</font><font color="#4000C0">[</font><font color="#000000">src_file</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
                <font color="#000000">warning_messages</font><font color="#4000C0">[</font><font color="#000000">src_file</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">{</font><font color="#000000">lineno</font><font color="#4000C0">:</font><font color="#4000C0">{</font><font color="#000000">msg</font><font color="#4000C0">:</font><font color="#0080C0">1</font><font color="#4000C0">}</font><font color="#4000C0">}</font>

<font color="#000000">mfile</font><font color="#4000C0">.</font><font color="#000000">close</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Load in current warning counts baseline data</font>
<font color="#a02030">#</font>
<font color="#000000">baseline_counts</font> <font color="#4000C0">=</font> <font color="#4000C0">{</font><font color="#4000C0">}</font>
<font color="#C00000">try</font><font color="#4000C0">:</font>
    <font color="#000000">baseline_counts</font> <font color="#4000C0">=</font> <font color="#000000">json</font><font color="#4000C0">.</font><font color="#000000">load</font><font color="#4000C0">(</font><font color="#000000">open</font><font color="#4000C0">(</font><font color="#000000">test_baseline_path</font><font color="#4000C0">(</font><font color="#008000">&quot;unit&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;compiler_warnings&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;warning_counts_by_file.txt&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#C00000">except</font><font color="#4000C0">:</font>
    <font color="#C00000">pass</font>

<font color="#000000">improved_counts</font> <font color="#4000C0">=</font> <font color="#4000C0">{</font><font color="#4000C0">}</font>
<font color="#000000">worsened_counts</font> <font color="#4000C0">=</font> <font color="#4000C0">{</font><font color="#4000C0">}</font>
<font color="#C00000">for</font> <font color="#000000">f</font> <font color="#C00000">in</font> <font color="#000000">warning_counts</font><font color="#4000C0">:</font>
    <font color="#C00000">if</font> <font color="#000000">f</font> <font color="#C00000">in</font> <font color="#000000">baseline_counts</font><font color="#4000C0">:</font>
        <font color="#C00000">if</font> <font color="#000000">warning_counts</font><font color="#4000C0">[</font><font color="#000000">f</font><font color="#4000C0">]</font> <font color="#4000C0">&gt;</font> <font color="#000000">baseline_counts</font><font color="#4000C0">[</font><font color="#000000">f</font><font color="#4000C0">]</font><font color="#4000C0">:</font>
            <font color="#000000">worsened_counts</font><font color="#4000C0">[</font><font color="#000000">f</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">warning_counts</font><font color="#4000C0">[</font><font color="#000000">f</font><font color="#4000C0">]</font>
        <font color="#C00000">elif</font> <font color="#000000">warning_counts</font><font color="#4000C0">[</font><font color="#000000">f</font><font color="#4000C0">]</font> <font color="#4000C0">&lt;</font> <font color="#000000">baseline_counts</font><font color="#4000C0">[</font><font color="#000000">f</font><font color="#4000C0">]</font><font color="#4000C0">:</font>
            <font color="#000000">improved_counts</font><font color="#4000C0">[</font><font color="#000000">f</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">warning_counts</font><font color="#4000C0">[</font><font color="#000000">f</font><font color="#4000C0">]</font>
            <font color="#000000">baseline_counts</font><font color="#4000C0">[</font><font color="#000000">f</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">warning_counts</font><font color="#4000C0">[</font><font color="#000000">f</font><font color="#4000C0">]</font>
    <font color="#C00000">else</font><font color="#4000C0">:</font>
        <font color="#000000">worsened_counts</font><font color="#4000C0">[</font><font color="#000000">f</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">warning_counts</font><font color="#4000C0">[</font><font color="#000000">f</font><font color="#4000C0">]</font>
<font color="#C00000">for</font> <font color="#000000">f</font> <font color="#C00000">in</font> <font color="#000000">baseline_counts</font><font color="#4000C0">:</font>
    <font color="#C00000">if</font> <font color="#000000">f</font> <font color="#C00000">not</font> <font color="#C00000">in</font> <font color="#000000">warning_counts</font><font color="#4000C0">:</font>
        <font color="#000000">improved_counts</font><font color="#4000C0">[</font><font color="#000000">f</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
<font color="#C00000">for</font> <font color="#000000">f</font> <font color="#C00000">in</font> <font color="#000000">improved_counts</font><font color="#4000C0">:</font>
    <font color="#C00000">if</font> <font color="#000000">improved_counts</font><font color="#4000C0">[</font><font color="#000000">f</font><font color="#4000C0">]</font> <font color="#4000C0">==</font> <font color="#0080C0">0</font> <font color="#C00000">and</font> <font color="#000000">f</font> <font color="#C00000">in</font> <font color="#000000">baseline_counts</font><font color="#4000C0">:</font>
        <font color="#C00000">del</font> <font color="#000000">baseline_counts</font><font color="#4000C0">[</font><font color="#000000">f</font><font color="#4000C0">]</font>

<font color="#a02030">#</font>
<font color="#a02030"># If there were improvements, re-baseline counts file</font>
<font color="#a02030">#</font>
<font color="#C00000">if</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">improved_counts</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">bfilename</font> <font color="#4000C0">=</font> <font color="#000000">test_baseline_path</font><font color="#4000C0">(</font><font color="#008000">&quot;unit&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;compiler_warnings&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;warning_counts_by_file.txt&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">bfile</font> <font color="#4000C0">=</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#000000">bfilename</font><font color="#4000C0">,</font><font color="#008000">&quot;w+&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">json</font><font color="#4000C0">.</font><font color="#000000">dump</font><font color="#4000C0">(</font><font color="#000000">baseline_counts</font><font color="#4000C0">,</font><font color="#000000">bfile</font><font color="#4000C0">,</font><font color="#000000">indent</font><font color="#4000C0">=</font><font color="#0080C0">4</font><font color="#4000C0">,</font><font color="#000000">sort_keys</font><font color="#4000C0">=</font><font color="#C00000">True</font><font color="#4000C0">)</font>
    <font color="#000000">bfile</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&quot;\n&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">bfile</font><font color="#4000C0">.</font><font color="#000000">close</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">retval</font> <font color="#4000C0">=</font> <font color="#000000">subprocess</font><font color="#4000C0">.</font><font color="#000000">call</font><font color="#4000C0">(</font><font color="#4000C0">[</font><font color="#008000">&quot;/usr/bin/svn&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;commit&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;-m&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;&#x27;Updating warning counts&#x27;&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;%s&quot;</font><font color="#4000C0">%</font><font color="#000000">bfilename</font><font color="#4000C0">]</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Generate the (sorted) warning counts data</font>
<font color="#a02030">#</font>
<font color="#000000">counts_txt</font> <font color="#4000C0">=</font> <font color="#008000">&quot;{\n&quot;</font>
<font color="#000000">keys</font> <font color="#4000C0">=</font> <font color="#000000">list</font><font color="#4000C0">(</font><font color="#000000">worsened_counts</font><font color="#4000C0">.</font><font color="#000000">keys</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">keys</font><font color="#4000C0">.</font><font color="#000000">sort</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#C00000">for</font> <font color="#000000">k</font> <font color="#C00000">in</font> <font color="#000000">keys</font><font color="#4000C0">:</font>
    <font color="#000000">counts_txt</font> <font color="#4000C0">+=</font> <font color="#008000">&quot;\&quot;%s\&quot;: %d,\n&quot;</font><font color="#4000C0">%</font><font color="#4000C0">(</font><font color="#000000">k</font><font color="#4000C0">,</font><font color="#000000">worsened_counts</font><font color="#4000C0">[</font><font color="#000000">k</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
<font color="#000000">counts_txt</font> <font color="#4000C0">+=</font> <font color="#008000">&quot;\&quot;last line\&quot;: 0\n}\n&quot;</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;worsened_counts_by_file&quot;</font><font color="#4000C0">,</font> <font color="#000000">counts_txt</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Ok, tricky here. Append all the warning details to the html file</font>
<font color="#a02030"># so others can actually see it</font>
<font color="#a02030">#</font>
<font color="#000000">uniq_msgs</font> <font color="#4000C0">=</font> <font color="#4000C0">{</font><font color="#4000C0">}</font>
<font color="#000000">tot_files</font> <font color="#4000C0">=</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">warning_counts</font><font color="#4000C0">)</font>
<font color="#000000">tot_cnt</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
<font color="#000000">tot_uniq_cnt</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
<font color="#C00000">for</font> <font color="#000000">srcfile</font> <font color="#C00000">in</font> <font color="#000000">warning_messages</font><font color="#4000C0">:</font>
    <font color="#C00000">for</font> <font color="#000000">lineno</font> <font color="#C00000">in</font> <font color="#000000">warning_messages</font><font color="#4000C0">[</font><font color="#000000">srcfile</font><font color="#4000C0">]</font><font color="#4000C0">:</font>
        <font color="#C00000">for</font> <font color="#000000">msg</font> <font color="#C00000">in</font> <font color="#000000">warning_messages</font><font color="#4000C0">[</font><font color="#000000">srcfile</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#000000">lineno</font><font color="#4000C0">]</font><font color="#4000C0">:</font>
            <font color="#C00000">if</font> <font color="#000000">msg</font> <font color="#C00000">not</font> <font color="#C00000">in</font> <font color="#000000">uniq_msgs</font><font color="#4000C0">:</font>
                <font color="#000000">uniq_msgs</font><font color="#4000C0">[</font><font color="#000000">msg</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
            <font color="#C00000">else</font><font color="#4000C0">:</font>
                <font color="#000000">uniq_msgs</font><font color="#4000C0">[</font><font color="#000000">msg</font><font color="#4000C0">]</font> <font color="#4000C0">+=</font> <font color="#0080C0">1</font>
            <font color="#000000">tot_uniq_cnt</font> <font color="#4000C0">+=</font> <font color="#0080C0">1</font>
            <font color="#000000">tot_cnt</font> <font color="#4000C0">+=</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">warning_messages</font><font color="#4000C0">[</font><font color="#000000">srcfile</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#000000">lineno</font><font color="#4000C0">]</font><font color="#4000C0">)</font>


<font color="#000000">f</font> <font color="#4000C0">=</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#008000">&quot;html&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;worsened_counts_by_file.html&quot;</font><font color="#4000C0">)</font><font color="#4000C0">,</font><font color="#008000">&quot;a&quot;</font><font color="#4000C0">)</font>
<font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&quot;&lt;pre&gt;\n&quot;</font><font color="#4000C0">)</font>
<font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&quot;\n\n\nTotal warnings %d\n&quot;</font><font color="#4000C0">%</font><font color="#000000">tot_cnt</font><font color="#4000C0">)</font>
<font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&quot;Total files with warnings %d\n&quot;</font><font color="#4000C0">%</font><font color="#000000">tot_files</font><font color="#4000C0">)</font>
<font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&quot;Total unique warnings %d\n&quot;</font><font color="#4000C0">%</font><font color="#000000">tot_uniq_cnt</font><font color="#4000C0">)</font>
<font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&quot;Unique warning messages by count...\n&quot;</font><font color="#4000C0">)</font>
<font color="#000000">sorted_uniq_msgs</font> <font color="#4000C0">=</font> <font color="#000000">sorted</font><font color="#4000C0">(</font><font color="#000000">uniq_msgs</font><font color="#4000C0">,</font> <font color="#000000">key</font><font color="#4000C0">=</font><font color="#000000">uniq_msgs</font><font color="#4000C0">.</font><font color="#000000">get</font><font color="#4000C0">,</font> <font color="#000000">reverse</font><font color="#4000C0">=</font><font color="#C00000">True</font><font color="#4000C0">)</font>
<font color="#C00000">for</font> <font color="#000000">msg</font> <font color="#C00000">in</font> <font color="#000000">sorted_uniq_msgs</font><font color="#4000C0">:</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&quot;%d: \&quot;%s\&quot;\n&quot;</font><font color="#4000C0">%</font><font color="#4000C0">(</font><font color="#000000">uniq_msgs</font><font color="#4000C0">[</font><font color="#000000">msg</font><font color="#4000C0">]</font><font color="#4000C0">,</font><font color="#000000">msg</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&quot;\n\n\nWarning message details by file and line number...\n&quot;</font><font color="#4000C0">)</font><font color="#4000C0">;</font>
<font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#000000">json</font><font color="#4000C0">.</font><font color="#000000">dumps</font><font color="#4000C0">(</font><font color="#000000">warning_messages</font><font color="#4000C0">,</font><font color="#000000">indent</font><font color="#4000C0">=</font><font color="#0080C0">4</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&quot;\n\n\nWarning message strings currently being skipped if matched...\n&quot;</font><font color="#4000C0">)</font>
<font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#000000">json</font><font color="#4000C0">.</font><font color="#000000">dumps</font><font color="#4000C0">(</font><font color="#000000">skip_list</font><font color="#4000C0">,</font><font color="#000000">indent</font><font color="#4000C0">=</font><font color="#0080C0">4</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&quot;&lt;/pre&gt;\n&quot;</font><font color="#4000C0">)</font>
<font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">close</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">Exit</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000"></font></font></pre></body></html>