<html><body bgcolor="#e0e0e0"><head><title>plots/molecule.py</title></head><pre><font face="Lucida,Courier New"><font color="#a02030"># ----------------------------------------------------------------------------</font>
<font color="#a02030">#  CLASSES: nightly</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Test Case:  molecule.py</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Tests:      mesh      - 3D points</font>
<font color="#a02030">#              plots     - Molecule</font>
<font color="#a02030">#              operators - CreateBonds, Replicate</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Programmer: Kathleen Biagas </font>
<font color="#a02030">#  Date:       June 15, 2021 </font>
<font color="#a02030">#</font>
<font color="#a02030">#  Modifications:</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Kathleen Biagas, Tue Jul 13 09:51:58 PDT 2021</font>
<font color="#a02030">#    Changed retrieval of renAtts from 'RenderingAttributes' to</font>
<font color="#a02030">#    'GetRenderingAttributes' when turning off specular highlighting. This</font>
<font color="#a02030">#    fixes a bug in scalable,parallel,icet mode where molecule_04 test would</font>
<font color="#a02030">#    fail to plot.</font>
<font color="#a02030">#</font>
<font color="#a02030"># ----------------------------------------------------------------------------</font>

<font color="#C00000">def</font> <font color="#000000">SetGradientBackground</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">annot</font> <font color="#4000C0">=</font> <font color="#000000">GetAnnotationAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">annot</font><font color="#4000C0">.</font><font color="#000000">backgroundMode</font> <font color="#4000C0">=</font> <font color="#000000">annot</font><font color="#4000C0">.</font><font color="#000000">Gradient</font>
    <font color="#000000">annot</font><font color="#4000C0">.</font><font color="#000000">gradientBackgroundStyle</font> <font color="#4000C0">=</font> <font color="#000000">annot</font><font color="#4000C0">.</font><font color="#000000">Radial</font>
    <font color="#000000">annot</font><font color="#4000C0">.</font><font color="#000000">gradientColor1</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">102</font><font color="#4000C0">,</font> <font color="#0080C0">102</font><font color="#4000C0">,</font> <font color="#0080C0">153</font><font color="#4000C0">,</font> <font color="#0080C0">255</font><font color="#4000C0">)</font>
    <font color="#000000">annot</font><font color="#4000C0">.</font><font color="#000000">gradientColor2</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">255</font><font color="#4000C0">)</font>
    <font color="#000000">annot</font><font color="#4000C0">.</font><font color="#000000">backgroundColor</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">255</font><font color="#4000C0">)</font>
    <font color="#000000">annot</font><font color="#4000C0">.</font><font color="#000000">foregroundColor</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">255</font><font color="#4000C0">,</font> <font color="#0080C0">255</font><font color="#4000C0">,</font> <font color="#0080C0">255</font><font color="#4000C0">,</font> <font color="#0080C0">255</font><font color="#4000C0">)</font>
    <font color="#000000">SetAnnotationAttributes</font><font color="#4000C0">(</font><font color="#000000">annot</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">SetWhiteBackground</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">annot</font> <font color="#4000C0">=</font> <font color="#000000">GetAnnotationAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">annot</font><font color="#4000C0">.</font><font color="#000000">backgroundMode</font> <font color="#4000C0">=</font> <font color="#000000">annot</font><font color="#4000C0">.</font><font color="#000000">Solid</font>
    <font color="#000000">annot</font><font color="#4000C0">.</font><font color="#000000">foregroundColor</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">255</font><font color="#4000C0">)</font>
    <font color="#000000">annot</font><font color="#4000C0">.</font><font color="#000000">backgroundColor</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">255</font><font color="#4000C0">,</font> <font color="#0080C0">255</font><font color="#4000C0">,</font> <font color="#0080C0">255</font><font color="#4000C0">,</font> <font color="#0080C0">255</font><font color="#4000C0">)</font>
    <font color="#000000">SetAnnotationAttributes</font><font color="#4000C0">(</font><font color="#000000">annot</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">Test500x500</font><font color="#4000C0">(</font><font color="#000000">name</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#a02030"># Save these images somewhat larger than a regular test case image</font>
    <font color="#a02030"># to better see the molecules </font>
    <font color="#000000">backup</font> <font color="#4000C0">=</font> <font color="#000000">GetSaveWindowAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">swa</font> <font color="#4000C0">=</font> <font color="#000000">SaveWindowAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">swa</font><font color="#4000C0">.</font><font color="#000000">width</font> <font color="#4000C0">=</font> <font color="#0080C0">500</font>
    <font color="#000000">swa</font><font color="#4000C0">.</font><font color="#000000">height</font> <font color="#4000C0">=</font> <font color="#0080C0">500</font>
    <font color="#000000">swa</font><font color="#4000C0">.</font><font color="#000000">screenCapture</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#000000">name</font><font color="#4000C0">,</font> <font color="#000000">swa</font><font color="#4000C0">)</font>
    <font color="#000000">SetSaveWindowAttributes</font><font color="#4000C0">(</font><font color="#000000">backup</font><font color="#4000C0">)</font>


<font color="#C00000">def</font> <font color="#000000">MoleculeOnly</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#a02030"># images similar to those in Molecule Plot docs</font>

    <font color="#000000">SetGradientBackground</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#a02030"># add specular highlighting</font>
    <font color="#000000">renAtts</font> <font color="#4000C0">=</font> <font color="#000000">GetRenderingAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">renAtts</font><font color="#4000C0">.</font><font color="#000000">specularFlag</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">SetRenderingAttributes</font><font color="#4000C0">(</font><font color="#000000">renAtts</font><font color="#4000C0">)</font>

    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">data_path</font><font color="#4000C0">(</font><font color="#008000">"ProteinDataBank_test_data/crotamine.pdb"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#a02030"># color by element, Covalent radius, no bonds</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Molecule"</font><font color="#4000C0">,</font> <font color="#008000">"element"</font><font color="#4000C0">)</font>
    <font color="#000000">mol</font> <font color="#4000C0">=</font> <font color="#000000">MoleculeAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">drawAtomsAs</font>   <font color="#4000C0">=</font> <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">SphereAtoms</font>
    <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">scaleRadiusBy</font> <font color="#4000C0">=</font> <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">Covalent</font>
    <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">drawBondsAs</font>   <font color="#4000C0">=</font> <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">NoBonds</font>
    <font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">mol</font><font color="#4000C0">)</font>

    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">v3d</font> <font color="#4000C0">=</font> <font color="#000000">GetView3D</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">v3d</font><font color="#4000C0">.</font><font color="#000000">viewNormal</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.784142</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">0.592494</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">0.184587</font><font color="#4000C0">)</font>
    <font color="#000000">v3d</font><font color="#4000C0">.</font><font color="#000000">viewUp</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#4000C0">-</font><font color="#0080C0">0.554863</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">0.536159</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">0.636129</font><font color="#4000C0">)</font>
    <font color="#000000">v3d</font><font color="#4000C0">.</font><font color="#000000">imageZoom</font> <font color="#4000C0">=</font> <font color="#0080C0">1.77156</font>
    <font color="#000000">SetView3D</font><font color="#4000C0">(</font><font color="#000000">v3d</font><font color="#4000C0">)</font>

    <font color="#000000">Test500x500</font><font color="#4000C0">(</font><font color="#008000">"molecule_01"</font><font color="#4000C0">)</font>

    <font color="#a02030"># color by residue, cylinder bonds, radius proportional to covalent radius</font>
    <font color="#000000">ChangeActivePlotsVar</font><font color="#4000C0">(</font><font color="#008000">"restype"</font><font color="#4000C0">)</font>
    <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">drawBondsAs</font> <font color="#4000C0">=</font> <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">CylinderBonds</font>
    <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">radiusScaleFactor</font> <font color="#4000C0">=</font> <font color="#0080C0">0.5</font>
    <font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">mol</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test500x500</font><font color="#4000C0">(</font><font color="#008000">"molecule_02"</font><font color="#4000C0">)</font>

    <font color="#a02030"># color by scalar (x-coord), no bonds</font>
    <font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"x"</font><font color="#4000C0">,</font> <font color="#008000">"coord(mesh)[0]"</font><font color="#4000C0">)</font>
    <font color="#000000">ChangeActivePlotsVar</font><font color="#4000C0">(</font><font color="#008000">"x"</font><font color="#4000C0">)</font>
    <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">drawAtomsAs</font> <font color="#4000C0">=</font> <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">NoAtoms</font>
    <font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">mol</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test500x500</font><font color="#4000C0">(</font><font color="#008000">"molecule_03"</font><font color="#4000C0">)</font>

    <font color="#a02030"># Create a blue-purple color table</font>
    <font color="#000000">ccpl</font> <font color="#4000C0">=</font> <font color="#000000">ColorControlPointList</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">ccpl</font><font color="#4000C0">.</font><font color="#000000">discreteFlag</font><font color="#4000C0">=</font><font color="#0080C0">1</font>
    <font color="#000000">ccpl</font><font color="#4000C0">.</font><font color="#000000">smoothing</font><font color="#4000C0">=</font><font color="#000000">ccpl</font><font color="#4000C0">.</font><font color="#000000">NONE</font>
    <font color="#000000">ccpl</font><font color="#4000C0">.</font><font color="#000000">equalSpacingFlag</font><font color="#4000C0">=</font><font color="#0080C0">1</font>
    <font color="#000000">p1</font> <font color="#4000C0">=</font> <font color="#000000">ColorControlPoint</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">p1</font><font color="#4000C0">.</font><font color="#000000">colors</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">51</font><font color="#4000C0">,</font> <font color="#0080C0">51</font><font color="#4000C0">,</font> <font color="#0080C0">153</font><font color="#4000C0">,</font> <font color="#0080C0">255</font><font color="#4000C0">)</font>
    <font color="#000000">p1</font><font color="#4000C0">.</font><font color="#000000">position</font> <font color="#4000C0">=</font>  <font color="#0080C0">0</font>
    <font color="#000000">ccpl</font><font color="#4000C0">.</font><font color="#000000">AddControlPoints</font><font color="#4000C0">(</font><font color="#000000">p1</font><font color="#4000C0">)</font>
    <font color="#000000">p2</font> <font color="#4000C0">=</font> <font color="#000000">ColorControlPoint</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">p2</font><font color="#4000C0">.</font><font color="#000000">colors</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">204</font><font color="#4000C0">,</font><font color="#0080C0">153</font><font color="#4000C0">,</font> <font color="#0080C0">255</font><font color="#4000C0">,</font> <font color="#0080C0">255</font><font color="#4000C0">)</font>
    <font color="#000000">p2</font><font color="#4000C0">.</font><font color="#000000">position</font> <font color="#4000C0">=</font>  <font color="#0080C0">1</font>
    <font color="#000000">ccpl</font><font color="#4000C0">.</font><font color="#000000">AddControlPoints</font><font color="#4000C0">(</font><font color="#000000">p2</font><font color="#4000C0">)</font>
    <font color="#000000">AddColorTable</font><font color="#4000C0">(</font><font color="#008000">"BluePurp2"</font><font color="#4000C0">,</font> <font color="#000000">ccpl</font><font color="#4000C0">)</font>

    <font color="#a02030"># color by backbone, atom and cylinder-bonds same fixed radius</font>
    <font color="#a02030"># special color table</font>
    <font color="#000000">ChangeActivePlotsVar</font><font color="#4000C0">(</font><font color="#008000">"backbone"</font><font color="#4000C0">)</font>
    <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">continuousColorTable</font><font color="#4000C0">=</font><font color="#008000">"BluePurp2"</font>
    <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">drawAtomsAs</font> <font color="#4000C0">=</font> <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">SphereAtoms</font>
    <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">drawBondsAs</font> <font color="#4000C0">=</font> <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">CylinderBonds</font>
    <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">scaleRadiusBy</font> <font color="#4000C0">=</font> <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">Fixed</font>
    <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">radiusFixed</font> <font color="#4000C0">=</font> <font color="#0080C0">0.2</font>
    <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">bondRadius</font> <font color="#4000C0">=</font> <font color="#0080C0">0.2</font>
    <font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">mol</font><font color="#4000C0">)</font>

    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#a02030"># turn off specular highlighting</font>
    <font color="#000000">renAtts</font> <font color="#4000C0">=</font> <font color="#000000">GetRenderingAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">renAtts</font><font color="#4000C0">.</font><font color="#000000">specularFlag</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
    <font color="#000000">SetRenderingAttributes</font><font color="#4000C0">(</font><font color="#000000">renAtts</font><font color="#4000C0">)</font>
    <font color="#000000">Test500x500</font><font color="#4000C0">(</font><font color="#008000">"molecule_04"</font><font color="#4000C0">)</font>

    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#a02030"># ensure engine/viewer doesn't crash when using ImposterAtoms and scaleRadiusBy option is changed</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Molecule"</font><font color="#4000C0">,</font> <font color="#008000">"element"</font><font color="#4000C0">)</font>
    <font color="#a02030"># get Fresh atts</font>
    <font color="#000000">mol</font> <font color="#4000C0">=</font> <font color="#000000">MoleculeAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#a02030"># set up sphere imposters</font>
    <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">drawAtomsAs</font> <font color="#4000C0">=</font> <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">ImposterAtoms</font>
    <font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">mol</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test500x500</font><font color="#4000C0">(</font><font color="#008000">"molecule_05"</font><font color="#4000C0">)</font>
    <font color="#a02030"># now change scaleRadiusBy</font>
    <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">scaleRadiusBy</font> <font color="#4000C0">=</font> <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">Covalent</font>
    <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">radiusScaleFactor</font><font color="#4000C0">=</font><font color="#0080C0">4</font>
    <font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">mol</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test500x500</font><font color="#4000C0">(</font><font color="#008000">"molecule_06"</font><font color="#4000C0">)</font>

    <font color="#a02030"># changing radiusScaleFactor while using Imposter atoms used to crash the viewer</font>
    <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">radiusScaleFactor</font><font color="#4000C0">=</font><font color="#0080C0">0.002</font>
    <font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">mol</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test500x500</font><font color="#4000C0">(</font><font color="#008000">"molecule_07"</font><font color="#4000C0">)</font>

    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">data_path</font><font color="#4000C0">(</font><font color="#008000">"ProteinDataBank_test_data/crotamine.pdb"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">ReplicateAddBonds</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">"Replicate and CreateBonds operators with Molecule plot"</font><font color="#4000C0">)</font>
    <font color="#000000">SetWhiteBackground</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">data_path</font><font color="#4000C0">(</font><font color="#008000">"vasp_test_data"</font><font color="#4000C0">,</font> <font color="#008000">"GaO40W12"</font><font color="#4000C0">,</font> <font color="#008000">"OUTCAR"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Mesh"</font><font color="#4000C0">,</font> <font color="#008000">"unitCell"</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Molecule"</font><font color="#4000C0">,</font> <font color="#008000">"element"</font><font color="#4000C0">)</font>
    <font color="#000000">mol</font> <font color="#4000C0">=</font> <font color="#000000">MoleculeAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">radiusFixed</font><font color="#4000C0">=</font><font color="#0080C0">0.5</font>
    <font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">mol</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">ResetView</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">v3D</font> <font color="#4000C0">=</font> <font color="#000000">GetView3D</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">v3D</font><font color="#4000C0">.</font><font color="#000000">viewNormal</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.0378647</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">0.776117</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">0.62945</font><font color="#4000C0">)</font> <font color="#a02030">#(-0.465303, -0.758273, 0.456634)</font>
    <font color="#000000">v3D</font><font color="#4000C0">.</font><font color="#000000">viewUp</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.839533</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">0.366352</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">0.401212</font><font color="#4000C0">)</font> <font color="#a02030">#(-0.0844518, 0.55156, 0.829849)</font>
    <font color="#000000">v3D</font><font color="#4000C0">.</font><font color="#000000">imageZoom</font><font color="#4000C0">=</font><font color="#0080C0">2.177156</font>
    <font color="#000000">v3D</font><font color="#4000C0">.</font><font color="#000000">imagePan</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0.0217552</font><font color="#4000C0">,</font> <font color="#0080C0">0.0165363</font><font color="#4000C0">)</font>
    <font color="#000000">SetView3D</font><font color="#4000C0">(</font><font color="#000000">v3D</font><font color="#4000C0">)</font>

    <font color="#000000">Test500x500</font><font color="#4000C0">(</font><font color="#008000">"mol_rep_bonds_01"</font><font color="#4000C0">)</font>

    <font color="#a02030"># Add replicate operator </font>
    <font color="#000000">SetActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">"Replicate"</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">repl</font> <font color="#4000C0">=</font> <font color="#000000">ReplicateAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">repl</font><font color="#4000C0">.</font><font color="#000000">useUnitCellVectors</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">repl</font><font color="#4000C0">.</font><font color="#000000">mergeResults</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#a02030"># replicate along unit cell boundaries</font>
    <font color="#000000">repl</font><font color="#4000C0">.</font><font color="#000000">replicateUnitCellAtoms</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">repl</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test500x500</font><font color="#4000C0">(</font><font color="#008000">"mol_rep_bonds_02"</font><font color="#4000C0">)</font>

    <font color="#a02030"># create a replication along y</font>
    <font color="#000000">repl</font><font color="#4000C0">.</font><font color="#000000">yReplications</font><font color="#4000C0">=</font><font color="#0080C0">2</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">repl</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">Test500x500</font><font color="#4000C0">(</font><font color="#008000">"mol_rep_bonds_03"</font><font color="#4000C0">)</font>

    <font color="#a02030"># Create bonds </font>
    <font color="#000000">SetActivePlots</font><font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">"CreateBonds"</font><font color="#4000C0">)</font>
    <font color="#000000">cb</font> <font color="#4000C0">=</font> <font color="#000000">CreateBondsAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">cb</font><font color="#4000C0">.</font><font color="#000000">atomicNumber1</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">31</font><font color="#4000C0">,</font> <font color="#0080C0">74</font><font color="#4000C0">)</font>
    <font color="#000000">cb</font><font color="#4000C0">.</font><font color="#000000">atomicNumber2</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">8</font><font color="#4000C0">,</font> <font color="#0080C0">8</font><font color="#4000C0">)</font>
    <font color="#000000">cb</font><font color="#4000C0">.</font><font color="#000000">minDist</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.4</font><font color="#4000C0">,</font> <font color="#0080C0">0.4</font><font color="#4000C0">)</font>
    <font color="#000000">cb</font><font color="#4000C0">.</font><font color="#000000">maxDist</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">1.9</font><font color="#4000C0">,</font> <font color="#0080C0">2.4</font><font color="#4000C0">)</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">cb</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">Test500x500</font><font color="#4000C0">(</font><font color="#008000">"mol_rep_bonds_04"</font><font color="#4000C0">)</font>

    <font color="#a02030"># have the CreateBonds operator create periodic bonds</font>
    <font color="#000000">cb</font><font color="#4000C0">.</font><font color="#000000">addPeriodicBonds</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">cb</font><font color="#4000C0">.</font><font color="#000000">useUnitCellVectors</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">cb</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">Test500x500</font><font color="#4000C0">(</font><font color="#008000">"mol_rep_bonds_05"</font><font color="#4000C0">)</font>

    <font color="#a02030"># Change bond style to lines</font>
    <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">drawBondsAs</font> <font color="#4000C0">=</font> <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">LineBonds</font>
    <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">bondLineWidth</font> <font color="#4000C0">=</font> <font color="#0080C0">5</font>
    <font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">mol</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">Test500x500</font><font color="#4000C0">(</font><font color="#008000">"mol_rep_bonds_06"</font><font color="#4000C0">)</font>

    <font color="#a02030"># Change atom radius</font>
    <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">drawBondsAs</font> <font color="#4000C0">=</font> <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">CylinderBonds</font>
    <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">scaleRadiusBy</font> <font color="#4000C0">=</font> <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">Atomic</font>
    <font color="#000000">mol</font><font color="#4000C0">.</font><font color="#000000">radiusScaleFactor</font> <font color="#4000C0">=</font> <font color="#0080C0">0.7</font>
    <font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">mol</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">Test500x500</font><font color="#4000C0">(</font><font color="#008000">"mol_rep_bonds_07"</font><font color="#4000C0">)</font>

    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">data_path</font><font color="#4000C0">(</font><font color="#008000">"vasp_test_data"</font><font color="#4000C0">,</font> <font color="#008000">"GaO40W12"</font><font color="#4000C0">,</font> <font color="#008000">"OUTCAR"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">MoleculeOnly</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">ReplicateAddBonds</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Exit</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000"></font></font></pre></body></html>