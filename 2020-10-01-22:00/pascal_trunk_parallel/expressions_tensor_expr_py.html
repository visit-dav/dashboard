<html><body bgcolor="#e0e0e0"><head><title>expressions/tensor_expr.py</title></head><pre><font face="Lucida,Courier New"><font color="#a02030"># ----------------------------------------------------------------------------</font>
<font color="#a02030">#  CLASSES: nightly</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Test Case:  tensor_expr.py</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Tests:      tensor expressions using simple, constant valued tensors for</font>
<font color="#a02030">#              which answers are known. The known answers were obtained by</font>
<font color="#a02030">#              scouring the internet for example problems that were worked.</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Mark C. Miller, Mon Nov 11 14:52:02 PST 2019</font>
<font color="#a02030">#</font>
<font color="#a02030"># ----------------------------------------------------------------------------</font>
<font color="#C00000">import</font> <font color="#000000">math</font><font color="#4000C0">,</font> <font color="#000000">re</font>

<font color="#a02030">#</font>
<font color="#a02030"># Scans a string for possible python iterables, builds a list of them</font>
<font color="#a02030"># and returns them with their values rounded to specific numbers of</font>
<font color="#a02030"># digits.</font>
<font color="#a02030">#</font>
<font color="#C00000">def</font> <font color="#000000">ExtractIterablesFromString</font><font color="#4000C0">(</font><font color="#000000">s</font><font color="#4000C0">,</font><font color="#000000">pair</font><font color="#4000C0">=</font><font color="#008000">'()'</font><font color="#4000C0">,</font><font color="#000000">rnd</font><font color="#4000C0">=</font><font color="#0080C0">4</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">retval</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#4000C0">]</font>
    <font color="#C00000">for</font> <font color="#000000">q</font> <font color="#C00000">in</font> <font color="#000000">s</font><font color="#4000C0">.</font><font color="#000000">split</font><font color="#4000C0">(</font><font color="#000000">pair</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#C00000">for</font> <font color="#000000">r</font> <font color="#C00000">in</font> <font color="#000000">q</font><font color="#4000C0">.</font><font color="#000000">split</font><font color="#4000C0">(</font><font color="#000000">pair</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
            <font color="#C00000">if</font> <font color="#000000">re</font><font color="#4000C0">.</font><font color="#000000">match</font><font color="#4000C0">(</font><font color="#008000">'^[ 0-9eE.,+-]+$'</font><font color="#4000C0">,</font> <font color="#000000">r</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
                <font color="#000000">retval</font><font color="#4000C0">.</font><font color="#000000">append</font><font color="#4000C0">(</font><font color="#4000C0">[</font><font color="#000000">round</font><font color="#4000C0">(</font><font color="#000000">float</font><font color="#4000C0">(</font><font color="#000000">x</font><font color="#4000C0">)</font><font color="#4000C0">,</font><font color="#000000">rnd</font><font color="#4000C0">)</font> <font color="#C00000">for</font> <font color="#000000">x</font> <font color="#C00000">in</font> <font color="#000000">r</font><font color="#4000C0">.</font><font color="#000000">split</font><font color="#4000C0">(</font><font color="#008000">','</font><font color="#4000C0">)</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#C00000">return</font> <font color="#000000">retval</font>

<font color="#C00000">def</font> <font color="#000000">HasEigval</font><font color="#4000C0">(</font><font color="#000000">vals</font><font color="#4000C0">,</font> <font color="#000000">cval</font><font color="#4000C0">,</font> <font color="#000000">rnd</font><font color="#4000C0">=</font><font color="#0080C0">4</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">vrnd</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#000000">round</font><font color="#4000C0">(</font><font color="#000000">float</font><font color="#4000C0">(</font><font color="#000000">x</font><font color="#4000C0">)</font><font color="#4000C0">,</font><font color="#000000">rnd</font><font color="#4000C0">)</font> <font color="#C00000">for</font> <font color="#000000">x</font> <font color="#C00000">in</font> <font color="#000000">vals</font><font color="#4000C0">]</font>
    <font color="#000000">crnd</font> <font color="#4000C0">=</font> <font color="#000000">round</font><font color="#4000C0">(</font><font color="#000000">float</font><font color="#4000C0">(</font><font color="#000000">cval</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">rnd</font><font color="#4000C0">)</font>
    <font color="#C00000">for</font> <font color="#000000">i</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">vrnd</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#C00000">if</font> <font color="#000000">vrnd</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font> <font color="#4000C0">==</font> <font color="#000000">crnd</font><font color="#4000C0">:</font>
           <font color="#000000">vals</font><font color="#4000C0">.</font><font color="#000000">remove</font><font color="#4000C0">(</font><font color="#000000">vals</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
           <font color="#C00000">return</font> <font color="#000000">True</font>
    <font color="#C00000">return</font> <font color="#000000">False</font>

<font color="#a02030">#</font>
<font color="#a02030"># Checks if a given vector, cvec, is amoung a list of vectors, vecs,</font>
<font color="#a02030"># within the specified rounding tolerance, rnd. If so, removes the</font>
<font color="#a02030"># matching entry and returns True.</font>
<font color="#a02030">#</font>
<font color="#C00000">def</font> <font color="#000000">HasEigvec</font><font color="#4000C0">(</font><font color="#000000">vecs</font><font color="#4000C0">,</font> <font color="#000000">cvec</font><font color="#4000C0">,</font> <font color="#000000">rnd</font><font color="#4000C0">=</font><font color="#0080C0">4</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">for</font> <font color="#000000">v</font> <font color="#C00000">in</font> <font color="#000000">vecs</font><font color="#4000C0">:</font>
        <font color="#000000">r</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#4000C0">]</font>
        <font color="#C00000">for</font> <font color="#000000">i</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">v</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
            <font color="#C00000">if</font> <font color="#000000">v</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font> <font color="#4000C0">!=</font> <font color="#0080C0">0</font><font color="#4000C0">:</font>
                <font color="#000000">ratio</font> <font color="#4000C0">=</font> <font color="#000000">float</font><font color="#4000C0">(</font><font color="#000000">cvec</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font><font color="#4000C0">)</font> <font color="#4000C0">/</font> <font color="#000000">float</font><font color="#4000C0">(</font><font color="#000000">v</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">;</font>
                <font color="#000000">r</font><font color="#4000C0">.</font><font color="#000000">append</font><font color="#4000C0">(</font><font color="#000000">round</font><font color="#4000C0">(</font><font color="#000000">ratio</font><font color="#4000C0">,</font> <font color="#000000">rnd</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
        <font color="#C00000">if</font> <font color="#4000C0">(</font><font color="#000000">max</font><font color="#4000C0">(</font><font color="#000000">r</font><font color="#4000C0">)</font> <font color="#4000C0">-</font> <font color="#000000">min</font><font color="#4000C0">(</font><font color="#000000">r</font><font color="#4000C0">)</font><font color="#4000C0">)</font> <font color="#4000C0">&lt;=</font> <font color="#000000">pow</font><font color="#4000C0">(</font><font color="#0080C0">10</font><font color="#4000C0">,</font><font color="#4000C0">-</font><font color="#000000">rnd</font><font color="#4000C0">+</font><font color="#0080C0">1</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
            <font color="#000000">vecs</font><font color="#4000C0">.</font><font color="#000000">remove</font><font color="#4000C0">(</font><font color="#000000">v</font><font color="#4000C0">)</font>
            <font color="#C00000">return</font> <font color="#000000">True</font>
    <font color="#C00000">return</font> <font color="#000000">False</font>

<font color="#C00000">def</font> <font color="#000000">ValuesAgree</font><font color="#4000C0">(</font><font color="#000000">vec</font><font color="#4000C0">,</font> <font color="#000000">val</font><font color="#4000C0">,</font> <font color="#000000">rnd</font><font color="#4000C0">=</font><font color="#0080C0">4</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">valrnd</font> <font color="#4000C0">=</font> <font color="#000000">round</font><font color="#4000C0">(</font><font color="#000000">float</font><font color="#4000C0">(</font><font color="#000000">val</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">rnd</font><font color="#4000C0">)</font>
    <font color="#000000">vecrnd</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#000000">round</font><font color="#4000C0">(</font><font color="#000000">float</font><font color="#4000C0">(</font><font color="#000000">x</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">rnd</font><font color="#4000C0">)</font> <font color="#C00000">for</font> <font color="#000000">x</font> <font color="#C00000">in</font> <font color="#000000">vec</font><font color="#4000C0">]</font>
    <font color="#C00000">for</font> <font color="#000000">i</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">vecrnd</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#C00000">if</font> <font color="#000000">vecrnd</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font> <font color="#4000C0">!=</font> <font color="#000000">valrnd</font><font color="#4000C0">:</font>
            <font color="#C00000">return</font> <font color="#000000">False</font>
    <font color="#C00000">return</font> <font color="#000000">True</font>

<font color="#a02030">#</font>
<font color="#a02030"># Creates a group of related expressions; 9 constant scalar expressions and</font>
<font color="#a02030"># from them a constant tensor expression with specified centering all in a</font>
<font color="#a02030"># sub-menu with of the given name. For 2D meshes, you would still create a</font>
<font color="#a02030"># 9 component (3x3) tensor but the z-dimension values would all be zeros.</font>
<font color="#a02030">#</font>
<font color="#C00000">def</font> <font color="#000000">CreateConstantTensorExpr</font><font color="#4000C0">(</font><font color="#000000">name</font><font color="#4000C0">,</font> <font color="#000000">meshName</font><font color="#4000C0">,</font> <font color="#000000">constType</font><font color="#4000C0">,</font> <font color="#000000">vals</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">comps</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">"s11"</font><font color="#4000C0">,</font><font color="#008000">"s12"</font><font color="#4000C0">,</font><font color="#008000">"s13"</font><font color="#4000C0">,</font><font color="#008000">"s21"</font><font color="#4000C0">,</font><font color="#008000">"s22"</font><font color="#4000C0">,</font><font color="#008000">"s23"</font><font color="#4000C0">,</font><font color="#008000">"s31"</font><font color="#4000C0">,</font><font color="#008000">"s32"</font><font color="#4000C0">,</font><font color="#008000">"s33"</font><font color="#4000C0">)</font>
    <font color="#C00000">for</font> <font color="#000000">i</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">vals</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"%s/%s"</font><font color="#4000C0">%</font><font color="#4000C0">(</font><font color="#000000">name</font><font color="#4000C0">,</font><font color="#000000">comps</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">,</font>\
            <font color="#008000">"%s_constant(&lt;%s&gt;, %g)"</font><font color="#4000C0">%</font><font color="#4000C0">(</font><font color="#000000">constType</font><font color="#4000C0">,</font><font color="#000000">meshName</font><font color="#4000C0">,</font><font color="#000000">vals</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">DefineTensorExpression</font><font color="#4000C0">(</font><font color="#008000">"%s/tensor"</font><font color="#4000C0">%</font><font color="#000000">name</font><font color="#4000C0">,</font>
        <font color="#008000">"{{&lt;%s/s11&gt;,&lt;%s/s12&gt;,&lt;%s/s13&gt;},\
          {&lt;%s/s21&gt;,&lt;%s/s22&gt;,&lt;%s/s23&gt;},\
          {&lt;%s/s31&gt;,&lt;%s/s32&gt;,&lt;%s/s33&gt;}}"</font><font color="#4000C0">%</font><font color="#4000C0">(</font><font color="#000000">name</font><font color="#4000C0">,</font> <font color="#000000">name</font><font color="#4000C0">,</font> <font color="#000000">name</font><font color="#4000C0">,</font> <font color="#000000">name</font><font color="#4000C0">,</font>\
              <font color="#000000">name</font><font color="#4000C0">,</font> <font color="#000000">name</font><font color="#4000C0">,</font> <font color="#000000">name</font><font color="#4000C0">,</font> <font color="#000000">name</font><font color="#4000C0">,</font> <font color="#000000">name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Set precision for rounding operations</font>
<font color="#a02030">#</font>
<font color="#000000">Prec</font> <font color="#4000C0">=</font> <font color="#0080C0">3</font>

<font color="#a02030">#  Since we use the expression system to construct mesh-wide constant values,</font>
<font color="#a02030">#  all we need as far as a database is a simple, small mesh. Maybe for both</font>
<font color="#a02030">#  two and three dimensions.</font>
<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">"arbpoly.silo"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">meshName</font> <font color="#4000C0">=</font> <font color="#008000">"clipped_hex"</font>

<font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">"2D Tensor Maximum Shear"</font><font color="#4000C0">)</font>
<font color="#000000">CreateConstantTensorExpr</font><font color="#4000C0">(</font><font color="#008000">"max_shear_2d"</font><font color="#4000C0">,</font> <font color="#000000">meshName</font><font color="#4000C0">,</font> <font color="#008000">"nodal"</font><font color="#4000C0">,</font>\
   <font color="#4000C0">(</font><font color="#0080C0">50</font><font color="#4000C0">,</font>  <font color="#0080C0">30</font><font color="#4000C0">,</font>   <font color="#0080C0">0</font><font color="#4000C0">,</font>\
    <font color="#0080C0">30</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">20</font><font color="#4000C0">,</font>   <font color="#0080C0">0</font><font color="#4000C0">,</font>\
     <font color="#0080C0">0</font><font color="#4000C0">,</font>   <font color="#0080C0">0</font><font color="#4000C0">,</font>   <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"max_shear_2d/result"</font><font color="#4000C0">,</font> <font color="#008000">"tensor_maximum_shear(&lt;max_shear_2d/tensor&gt;)"</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"max_shear_2d/result"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"MinMax"</font><font color="#4000C0">)</font>
<font color="#000000">q</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputObject</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"Maximum Shear 2D"</font><font color="#4000C0">,</font> <font color="#000000">ValuesAgree</font><font color="#4000C0">(</font><font color="#4000C0">(</font><font color="#000000">q</font><font color="#4000C0">[</font><font color="#008000">'min'</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">q</font><font color="#4000C0">[</font><font color="#008000">'max'</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#0080C0">46.098</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">"3D Tensor Maximum Shear"</font><font color="#4000C0">)</font>
<font color="#000000">CreateConstantTensorExpr</font><font color="#4000C0">(</font><font color="#008000">"max_shear"</font><font color="#4000C0">,</font> <font color="#000000">meshName</font><font color="#4000C0">,</font> <font color="#008000">"nodal"</font><font color="#4000C0">,</font>\
   <font color="#4000C0">(</font><font color="#0080C0">5</font><font color="#4000C0">,</font>   <font color="#0080C0">0</font><font color="#4000C0">,</font>   <font color="#0080C0">0</font><font color="#4000C0">,</font>\
    <font color="#0080C0">0</font><font color="#4000C0">,</font>  <font color="#4000C0">-</font><font color="#0080C0">6</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">12</font><font color="#4000C0">,</font>\
    <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">12</font><font color="#4000C0">,</font>   <font color="#0080C0">1</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"max_shear/result"</font><font color="#4000C0">,</font> <font color="#008000">"tensor_maximum_shear(&lt;max_shear/tensor&gt;)"</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"max_shear/result"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"MinMax"</font><font color="#4000C0">)</font>
<font color="#000000">q</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputObject</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"Maximum Shear 3D"</font><font color="#4000C0">,</font> <font color="#000000">ValuesAgree</font><font color="#4000C0">(</font><font color="#4000C0">(</font><font color="#000000">q</font><font color="#4000C0">[</font><font color="#008000">'min'</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">q</font><font color="#4000C0">[</font><font color="#008000">'max'</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#0080C0">12.5</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">"2D Effective Tensor"</font><font color="#4000C0">)</font>
<font color="#000000">CreateConstantTensorExpr</font><font color="#4000C0">(</font><font color="#008000">"eff_tensor_2d"</font><font color="#4000C0">,</font> <font color="#000000">meshName</font><font color="#4000C0">,</font> <font color="#008000">"nodal"</font><font color="#4000C0">,</font>\
   <font color="#4000C0">(</font><font color="#0080C0">50</font><font color="#4000C0">,</font>  <font color="#0080C0">30</font><font color="#4000C0">,</font>   <font color="#0080C0">0</font><font color="#4000C0">,</font>\
    <font color="#0080C0">30</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">20</font><font color="#4000C0">,</font>   <font color="#0080C0">0</font><font color="#4000C0">,</font>\
     <font color="#0080C0">0</font><font color="#4000C0">,</font>   <font color="#0080C0">0</font><font color="#4000C0">,</font>   <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"eff_tensor_2d/result"</font><font color="#4000C0">,</font> <font color="#008000">"effective_tensor(&lt;eff_tensor_2d/tensor&gt;)"</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"eff_tensor_2d/result"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"MinMax"</font><font color="#4000C0">)</font>
<font color="#000000">q</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputObject</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"2D Effective Tensor"</font><font color="#4000C0">,</font> <font color="#000000">ValuesAgree</font><font color="#4000C0">(</font><font color="#4000C0">(</font><font color="#000000">q</font><font color="#4000C0">[</font><font color="#008000">'min'</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">q</font><font color="#4000C0">[</font><font color="#008000">'max'</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#0080C0">81.240</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">"3D Effective Tensor"</font><font color="#4000C0">)</font>
<font color="#000000">CreateConstantTensorExpr</font><font color="#4000C0">(</font><font color="#008000">"eff_tensor"</font><font color="#4000C0">,</font> <font color="#000000">meshName</font><font color="#4000C0">,</font> <font color="#008000">"nodal"</font><font color="#4000C0">,</font>\
   <font color="#4000C0">(</font><font color="#0080C0">2</font><font color="#4000C0">,</font>  <font color="#4000C0">-</font><font color="#0080C0">3</font><font color="#4000C0">,</font>   <font color="#0080C0">4</font><font color="#4000C0">,</font>\
   <font color="#4000C0">-</font><font color="#0080C0">3</font><font color="#4000C0">,</font>  <font color="#4000C0">-</font><font color="#0080C0">5</font><font color="#4000C0">,</font>   <font color="#0080C0">1</font><font color="#4000C0">,</font>\
    <font color="#0080C0">4</font><font color="#4000C0">,</font>   <font color="#0080C0">1</font><font color="#4000C0">,</font>   <font color="#0080C0">6</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"eff_tensor/result"</font><font color="#4000C0">,</font> <font color="#008000">"effective_tensor(&lt;eff_tensor/tensor&gt;)"</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"eff_tensor/result"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">"MinMax"</font><font color="#4000C0">)</font>
<font color="#000000">q</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputObject</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"Effective Tensor"</font><font color="#4000C0">,</font> <font color="#000000">ValuesAgree</font><font color="#4000C0">(</font><font color="#4000C0">(</font><font color="#000000">q</font><font color="#4000C0">[</font><font color="#008000">'min'</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">q</font><font color="#4000C0">[</font><font color="#008000">'max'</font><font color="#4000C0">]</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#0080C0">13.077</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">"3D, Symmetric Eigenvalues and Eigenvectors"</font><font color="#4000C0">)</font>
<font color="#000000">CreateConstantTensorExpr</font><font color="#4000C0">(</font><font color="#008000">"eigvals_symm2"</font><font color="#4000C0">,</font> <font color="#000000">meshName</font><font color="#4000C0">,</font> <font color="#008000">"nodal"</font><font color="#4000C0">,</font>\
    <font color="#4000C0">(</font><font color="#0080C0">2</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">,</font>  <font color="#0080C0">0</font><font color="#4000C0">,</font>\
    <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">,</font>  <font color="#0080C0">2</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">,</font>\
     <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">,</font>  <font color="#0080C0">2</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">DefineVectorExpression</font><font color="#4000C0">(</font><font color="#008000">"eigvals_symm2/result"</font><font color="#4000C0">,</font> <font color="#008000">"eigenvalue(&lt;eigvals_symm2/tensor&gt;)"</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Vector"</font><font color="#4000C0">,</font> <font color="#008000">"eigvals_symm2/result"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">p</font> <font color="#4000C0">=</font> <font color="#000000">PickByNode</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#4000C0">(</font><font color="#008000">'eigvals_symm2/result'</font><font color="#4000C0">,</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">eigvals</font> <font color="#4000C0">=</font> <font color="#000000">list</font><font color="#4000C0">(</font><font color="#000000">p</font><font color="#4000C0">[</font><font color="#008000">'eigvals_symm2/result'</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"First Eigenvalue of 2"</font><font color="#4000C0">,</font> <font color="#000000">HasEigval</font><font color="#4000C0">(</font><font color="#000000">eigvals</font><font color="#4000C0">,</font> <font color="#0080C0">2</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"Second Eigenvalue of 2+sqrt(2)"</font><font color="#4000C0">,</font> <font color="#000000">HasEigval</font><font color="#4000C0">(</font><font color="#000000">eigvals</font><font color="#4000C0">,</font> <font color="#0080C0">2</font><font color="#4000C0">+</font><font color="#000000">math</font><font color="#4000C0">.</font><font color="#000000">sqrt</font><font color="#4000C0">(</font><font color="#0080C0">2</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"Third Eigenvalue of 2-sqrt(2)"</font><font color="#4000C0">,</font>  <font color="#000000">HasEigval</font><font color="#4000C0">(</font><font color="#000000">eigvals</font><font color="#4000C0">,</font> <font color="#0080C0">2</font><font color="#4000C0">-</font><font color="#000000">math</font><font color="#4000C0">.</font><font color="#000000">sqrt</font><font color="#4000C0">(</font><font color="#0080C0">2</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">DefineTensorExpression</font><font color="#4000C0">(</font><font color="#008000">"eigvals_symm2/result2"</font><font color="#4000C0">,</font> <font color="#008000">"transpose(eigenvector(&lt;eigvals_symm2/tensor&gt;))"</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Tensor"</font><font color="#4000C0">,</font> <font color="#008000">"eigvals_symm2/result2"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">PickByNode</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">)</font>
<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetPickOutput</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">vecs</font> <font color="#4000C0">=</font> <font color="#000000">ExtractIterablesFromString</font><font color="#4000C0">(</font><font color="#000000">s</font><font color="#4000C0">,</font> <font color="#008000">'()'</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"First Eigenvector of (1,0,-1)"</font><font color="#4000C0">,</font> <font color="#000000">HasEigvec</font><font color="#4000C0">(</font><font color="#000000">vecs</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">,</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"Second Eigenvector of (1,-sqrt(2),1)"</font><font color="#4000C0">,</font> <font color="#000000">HasEigvec</font><font color="#4000C0">(</font><font color="#000000">vecs</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">,</font><font color="#4000C0">-</font><font color="#000000">math</font><font color="#4000C0">.</font><font color="#000000">sqrt</font><font color="#4000C0">(</font><font color="#0080C0">2</font><font color="#4000C0">)</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"Third Eigenvector of (1,sqrt(2),1)"</font><font color="#4000C0">,</font> <font color="#000000">HasEigvec</font><font color="#4000C0">(</font><font color="#000000">vecs</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">,</font><font color="#000000">math</font><font color="#4000C0">.</font><font color="#000000">sqrt</font><font color="#4000C0">(</font><font color="#0080C0">2</font><font color="#4000C0">)</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">"3D, Symmetric Eigenvalues and Eigenvectors with Repeated values"</font><font color="#4000C0">)</font>
<font color="#000000">CreateConstantTensorExpr</font><font color="#4000C0">(</font><font color="#008000">"eigvals_symm"</font><font color="#4000C0">,</font> <font color="#000000">meshName</font><font color="#4000C0">,</font> <font color="#008000">"nodal"</font><font color="#4000C0">,</font>\
    <font color="#4000C0">(</font><font color="#0080C0">3</font><font color="#4000C0">,</font><font color="#0080C0">2</font><font color="#4000C0">,</font><font color="#0080C0">4</font><font color="#4000C0">,</font>\
     <font color="#0080C0">2</font><font color="#4000C0">,</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">2</font><font color="#4000C0">,</font>\
     <font color="#0080C0">4</font><font color="#4000C0">,</font><font color="#0080C0">2</font><font color="#4000C0">,</font><font color="#0080C0">3</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">DefineVectorExpression</font><font color="#4000C0">(</font><font color="#008000">"eigvals_symm/result"</font><font color="#4000C0">,</font> <font color="#008000">"eigenvalue(&lt;eigvals_symm/tensor&gt;)"</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Vector"</font><font color="#4000C0">,</font> <font color="#008000">"eigvals_symm/result"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">p</font> <font color="#4000C0">=</font> <font color="#000000">PickByNode</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">)</font>
<font color="#000000">eigvals</font> <font color="#4000C0">=</font> <font color="#000000">list</font><font color="#4000C0">(</font><font color="#000000">p</font><font color="#4000C0">[</font><font color="#008000">'eigvals_symm/result'</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"First Eigenvalue of -1"</font><font color="#4000C0">,</font> <font color="#000000">HasEigval</font><font color="#4000C0">(</font><font color="#000000">eigvals</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"Second Eigenvalue of -1"</font><font color="#4000C0">,</font> <font color="#000000">HasEigval</font><font color="#4000C0">(</font><font color="#000000">eigvals</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"Third Eigenvalue of 8"</font><font color="#4000C0">,</font> <font color="#000000">HasEigval</font><font color="#4000C0">(</font><font color="#000000">eigvals</font><font color="#4000C0">,</font> <font color="#0080C0">8</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">DefineTensorExpression</font><font color="#4000C0">(</font><font color="#008000">"eigvals_symm/result2"</font><font color="#4000C0">,</font> <font color="#008000">"transpose(eigenvector(&lt;eigvals_symm/tensor&gt;))"</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Tensor"</font><font color="#4000C0">,</font> <font color="#008000">"eigvals_symm/result2"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">PickByNode</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">)</font>
<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetPickOutput</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">vecs</font> <font color="#4000C0">=</font> <font color="#000000">ExtractIterablesFromString</font><font color="#4000C0">(</font><font color="#000000">s</font><font color="#4000C0">,</font> <font color="#008000">'()'</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">+</font><font color="#0080C0">1</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"First Eigenvector of (1,-2,0)"</font><font color="#4000C0">,</font> <font color="#000000">HasEigvec</font><font color="#4000C0">(</font><font color="#000000">vecs</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">,</font><font color="#4000C0">-</font><font color="#0080C0">2</font><font color="#4000C0">,</font><font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"Second Eigenvector of (4,2,-5)"</font><font color="#4000C0">,</font> <font color="#000000">HasEigvec</font><font color="#4000C0">(</font><font color="#000000">vecs</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#0080C0">4</font><font color="#4000C0">,</font><font color="#0080C0">2</font><font color="#4000C0">,</font><font color="#4000C0">-</font><font color="#0080C0">5</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"Third Eigenvector of (2,1,2)"</font><font color="#4000C0">,</font> <font color="#000000">HasEigvec</font><font color="#4000C0">(</font><font color="#000000">vecs</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#0080C0">2</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">,</font><font color="#0080C0">2</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030"># Confirm principal_tensor function gives same result as above</font>
<font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">"Cross Principal Stresses and Eigenvalues"</font><font color="#4000C0">)</font>
<font color="#000000">DefineVectorExpression</font><font color="#4000C0">(</font><font color="#008000">"pcomps_symm/result"</font><font color="#4000C0">,</font> <font color="#008000">"principal_tensor(&lt;eigvals_symm/tensor&gt;)"</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Vector"</font><font color="#4000C0">,</font> <font color="#008000">"pcomps_symm/result"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">p</font> <font color="#4000C0">=</font> <font color="#000000">PickByNode</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">)</font>
<font color="#000000">pcomps</font> <font color="#4000C0">=</font> <font color="#000000">list</font><font color="#4000C0">(</font><font color="#000000">p</font><font color="#4000C0">[</font><font color="#008000">'pcomps_symm/result'</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"First principal component is first eigenvalue"</font><font color="#4000C0">,</font> <font color="#000000">HasEigval</font><font color="#4000C0">(</font><font color="#000000">pcomps</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"Second principal component is second eigenvalue"</font><font color="#4000C0">,</font> <font color="#000000">HasEigval</font><font color="#4000C0">(</font><font color="#000000">pcomps</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"Third principal component is third eigenvalue"</font><font color="#4000C0">,</font> <font color="#000000">HasEigval</font><font color="#4000C0">(</font><font color="#000000">pcomps</font><font color="#4000C0">,</font> <font color="#0080C0">8</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">"2D, Symmetric Eigenvalues and Eigenvectors"</font><font color="#4000C0">)</font>
<font color="#000000">CreateConstantTensorExpr</font><font color="#4000C0">(</font><font color="#008000">"eigvals_symm_2d"</font><font color="#4000C0">,</font> <font color="#000000">meshName</font><font color="#4000C0">,</font> <font color="#008000">"nodal"</font><font color="#4000C0">,</font>\
    <font color="#4000C0">(</font><font color="#0080C0">2</font><font color="#4000C0">,</font>  <font color="#0080C0">3</font><font color="#4000C0">,</font>  <font color="#0080C0">0</font><font color="#4000C0">,</font>\
     <font color="#0080C0">3</font><font color="#4000C0">,</font>  <font color="#0080C0">2</font><font color="#4000C0">,</font>  <font color="#0080C0">0</font><font color="#4000C0">,</font>\
     <font color="#0080C0">0</font><font color="#4000C0">,</font>  <font color="#0080C0">0</font><font color="#4000C0">,</font>  <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">DefineVectorExpression</font><font color="#4000C0">(</font><font color="#008000">"eigvals_symm_2d/result"</font><font color="#4000C0">,</font> <font color="#008000">"eigenvalue(&lt;eigvals_symm_2d/tensor&gt;)"</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Vector"</font><font color="#4000C0">,</font> <font color="#008000">"eigvals_symm_2d/result"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">p</font> <font color="#4000C0">=</font> <font color="#000000">PickByNode</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#4000C0">(</font><font color="#008000">'eigvals_symm_2d/result'</font><font color="#4000C0">,</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">eigvals</font> <font color="#4000C0">=</font> <font color="#000000">list</font><font color="#4000C0">(</font><font color="#000000">p</font><font color="#4000C0">[</font><font color="#008000">'eigvals_symm_2d/result'</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"First Eigenvalue of -1"</font><font color="#4000C0">,</font> <font color="#000000">HasEigval</font><font color="#4000C0">(</font><font color="#000000">eigvals</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"Second Eigenvalue of 5"</font><font color="#4000C0">,</font> <font color="#000000">HasEigval</font><font color="#4000C0">(</font><font color="#000000">eigvals</font><font color="#4000C0">,</font> <font color="#0080C0">5</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">DefineTensorExpression</font><font color="#4000C0">(</font><font color="#008000">"eigvals_symm_2d/result2"</font><font color="#4000C0">,</font> <font color="#008000">"transpose(eigenvector(&lt;eigvals_symm_2d/tensor&gt;))"</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Tensor"</font><font color="#4000C0">,</font> <font color="#008000">"eigvals_symm_2d/result2"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">PickByNode</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">)</font>
<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetPickOutput</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">vecs</font> <font color="#4000C0">=</font> <font color="#000000">ExtractIterablesFromString</font><font color="#4000C0">(</font><font color="#000000">s</font><font color="#4000C0">,</font> <font color="#008000">'()'</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font>
<font color="#000000">vecs</font><font color="#4000C0">.</font><font color="#000000">remove</font><font color="#4000C0">(</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">)</font> <font color="#a02030"># we have to take out the Z eigenvector</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"First Eigenvector of (1,-1)"</font><font color="#4000C0">,</font> <font color="#000000">HasEigvec</font><font color="#4000C0">(</font><font color="#000000">vecs</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">,</font><font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"Second Eigenvector of (1,1)"</font><font color="#4000C0">,</font> <font color="#000000">HasEigvec</font><font color="#4000C0">(</font><font color="#000000">vecs</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Test a case where eigenvalues are complex (e.g. imaginary)</font>
<font color="#a02030"># The real eigenvalues are 2, (4+3i)/5, (4-3i)/5 but what you</font>
<font color="#a02030"># get from VisIt is 2, 7/5, 1/5 (as though i==1 in the above).</font>
<font color="#a02030">#</font>
<font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">"3D, Complex Eigenvalues and Eigenvectors"</font><font color="#4000C0">)</font>
<font color="#000000">CreateConstantTensorExpr</font><font color="#4000C0">(</font><font color="#008000">"eigvals_complex"</font><font color="#4000C0">,</font> <font color="#000000">meshName</font><font color="#4000C0">,</font> <font color="#008000">"nodal"</font><font color="#4000C0">,</font>\
    <font color="#4000C0">(</font><font color="#0080C0">4.0</font><font color="#4000C0">/</font><font color="#0080C0">5.0</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">3.0</font><font color="#4000C0">/</font><font color="#0080C0">5.0</font><font color="#4000C0">,</font>     <font color="#0080C0">0</font><font color="#4000C0">,</font>\
     <font color="#0080C0">3.0</font><font color="#4000C0">/</font><font color="#0080C0">5.0</font><font color="#4000C0">,</font>  <font color="#0080C0">4.0</font><font color="#4000C0">/</font><font color="#0080C0">5.0</font><font color="#4000C0">,</font>     <font color="#0080C0">0</font><font color="#4000C0">,</font>\
        <font color="#0080C0">1</font><font color="#4000C0">,</font>        <font color="#0080C0">2</font><font color="#4000C0">,</font>        <font color="#0080C0">2</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">DefineVectorExpression</font><font color="#4000C0">(</font><font color="#008000">"eigvals_complex/result"</font><font color="#4000C0">,</font> <font color="#008000">"eigenvalue(&lt;eigvals_complex/tensor&gt;)"</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Vector"</font><font color="#4000C0">,</font> <font color="#008000">"eigvals_complex/result"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">p</font> <font color="#4000C0">=</font> <font color="#000000">PickByNode</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">)</font>
<font color="#000000">eigvals</font> <font color="#4000C0">=</font> <font color="#000000">list</font><font color="#4000C0">(</font><font color="#000000">p</font><font color="#4000C0">[</font><font color="#008000">'eigvals_complex/result'</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"First Eigenvalue of 2"</font><font color="#4000C0">,</font> <font color="#000000">HasEigval</font><font color="#4000C0">(</font><font color="#000000">eigvals</font><font color="#4000C0">,</font> <font color="#0080C0">2</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"Second Eigenvalue of (4+3i)/5"</font><font color="#4000C0">,</font> <font color="#000000">HasEigval</font><font color="#4000C0">(</font><font color="#000000">eigvals</font><font color="#4000C0">,</font> <font color="#000000">float</font><font color="#4000C0">(</font><font color="#0080C0">4</font><font color="#4000C0">+</font><font color="#0080C0">3</font><font color="#4000C0">)</font><font color="#4000C0">/</font><font color="#0080C0">5.0</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"Third Eigenvalue of (4-3i)/5"</font><font color="#4000C0">,</font> <font color="#000000">HasEigval</font><font color="#4000C0">(</font><font color="#000000">eigvals</font><font color="#4000C0">,</font> <font color="#000000">float</font><font color="#4000C0">(</font><font color="#0080C0">4</font><font color="#4000C0">-</font><font color="#0080C0">3</font><font color="#4000C0">)</font><font color="#4000C0">/</font><font color="#0080C0">5.0</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">DefineTensorExpression</font><font color="#4000C0">(</font><font color="#008000">"eigvals_complex/result2"</font><font color="#4000C0">,</font> <font color="#008000">"transpose(eigenvector(&lt;eigvals_complex/tensor&gt;))"</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Tensor"</font><font color="#4000C0">,</font> <font color="#008000">"eigvals_complex/result2"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">PickByNode</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">)</font>
<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetPickOutput</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">vecs</font> <font color="#4000C0">=</font> <font color="#000000">ExtractIterablesFromString</font><font color="#4000C0">(</font><font color="#000000">s</font><font color="#4000C0">,</font> <font color="#008000">'()'</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"First Eigenvector of (0,0,1)"</font><font color="#4000C0">,</font> <font color="#000000">HasEigvec</font><font color="#4000C0">(</font><font color="#000000">vecs</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030"># Re-use eigvals_symm here</font>
<font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">"Cross Check Deviatoric and Principal Stresses"</font><font color="#4000C0">)</font>
<font color="#000000">DefineVectorExpression</font><font color="#4000C0">(</font><font color="#008000">"eigvals_symm/dev"</font><font color="#4000C0">,</font> <font color="#008000">"principal_deviatoric_tensor(&lt;eigvals_symm/tensor&gt;)"</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Vector"</font><font color="#4000C0">,</font> <font color="#008000">"eigvals_symm/dev"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">PickByNode</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">)</font>
<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetPickOutput</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">dev_vec</font> <font color="#4000C0">=</font> <font color="#000000">ExtractIterablesFromString</font><font color="#4000C0">(</font><font color="#000000">s</font><font color="#4000C0">,</font> <font color="#008000">'()'</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"eigvals_symm/tr3"</font><font color="#4000C0">,</font> <font color="#008000">"trace(&lt;eigvals_symm/tensor&gt;)/3.0"</font><font color="#4000C0">)</font>
<font color="#000000">DefineTensorExpression</font><font color="#4000C0">(</font><font color="#008000">"eigvals_symm/tensor3"</font><font color="#4000C0">,</font>\
<font color="#008000">"""
    {{&lt;eigvals_symm/tensor&gt;[0][0]-&lt;eigvals_symm/tr3&gt;, &lt;eigvals_symm/tensor&gt;[0][1], &lt;eigvals_symm/tensor&gt;[0][2]},
     {&lt;eigvals_symm/tensor&gt;[1][0], &lt;eigvals_symm/tensor&gt;[1][1]-&lt;eigvals_symm/tr3&gt;, &lt;eigvals_symm/tensor&gt;[1][2]},
     {&lt;eigvals_symm/tensor&gt;[2][0], &lt;eigvals_symm/tensor&gt;[2][1], &lt;eigvals_symm/tensor&gt;[2][2]-&lt;eigvals_symm/tr3&gt;}}
"""</font>
<font color="#4000C0">)</font>
<font color="#000000">DefineVectorExpression</font><font color="#4000C0">(</font><font color="#008000">"eigvals_symm/dev2"</font><font color="#4000C0">,</font> <font color="#008000">"principal_tensor(&lt;eigvals_symm/tensor3&gt;)"</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Vector"</font><font color="#4000C0">,</font> <font color="#008000">"eigvals_symm/dev2"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">PickByNode</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">)</font>
<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetPickOutput</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">dev2_vec</font> <font color="#4000C0">=</font> <font color="#000000">ExtractIterablesFromString</font><font color="#4000C0">(</font><font color="#000000">s</font><font color="#4000C0">,</font> <font color="#008000">'()'</font><font color="#4000C0">,</font> <font color="#000000">Prec</font><font color="#4000C0">)</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">AssertTrue</font><font color="#4000C0">(</font><font color="#008000">"Principal deviatoric and principal-tr()/3 agree"</font><font color="#4000C0">,</font> <font color="#000000">dev_vec</font> <font color="#4000C0">==</font> <font color="#000000">dev2_vec</font><font color="#4000C0">)</font>

<font color="#000000">Exit</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#000000"></font></font></pre></body></html>