<html><body bgcolor="#e0e0e0"><head><title>hybrid/cinema-a.py</title></head><pre><font face="Lucida,Courier New"><font color="#a02030"># ----------------------------------------------------------------------------</font>
<font color="#a02030">#  CLASSES: nightly</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Test Case:  cinema-a.py</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Tests:      Tests various aspects of "visit -cinema".</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Notes:      </font>
<font color="#a02030">#</font>
<font color="#a02030">#  Programmer: Brad Whitlock</font>
<font color="#a02030">#  Date:       Thu Feb 15 16:37:20 PST 2018</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Modifications:</font>
<font color="#a02030">#    Kathleen Biagas, Friday December 14, 2018</font>
<font color="#a02030">#    Fixes for running on Windows: Use abs_path for short_wave.visit, and cdb,</font>
<font color="#a02030">#    use 'repr(db)' when writing script file to preserve '\' escapes.</font>
<font color="#a02030">#    Replace forward-slash with back-slash in pattern.</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Kathleen Biagas, Tue Jun 11 11:44:14 PDT 2019</font>
<font color="#a02030">#    Pass '-noconfig' to generated command line in GenerateCinema.</font>
<font color="#a02030">#</font>
<font color="#a02030"># ----------------------------------------------------------------------------</font>
<font color="#C00000">import</font> <font color="#000000">os</font>
<font color="#C00000">import</font> <font color="#000000">subprocess</font>

<font color="#C00000">def</font> <font color="#000000">GenerateCinema</font><font color="#4000C0">(</font><font color="#000000">cinemaArgs</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">if</font> <font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"parallel"</font><font color="#4000C0">]</font><font color="#4000C0">:</font>
        <font color="#000000">args</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"visit_bin"</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">"-noconfig"</font><font color="#4000C0">,</font> <font color="#008000">"-cinema"</font><font color="#4000C0">,</font> <font color="#008000">"-np"</font><font color="#4000C0">,</font> <font color="#008000">"2"</font><font color="#4000C0">,</font> <font color="#008000">"-l"</font><font color="#4000C0">,</font> <font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"parallel_launch"</font><font color="#4000C0">]</font><font color="#4000C0">]</font> <font color="#4000C0">+</font> <font color="#000000">cinemaArgs</font>
    <font color="#C00000">else</font><font color="#4000C0">:</font>
        <font color="#000000">args</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"visit_bin"</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">"-noconfig"</font><font color="#4000C0">,</font> <font color="#008000">"-cinema"</font><font color="#4000C0">]</font> <font color="#4000C0">+</font> <font color="#000000">cinemaArgs</font>
    <font color="#000000">p</font> <font color="#4000C0">=</font> <font color="#000000">subprocess</font><font color="#4000C0">.</font><font color="#000000">check_output</font><font color="#4000C0">(</font><font color="#000000">args</font><font color="#4000C0">)</font>
    <font color="#C00000">return</font> <font color="#000000">p</font>

<font color="#C00000">def</font> <font color="#000000">GetFileList</font><font color="#4000C0">(</font><font color="#000000">path0</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">def</font> <font color="#000000">gfl</font><font color="#4000C0">(</font><font color="#000000">path</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">outfiles</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#4000C0">]</font>
        <font color="#000000">files</font> <font color="#4000C0">=</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">listdir</font><font color="#4000C0">(</font><font color="#000000">path</font><font color="#4000C0">)</font>
        <font color="#C00000">for</font> <font color="#000000">f</font> <font color="#C00000">in</font> <font color="#000000">sorted</font><font color="#4000C0">(</font><font color="#000000">files</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
            <font color="#000000">fpath</font> <font color="#4000C0">=</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">path</font><font color="#4000C0">,</font> <font color="#000000">f</font><font color="#4000C0">)</font>
            <font color="#C00000">if</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">fpath</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
                <font color="#000000">outfiles</font> <font color="#4000C0">=</font> <font color="#000000">outfiles</font> <font color="#4000C0">+</font> <font color="#000000">gfl</font><font color="#4000C0">(</font><font color="#000000">fpath</font><font color="#4000C0">)</font>
            <font color="#C00000">else</font><font color="#4000C0">:</font>
                <font color="#000000">outfiles</font> <font color="#4000C0">=</font> <font color="#000000">outfiles</font> <font color="#4000C0">+</font> <font color="#4000C0">[</font><font color="#000000">fpath</font><font color="#4000C0">[</font><font color="#000000">lpath0</font><font color="#4000C0">+</font><font color="#0080C0">1</font><font color="#4000C0">:</font><font color="#4000C0">]</font><font color="#4000C0">]</font>
        <font color="#C00000">return</font> <font color="#000000">outfiles</font>
    <font color="#000000">lpath0</font> <font color="#4000C0">=</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">path0</font><font color="#4000C0">)</font>
    <font color="#C00000">return</font> <font color="#000000">gfl</font><font color="#4000C0">(</font><font color="#000000">path0</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">ListToString</font><font color="#4000C0">(</font><font color="#000000">files</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#008000">""</font>
    <font color="#C00000">for</font> <font color="#000000">f</font> <font color="#C00000">in</font> <font color="#000000">files</font><font color="#4000C0">:</font>
        <font color="#000000">s</font> <font color="#4000C0">+=</font> <font color="#000000">f</font>
        <font color="#000000">s</font> <font color="#4000C0">+=</font> <font color="#008000">"\n"</font>
    <font color="#C00000">return</font> <font color="#000000">s</font>

<font color="#C00000">def</font> <font color="#000000">GetFile</font><font color="#4000C0">(</font><font color="#000000">manyfilenames</font><font color="#4000C0">,</font> <font color="#000000">filename</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">for</font> <font color="#000000">f</font> <font color="#C00000">in</font> <font color="#000000">manyfilenames</font><font color="#4000C0">:</font>
        <font color="#C00000">if</font> <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">find</font><font color="#4000C0">(</font><font color="#000000">filename</font><font color="#4000C0">)</font> <font color="#4000C0">!=</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">:</font>
            <font color="#C00000">return</font> <font color="#000000">f</font>
    <font color="#C00000">return</font> <font color="#008000">""</font>

<font color="#C00000">def</font> <font color="#000000">ReadTextFile</font><font color="#4000C0">(</font><font color="#000000">filename</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">lines</font> <font color="#4000C0">=</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#000000">filename</font><font color="#4000C0">,</font> <font color="#008000">"rt"</font><font color="#4000C0">)</font><font color="#4000C0">.</font><font color="#000000">readlines</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#008000">""</font>
    <font color="#C00000">for</font> <font color="#000000">line</font> <font color="#C00000">in</font> <font color="#000000">lines</font><font color="#4000C0">:</font>
        <font color="#000000">s</font> <font color="#4000C0">+=</font> <font color="#000000">line</font>
    <font color="#C00000">return</font> <font color="#000000">s</font>

<font color="#C00000">def</font> <font color="#000000">test0</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">"Cinema spec A static camera"</font><font color="#4000C0">)</font>
    <font color="#000000">f</font> <font color="#4000C0">=</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#008000">"test0.py"</font><font color="#4000C0">,</font> <font color="#008000">"wt"</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">"OpenDatabase(%s)\n"</font> <font color="#4000C0">%</font> <font color="#000000">repr</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'AddPlot("Pseudocolor", "pressure")\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'DrawPlots()\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v = GetView3D()\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.viewNormal = (-0.569392, 0.672931, 0.472183)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.focus = (5, 0.353448, 2.5)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.viewUp = (0.562941, 0.737756, -0.372577)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.viewAngle = 30\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.parallelScale = 5.6009\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.nearPlane = -11.2018\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.farPlane = 11.2018\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.imagePan = (0.0431021, 0.0442006)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.imageZoom = 1.06444\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.perspective = 1\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.eyeAngle = 2\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.centerOfRotationSet = 0\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.centerOfRotation = (5, 0.353448, 2.5)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.axis3DScaleFlag = 0\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.axis3DScales = (1, 1, 1)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.shear = (0, 0, 1)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'v.windowValid = 1\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'SetView3D(v)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a = GetAnnotationAttributes()\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a.axes3D.visible = 0\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a.axes3D.bboxFlag = 0\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a.axes3D.triadFlag = 0\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a.legendInfoFlag = 0\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a.databaseInfoFlag = 0\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a.userInfoFlag = 0\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'SetAnnotationAttributes(a)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">close</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">cdb</font> <font color="#4000C0">=</font> <font color="#000000">abs_path</font><font color="#4000C0">(</font><font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"run_dir"</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">"test0.cdb"</font><font color="#4000C0">)</font>
    <font color="#000000">sz</font> <font color="#4000C0">=</font> <font color="#008000">"%dx%d"</font> <font color="#4000C0">%</font> <font color="#4000C0">(</font><font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"width"</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"height"</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#000000">args</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#008000">"-specification"</font><font color="#4000C0">,</font> <font color="#008000">"A"</font><font color="#4000C0">,</font> <font color="#008000">"-scriptfile"</font><font color="#4000C0">,</font> <font color="#008000">"test0.py"</font><font color="#4000C0">,</font> <font color="#008000">"-output"</font><font color="#4000C0">,</font> <font color="#000000">cdb</font><font color="#4000C0">,</font> <font color="#008000">"-format"</font><font color="#4000C0">,</font> <font color="#008000">"png"</font><font color="#4000C0">,</font> <font color="#008000">"-geometry"</font><font color="#4000C0">,</font> <font color="#000000">sz</font><font color="#4000C0">,</font> <font color="#008000">"-camera"</font><font color="#4000C0">,</font> <font color="#008000">"static"</font><font color="#4000C0">]</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"cinema_0_00"</font><font color="#4000C0">,</font> <font color="#000000">ListToString</font><font color="#4000C0">(</font><font color="#000000">args</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#000000">output</font> <font color="#4000C0">=</font> <font color="#000000">GenerateCinema</font><font color="#4000C0">(</font><font color="#000000">args</font><font color="#4000C0">)</font>

    <font color="#000000">files</font> <font color="#4000C0">=</font> <font color="#000000">GetFileList</font><font color="#4000C0">(</font><font color="#000000">cdb</font><font color="#4000C0">)</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"cinema_0_01"</font><font color="#4000C0">,</font> <font color="#000000">ListToString</font><font color="#4000C0">(</font><font color="#000000">files</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#000000">json</font> <font color="#4000C0">=</font> <font color="#000000">ReadTextFile</font><font color="#4000C0">(</font><font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">cdb</font><font color="#4000C0">,</font> <font color="#000000">GetFile</font><font color="#4000C0">(</font><font color="#000000">files</font><font color="#4000C0">,</font> <font color="#008000">"info.json"</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"cinema_0_02"</font><font color="#4000C0">,</font> <font color="#000000">json</font><font color="#4000C0">)</font>

    <font color="#000000">firstimg</font> <font color="#4000C0">=</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">cdb</font><font color="#4000C0">,</font> <font color="#000000">GetFile</font><font color="#4000C0">(</font><font color="#000000">files</font><font color="#4000C0">,</font> <font color="#008000">".png"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">firstimg</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Truecolor"</font><font color="#4000C0">,</font> <font color="#008000">"color"</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">v</font> <font color="#4000C0">=</font> <font color="#000000">GetView2D</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">v</font><font color="#4000C0">.</font><font color="#000000">viewportCoords</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">,</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">SetView2D</font><font color="#4000C0">(</font><font color="#000000">v</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"cinema_0_03"</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">firstimg</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">test1</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">"Cinema spec A phi-theta camera"</font><font color="#4000C0">)</font>
    <font color="#000000">f</font> <font color="#4000C0">=</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#008000">"test1.py"</font><font color="#4000C0">,</font> <font color="#008000">"wt"</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">"OpenDatabase(%s)\n"</font> <font color="#4000C0">%</font> <font color="#000000">repr</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'AddPlot("Pseudocolor", "pressure")\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'DrawPlots()\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a = GetAnnotationAttributes()\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a.axes3D.visible = 0\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a.axes3D.bboxFlag = 0\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a.axes3D.triadFlag = 0\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a.legendInfoFlag = 0\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a.databaseInfoFlag = 0\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'a.userInfoFlag = 0\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">'SetAnnotationAttributes(a)\n'</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">close</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">cdb</font> <font color="#4000C0">=</font> <font color="#000000">abs_path</font><font color="#4000C0">(</font><font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"run_dir"</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">"test1.cdb"</font><font color="#4000C0">)</font>

    <font color="#000000">sz</font> <font color="#4000C0">=</font> <font color="#008000">"%dx%d"</font> <font color="#4000C0">%</font> <font color="#4000C0">(</font><font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"width"</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"height"</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#000000">args</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#008000">"-specification"</font><font color="#4000C0">,</font> <font color="#008000">"A"</font><font color="#4000C0">,</font> <font color="#008000">"-scriptfile"</font><font color="#4000C0">,</font> <font color="#008000">"test1.py"</font><font color="#4000C0">,</font> <font color="#008000">"-output"</font><font color="#4000C0">,</font> <font color="#000000">cdb</font><font color="#4000C0">,</font> <font color="#008000">"-format"</font><font color="#4000C0">,</font> <font color="#008000">"png"</font><font color="#4000C0">,</font> <font color="#008000">"-geometry"</font><font color="#4000C0">,</font> <font color="#000000">sz</font><font color="#4000C0">,</font> <font color="#008000">"-camera"</font><font color="#4000C0">,</font> <font color="#008000">"phi-theta"</font><font color="#4000C0">,</font> <font color="#008000">"-phi"</font><font color="#4000C0">,</font> <font color="#008000">"6"</font><font color="#4000C0">,</font> <font color="#008000">"-theta"</font><font color="#4000C0">,</font> <font color="#008000">"5"</font><font color="#4000C0">,</font> <font color="#008000">"-stride"</font><font color="#4000C0">,</font> <font color="#008000">"3"</font><font color="#4000C0">]</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"cinema_1_00"</font><font color="#4000C0">,</font> <font color="#000000">ListToString</font><font color="#4000C0">(</font><font color="#000000">args</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#000000">output</font> <font color="#4000C0">=</font> <font color="#000000">GenerateCinema</font><font color="#4000C0">(</font><font color="#000000">args</font><font color="#4000C0">)</font>

    <font color="#000000">files</font> <font color="#4000C0">=</font> <font color="#000000">GetFileList</font><font color="#4000C0">(</font><font color="#000000">cdb</font><font color="#4000C0">)</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"cinema_1_01"</font><font color="#4000C0">,</font> <font color="#000000">ListToString</font><font color="#4000C0">(</font><font color="#000000">files</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#000000">json</font> <font color="#4000C0">=</font> <font color="#000000">ReadTextFile</font><font color="#4000C0">(</font><font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">cdb</font><font color="#4000C0">,</font> <font color="#000000">GetFile</font><font color="#4000C0">(</font><font color="#000000">files</font><font color="#4000C0">,</font> <font color="#008000">"info.json"</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"cinema_1_02"</font><font color="#4000C0">,</font> <font color="#000000">json</font><font color="#4000C0">)</font>

    <font color="#a02030"># Use the JSON to come up with some filenames to plot. We will vary phi.</font>
    <font color="#000000">params</font> <font color="#4000C0">=</font> <font color="#000000">eval</font><font color="#4000C0">(</font><font color="#000000">json</font><font color="#4000C0">)</font>
    <font color="#000000">theta_values</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">x</font><font color="#4000C0">)</font> <font color="#C00000">for</font> <font color="#000000">x</font> <font color="#C00000">in</font> <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"arguments"</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">"theta"</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">"values"</font><font color="#4000C0">]</font><font color="#4000C0">]</font>
    <font color="#000000">phi_values</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">x</font><font color="#4000C0">)</font> <font color="#C00000">for</font> <font color="#000000">x</font> <font color="#C00000">in</font>  <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"arguments"</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">"phi"</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">"values"</font><font color="#4000C0">]</font><font color="#4000C0">]</font>
    <font color="#000000">time_values</font> <font color="#4000C0">=</font> <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"arguments"</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">"time"</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">"values"</font><font color="#4000C0">]</font>

    <font color="#000000">theta</font> <font color="#4000C0">=</font> <font color="#000000">theta_values</font><font color="#4000C0">[</font><font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">theta_values</font><font color="#4000C0">)</font><font color="#4000C0">/</font><font color="#0080C0">4</font><font color="#4000C0">]</font>
    <font color="#000000">time</font> <font color="#4000C0">=</font> <font color="#000000">time_values</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font>
    <font color="#000000">i</font> <font color="#4000C0">=</font> <font color="#0080C0">3</font>
    <font color="#C00000">for</font> <font color="#000000">phi</font> <font color="#C00000">in</font> <font color="#000000">phi_values</font><font color="#4000C0">:</font>
        <font color="#000000">pattern</font> <font color="#4000C0">=</font> <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">"name_pattern"</font><font color="#4000C0">]</font>
        <font color="#C00000">if</font> <font color="#000000">sys</font><font color="#4000C0">.</font><font color="#000000">platform</font><font color="#4000C0">.</font><font color="#000000">startswith</font><font color="#4000C0">(</font><font color="#008000">"win"</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
            <font color="#000000">pattern</font> <font color="#4000C0">=</font> <font color="#000000">pattern</font><font color="#4000C0">.</font><font color="#000000">replace</font><font color="#4000C0">(</font><font color="#008000">"/"</font><font color="#4000C0">,</font> <font color="#008000">"\\"</font><font color="#4000C0">)</font>
        <font color="#000000">name</font> <font color="#4000C0">=</font> <font color="#000000">pattern</font><font color="#4000C0">.</font><font color="#000000">replace</font><font color="#4000C0">(</font><font color="#008000">"{phi}"</font><font color="#4000C0">,</font> <font color="#000000">phi</font><font color="#4000C0">)</font>
        <font color="#000000">name</font> <font color="#4000C0">=</font> <font color="#000000">name</font><font color="#4000C0">.</font><font color="#000000">replace</font><font color="#4000C0">(</font><font color="#008000">"{theta}"</font><font color="#4000C0">,</font> <font color="#000000">theta</font><font color="#4000C0">)</font>
        <font color="#000000">name</font> <font color="#4000C0">=</font> <font color="#000000">name</font><font color="#4000C0">.</font><font color="#000000">replace</font><font color="#4000C0">(</font><font color="#008000">"{time}"</font><font color="#4000C0">,</font> <font color="#000000">time</font><font color="#4000C0">)</font>

        <font color="#000000">img</font> <font color="#4000C0">=</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">cdb</font><font color="#4000C0">,</font> <font color="#000000">GetFile</font><font color="#4000C0">(</font><font color="#000000">files</font><font color="#4000C0">,</font> <font color="#000000">name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
        <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">img</font><font color="#4000C0">)</font>
        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Truecolor"</font><font color="#4000C0">,</font> <font color="#008000">"color"</font><font color="#4000C0">)</font>
        <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">v</font> <font color="#4000C0">=</font> <font color="#000000">GetView2D</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">v</font><font color="#4000C0">.</font><font color="#000000">viewportCoords</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">,</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">)</font>
        <font color="#000000">SetView2D</font><font color="#4000C0">(</font><font color="#000000">v</font><font color="#4000C0">)</font>
        <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"cinema_1_%02d"</font> <font color="#4000C0">%</font> <font color="#000000">i</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">img</font><font color="#4000C0">)</font>
        <font color="#000000">i</font> <font color="#4000C0">=</font> <font color="#000000">i</font> <font color="#4000C0">+</font> <font color="#0080C0">1</font>

<font color="#C00000">def</font> <font color="#000000">MakeShortWave</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">db</font> <font color="#4000C0">=</font> <font color="#000000">abs_path</font><font color="#4000C0">(</font><font color="#008000">"short_wave.visit"</font><font color="#4000C0">)</font>
    <font color="#000000">f</font> <font color="#4000C0">=</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">,</font> <font color="#008000">"wt"</font><font color="#4000C0">)</font>
    <font color="#C00000">for</font> <font color="#000000">i</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">700</font><font color="#4000C0">,</font> <font color="#0080C0">100</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">"wave%04d.silo"</font> <font color="#4000C0">%</font> <font color="#000000">i</font><font color="#4000C0">)</font> <font color="#4000C0">+</font> <font color="#008000">"\n"</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">close</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#C00000">return</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">abspath</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">main</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">db</font> <font color="#4000C0">=</font> <font color="#000000">MakeShortWave</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">test0</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">)</font>
    <font color="#000000">test1</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">)</font>

    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">unlink</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">)</font>

<font color="#000000">main</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Exit</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#000000"></font></font></pre></body></html>