<html><body bgcolor="#e0e0e0"><head><title>databases/samrai.py</title></head><pre><font face="Lucida,Courier New"><font color="#a02030"># ----------------------------------------------------------------------------</font>
<font color="#a02030">#  CLASSES: nightly</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Test Case:  samrai.py </font>
<font color="#a02030">#</font>
<font color="#a02030">#  Tests:      presence of HDF5</font>
<font color="#a02030">#              default plot </font>
<font color="#a02030">#              sil changing with time</font>
<font color="#a02030">#              nested ghosting</font>
<font color="#a02030">#              zbuffer contention</font>
<font color="#a02030">#              2d ale data</font>
<font color="#a02030">#              operators - slice</font>
<font color="#a02030">#              selection - by level</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Programmer: Mark C. Miller </font>
<font color="#a02030">#  Date:       November 12, 2003 </font>
<font color="#a02030">#</font>
<font color="#a02030">#  Modifications:</font>
<font color="#a02030">#    Brad Whitlock, Thu Mar 25 14:05:32 PST 2004</font>
<font color="#a02030">#    Added a check to see if plots at later time steps get the right metadata.</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Jeremy Meredith, Thu Jun 24 12:58:06 PDT 2004</font>
<font color="#a02030">#    Set the vector origin explicitly for some cases because I changed the</font>
<font color="#a02030">#    default to Tail.</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Mark C. Miller, Thu Aug 19 16:22:49 PDT 2004</font>
<font color="#a02030">#    Turned off database info flag so future changes to samrai db plugin</font>
<font color="#a02030">#    are less likely to result in a need to update the baselines</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Hank Childs, Wed Feb 16 07:34:07 PST 2005</font>
<font color="#a02030">#    Rename variables that have unsupported characters.</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Mark C. Miller, Thu Feb 17 09:00:41 PST 2005</font>
<font color="#a02030">#    Added tests for variables defined on only some patches</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Brad Whitlock, Wed Mar 9 09:15:30 PDT 2005</font>
<font color="#a02030">#    Removed deprecated functions.</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Jeremy Meredith, Wed Sep  7 12:06:04 PDT 2005</font>
<font color="#a02030">#    Allowed spaces in variable names.</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Mark C. Miller, Mon Nov  5 20:15:05 PST 2007</font>
<font color="#a02030">#    Added tests for sparse materials, expressions</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Jeremy Meredith, Tue Jul 15 10:43:58 EDT 2008</font>
<font color="#a02030">#    Changed number of vectors in vector plot to match the old behavior.</font>
<font color="#a02030">#    (We now account for how many domains there are.)</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Brad Whitlock, Thu Feb 4 10:18:23 PDT 2010</font>
<font color="#a02030">#    Turn off sets by name instead of index since that can change.</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Kathleen Biagas, Mon Dec 19 15:45:38 PST 2016</font>
<font color="#a02030">#    Use Subset plot for levels instead of FilledBoundary.</font>
<font color="#a02030">#</font>
<font color="#a02030"># ----------------------------------------------------------------------------</font>

<font color="#000000">LevelZero</font> <font color="#4000C0">=</font> <font color="#0080C0">4</font> <font color="#a02030"># set id for level 0</font>

<font color="#a02030"># Turn off sets by name</font>
<font color="#C00000">def</font> <font color="#000000">TurnOffSetsByName</font><font color="#4000C0">(</font><font color="#000000">silr</font><font color="#4000C0">,</font> <font color="#000000">cat</font><font color="#4000C0">,</font> <font color="#000000">names</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">sets</font> <font color="#4000C0">=</font> <font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">SetsInCategory</font><font color="#4000C0">(</font><font color="#000000">cat</font><font color="#4000C0">)</font>
    <font color="#C00000">for</font> <font color="#000000">s</font> <font color="#C00000">in</font> <font color="#000000">sets</font><font color="#4000C0">:</font>
        <font color="#000000">setname</font> <font color="#4000C0">=</font> <font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">SetName</font><font color="#4000C0">(</font><font color="#000000">s</font><font color="#4000C0">)</font>
        <font color="#C00000">try</font><font color="#4000C0">:</font>
            <font color="#C00000">if</font> <font color="#000000">setname</font> <font color="#C00000">in</font> <font color="#000000">names</font><font color="#4000C0">:</font>
                <font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">TurnOffSet</font><font color="#4000C0">(</font><font color="#000000">s</font><font color="#4000C0">)</font>
        <font color="#C00000">except</font><font color="#4000C0">:</font>
            <font color="#C00000">if</font> <font color="#000000">setname</font> <font color="#4000C0">==</font> <font color="#000000">names</font><font color="#4000C0">:</font>
                <font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">TurnOffSet</font><font color="#4000C0">(</font><font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">data_path</font><font color="#4000C0">(</font><font color="#008000">"samrai_test_data/sil_changes/dumps.visit"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>


<font color="#a02030">#</font>
<font color="#a02030"># just tests that default plot comes up automatically </font>
<font color="#a02030">#</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_01"</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># test exterenal face overlap</font>
<font color="#a02030">#</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font><font color="#008000">"Primitive Var _number_0"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">v</font><font color="#4000C0">=</font><font color="#000000">GetView3D</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">v</font><font color="#4000C0">.</font><font color="#000000">viewNormal</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">)</font>
<font color="#000000">SetView3D</font><font color="#4000C0">(</font><font color="#000000">v</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_02"</font><font color="#4000C0">)</font>

<font color="#000000">v</font><font color="#4000C0">.</font><font color="#000000">viewNormal</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0.34202</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">0.939693</font><font color="#4000C0">)</font>
<font color="#000000">SetView3D</font><font color="#4000C0">(</font><font color="#000000">v</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_03"</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># test level selection</font>
<font color="#a02030">#</font>
<font color="#000000">silr</font><font color="#4000C0">=</font><font color="#000000">SILRestriction</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">TurnOffSet</font><font color="#4000C0">(</font><font color="#000000">LevelZero</font><font color="#4000C0">)</font>
<font color="#000000">SetPlotSILRestriction</font><font color="#4000C0">(</font><font color="#000000">silr</font><font color="#4000C0">)</font>
<font color="#000000">v</font><font color="#4000C0">.</font><font color="#000000">viewNormal</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">)</font>
<font color="#000000">SetView3D</font><font color="#4000C0">(</font><font color="#000000">v</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_04"</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># test changing time steps (and sil)</font>
<font color="#a02030">#</font>
<font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_05"</font><font color="#4000C0">)</font>

<font color="#a02030"># go back to begnning of time</font>
<font color="#000000">SetTimeSliderState</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># turn on level 0 so we can check that</font>
<font color="#a02030"># nested ghosting is working correctly when we slice</font>
<font color="#a02030">#</font>
<font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">TurnOnSet</font><font color="#4000C0">(</font><font color="#000000">LevelZero</font><font color="#4000C0">)</font>
<font color="#000000">SetPlotSILRestriction</font><font color="#4000C0">(</font><font color="#000000">silr</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># this test is here to remind us we have many internal faces </font>
<font color="#a02030">#</font>
<font color="#000000">v</font><font color="#4000C0">.</font><font color="#000000">viewNormal</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#4000C0">-</font><font color="#0080C0">0.537631</font><font color="#4000C0">,</font> <font color="#0080C0">0.372794</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">0.756292</font><font color="#4000C0">)</font>
<font color="#000000">v</font><font color="#4000C0">.</font><font color="#000000">focus</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">15</font><font color="#4000C0">,</font> <font color="#0080C0">10</font><font color="#4000C0">,</font> <font color="#0080C0">10</font><font color="#4000C0">)</font>
<font color="#000000">v</font><font color="#4000C0">.</font><font color="#000000">viewUp</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0.262569</font><font color="#4000C0">,</font> <font color="#0080C0">0.926375</font><font color="#4000C0">,</font> <font color="#0080C0">0.269976</font><font color="#4000C0">)</font>
<font color="#000000">v</font><font color="#4000C0">.</font><font color="#000000">parallelScale</font><font color="#4000C0">=</font><font color="#0080C0">30</font>
<font color="#000000">v</font><font color="#4000C0">.</font><font color="#000000">nearPlane</font><font color="#4000C0">=</font><font color="#4000C0">-</font><font color="#0080C0">10</font>
<font color="#000000">v</font><font color="#4000C0">.</font><font color="#000000">farPlane</font><font color="#4000C0">=</font><font color="#0080C0">90</font>
<font color="#000000">SetView3D</font><font color="#4000C0">(</font><font color="#000000">v</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_06"</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># add a mesh plot and slice operator</font>
<font color="#a02030">#</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Mesh"</font><font color="#4000C0">,</font><font color="#008000">"amr_mesh"</font><font color="#4000C0">)</font>
<font color="#000000">sliceAtts</font><font color="#4000C0">=</font><font color="#000000">SliceAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">sliceAtts</font><font color="#4000C0">.</font><font color="#000000">originType</font><font color="#4000C0">=</font><font color="#000000">sliceAtts</font><font color="#4000C0">.</font><font color="#000000">Percent</font>
<font color="#000000">sliceAtts</font><font color="#4000C0">.</font><font color="#000000">originPercent</font><font color="#4000C0">=</font><font color="#0080C0">20</font>
<font color="#000000">sliceAtts</font><font color="#4000C0">.</font><font color="#000000">axisType</font><font color="#4000C0">=</font><font color="#000000">sliceAtts</font><font color="#4000C0">.</font><font color="#000000">ZAxis</font>
<font color="#000000">sliceAtts</font><font color="#4000C0">.</font><font color="#000000">project2d</font><font color="#4000C0">=</font><font color="#0080C0">1</font>
<font color="#000000">SetDefaultOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">sliceAtts</font><font color="#4000C0">)</font>
<font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">"Slice"</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_07"</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Animate forward 1 frame</font>
<font color="#a02030">#</font>
<font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_08"</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Now, go back 1 frame</font>
<font color="#a02030">#</font>
<font color="#000000">SetTimeSliderState</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_09"</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Tests for data from a 2d ale calculation.</font>
<font color="#a02030">#</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">data_path</font><font color="#4000C0">(</font><font color="#008000">"samrai_test_data/ale2d/dumps.visit"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">ResetView</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Test the default plot.</font>
<font color="#a02030">#</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_10"</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Check the last frame.</font>
<font color="#a02030">#</font>
<font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_11"</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Test a vector plot.</font>
<font color="#a02030">#</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Vector"</font><font color="#4000C0">,</font> <font color="#008000">"Velocity"</font><font color="#4000C0">)</font>
<font color="#000000">vectorAtts</font><font color="#4000C0">=</font><font color="#000000">VectorAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">vectorAtts</font><font color="#4000C0">.</font><font color="#000000">scale</font> <font color="#4000C0">=</font> <font color="#0080C0">0.02</font>
<font color="#000000">vectorAtts</font><font color="#4000C0">.</font><font color="#000000">vectorOrigin</font> <font color="#4000C0">=</font> <font color="#000000">vectorAtts</font><font color="#4000C0">.</font><font color="#000000">Middle</font>
<font color="#000000">vectorAtts</font><font color="#4000C0">.</font><font color="#000000">nVectors</font> <font color="#4000C0">=</font> <font color="#0080C0">400</font><font color="#4000C0">*</font><font color="#0080C0">47</font>
<font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">vectorAtts</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">v</font> <font color="#4000C0">=</font> <font color="#000000">View2DAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">v</font><font color="#4000C0">.</font><font color="#000000">windowCoords</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.31</font><font color="#4000C0">,</font> <font color="#0080C0">0.58</font><font color="#4000C0">,</font> <font color="#0080C0">0.15</font><font color="#4000C0">,</font> <font color="#0080C0">0.36</font><font color="#4000C0">)</font>
<font color="#000000">SetView2D</font><font color="#4000C0">(</font><font color="#000000">v</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_12"</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Tests for material/species data </font>
<font color="#a02030">#</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">data_path</font><font color="#4000C0">(</font><font color="#008000">"samrai_test_data/mats-par3/dumps.visit"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">ResetView</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># test a material plot</font>
<font color="#a02030">#</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"FilledBoundary"</font><font color="#4000C0">,</font><font color="#008000">"materials"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_13"</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># test material plot with some patches off</font>
<font color="#a02030">#</font>
<font color="#000000">silr</font><font color="#4000C0">=</font><font color="#000000">SILRestriction</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TurnOffSetsByName</font><font color="#4000C0">(</font><font color="#000000">silr</font><font color="#4000C0">,</font> <font color="#008000">"patches"</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#008000">"level0,patch0"</font><font color="#4000C0">,</font> <font color="#008000">"level0,patch1"</font><font color="#4000C0">,</font><font color="#008000">"level0,patch2"</font><font color="#4000C0">,</font><font color="#008000">"level0,patch3"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">SetPlotSILRestriction</font><font color="#4000C0">(</font><font color="#000000">silr</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_14"</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># now, turn off a material, too</font>
<font color="#a02030">#</font>
<font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">TurnOnAll</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TurnOffSetsByName</font><font color="#4000C0">(</font><font color="#000000">silr</font><font color="#4000C0">,</font> <font color="#008000">"materials"</font><font color="#4000C0">,</font> <font color="#008000">"Copper"</font><font color="#4000C0">)</font>
<font color="#000000">SetPlotSILRestriction</font><font color="#4000C0">(</font><font color="#000000">silr</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_15"</font><font color="#4000C0">)</font>

<font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">TurnOnAll</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">SetPlotSILRestriction</font><font color="#4000C0">(</font><font color="#000000">silr</font><font color="#4000C0">)</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># add a species plot</font>
<font color="#a02030">#</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font><font color="#008000">"species"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Selectively turn off each species</font>
<font color="#a02030">#</font>
<font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">TurnOffSet</font><font color="#4000C0">(</font><font color="#0080C0">24</font><font color="#4000C0">)</font>
<font color="#000000">SetPlotSILRestriction</font><font color="#4000C0">(</font><font color="#000000">silr</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_16"</font><font color="#4000C0">)</font>

<font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">TurnOffSet</font><font color="#4000C0">(</font><font color="#0080C0">25</font><font color="#4000C0">)</font>
<font color="#000000">SetPlotSILRestriction</font><font color="#4000C0">(</font><font color="#000000">silr</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_17"</font><font color="#4000C0">)</font>

<font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">TurnOffSet</font><font color="#4000C0">(</font><font color="#0080C0">26</font><font color="#4000C0">)</font>
<font color="#000000">SetPlotSILRestriction</font><font color="#4000C0">(</font><font color="#000000">silr</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_18"</font><font color="#4000C0">)</font>

<font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">TurnOffSet</font><font color="#4000C0">(</font><font color="#0080C0">27</font><font color="#4000C0">)</font>
<font color="#000000">SetPlotSILRestriction</font><font color="#4000C0">(</font><font color="#000000">silr</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_19"</font><font color="#4000C0">)</font>

<font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">TurnOffSet</font><font color="#4000C0">(</font><font color="#0080C0">28</font><font color="#4000C0">)</font>
<font color="#000000">SetPlotSILRestriction</font><font color="#4000C0">(</font><font color="#000000">silr</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_20"</font><font color="#4000C0">)</font>

<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030"># test matvf exprs</font>
<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"copper_vf"</font><font color="#4000C0">,</font><font color="#008000">'matvf(materials,"Copper")'</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font><font color="#008000">"copper_vf"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">patts</font> <font color="#4000C0">=</font> <font color="#000000">PseudocolorAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_copper_matvf_01"</font><font color="#4000C0">)</font>
<font color="#000000">patts</font><font color="#4000C0">.</font><font color="#000000">centering</font> <font color="#4000C0">=</font> <font color="#000000">patts</font><font color="#4000C0">.</font><font color="#000000">Nodal</font>  <font color="#a02030"># Natural, Nodal, Zonal</font>
<font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">patts</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_copper_matvf_02"</font><font color="#4000C0">)</font>
<font color="#000000">patts</font><font color="#4000C0">.</font><font color="#000000">centering</font> <font color="#4000C0">=</font> <font color="#000000">patts</font><font color="#4000C0">.</font><font color="#000000">Zonal</font> <font color="#a02030"># Natural, Nodal, Zonal</font>
<font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">patts</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_copper_matvf_03"</font><font color="#4000C0">)</font>
<font color="#000000">patts</font><font color="#4000C0">.</font><font color="#000000">centering</font> <font color="#4000C0">=</font> <font color="#000000">patts</font><font color="#4000C0">.</font><font color="#000000">Natural</font> <font color="#a02030"># Natural, Nodal, Zonal</font>
<font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">patts</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_copper_matvf_04"</font><font color="#4000C0">)</font>

<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"gold_den"</font><font color="#4000C0">,</font><font color="#008000">'val4mat(Density,"Gold")'</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font><font color="#008000">"gold_den"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">patts</font> <font color="#4000C0">=</font> <font color="#000000">PseudocolorAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_gold_val4mat_01"</font><font color="#4000C0">)</font>
<font color="#000000">patts</font><font color="#4000C0">.</font><font color="#000000">centering</font> <font color="#4000C0">=</font> <font color="#000000">patts</font><font color="#4000C0">.</font><font color="#000000">Nodal</font>  <font color="#a02030"># Natural, Nodal, Zonal</font>
<font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">patts</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_gold_val4mat_02"</font><font color="#4000C0">)</font>
<font color="#000000">patts</font><font color="#4000C0">.</font><font color="#000000">centering</font> <font color="#4000C0">=</font> <font color="#000000">patts</font><font color="#4000C0">.</font><font color="#000000">Zonal</font> <font color="#a02030"># Natural, Nodal, Zonal</font>
<font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">patts</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_gold_val4mat_03"</font><font color="#4000C0">)</font>
<font color="#000000">patts</font><font color="#4000C0">.</font><font color="#000000">centering</font> <font color="#4000C0">=</font> <font color="#000000">patts</font><font color="#4000C0">.</font><font color="#000000">Natural</font> <font color="#a02030"># Natural, Nodal, Zonal</font>
<font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">patts</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_gold_val4mat_04"</font><font color="#4000C0">)</font>

<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Open a new database that has levels that change over time so we can test</font>
<font color="#a02030"># that plots get the right metadata and SIL as time advances.</font>
<font color="#a02030">#</font>
<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">data_path</font><font color="#4000C0">(</font><font color="#008000">"samrai_test_data/front/dumps.visit"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#a02030"># Get rid of the default plot</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Subset"</font><font color="#4000C0">,</font> <font color="#008000">"levels"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">ResetView</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_21"</font><font color="#4000C0">)</font>

<font color="#a02030"># Go to the next time state. This used to cause an InvalidIndexException.</font>
<font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_22"</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Test a database where some variables are not defined on all patches</font>
<font color="#a02030">#</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">data_path</font><font color="#4000C0">(</font><font color="#008000">"samrai_test_data/viz_2d/dumps.visit"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"Function_0"</font><font color="#4000C0">)</font> <font color="#a02030"># only defined on some patches</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"Function_1"</font><font color="#4000C0">)</font> <font color="#a02030"># only defined on some other patches</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_23"</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Test a samrai database with sparse material representation</font>
<font color="#a02030">#</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">data_path</font><font color="#4000C0">(</font><font color="#008000">"samrai_test_data/sparse_mats/summary.samrai"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"energy"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_24"</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030">#  Zoom into a region where there is mixing</font>
<font color="#a02030">#</font>
<font color="#000000">v</font><font color="#4000C0">=</font><font color="#000000">GetView2D</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">v</font><font color="#4000C0">.</font><font color="#000000">windowCoords</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#4000C0">-</font><font color="#0080C0">0.296975</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">0.223086</font><font color="#4000C0">,</font> <font color="#0080C0">0.0437891</font><font color="#4000C0">,</font> <font color="#0080C0">0.120943</font><font color="#4000C0">)</font>
<font color="#000000">SetView2D</font><font color="#4000C0">(</font><font color="#000000">v</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_25"</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Turn off different materials and see what we get for the PC plot</font>
<font color="#a02030"># and zone picks</font>
<font color="#a02030">#</font>
<font color="#000000">silr</font> <font color="#4000C0">=</font> <font color="#000000">SILRestriction</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">j</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
<font color="#C00000">for</font> <font color="#000000">k1</font> <font color="#C00000">in</font> <font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">SetsInCategory</font><font color="#4000C0">(</font><font color="#008000">"materials"</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">i</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#C00000">for</font> <font color="#000000">k2</font> <font color="#C00000">in</font> <font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">SetsInCategory</font><font color="#4000C0">(</font><font color="#008000">"materials"</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#C00000">if</font> <font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">SetName</font><font color="#4000C0">(</font><font color="#000000">k2</font><font color="#4000C0">)</font> <font color="#4000C0">==</font> <font color="#008000">"material_%d"</font><font color="#4000C0">%</font><font color="#4000C0">(</font><font color="#000000">j</font><font color="#4000C0">+</font><font color="#0080C0">1</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
            <font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">TurnOffSet</font><font color="#4000C0">(</font><font color="#000000">k2</font><font color="#4000C0">)</font>
        <font color="#C00000">else</font><font color="#4000C0">:</font>
            <font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">TurnOnSet</font><font color="#4000C0">(</font><font color="#000000">k2</font><font color="#4000C0">)</font>
        <font color="#000000">i</font> <font color="#4000C0">=</font> <font color="#000000">i</font> <font color="#4000C0">+</font> <font color="#0080C0">1</font>
    <font color="#000000">SetPlotSILRestriction</font><font color="#4000C0">(</font><font color="#000000">silr</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_%d"</font><font color="#4000C0">%</font><font color="#4000C0">(</font><font color="#0080C0">26</font><font color="#4000C0">+</font><font color="#0080C0">2</font><font color="#4000C0">*</font><font color="#000000">j</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">PickByZone</font><font color="#4000C0">(</font><font color="#0080C0">247</font><font color="#4000C0">,</font><font color="#0080C0">15</font><font color="#4000C0">)</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">"samrai_%d"</font><font color="#4000C0">%</font><font color="#4000C0">(</font><font color="#0080C0">26</font><font color="#4000C0">+</font><font color="#0080C0">2</font><font color="#4000C0">*</font><font color="#000000">j</font><font color="#4000C0">+</font><font color="#0080C0">1</font><font color="#4000C0">)</font><font color="#4000C0">,</font><font color="#000000">GetPickOutput</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">j</font> <font color="#4000C0">=</font> <font color="#000000">j</font> <font color="#4000C0">+</font> <font color="#0080C0">1</font>

<font color="#a02030">#</font>
<font color="#a02030"># Test some expressions from the samrai database </font>
<font color="#a02030">#</font>
<font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">TurnOnAll</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">SetPlotSILRestriction</font><font color="#4000C0">(</font><font color="#000000">silr</font><font color="#4000C0">)</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font><font color="#008000">"von_mises_stress"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_33"</font><font color="#4000C0">)</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font><font color="#008000">"speed"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_34"</font><font color="#4000C0">)</font>


<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">data_path</font><font color="#4000C0">(</font><font color="#008000">"samrai_test_data/sparse_mats/summary.samrai"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">data_path</font><font color="#4000C0">(</font><font color="#008000">"samrai_test_data/curv_bnd_ghost/dumps.visit"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetPlotOptions</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">s</font><font color="#4000C0">.</font><font color="#000000">colorType</font> <font color="#4000C0">=</font> <font color="#000000">s</font><font color="#4000C0">.</font><font color="#000000">ColorBySingleColor</font>
<font color="#000000">s</font><font color="#4000C0">.</font><font color="#000000">singleColor</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">100</font><font color="#4000C0">,</font><font color="#0080C0">100</font><font color="#4000C0">,</font><font color="#0080C0">100</font><font color="#4000C0">,</font><font color="#0080C0">255</font><font color="#4000C0">)</font>
<font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">s</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font><font color="#008000">"Y_01"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_35"</font><font color="#4000C0">)</font>

<font color="#000000">silr</font> <font color="#4000C0">=</font> <font color="#000000">SILRestriction</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#C00000">for</font> <font color="#000000">i</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">NumSets</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">if</font> <font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">SetName</font><font color="#4000C0">(</font><font color="#000000">i</font><font color="#4000C0">)</font> <font color="#4000C0">==</font> <font color="#008000">"level0,patch7"</font><font color="#4000C0">:</font>
        <font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">TurnOffSet</font><font color="#4000C0">(</font><font color="#000000">i</font><font color="#4000C0">)</font>
        <font color="#C00000">break</font>
<font color="#000000">SetPlotSILRestriction</font><font color="#4000C0">(</font><font color="#000000">silr</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_36"</font><font color="#4000C0">)</font>

<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">data_path</font><font color="#4000C0">(</font><font color="#008000">"samrai_test_data/curv_bnd_ghost/dumps.visit"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">data_path</font><font color="#4000C0">(</font><font color="#008000">"samrai_test_data/matghosts_fullzonal/dumps.visit"</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetPlotOptions</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">s</font><font color="#4000C0">.</font><font color="#000000">colorType</font> <font color="#4000C0">=</font> <font color="#000000">s</font><font color="#4000C0">.</font><font color="#000000">ColorBySingleColor</font>
<font color="#000000">s</font><font color="#4000C0">.</font><font color="#000000">singleColor</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">100</font><font color="#4000C0">,</font><font color="#0080C0">100</font><font color="#4000C0">,</font><font color="#0080C0">100</font><font color="#4000C0">,</font><font color="#0080C0">255</font><font color="#4000C0">)</font>
<font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">s</font><font color="#4000C0">)</font>
<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"FilledBoundary"</font><font color="#4000C0">,</font> <font color="#008000">"materials"</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">silr</font> <font color="#4000C0">=</font> <font color="#000000">SILRestriction</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">silr</font><font color="#4000C0">.</font><font color="#000000">TurnOffSet</font><font color="#4000C0">(</font><font color="#0080C0">30</font><font color="#4000C0">)</font>
<font color="#000000">SetPlotSILRestriction</font><font color="#4000C0">(</font><font color="#000000">silr</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"samrai_37"</font><font color="#4000C0">)</font>

<font color="#000000">Exit</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000"></font></font></pre></body></html>