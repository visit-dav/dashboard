<html><body bgcolor="#e0e0e0"><head><title>databases/blueprint_export.py</title></head><pre><font face="Lucida,Courier New"><font color="#a02030"># ----------------------------------------------------------------------------</font>
<font color="#a02030">#  MODES: serial parallel</font>
<font color="#a02030">#  CLASSES: nightly</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Test Case:  blueprint_export.py</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Tests:      Tests blueprint export features "partition" and "flatten".</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Programmer: Christopher Laganella</font>
<font color="#a02030">#  Date:       Tue Dec 14 12:35:16 EST 2021</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Modifications:</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Chris Laganella, Mon Feb 14 14:39:48 EST 2022</font>
<font color="#a02030">#  I added a test case for user provided JSON/YAML options</font>
<font color="#a02030"># ----------------------------------------------------------------------------</font>
<font color="#C00000">import</font> <font color="#000000">time</font>
<font color="#C00000">import</font> <font color="#000000">sys</font>
<font color="#C00000">import</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font>

<font color="#a02030"># Uncomment these functions to run the script through the regular CLI</font>
<font color="#a02030"># def Exit():</font>
<font color="#a02030">#     print("Exiting test...")</font>
<font color="#a02030">#     return</font>

<font color="#a02030"># def RequiredDatabasePlugin(name):</font>
<font color="#a02030">#     print("This test requires database plugin " + name)</font>
<font color="#a02030">#     return</font>

<font color="#a02030"># def TestSection(name):</font>
<font color="#a02030">#     print("---- " + name + " ----")</font>
<font color="#a02030">#     return</font>

<font color="#a02030"># def Test(name):</font>
<font color="#a02030">#     s = SaveWindowAttributes()</font>
<font color="#a02030">#     s.fileName = name</font>
<font color="#a02030">#     SetSaveWindowAttributes(s)</font>
<font color="#a02030">#     SaveWindow()</font>
<font color="#a02030">#     return</font>

<font color="#a02030"># def TestText(name):</font>
<font color="#a02030">#     print("Testing text file {}".format(name))</font>

<font color="#a02030"># def silo_data_path(name):</font>
<font color="#a02030">#     retval = os.path.join("/mnt/data/il/VisIt/VisItClass/data", name)</font>
<font color="#a02030">#     # print(retval)</font>
<font color="#a02030">#     return retval</font>

<font color="#C00000">def</font> <font color="#000000">load_text</font><font color="#4000C0">(</font><font color="#000000">file_name</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#a02030"># print("Loading text from {}".format(os.path.abspath(file_name)), file=sys.stderr)</font>
    <font color="#C00000">with</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#000000">file_name</font><font color="#4000C0">,</font> <font color="#008000">'r'</font><font color="#4000C0">)</font> <font color="#C00000">as</font> <font color="#000000">f</font><font color="#4000C0">:</font>
        <font color="#C00000">return</font> <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">read</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">set_view</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">,</font> <font color="#000000">view</font><font color="#4000C0">=</font><font color="#C00000">None</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">if</font> <font color="#008000">"2d"</font> <font color="#C00000">in</font> <font color="#000000">case_name</font><font color="#4000C0">:</font>
        <font color="#000000">ResetView</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#C00000">else</font><font color="#4000C0">:</font>
        <font color="#000000">SetView3D</font><font color="#4000C0">(</font><font color="#000000">view</font><font color="#4000C0">)</font>


<font color="#C00000">def</font> <font color="#000000">test_name</font><font color="#4000C0">(</font><font color="#000000">case</font><font color="#4000C0">,</font> <font color="#000000">i</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">return</font> <font color="#000000">case</font> <font color="#4000C0">+</font> <font color="#008000">"_"</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">i</font><font color="#4000C0">)</font> <font color="#4000C0">+</font> <font color="#008000">"_"</font>

<font color="#a02030"># Export DB as csv, return the folder name</font>
<font color="#C00000">def</font> <font color="#000000">create_csv_output</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">export_name</font> <font color="#4000C0">=</font> <font color="#000000">case_name</font>
    <font color="#000000">e</font> <font color="#4000C0">=</font> <font color="#000000">ExportDBAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">db_type</font> <font color="#4000C0">=</font> <font color="#008000">"Blueprint"</font>
    <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">filename</font> <font color="#4000C0">=</font> <font color="#000000">export_name</font>
    <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">variables</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">'mesh_coords'</font><font color="#4000C0">,</font> <font color="#008000">'zc_mesh_coords'</font><font color="#4000C0">)</font>
    <font color="#000000">opts</font> <font color="#4000C0">=</font> <font color="#000000">GetExportOptions</font><font color="#4000C0">(</font><font color="#008000">"Blueprint"</font><font color="#4000C0">)</font>
    <font color="#000000">opts</font><font color="#4000C0">[</font><font color="#008000">"Operation"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">"Flatten_CSV"</font>
    <font color="#000000">ExportDatabase</font><font color="#4000C0">(</font><font color="#000000">e</font><font color="#4000C0">,</font> <font color="#000000">opts</font><font color="#4000C0">)</font>
    <font color="#000000">time</font><font color="#4000C0">.</font><font color="#000000">sleep</font><font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#C00000">return</font> <font color="#000000">export_name</font> <font color="#4000C0">+</font> <font color="#008000">".csv"</font>

<font color="#C00000">def</font> <font color="#000000">test_csv_output</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">vert_file</font> <font color="#4000C0">=</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">,</font> <font color="#008000">"vertex_data.csv"</font><font color="#4000C0">)</font>
    <font color="#000000">elem_file</font> <font color="#4000C0">=</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">,</font> <font color="#008000">"element_data.csv"</font><font color="#4000C0">)</font>
    <font color="#000000">vert_baseline</font> <font color="#4000C0">=</font> <font color="#000000">case_name</font> <font color="#4000C0">+</font> <font color="#008000">"-"</font> <font color="#4000C0">+</font> <font color="#008000">"vertex_data.csv"</font>
    <font color="#000000">elem_baseline</font> <font color="#4000C0">=</font> <font color="#000000">case_name</font> <font color="#4000C0">+</font> <font color="#008000">"-"</font> <font color="#4000C0">+</font> <font color="#008000">"element_data.csv"</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#000000">vert_baseline</font><font color="#4000C0">,</font> <font color="#000000">load_text</font><font color="#4000C0">(</font><font color="#000000">vert_file</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#000000">elem_baseline</font><font color="#4000C0">,</font> <font color="#000000">load_text</font><font color="#4000C0">(</font><font color="#000000">elem_file</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">define_mesh_expressions</font><font color="#4000C0">(</font><font color="#000000">mesh_name</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"nid"</font><font color="#4000C0">,</font> <font color="#008000">"nodeid({})"</font><font color="#4000C0">.</font><font color="#000000">format</font><font color="#4000C0">(</font><font color="#000000">mesh_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"zid"</font><font color="#4000C0">,</font> <font color="#008000">"zoneid({})"</font><font color="#4000C0">.</font><font color="#000000">format</font><font color="#4000C0">(</font><font color="#000000">mesh_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"mesh_coords"</font><font color="#4000C0">,</font> <font color="#008000">"coords({})"</font><font color="#4000C0">.</font><font color="#000000">format</font><font color="#4000C0">(</font><font color="#000000">mesh_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">"zc_mesh_coords"</font><font color="#4000C0">,</font> <font color="#008000">"recenter(mesh_coords, \"zonal\")"</font><font color="#4000C0">)</font>
    <font color="#C00000">return</font> <font color="#4000C0">(</font><font color="#008000">"nid"</font><font color="#4000C0">,</font> <font color="#008000">"zid"</font><font color="#4000C0">,</font> <font color="#008000">"mesh_coords"</font><font color="#4000C0">,</font> <font color="#008000">"zc_mesh_coords"</font><font color="#4000C0">)</font>

<font color="#a02030"># 's' for structured 'r' for rectilinear</font>
<font color="#C00000">def</font> <font color="#000000">flatten_multi_2d_case</font><font color="#4000C0">(</font><font color="#000000">case</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">case_name</font> <font color="#4000C0">=</font> <font color="#008000">"multi_rect2d.silo"</font>
    <font color="#000000">mesh_name</font> <font color="#4000C0">=</font> <font color="#008000">"mesh1"</font>
    <font color="#000000">export_name</font> <font color="#4000C0">=</font> <font color="#000000">case_name</font>

    <font color="#a02030"># Use multi_rect3d to create all cases</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Mesh"</font><font color="#4000C0">,</font> <font color="#000000">mesh_name</font><font color="#4000C0">)</font>

    <font color="#a02030"># Define some mesh based variables</font>
    <font color="#000000">vars</font> <font color="#4000C0">=</font> <font color="#000000">define_mesh_expressions</font><font color="#4000C0">(</font><font color="#000000">mesh_name</font><font color="#4000C0">)</font>

    <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">"Resample"</font><font color="#4000C0">)</font>
    <font color="#000000">ra</font> <font color="#4000C0">=</font> <font color="#000000">ResampleAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">ra</font><font color="#4000C0">.</font><font color="#000000">samplesX</font> <font color="#4000C0">=</font> <font color="#0080C0">5</font>
    <font color="#000000">ra</font><font color="#4000C0">.</font><font color="#000000">samplesY</font> <font color="#4000C0">=</font> <font color="#0080C0">4</font>
    <font color="#000000">ra</font><font color="#4000C0">.</font><font color="#000000">is3D</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
    <font color="#000000">ra</font><font color="#4000C0">.</font><font color="#000000">distributedResample</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">ra</font><font color="#4000C0">)</font>

    <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">"DeferExpression"</font><font color="#4000C0">)</font>
    <font color="#000000">dea</font> <font color="#4000C0">=</font> <font color="#000000">DeferExpressionAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">dea</font><font color="#4000C0">.</font><font color="#000000">exprs</font> <font color="#4000C0">=</font> <font color="#000000">vars</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">dea</font><font color="#4000C0">)</font>

    <font color="#C00000">if</font> <font color="#000000">case</font> <font color="#4000C0">==</font> <font color="#008000">'s'</font><font color="#4000C0">:</font>
        <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">"Transform"</font><font color="#4000C0">)</font>
        <font color="#000000">ta</font> <font color="#4000C0">=</font> <font color="#000000">TransformAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">ta</font><font color="#4000C0">.</font><font color="#000000">doRotate</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
        <font color="#a02030"># ta.rotateType = "Deg"</font>
        <font color="#000000">ta</font><font color="#4000C0">.</font><font color="#000000">rotateAmount</font> <font color="#4000C0">=</font> <font color="#0080C0">0.00001</font>
        <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">ta</font><font color="#4000C0">)</font>
        <font color="#000000">export_name</font> <font color="#4000C0">=</font> <font color="#008000">"structured_"</font> <font color="#4000C0">+</font> <font color="#000000">case_name</font>

    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#a02030"># Create csv file</font>
    <font color="#000000">export_dir</font> <font color="#4000C0">=</font> <font color="#000000">create_csv_output</font><font color="#4000C0">(</font><font color="#000000">export_name</font><font color="#4000C0">)</font>

    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test text</font>
    <font color="#000000">test_csv_output</font><font color="#4000C0">(</font><font color="#000000">export_dir</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">flatten_multi_2d_unstructured_case</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">case_name</font> <font color="#4000C0">=</font> <font color="#008000">"ucd2d.silo"</font>
    <font color="#000000">mesh_name</font> <font color="#4000C0">=</font> <font color="#008000">"ucdmesh2d"</font>
    <font color="#000000">export_name</font> <font color="#4000C0">=</font> <font color="#000000">case_name</font>

    <font color="#a02030"># Use multi_curv2d and remove cells</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Mesh"</font><font color="#4000C0">,</font> <font color="#000000">mesh_name</font><font color="#4000C0">)</font>

    <font color="#a02030"># Define some mesh based variables</font>
    <font color="#000000">vars</font> <font color="#4000C0">=</font> <font color="#000000">define_mesh_expressions</font><font color="#4000C0">(</font><font color="#000000">mesh_name</font><font color="#4000C0">)</font>

    <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">"Threshold"</font><font color="#4000C0">)</font>
    <font color="#000000">ta</font> <font color="#4000C0">=</font> <font color="#000000">ThresholdAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">ta</font><font color="#4000C0">.</font><font color="#000000">listedVarNames</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">"zid"</font><font color="#4000C0">,</font><font color="#4000C0">)</font>
    <font color="#000000">ta</font><font color="#4000C0">.</font><font color="#000000">lowerBounds</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">8</font><font color="#4000C0">,</font><font color="#4000C0">)</font>
    <font color="#000000">ta</font><font color="#4000C0">.</font><font color="#000000">upperBounds</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">11</font><font color="#4000C0">,</font><font color="#4000C0">)</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">ta</font><font color="#4000C0">)</font>
    <font color="#000000">export_name</font> <font color="#4000C0">=</font> <font color="#000000">case_name</font>

    <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">"DeferExpression"</font><font color="#4000C0">)</font>
    <font color="#000000">dea</font> <font color="#4000C0">=</font> <font color="#000000">DeferExpressionAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">dea</font><font color="#4000C0">.</font><font color="#000000">exprs</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">"mesh_coords"</font><font color="#4000C0">,</font> <font color="#008000">"zc_mesh_coords"</font><font color="#4000C0">)</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">dea</font><font color="#4000C0">)</font>

    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#a02030"># Create csv file</font>
    <font color="#000000">export_dir</font> <font color="#4000C0">=</font> <font color="#000000">create_csv_output</font><font color="#4000C0">(</font><font color="#000000">export_name</font><font color="#4000C0">)</font>

    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test text</font>
    <font color="#000000">test_csv_output</font><font color="#4000C0">(</font><font color="#000000">export_dir</font><font color="#4000C0">)</font>

<font color="#a02030"># case = 'u' for unstructured, 'r' for rectilinear, 's' for structured</font>
<font color="#C00000">def</font> <font color="#000000">flatten_multi_3d_case</font><font color="#4000C0">(</font><font color="#000000">case</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">case_name</font> <font color="#4000C0">=</font> <font color="#008000">"multi_rect3d.silo"</font>
    <font color="#000000">mesh_name</font> <font color="#4000C0">=</font> <font color="#008000">"mesh1"</font>
    <font color="#000000">export_name</font> <font color="#4000C0">=</font> <font color="#000000">case_name</font>
    <font color="#a02030"># Use multi_rect3d to create all cases</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Mesh"</font><font color="#4000C0">,</font> <font color="#000000">mesh_name</font><font color="#4000C0">)</font>

    <font color="#a02030"># Define some mesh based variables</font>
    <font color="#000000">vars</font> <font color="#4000C0">=</font> <font color="#000000">define_mesh_expressions</font><font color="#4000C0">(</font><font color="#000000">mesh_name</font><font color="#4000C0">)</font>

    <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">"Resample"</font><font color="#4000C0">)</font>
    <font color="#000000">ra</font> <font color="#4000C0">=</font> <font color="#000000">ResampleAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">ra</font><font color="#4000C0">.</font><font color="#000000">samplesX</font> <font color="#4000C0">=</font> <font color="#0080C0">5</font>
    <font color="#000000">ra</font><font color="#4000C0">.</font><font color="#000000">samplesY</font> <font color="#4000C0">=</font> <font color="#0080C0">4</font>
    <font color="#000000">ra</font><font color="#4000C0">.</font><font color="#000000">samplesZ</font> <font color="#4000C0">=</font> <font color="#0080C0">3</font>
    <font color="#000000">ra</font><font color="#4000C0">.</font><font color="#000000">distributedResample</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">ra</font><font color="#4000C0">)</font>

    <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">"DeferExpression"</font><font color="#4000C0">)</font>
    <font color="#000000">dea</font> <font color="#4000C0">=</font> <font color="#000000">DeferExpressionAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">dea</font><font color="#4000C0">.</font><font color="#000000">exprs</font> <font color="#4000C0">=</font> <font color="#000000">vars</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">dea</font><font color="#4000C0">)</font>

    <font color="#C00000">if</font> <font color="#000000">case</font> <font color="#4000C0">==</font> <font color="#008000">'u'</font><font color="#4000C0">:</font>
        <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">"Threshold"</font><font color="#4000C0">)</font>
        <font color="#000000">ta</font> <font color="#4000C0">=</font> <font color="#000000">ThresholdAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">ta</font><font color="#4000C0">.</font><font color="#000000">listedVarNames</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">"zid"</font><font color="#4000C0">,</font><font color="#4000C0">)</font>
        <font color="#000000">ta</font><font color="#4000C0">.</font><font color="#000000">lowerBounds</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">,</font><font color="#4000C0">)</font>
        <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">ta</font><font color="#4000C0">)</font>
        <font color="#000000">export_name</font> <font color="#4000C0">=</font> <font color="#008000">"unstructured_"</font> <font color="#4000C0">+</font> <font color="#000000">case_name</font>
    <font color="#C00000">elif</font> <font color="#000000">case</font> <font color="#4000C0">==</font> <font color="#008000">'s'</font><font color="#4000C0">:</font>
        <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">"Transform"</font><font color="#4000C0">)</font>
        <font color="#000000">ta</font> <font color="#4000C0">=</font> <font color="#000000">TransformAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">ta</font><font color="#4000C0">.</font><font color="#000000">doRotate</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
        <font color="#a02030"># ta.rotateType = "Deg"</font>
        <font color="#000000">ta</font><font color="#4000C0">.</font><font color="#000000">rotateAmount</font> <font color="#4000C0">=</font> <font color="#0080C0">0.00001</font>
        <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">ta</font><font color="#4000C0">)</font>
        <font color="#000000">export_name</font> <font color="#4000C0">=</font> <font color="#008000">"structured_"</font> <font color="#4000C0">+</font> <font color="#000000">case_name</font>
    <font color="#a02030"># Do nothing for rectilinear</font>

    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#a02030"># Create csv file</font>
    <font color="#000000">export_dir</font> <font color="#4000C0">=</font> <font color="#000000">create_csv_output</font><font color="#4000C0">(</font><font color="#000000">export_name</font><font color="#4000C0">)</font>

    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test text</font>
    <font color="#000000">test_csv_output</font><font color="#4000C0">(</font><font color="#000000">export_dir</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">flatten_noise</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">case_name</font> <font color="#4000C0">=</font> <font color="#008000">"noise.silo"</font>
    <font color="#000000">mesh_name</font> <font color="#4000C0">=</font> <font color="#008000">"Mesh"</font>
    <font color="#000000">samples</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">5</font><font color="#4000C0">,</font> <font color="#0080C0">4</font><font color="#4000C0">,</font> <font color="#0080C0">3</font><font color="#4000C0">)</font>

    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Mesh"</font><font color="#4000C0">,</font> <font color="#000000">mesh_name</font><font color="#4000C0">)</font>

    <font color="#a02030"># Expose coordinates as variables</font>
    <font color="#000000">vars</font> <font color="#4000C0">=</font> <font color="#000000">define_mesh_expressions</font><font color="#4000C0">(</font><font color="#000000">mesh_name</font><font color="#4000C0">)</font>

    <font color="#a02030"># Resample</font>
    <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">"Resample"</font><font color="#4000C0">)</font>
    <font color="#000000">ra</font> <font color="#4000C0">=</font> <font color="#000000">ResampleAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">ra</font><font color="#4000C0">.</font><font color="#000000">samplesX</font> <font color="#4000C0">=</font> <font color="#000000">samples</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font>
    <font color="#000000">ra</font><font color="#4000C0">.</font><font color="#000000">samplesY</font> <font color="#4000C0">=</font> <font color="#000000">samples</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font>
    <font color="#000000">ra</font><font color="#4000C0">.</font><font color="#000000">samplesZ</font> <font color="#4000C0">=</font> <font color="#000000">samples</font><font color="#4000C0">[</font><font color="#0080C0">2</font><font color="#4000C0">]</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">ra</font><font color="#4000C0">)</font>

    <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">"DeferExpression"</font><font color="#4000C0">)</font>
    <font color="#000000">dea</font> <font color="#4000C0">=</font> <font color="#000000">DeferExpressionAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">dea</font><font color="#4000C0">.</font><font color="#000000">exprs</font> <font color="#4000C0">=</font> <font color="#000000">vars</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">dea</font><font color="#4000C0">)</font>

    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#a02030"># Create the CSV output</font>
    <font color="#000000">export_dir</font> <font color="#4000C0">=</font> <font color="#000000">create_csv_output</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font>

    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test text</font>
    <font color="#000000">test_csv_output</font><font color="#4000C0">(</font><font color="#000000">export_dir</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">partition_test_case</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">,</font> <font color="#000000">targets</font><font color="#4000C0">,</font> <font color="#000000">view</font><font color="#4000C0">=</font><font color="#C00000">None</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#a02030"># Write the original dataset</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"u"</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">set_view</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">,</font> <font color="#000000">view</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#C00000">for</font> <font color="#000000">target</font> <font color="#C00000">in</font> <font color="#000000">targets</font><font color="#4000C0">:</font>
        <font color="#000000">export_name</font> <font color="#4000C0">=</font> <font color="#000000">case_name</font> <font color="#4000C0">+</font> <font color="#008000">"_partition"</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">target</font><font color="#4000C0">)</font>
        <font color="#000000">export_filename</font> <font color="#4000C0">=</font> <font color="#000000">export_name</font> <font color="#4000C0">+</font> <font color="#008000">".cycle_000000.root"</font>

        <font color="#a02030"># Plot the original dataset</font>
        <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"u"</font><font color="#4000C0">)</font>
        <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">set_view</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">,</font> <font color="#000000">view</font><font color="#4000C0">)</font>

        <font color="#a02030"># Set the export database attributes.</font>
        <font color="#000000">e</font> <font color="#4000C0">=</font> <font color="#000000">ExportDBAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">db_type</font> <font color="#4000C0">=</font> <font color="#008000">"Blueprint"</font>
        <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">filename</font> <font color="#4000C0">=</font> <font color="#000000">export_name</font>
        <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">variables</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">"u"</font><font color="#4000C0">)</font>
        <font color="#000000">opts</font> <font color="#4000C0">=</font> <font color="#000000">GetExportOptions</font><font color="#4000C0">(</font><font color="#008000">"Blueprint"</font><font color="#4000C0">)</font>
        <font color="#000000">opts</font><font color="#4000C0">[</font><font color="#008000">"Operation"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">"Partition"</font>
        <font color="#000000">opts</font><font color="#4000C0">[</font><font color="#008000">"Partition target number of domains"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">target</font>
        <font color="#000000">print</font><font color="#4000C0">(</font><font color="#008000">"About to partition "</font> <font color="#4000C0">+</font> <font color="#000000">case_name</font> <font color="#4000C0">+</font> <font color="#008000">" into "</font>
            <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">target</font><font color="#4000C0">)</font> <font color="#4000C0">+</font> <font color="#008000">" blocks."</font><font color="#4000C0">)</font>
        <font color="#000000">ExportDatabase</font><font color="#4000C0">(</font><font color="#000000">e</font><font color="#4000C0">,</font> <font color="#000000">opts</font><font color="#4000C0">)</font>
        <font color="#000000">time</font><font color="#4000C0">.</font><font color="#000000">sleep</font><font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

        <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">export_filename</font><font color="#4000C0">)</font>
        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Pseudocolor"</font><font color="#4000C0">,</font> <font color="#008000">"mesh_topo/u"</font><font color="#4000C0">)</font>
        <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">set_view</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">,</font> <font color="#000000">view</font><font color="#4000C0">)</font>
        <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#000000">test_name</font><font color="#4000C0">(</font><font color="#000000">export_name</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Subset"</font><font color="#4000C0">,</font> <font color="#008000">"domains"</font><font color="#4000C0">)</font>
        <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">set_view</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">,</font> <font color="#000000">view</font><font color="#4000C0">)</font>
        <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#000000">test_name</font><font color="#4000C0">(</font><font color="#000000">export_name</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">export_filename</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">partition_test_extra_options</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">dbname</font> <font color="#4000C0">=</font> <font color="#008000">"multi_rect2d.silo"</font>
    <font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">"Extra options"</font><font color="#4000C0">)</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">dbname</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Subset"</font><font color="#4000C0">,</font> <font color="#008000">"domains(mesh1)"</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"DefaultMesh"</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test JSON</font>
    <font color="#000000">e0</font> <font color="#4000C0">=</font> <font color="#000000">ExportDBAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">e0</font><font color="#4000C0">.</font><font color="#000000">db_type</font> <font color="#4000C0">=</font> <font color="#008000">"Blueprint"</font>
    <font color="#000000">e0</font><font color="#4000C0">.</font><font color="#000000">filename</font> <font color="#4000C0">=</font> <font color="#008000">"multi_rect2d_json_target_1"</font>
    <font color="#000000">e0</font><font color="#4000C0">.</font><font color="#000000">variables</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">"u"</font><font color="#4000C0">)</font>
    <font color="#000000">opts0</font> <font color="#4000C0">=</font> <font color="#000000">GetExportOptions</font><font color="#4000C0">(</font><font color="#008000">"Blueprint"</font><font color="#4000C0">)</font>
    <font color="#000000">opts0</font><font color="#4000C0">[</font><font color="#008000">"Operation"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">"Partition"</font>
    <font color="#000000">opts0</font><font color="#4000C0">[</font><font color="#008000">"Flatten / Partition extra options"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">'{"target": 1}'</font>
    <font color="#000000">ExportDatabase</font><font color="#4000C0">(</font><font color="#000000">e0</font><font color="#4000C0">,</font> <font color="#000000">opts0</font><font color="#4000C0">)</font>
    <font color="#000000">time</font><font color="#4000C0">.</font><font color="#000000">sleep</font><font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test YAML</font>
    <font color="#000000">e1</font> <font color="#4000C0">=</font> <font color="#000000">ExportDBAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">e1</font><font color="#4000C0">.</font><font color="#000000">db_type</font> <font color="#4000C0">=</font> <font color="#008000">"Blueprint"</font>
    <font color="#000000">e1</font><font color="#4000C0">.</font><font color="#000000">filename</font> <font color="#4000C0">=</font> <font color="#008000">"multi_rect2d_yaml_target_1"</font>
    <font color="#000000">e1</font><font color="#4000C0">.</font><font color="#000000">variables</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">"u"</font><font color="#4000C0">)</font>
    <font color="#000000">opts1</font> <font color="#4000C0">=</font> <font color="#000000">GetExportOptions</font><font color="#4000C0">(</font><font color="#008000">"Blueprint"</font><font color="#4000C0">)</font>
    <font color="#000000">opts1</font><font color="#4000C0">[</font><font color="#008000">"Operation"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">"Partition"</font>
    <font color="#000000">opts1</font><font color="#4000C0">[</font><font color="#008000">"Flatten / Partition extra options"</font><font color="#4000C0">]</font>  <font color="#4000C0">=</font> <font color="#008000">'target: 1'</font>
    <font color="#000000">ExportDatabase</font><font color="#4000C0">(</font><font color="#000000">e1</font><font color="#4000C0">,</font> <font color="#000000">opts1</font><font color="#4000C0">)</font>
    <font color="#000000">time</font><font color="#4000C0">.</font><font color="#000000">sleep</font><font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test that the JSON/YAML overrides the options field</font>
    <font color="#000000">e2</font> <font color="#4000C0">=</font> <font color="#000000">ExportDBAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">e2</font><font color="#4000C0">.</font><font color="#000000">db_type</font> <font color="#4000C0">=</font> <font color="#008000">"Blueprint"</font>
    <font color="#000000">e2</font><font color="#4000C0">.</font><font color="#000000">filename</font> <font color="#4000C0">=</font> <font color="#008000">"multi_rect2d_override_target_1"</font>
    <font color="#000000">e2</font><font color="#4000C0">.</font><font color="#000000">variables</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">"u"</font><font color="#4000C0">)</font>
    <font color="#000000">opts2</font> <font color="#4000C0">=</font> <font color="#000000">GetExportOptions</font><font color="#4000C0">(</font><font color="#008000">"Blueprint"</font><font color="#4000C0">)</font>
    <font color="#000000">opts2</font><font color="#4000C0">[</font><font color="#008000">"Operation"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">"Partition"</font>
    <font color="#000000">opts2</font><font color="#4000C0">[</font><font color="#008000">"Partition target number of domains"</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">13</font>
    <font color="#000000">opts2</font><font color="#4000C0">[</font><font color="#008000">"Flatten / Partition extra options"</font><font color="#4000C0">]</font>  <font color="#4000C0">=</font> <font color="#008000">'target: 1'</font>
    <font color="#000000">ExportDatabase</font><font color="#4000C0">(</font><font color="#000000">e2</font><font color="#4000C0">,</font> <font color="#000000">opts2</font><font color="#4000C0">)</font>
    <font color="#000000">time</font><font color="#4000C0">.</font><font color="#000000">sleep</font><font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">dbname</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#008000">"multi_rect2d_json_target_1.cycle_000000.root"</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Subset"</font><font color="#4000C0">,</font> <font color="#008000">"domains"</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"JSONOptions"</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#008000">"multi_rect2d_json_target_1.cycle_000000.root"</font><font color="#4000C0">)</font>

    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#008000">"multi_rect2d_yaml_target_1.cycle_000000.root"</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Subset"</font><font color="#4000C0">,</font> <font color="#008000">"domains"</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"YAMLOptions"</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#008000">"multi_rect2d_yaml_target_1.cycle_000000.root"</font><font color="#4000C0">)</font>

    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#008000">"multi_rect2d_override_target_1.cycle_000000.root"</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">"Subset"</font><font color="#4000C0">,</font> <font color="#008000">"domains"</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">"OverrideOptions"</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#008000">"multi_rect2d_override_target_1.cycle_000000.root"</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">test_flatten</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">"Blueprint flatten"</font><font color="#4000C0">)</font>

    <font color="#000000">flatten_noise</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">flatten_multi_3d_case</font><font color="#4000C0">(</font><font color="#008000">'r'</font><font color="#4000C0">)</font>
    <font color="#000000">flatten_multi_3d_case</font><font color="#4000C0">(</font><font color="#008000">'s'</font><font color="#4000C0">)</font>
    <font color="#000000">flatten_multi_3d_case</font><font color="#4000C0">(</font><font color="#008000">'u'</font><font color="#4000C0">)</font>

    <font color="#000000">flatten_multi_2d_case</font><font color="#4000C0">(</font><font color="#008000">'r'</font><font color="#4000C0">)</font>
    <font color="#000000">flatten_multi_2d_case</font><font color="#4000C0">(</font><font color="#008000">'s'</font><font color="#4000C0">)</font>
    <font color="#000000">flatten_multi_2d_unstructured_case</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">test_partition</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">"Blueprint partition"</font><font color="#4000C0">)</font>

    <font color="#a02030"># Need a couple different views</font>
    <font color="#000000">rect3d_view</font> <font color="#4000C0">=</font> <font color="#000000">GetView3D</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">viewNormal</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#4000C0">-</font><font color="#0080C0">0.467474</font><font color="#4000C0">,</font> <font color="#0080C0">0.301847</font><font color="#4000C0">,</font> <font color="#0080C0">0.830877</font><font color="#4000C0">)</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">focus</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.5</font><font color="#4000C0">,</font> <font color="#0080C0">0.5</font><font color="#4000C0">,</font> <font color="#0080C0">0.5</font><font color="#4000C0">)</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">viewUp</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.140705</font><font color="#4000C0">,</font> <font color="#0080C0">0.953323</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">0.267166</font><font color="#4000C0">)</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">viewAngle</font> <font color="#4000C0">=</font> <font color="#0080C0">30</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">parallelScale</font> <font color="#4000C0">=</font> <font color="#0080C0">0.866025</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">nearPlane</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">1.73205</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">farPlane</font> <font color="#4000C0">=</font> <font color="#0080C0">1.73205</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">imagePan</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#4000C0">-</font><font color="#0080C0">0.0154649</font><font color="#4000C0">,</font> <font color="#0080C0">0.027457</font><font color="#4000C0">)</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">imageZoom</font> <font color="#4000C0">=</font> <font color="#0080C0">1.14276</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">perspective</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">eyeAngle</font> <font color="#4000C0">=</font> <font color="#0080C0">2</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">centerOfRotationSet</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">centerOfRotation</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.5</font><font color="#4000C0">,</font> <font color="#0080C0">0.5</font><font color="#4000C0">,</font> <font color="#0080C0">0.5</font><font color="#4000C0">)</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">axis3DScaleFlag</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">axis3DScales</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">shear</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">windowValid</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>

    <font color="#000000">curv3d_view</font> <font color="#4000C0">=</font> <font color="#000000">GetView3D</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">viewNormal</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#4000C0">-</font><font color="#0080C0">0.254971</font><font color="#4000C0">,</font> <font color="#0080C0">0.246468</font><font color="#4000C0">,</font> <font color="#0080C0">0.93501</font><font color="#4000C0">)</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">focus</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">15</font><font color="#4000C0">)</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">viewUp</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.0453522</font><font color="#4000C0">,</font> <font color="#0080C0">0.968953</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">0.243049</font><font color="#4000C0">)</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">viewAngle</font> <font color="#4000C0">=</font> <font color="#0080C0">30</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">parallelScale</font> <font color="#4000C0">=</font> <font color="#0080C0">16.0078</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">nearPlane</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">32.0156</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">farPlane</font> <font color="#4000C0">=</font> <font color="#0080C0">32.0156</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">imagePan</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">imageZoom</font> <font color="#4000C0">=</font> <font color="#0080C0">1.21</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">perspective</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">eyeAngle</font> <font color="#4000C0">=</font> <font color="#0080C0">2</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">centerOfRotationSet</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">centerOfRotation</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">15</font><font color="#4000C0">)</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">axis3DScaleFlag</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">axis3DScales</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">shear</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">windowValid</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>

    <font color="#a02030"># Run 3D tests</font>
    <font color="#000000">targets_3d</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">4</font><font color="#4000C0">,</font> <font color="#0080C0">19</font><font color="#4000C0">,</font> <font color="#0080C0">45</font><font color="#4000C0">)</font>
    <font color="#000000">partition_test_case</font><font color="#4000C0">(</font><font color="#008000">"multi_rect3d.silo"</font><font color="#4000C0">,</font>
        <font color="#000000">targets_3d</font><font color="#4000C0">,</font> <font color="#000000">rect3d_view</font><font color="#4000C0">)</font>
    <font color="#000000">partition_test_case</font><font color="#4000C0">(</font><font color="#008000">"multi_curv3d.silo"</font><font color="#4000C0">,</font>
        <font color="#000000">targets_3d</font><font color="#4000C0">,</font> <font color="#000000">curv3d_view</font><font color="#4000C0">)</font>
    <font color="#000000">partition_test_case</font><font color="#4000C0">(</font><font color="#008000">"multi_ucd3d.silo"</font><font color="#4000C0">,</font>
        <font color="#000000">targets_3d</font><font color="#4000C0">,</font> <font color="#000000">curv3d_view</font><font color="#4000C0">)</font>

    <font color="#a02030"># Run 2D tests</font>
    <font color="#000000">targets_2d</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">4</font><font color="#4000C0">,</font> <font color="#0080C0">7</font><font color="#4000C0">,</font> <font color="#0080C0">13</font><font color="#4000C0">,</font> <font color="#0080C0">19</font><font color="#4000C0">)</font>
    <font color="#000000">partition_test_case</font><font color="#4000C0">(</font><font color="#008000">"multi_curv2d.silo"</font><font color="#4000C0">,</font>
        <font color="#000000">targets_2d</font><font color="#4000C0">)</font>
    <font color="#000000">partition_test_case</font><font color="#4000C0">(</font><font color="#008000">"multi_rect2d.silo"</font><font color="#4000C0">,</font>
        <font color="#000000">targets_2d</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test extra options</font>
    <font color="#000000">partition_test_extra_options</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">RequiredDatabasePlugin</font><font color="#4000C0">(</font><font color="#008000">"Blueprint"</font><font color="#4000C0">)</font>
<font color="#000000">test_partition</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">test_flatten</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Exit</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000"></font></font></pre></body></html>