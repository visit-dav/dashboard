<html><body bgcolor="#e0e0e0"><head><title>databases/blueprint_export.py</title></head><pre><font face="Lucida,Courier New"><font color="#a02030"># ----------------------------------------------------------------------------</font>
<font color="#a02030">#  MODES: serial parallel</font>
<font color="#a02030">#  CLASSES: nightly</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Test Case:  blueprint_export.py</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Tests:      Tests blueprint export features &quot;partition&quot; and &quot;flatten&quot;.</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Programmer: Christopher Laganella</font>
<font color="#a02030">#  Date:       Tue Dec 14 12:35:16 EST 2021</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Modifications:</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Chris Laganella, Mon Feb 14 14:39:48 EST 2022</font>
<font color="#a02030">#    I added a test case for user provided JSON/YAML options</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Sat Jun 29 14:22:21 PDT 2024</font>
<font color="#a02030">#    Added tests to round-trip mixed element topologies.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Tue Jul  9 10:47:29 PDT 2024</font>
<font color="#a02030">#    Added tests for setting the directory, fixed the cycle numbers, added tests</font>
<font color="#a02030">#    for using the new relay.io.blueprint.save_mesh() options, </font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Fri Jun 27 18:52:37 PDT 2025</font>
<font color="#a02030">#    Added yaml and json tests.</font>
<font color="#a02030"># ----------------------------------------------------------------------------</font>
<font color="#C00000">import</font> <font color="#000000">time</font>
<font color="#C00000">import</font> <font color="#000000">sys</font>
<font color="#C00000">import</font> <font color="#000000">os</font>
<font color="#C00000">import</font> <font color="#000000">conduit</font>

<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#008000">&quot;current&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;databases&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#008000">&quot;current&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;databases&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">out_base</font> <font color="#4000C0">=</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#008000">&quot;current&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;databases&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;blueprint_export&quot;</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">)</font>

<font color="#000000">outdir_set</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;run_dir&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">&quot;testdir&quot;</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">)</font>

<font color="#000000">export_test_save_location</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">,</font> <font color="#008000">&quot;export_test_save_location&quot;</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">export_test_save_location</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">export_test_save_location</font><font color="#4000C0">)</font>

<font color="#a02030"># Uncomment these functions to run the script through the regular CLI</font>
<font color="#a02030"># def Exit():</font>
<font color="#a02030">#     print(&quot;Exiting test...&quot;)</font>
<font color="#a02030">#     return</font>

<font color="#a02030"># def RequiredDatabasePlugin(name):</font>
<font color="#a02030">#     print(&quot;This test requires database plugin &quot; + name)</font>
<font color="#a02030">#     return</font>

<font color="#a02030"># def TestSection(name):</font>
<font color="#a02030">#     print(&quot;---- &quot; + name + &quot; ----&quot;)</font>
<font color="#a02030">#     return</font>

<font color="#a02030"># def Test(name):</font>
<font color="#a02030">#     s = SaveWindowAttributes()</font>
<font color="#a02030">#     s.fileName = name</font>
<font color="#a02030">#     SetSaveWindowAttributes(s)</font>
<font color="#a02030">#     SaveWindow()</font>
<font color="#a02030">#     return</font>

<font color="#a02030"># def TestText(name):</font>
<font color="#a02030">#     print(&quot;Testing text file {}&quot;.format(name))</font>

<font color="#a02030"># def silo_data_path(name):</font>
<font color="#a02030">#     retval = os.path.join(&quot;/mnt/data/il/VisIt/VisItClass/data&quot;, name)</font>
<font color="#a02030">#     # print(retval)</font>
<font color="#a02030">#     return retval</font>

<font color="#C00000">def</font> <font color="#000000">load_text</font><font color="#4000C0">(</font><font color="#000000">file_name</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#a02030"># print(&quot;Loading text from {}&quot;.format(os.path.abspath(file_name)), file=sys.stderr)</font>
    <font color="#C00000">with</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#000000">file_name</font><font color="#4000C0">,</font> <font color="#008000">&#x27;r&#x27;</font><font color="#4000C0">)</font> <font color="#C00000">as</font> <font color="#000000">f</font><font color="#4000C0">:</font>
        <font color="#C00000">return</font> <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">read</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">set_view</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">,</font> <font color="#000000">view</font><font color="#4000C0">=</font><font color="#C00000">None</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">if</font> <font color="#008000">&quot;2d&quot;</font> <font color="#C00000">in</font> <font color="#000000">case_name</font><font color="#4000C0">:</font>
        <font color="#000000">ResetView</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#C00000">else</font><font color="#4000C0">:</font>
        <font color="#000000">SetView3D</font><font color="#4000C0">(</font><font color="#000000">view</font><font color="#4000C0">)</font>


<font color="#C00000">def</font> <font color="#000000">test_name</font><font color="#4000C0">(</font><font color="#000000">case</font><font color="#4000C0">,</font> <font color="#000000">i</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">return</font> <font color="#000000">case</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">i</font><font color="#4000C0">)</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_&quot;</font>

<font color="#a02030"># Export DB as bp data set</font>
<font color="#C00000">def</font> <font color="#000000">export_mesh_bp</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">,</font> <font color="#000000">varname</font><font color="#4000C0">,</font> <font color="#000000">varname2</font> <font color="#4000C0">=</font> <font color="#008000">&quot;&quot;</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#008000">&quot;.&quot;</font><font color="#4000C0">,</font> <font color="#000000">output_type</font> <font color="#4000C0">=</font> <font color="#008000">&quot;HDF5&quot;</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">export_name</font> <font color="#4000C0">=</font> <font color="#000000">case_name</font>
    <font color="#000000">e</font> <font color="#4000C0">=</font> <font color="#000000">ExportDBAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">db_type</font> <font color="#4000C0">=</font> <font color="#008000">&quot;Blueprint&quot;</font>
    <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">filename</font> <font color="#4000C0">=</font> <font color="#000000">export_name</font>
    <font color="#C00000">if</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">varname2</font><font color="#4000C0">)</font> <font color="#4000C0">&gt;</font> <font color="#0080C0">0</font><font color="#4000C0">:</font>
        <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">variables</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#000000">varname</font><font color="#4000C0">,</font> <font color="#000000">varname2</font><font color="#4000C0">)</font>
    <font color="#C00000">else</font><font color="#4000C0">:</font>
        <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">variables</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#000000">varname</font><font color="#4000C0">,</font><font color="#4000C0">)</font>
    <font color="#C00000">if</font> <font color="#000000">dirname</font> <font color="#4000C0">!=</font> <font color="#008000">&quot;.&quot;</font><font color="#4000C0">:</font>
        <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">dirname</font> <font color="#4000C0">=</font> <font color="#000000">dirname</font>
    <font color="#000000">opts</font> <font color="#4000C0">=</font> <font color="#000000">GetExportOptions</font><font color="#4000C0">(</font><font color="#008000">&quot;Blueprint&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">opts</font><font color="#4000C0">[</font><font color="#008000">&quot;Output type&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">output_type</font>
    <font color="#000000">ExportDatabase</font><font color="#4000C0">(</font><font color="#000000">e</font><font color="#4000C0">,</font> <font color="#000000">opts</font><font color="#4000C0">)</font>
    <font color="#000000">time</font><font color="#4000C0">.</font><font color="#000000">sleep</font><font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#C00000">return</font> <font color="#000000">export_name</font>

<font color="#a02030"># Export DB as csv, return the folder name</font>
<font color="#C00000">def</font> <font color="#000000">create_csv_output</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#008000">&quot;.&quot;</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">export_name</font> <font color="#4000C0">=</font> <font color="#000000">case_name</font>
    <font color="#000000">e</font> <font color="#4000C0">=</font> <font color="#000000">ExportDBAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">db_type</font> <font color="#4000C0">=</font> <font color="#008000">&quot;Blueprint&quot;</font>
    <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">filename</font> <font color="#4000C0">=</font> <font color="#000000">export_name</font>
    <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">variables</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">&#x27;mesh_coords&#x27;</font><font color="#4000C0">,</font> <font color="#008000">&#x27;zc_mesh_coords&#x27;</font><font color="#4000C0">)</font>
    <font color="#C00000">if</font> <font color="#000000">dirname</font> <font color="#4000C0">!=</font> <font color="#008000">&quot;.&quot;</font><font color="#4000C0">:</font>
        <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">dirname</font> <font color="#4000C0">=</font> <font color="#000000">dirname</font>
    <font color="#000000">opts</font> <font color="#4000C0">=</font> <font color="#000000">GetExportOptions</font><font color="#4000C0">(</font><font color="#008000">&quot;Blueprint&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">opts</font><font color="#4000C0">[</font><font color="#008000">&quot;Operation&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;Flatten_CSV&quot;</font>
    <font color="#000000">ExportDatabase</font><font color="#4000C0">(</font><font color="#000000">e</font><font color="#4000C0">,</font> <font color="#000000">opts</font><font color="#4000C0">)</font>
    <font color="#000000">time</font><font color="#4000C0">.</font><font color="#000000">sleep</font><font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#C00000">return</font> <font color="#000000">export_name</font> <font color="#4000C0">+</font> <font color="#008000">&quot;.csv&quot;</font>

<font color="#C00000">def</font> <font color="#000000">test_csv_output</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#008000">&quot;.&quot;</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">vert_file</font> <font color="#4000C0">=</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">dirname</font><font color="#4000C0">,</font> <font color="#000000">case_name</font><font color="#4000C0">,</font> <font color="#008000">&quot;vertex_data.csv&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">elem_file</font> <font color="#4000C0">=</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">dirname</font><font color="#4000C0">,</font> <font color="#000000">case_name</font><font color="#4000C0">,</font> <font color="#008000">&quot;element_data.csv&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">vert_baseline</font> <font color="#4000C0">=</font> <font color="#000000">case_name</font> <font color="#4000C0">+</font> <font color="#008000">&quot;-&quot;</font> <font color="#4000C0">+</font> <font color="#008000">&quot;vertex_data.csv&quot;</font>
    <font color="#000000">elem_baseline</font> <font color="#4000C0">=</font> <font color="#000000">case_name</font> <font color="#4000C0">+</font> <font color="#008000">&quot;-&quot;</font> <font color="#4000C0">+</font> <font color="#008000">&quot;element_data.csv&quot;</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#000000">vert_baseline</font><font color="#4000C0">,</font> <font color="#000000">load_text</font><font color="#4000C0">(</font><font color="#000000">vert_file</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#000000">elem_baseline</font><font color="#4000C0">,</font> <font color="#000000">load_text</font><font color="#4000C0">(</font><font color="#000000">elem_file</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">define_mesh_expressions</font><font color="#4000C0">(</font><font color="#000000">mesh_name</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;nid&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;nodeid({})&quot;</font><font color="#4000C0">.</font><font color="#000000">format</font><font color="#4000C0">(</font><font color="#000000">mesh_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;zid&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;zoneid({})&quot;</font><font color="#4000C0">.</font><font color="#000000">format</font><font color="#4000C0">(</font><font color="#000000">mesh_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;mesh_coords&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;coords({})&quot;</font><font color="#4000C0">.</font><font color="#000000">format</font><font color="#4000C0">(</font><font color="#000000">mesh_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;zc_mesh_coords&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;recenter(mesh_coords, \&quot;zonal\&quot;)&quot;</font><font color="#4000C0">)</font>
    <font color="#C00000">return</font> <font color="#4000C0">(</font><font color="#008000">&quot;nid&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;zid&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_coords&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;zc_mesh_coords&quot;</font><font color="#4000C0">)</font>

<font color="#a02030"># &#x27;s&#x27; for structured &#x27;r&#x27; for rectilinear</font>
<font color="#C00000">def</font> <font color="#000000">flatten_multi_2d_case</font><font color="#4000C0">(</font><font color="#000000">case</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#008000">&quot;.&quot;</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">case_name</font> <font color="#4000C0">=</font> <font color="#008000">&quot;multi_rect2d.silo&quot;</font>
    <font color="#000000">mesh_name</font> <font color="#4000C0">=</font> <font color="#008000">&quot;mesh1&quot;</font>
    <font color="#000000">export_name</font> <font color="#4000C0">=</font> <font color="#000000">case_name</font>

    <font color="#a02030"># Use multi_rect3d to create all cases</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Mesh&quot;</font><font color="#4000C0">,</font> <font color="#000000">mesh_name</font><font color="#4000C0">)</font>

    <font color="#a02030"># Define some mesh based variables</font>
    <font color="#000000">vars</font> <font color="#4000C0">=</font> <font color="#000000">define_mesh_expressions</font><font color="#4000C0">(</font><font color="#000000">mesh_name</font><font color="#4000C0">)</font>

    <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">&quot;Resample&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">ra</font> <font color="#4000C0">=</font> <font color="#000000">ResampleAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">ra</font><font color="#4000C0">.</font><font color="#000000">samplesX</font> <font color="#4000C0">=</font> <font color="#0080C0">5</font>
    <font color="#000000">ra</font><font color="#4000C0">.</font><font color="#000000">samplesY</font> <font color="#4000C0">=</font> <font color="#0080C0">4</font>
    <font color="#000000">ra</font><font color="#4000C0">.</font><font color="#000000">is3D</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
    <font color="#000000">ra</font><font color="#4000C0">.</font><font color="#000000">distributedResample</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">ra</font><font color="#4000C0">)</font>

    <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">&quot;DeferExpression&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">dea</font> <font color="#4000C0">=</font> <font color="#000000">DeferExpressionAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">dea</font><font color="#4000C0">.</font><font color="#000000">exprs</font> <font color="#4000C0">=</font> <font color="#000000">vars</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">dea</font><font color="#4000C0">)</font>

    <font color="#C00000">if</font> <font color="#000000">case</font> <font color="#4000C0">==</font> <font color="#008000">&#x27;s&#x27;</font><font color="#4000C0">:</font>
        <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">&quot;Transform&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">ta</font> <font color="#4000C0">=</font> <font color="#000000">TransformAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">ta</font><font color="#4000C0">.</font><font color="#000000">doRotate</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
        <font color="#a02030"># ta.rotateType = &quot;Deg&quot;</font>
        <font color="#000000">ta</font><font color="#4000C0">.</font><font color="#000000">rotateAmount</font> <font color="#4000C0">=</font> <font color="#0080C0">0.00001</font>
        <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">ta</font><font color="#4000C0">)</font>
        <font color="#000000">export_name</font> <font color="#4000C0">=</font> <font color="#008000">&quot;structured_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">case_name</font>

    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#a02030"># Create csv file</font>
    <font color="#000000">export_dir</font> <font color="#4000C0">=</font> <font color="#000000">create_csv_output</font><font color="#4000C0">(</font><font color="#000000">export_name</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">)</font>

    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test text</font>
    <font color="#000000">test_csv_output</font><font color="#4000C0">(</font><font color="#000000">export_dir</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">flatten_multi_2d_unstructured_case</font><font color="#4000C0">(</font><font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#008000">&quot;.&quot;</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">case_name</font> <font color="#4000C0">=</font> <font color="#008000">&quot;ucd2d.silo&quot;</font>
    <font color="#000000">mesh_name</font> <font color="#4000C0">=</font> <font color="#008000">&quot;ucdmesh2d&quot;</font>
    <font color="#000000">export_name</font> <font color="#4000C0">=</font> <font color="#000000">case_name</font>

    <font color="#a02030"># Use multi_curv2d and remove cells</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Mesh&quot;</font><font color="#4000C0">,</font> <font color="#000000">mesh_name</font><font color="#4000C0">)</font>

    <font color="#a02030"># Define some mesh based variables</font>
    <font color="#000000">vars</font> <font color="#4000C0">=</font> <font color="#000000">define_mesh_expressions</font><font color="#4000C0">(</font><font color="#000000">mesh_name</font><font color="#4000C0">)</font>

    <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">&quot;Threshold&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">ta</font> <font color="#4000C0">=</font> <font color="#000000">ThresholdAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">ta</font><font color="#4000C0">.</font><font color="#000000">listedVarNames</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">&quot;zid&quot;</font><font color="#4000C0">,</font><font color="#4000C0">)</font>
    <font color="#000000">ta</font><font color="#4000C0">.</font><font color="#000000">lowerBounds</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">8</font><font color="#4000C0">,</font><font color="#4000C0">)</font>
    <font color="#000000">ta</font><font color="#4000C0">.</font><font color="#000000">upperBounds</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">11</font><font color="#4000C0">,</font><font color="#4000C0">)</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">ta</font><font color="#4000C0">)</font>
    <font color="#000000">export_name</font> <font color="#4000C0">=</font> <font color="#000000">case_name</font>

    <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">&quot;DeferExpression&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">dea</font> <font color="#4000C0">=</font> <font color="#000000">DeferExpressionAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">dea</font><font color="#4000C0">.</font><font color="#000000">exprs</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">&quot;mesh_coords&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;zc_mesh_coords&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">dea</font><font color="#4000C0">)</font>

    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#a02030"># Create csv file</font>
    <font color="#000000">export_dir</font> <font color="#4000C0">=</font> <font color="#000000">create_csv_output</font><font color="#4000C0">(</font><font color="#000000">export_name</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">)</font>

    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test text</font>
    <font color="#000000">test_csv_output</font><font color="#4000C0">(</font><font color="#000000">export_dir</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">)</font>

<font color="#a02030"># case = &#x27;u&#x27; for unstructured, &#x27;r&#x27; for rectilinear, &#x27;s&#x27; for structured</font>
<font color="#C00000">def</font> <font color="#000000">flatten_multi_3d_case</font><font color="#4000C0">(</font><font color="#000000">case</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#008000">&quot;.&quot;</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">case_name</font> <font color="#4000C0">=</font> <font color="#008000">&quot;multi_rect3d.silo&quot;</font>
    <font color="#000000">mesh_name</font> <font color="#4000C0">=</font> <font color="#008000">&quot;mesh1&quot;</font>
    <font color="#000000">export_name</font> <font color="#4000C0">=</font> <font color="#000000">case_name</font>
    <font color="#a02030"># Use multi_rect3d to create all cases</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Mesh&quot;</font><font color="#4000C0">,</font> <font color="#000000">mesh_name</font><font color="#4000C0">)</font>

    <font color="#a02030"># Define some mesh based variables</font>
    <font color="#000000">vars</font> <font color="#4000C0">=</font> <font color="#000000">define_mesh_expressions</font><font color="#4000C0">(</font><font color="#000000">mesh_name</font><font color="#4000C0">)</font>

    <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">&quot;Resample&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">ra</font> <font color="#4000C0">=</font> <font color="#000000">ResampleAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">ra</font><font color="#4000C0">.</font><font color="#000000">samplesX</font> <font color="#4000C0">=</font> <font color="#0080C0">5</font>
    <font color="#000000">ra</font><font color="#4000C0">.</font><font color="#000000">samplesY</font> <font color="#4000C0">=</font> <font color="#0080C0">4</font>
    <font color="#000000">ra</font><font color="#4000C0">.</font><font color="#000000">samplesZ</font> <font color="#4000C0">=</font> <font color="#0080C0">3</font>
    <font color="#000000">ra</font><font color="#4000C0">.</font><font color="#000000">distributedResample</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">ra</font><font color="#4000C0">)</font>

    <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">&quot;DeferExpression&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">dea</font> <font color="#4000C0">=</font> <font color="#000000">DeferExpressionAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">dea</font><font color="#4000C0">.</font><font color="#000000">exprs</font> <font color="#4000C0">=</font> <font color="#000000">vars</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">dea</font><font color="#4000C0">)</font>

    <font color="#C00000">if</font> <font color="#000000">case</font> <font color="#4000C0">==</font> <font color="#008000">&#x27;u&#x27;</font><font color="#4000C0">:</font>
        <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">&quot;Threshold&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">ta</font> <font color="#4000C0">=</font> <font color="#000000">ThresholdAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">ta</font><font color="#4000C0">.</font><font color="#000000">listedVarNames</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">&quot;zid&quot;</font><font color="#4000C0">,</font><font color="#4000C0">)</font>
        <font color="#000000">ta</font><font color="#4000C0">.</font><font color="#000000">lowerBounds</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">,</font><font color="#4000C0">)</font>
        <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">ta</font><font color="#4000C0">)</font>
        <font color="#000000">export_name</font> <font color="#4000C0">=</font> <font color="#008000">&quot;unstructured_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">case_name</font>
    <font color="#C00000">elif</font> <font color="#000000">case</font> <font color="#4000C0">==</font> <font color="#008000">&#x27;s&#x27;</font><font color="#4000C0">:</font>
        <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">&quot;Transform&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">ta</font> <font color="#4000C0">=</font> <font color="#000000">TransformAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">ta</font><font color="#4000C0">.</font><font color="#000000">doRotate</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
        <font color="#a02030"># ta.rotateType = &quot;Deg&quot;</font>
        <font color="#000000">ta</font><font color="#4000C0">.</font><font color="#000000">rotateAmount</font> <font color="#4000C0">=</font> <font color="#0080C0">0.00001</font>
        <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">ta</font><font color="#4000C0">)</font>
        <font color="#000000">export_name</font> <font color="#4000C0">=</font> <font color="#008000">&quot;structured_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">case_name</font>
    <font color="#a02030"># Do nothing for rectilinear</font>

    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#a02030"># Create csv file</font>
    <font color="#000000">export_dir</font> <font color="#4000C0">=</font> <font color="#000000">create_csv_output</font><font color="#4000C0">(</font><font color="#000000">export_name</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">)</font>

    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test text</font>
    <font color="#000000">test_csv_output</font><font color="#4000C0">(</font><font color="#000000">export_dir</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">flatten_noise</font><font color="#4000C0">(</font><font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#008000">&quot;.&quot;</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">case_name</font> <font color="#4000C0">=</font> <font color="#008000">&quot;noise.silo&quot;</font>
    <font color="#000000">mesh_name</font> <font color="#4000C0">=</font> <font color="#008000">&quot;Mesh&quot;</font>
    <font color="#000000">samples</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">5</font><font color="#4000C0">,</font> <font color="#0080C0">4</font><font color="#4000C0">,</font> <font color="#0080C0">3</font><font color="#4000C0">)</font>

    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Mesh&quot;</font><font color="#4000C0">,</font> <font color="#000000">mesh_name</font><font color="#4000C0">)</font>

    <font color="#a02030"># Expose coordinates as variables</font>
    <font color="#000000">vars</font> <font color="#4000C0">=</font> <font color="#000000">define_mesh_expressions</font><font color="#4000C0">(</font><font color="#000000">mesh_name</font><font color="#4000C0">)</font>

    <font color="#a02030"># Resample</font>
    <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">&quot;Resample&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">ra</font> <font color="#4000C0">=</font> <font color="#000000">ResampleAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">ra</font><font color="#4000C0">.</font><font color="#000000">samplesX</font> <font color="#4000C0">=</font> <font color="#000000">samples</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font>
    <font color="#000000">ra</font><font color="#4000C0">.</font><font color="#000000">samplesY</font> <font color="#4000C0">=</font> <font color="#000000">samples</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font>
    <font color="#000000">ra</font><font color="#4000C0">.</font><font color="#000000">samplesZ</font> <font color="#4000C0">=</font> <font color="#000000">samples</font><font color="#4000C0">[</font><font color="#0080C0">2</font><font color="#4000C0">]</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">ra</font><font color="#4000C0">)</font>

    <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">&quot;DeferExpression&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">dea</font> <font color="#4000C0">=</font> <font color="#000000">DeferExpressionAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">dea</font><font color="#4000C0">.</font><font color="#000000">exprs</font> <font color="#4000C0">=</font> <font color="#000000">vars</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">dea</font><font color="#4000C0">)</font>

    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#a02030"># Create the CSV output</font>
    <font color="#000000">export_dir</font> <font color="#4000C0">=</font> <font color="#000000">create_csv_output</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">)</font>

    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test text</font>
    <font color="#000000">test_csv_output</font><font color="#4000C0">(</font><font color="#000000">export_dir</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">partition_test_case</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">,</font> <font color="#000000">targets</font><font color="#4000C0">,</font> <font color="#000000">view</font><font color="#4000C0">=</font><font color="#C00000">None</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#008000">&quot;.&quot;</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#a02030"># Write the original dataset</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;u&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">set_view</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">,</font> <font color="#000000">view</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#000000">case_name</font> <font color="#4000C0">+</font> <font color="#4000C0">(</font><font color="#008000">&quot;_output_dir&quot;</font> <font color="#C00000">if</font> <font color="#000000">dirname</font> <font color="#4000C0">!=</font> <font color="#008000">&quot;.&quot;</font> <font color="#C00000">else</font> <font color="#008000">&quot;&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#C00000">for</font> <font color="#000000">target</font> <font color="#C00000">in</font> <font color="#000000">targets</font><font color="#4000C0">:</font>
        <font color="#000000">export_name</font> <font color="#4000C0">=</font> <font color="#000000">case_name</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_partition&quot;</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">target</font><font color="#4000C0">)</font>
        <font color="#000000">export_filename</font> <font color="#4000C0">=</font> <font color="#000000">export_name</font> <font color="#4000C0">+</font> <font color="#008000">&quot;.cycle_000048.root&quot;</font>

        <font color="#a02030"># Plot the original dataset</font>
        <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;u&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">set_view</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">,</font> <font color="#000000">view</font><font color="#4000C0">)</font>

        <font color="#a02030"># Set the export database attributes.</font>
        <font color="#000000">e</font> <font color="#4000C0">=</font> <font color="#000000">ExportDBAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">db_type</font> <font color="#4000C0">=</font> <font color="#008000">&quot;Blueprint&quot;</font>
        <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">filename</font> <font color="#4000C0">=</font> <font color="#000000">export_name</font>
        <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">variables</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">&quot;u&quot;</font><font color="#4000C0">)</font>
        <font color="#C00000">if</font> <font color="#000000">dirname</font> <font color="#4000C0">!=</font> <font color="#008000">&quot;.&quot;</font><font color="#4000C0">:</font>
            <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">dirname</font> <font color="#4000C0">=</font> <font color="#000000">dirname</font>
        <font color="#000000">opts</font> <font color="#4000C0">=</font> <font color="#000000">GetExportOptions</font><font color="#4000C0">(</font><font color="#008000">&quot;Blueprint&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">opts</font><font color="#4000C0">[</font><font color="#008000">&quot;Operation&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;Partition&quot;</font>
        <font color="#000000">opts</font><font color="#4000C0">[</font><font color="#008000">&quot;Partition target number of domains&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">target</font>
        <font color="#000000">print</font><font color="#4000C0">(</font><font color="#008000">&quot;About to partition &quot;</font> <font color="#4000C0">+</font> <font color="#000000">case_name</font> <font color="#4000C0">+</font> <font color="#008000">&quot; into &quot;</font>
            <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">target</font><font color="#4000C0">)</font> <font color="#4000C0">+</font> <font color="#008000">&quot; blocks.&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">ExportDatabase</font><font color="#4000C0">(</font><font color="#000000">e</font><font color="#4000C0">,</font> <font color="#000000">opts</font><font color="#4000C0">)</font>
        <font color="#000000">time</font><font color="#4000C0">.</font><font color="#000000">sleep</font><font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

        <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">export_filename</font><font color="#4000C0">)</font>
        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_topo/u&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">set_view</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">,</font> <font color="#000000">view</font><font color="#4000C0">)</font>
        <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#000000">test_name</font><font color="#4000C0">(</font><font color="#000000">export_name</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font> <font color="#4000C0">+</font> <font color="#4000C0">(</font><font color="#008000">&quot;output_dir&quot;</font> <font color="#C00000">if</font> <font color="#000000">dirname</font> <font color="#4000C0">!=</font> <font color="#008000">&quot;.&quot;</font> <font color="#C00000">else</font> <font color="#008000">&quot;&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Subset&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;domains&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">set_view</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">,</font> <font color="#000000">view</font><font color="#4000C0">)</font>
        <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#000000">test_name</font><font color="#4000C0">(</font><font color="#000000">export_name</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font> <font color="#4000C0">+</font> <font color="#4000C0">(</font><font color="#008000">&quot;output_dir&quot;</font> <font color="#C00000">if</font> <font color="#000000">dirname</font> <font color="#4000C0">!=</font> <font color="#008000">&quot;.&quot;</font> <font color="#C00000">else</font> <font color="#008000">&quot;&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">export_filename</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">partition_test_extra_options</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">dbname</font> <font color="#4000C0">=</font> <font color="#008000">&quot;multi_rect2d.silo&quot;</font>
    <font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">&quot;Extra options&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">dbname</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Subset&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;domains(mesh1)&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;DefaultMesh&quot;</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test JSON</font>
    <font color="#000000">e0</font> <font color="#4000C0">=</font> <font color="#000000">ExportDBAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">e0</font><font color="#4000C0">.</font><font color="#000000">db_type</font> <font color="#4000C0">=</font> <font color="#008000">&quot;Blueprint&quot;</font>
    <font color="#000000">e0</font><font color="#4000C0">.</font><font color="#000000">filename</font> <font color="#4000C0">=</font> <font color="#008000">&quot;multi_rect2d_json_target_1&quot;</font>
    <font color="#000000">e0</font><font color="#4000C0">.</font><font color="#000000">variables</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">&quot;u&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">opts0</font> <font color="#4000C0">=</font> <font color="#000000">GetExportOptions</font><font color="#4000C0">(</font><font color="#008000">&quot;Blueprint&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">opts0</font><font color="#4000C0">[</font><font color="#008000">&quot;Operation&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;Partition&quot;</font>
    <font color="#000000">opts0</font><font color="#4000C0">[</font><font color="#008000">&quot;Flatten / Partition extra options&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&#x27;{&quot;target&quot;: 1}&#x27;</font>
    <font color="#000000">ExportDatabase</font><font color="#4000C0">(</font><font color="#000000">e0</font><font color="#4000C0">,</font> <font color="#000000">opts0</font><font color="#4000C0">)</font>
    <font color="#000000">time</font><font color="#4000C0">.</font><font color="#000000">sleep</font><font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test YAML</font>
    <font color="#000000">e1</font> <font color="#4000C0">=</font> <font color="#000000">ExportDBAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">e1</font><font color="#4000C0">.</font><font color="#000000">db_type</font> <font color="#4000C0">=</font> <font color="#008000">&quot;Blueprint&quot;</font>
    <font color="#000000">e1</font><font color="#4000C0">.</font><font color="#000000">filename</font> <font color="#4000C0">=</font> <font color="#008000">&quot;multi_rect2d_yaml_target_1&quot;</font>
    <font color="#000000">e1</font><font color="#4000C0">.</font><font color="#000000">variables</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">&quot;u&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">opts1</font> <font color="#4000C0">=</font> <font color="#000000">GetExportOptions</font><font color="#4000C0">(</font><font color="#008000">&quot;Blueprint&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">opts1</font><font color="#4000C0">[</font><font color="#008000">&quot;Operation&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;Partition&quot;</font>
    <font color="#000000">opts1</font><font color="#4000C0">[</font><font color="#008000">&quot;Flatten / Partition extra options&quot;</font><font color="#4000C0">]</font>  <font color="#4000C0">=</font> <font color="#008000">&#x27;target: 1&#x27;</font>
    <font color="#000000">ExportDatabase</font><font color="#4000C0">(</font><font color="#000000">e1</font><font color="#4000C0">,</font> <font color="#000000">opts1</font><font color="#4000C0">)</font>
    <font color="#000000">time</font><font color="#4000C0">.</font><font color="#000000">sleep</font><font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test that the JSON/YAML overrides the options field</font>
    <font color="#000000">e2</font> <font color="#4000C0">=</font> <font color="#000000">ExportDBAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">e2</font><font color="#4000C0">.</font><font color="#000000">db_type</font> <font color="#4000C0">=</font> <font color="#008000">&quot;Blueprint&quot;</font>
    <font color="#000000">e2</font><font color="#4000C0">.</font><font color="#000000">filename</font> <font color="#4000C0">=</font> <font color="#008000">&quot;multi_rect2d_override_target_1&quot;</font>
    <font color="#000000">e2</font><font color="#4000C0">.</font><font color="#000000">variables</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">&quot;u&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">opts2</font> <font color="#4000C0">=</font> <font color="#000000">GetExportOptions</font><font color="#4000C0">(</font><font color="#008000">&quot;Blueprint&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">opts2</font><font color="#4000C0">[</font><font color="#008000">&quot;Operation&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;Partition&quot;</font>
    <font color="#000000">opts2</font><font color="#4000C0">[</font><font color="#008000">&quot;Partition target number of domains&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">13</font>
    <font color="#000000">opts2</font><font color="#4000C0">[</font><font color="#008000">&quot;Flatten / Partition extra options&quot;</font><font color="#4000C0">]</font>  <font color="#4000C0">=</font> <font color="#008000">&#x27;target: 1&#x27;</font>
    <font color="#000000">ExportDatabase</font><font color="#4000C0">(</font><font color="#000000">e2</font><font color="#4000C0">,</font> <font color="#000000">opts2</font><font color="#4000C0">)</font>
    <font color="#000000">time</font><font color="#4000C0">.</font><font color="#000000">sleep</font><font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">dbname</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_rect2d_json_target_1.cycle_000048.root&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Subset&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;domains&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;JSONOptions&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_rect2d_json_target_1.cycle_000048.root&quot;</font><font color="#4000C0">)</font>

    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_rect2d_yaml_target_1.cycle_000048.root&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Subset&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;domains&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;YAMLOptions&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_rect2d_yaml_target_1.cycle_000048.root&quot;</font><font color="#4000C0">)</font>

    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_rect2d_override_target_1.cycle_000048.root&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Subset&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;domains&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;OverrideOptions&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_rect2d_override_target_1.cycle_000048.root&quot;</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">partition_test_extra_extra_options</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">dbname</font> <font color="#4000C0">=</font> <font color="#008000">&quot;multi_rect2d.silo&quot;</font>
    <font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">&quot;Extra extra options&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">dbname</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Subset&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;domains(mesh1)&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;DefaultMesh_extra_extra_options&quot;</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test JSON</font>
    <font color="#000000">e0</font> <font color="#4000C0">=</font> <font color="#000000">ExportDBAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">e0</font><font color="#4000C0">.</font><font color="#000000">db_type</font> <font color="#4000C0">=</font> <font color="#008000">&quot;Blueprint&quot;</font>
    <font color="#000000">e0</font><font color="#4000C0">.</font><font color="#000000">filename</font> <font color="#4000C0">=</font> <font color="#008000">&quot;multi_rect2d_json_target_1&quot;</font>
    <font color="#000000">e0</font><font color="#4000C0">.</font><font color="#000000">variables</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">&quot;u&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">opts0</font> <font color="#4000C0">=</font> <font color="#000000">GetExportOptions</font><font color="#4000C0">(</font><font color="#008000">&quot;Blueprint&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">opts0</font><font color="#4000C0">[</font><font color="#008000">&quot;Operation&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;Partition&quot;</font>
    <font color="#000000">opts0</font><font color="#4000C0">[</font><font color="#008000">&quot;Flatten / Partition extra options&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&#x27;{&quot;target&quot;: 1}&#x27;</font>
    <font color="#000000">opts0</font><font color="#4000C0">[</font><font color="#008000">&quot;Blueprint Relay I/O extra options&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;&quot;&quot;{
    \&quot;file_style\&quot;: \&quot;multi_file\&quot;,
    \&quot;suffix\&quot;: \&quot;none\&quot;,
    \&quot;mesh_name\&quot;: \&quot;mesh1\&quot;,
    \&quot;number_of_files\&quot;: 2,
    \&quot;truncate\&quot;: \&quot;false\&quot;
}&quot;&quot;&quot;</font>
    <font color="#a02030"># opts0[&quot;Output type&quot;] = &quot;JSON&quot;</font>
    <font color="#000000">ExportDatabase</font><font color="#4000C0">(</font><font color="#000000">e0</font><font color="#4000C0">,</font> <font color="#000000">opts0</font><font color="#4000C0">)</font>
    <font color="#000000">time</font><font color="#4000C0">.</font><font color="#000000">sleep</font><font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test YAML</font>
    <font color="#000000">e1</font> <font color="#4000C0">=</font> <font color="#000000">ExportDBAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">e1</font><font color="#4000C0">.</font><font color="#000000">db_type</font> <font color="#4000C0">=</font> <font color="#008000">&quot;Blueprint&quot;</font>
    <font color="#000000">e1</font><font color="#4000C0">.</font><font color="#000000">filename</font> <font color="#4000C0">=</font> <font color="#008000">&quot;multi_rect2d_yaml_target_1&quot;</font>
    <font color="#000000">e1</font><font color="#4000C0">.</font><font color="#000000">variables</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">&quot;u&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">opts1</font> <font color="#4000C0">=</font> <font color="#000000">GetExportOptions</font><font color="#4000C0">(</font><font color="#008000">&quot;Blueprint&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">opts1</font><font color="#4000C0">[</font><font color="#008000">&quot;Operation&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;Partition&quot;</font>
    <font color="#000000">opts1</font><font color="#4000C0">[</font><font color="#008000">&quot;Flatten / Partition extra options&quot;</font><font color="#4000C0">]</font>  <font color="#4000C0">=</font> <font color="#008000">&#x27;target: 1&#x27;</font>
    <font color="#000000">opts1</font><font color="#4000C0">[</font><font color="#008000">&quot;Blueprint Relay I/O extra options&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;&quot;&quot;file_style: \&quot;multi_file\&quot;
suffix: \&quot;none\&quot;
mesh_name: \&quot;mesh1\&quot;
number_of_files: 2
truncate: \&quot;false\&quot;&quot;&quot;&quot;</font>
    <font color="#a02030"># opts1[&quot;Output type&quot;] = &quot;YAML&quot;</font>
    <font color="#000000">ExportDatabase</font><font color="#4000C0">(</font><font color="#000000">e1</font><font color="#4000C0">,</font> <font color="#000000">opts1</font><font color="#4000C0">)</font>
    <font color="#000000">time</font><font color="#4000C0">.</font><font color="#000000">sleep</font><font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test that the JSON/YAML overrides the options field</font>
    <font color="#000000">e2</font> <font color="#4000C0">=</font> <font color="#000000">ExportDBAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">e2</font><font color="#4000C0">.</font><font color="#000000">db_type</font> <font color="#4000C0">=</font> <font color="#008000">&quot;Blueprint&quot;</font>
    <font color="#000000">e2</font><font color="#4000C0">.</font><font color="#000000">filename</font> <font color="#4000C0">=</font> <font color="#008000">&quot;multi_rect2d_override_target_1&quot;</font>
    <font color="#000000">e2</font><font color="#4000C0">.</font><font color="#000000">variables</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">&quot;u&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">opts2</font> <font color="#4000C0">=</font> <font color="#000000">GetExportOptions</font><font color="#4000C0">(</font><font color="#008000">&quot;Blueprint&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">opts2</font><font color="#4000C0">[</font><font color="#008000">&quot;Operation&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;Partition&quot;</font>
    <font color="#000000">opts2</font><font color="#4000C0">[</font><font color="#008000">&quot;Partition target number of domains&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">13</font>
    <font color="#000000">opts2</font><font color="#4000C0">[</font><font color="#008000">&quot;Flatten / Partition extra options&quot;</font><font color="#4000C0">]</font>  <font color="#4000C0">=</font> <font color="#008000">&#x27;target: 1&#x27;</font>
    <font color="#000000">ExportDatabase</font><font color="#4000C0">(</font><font color="#000000">e2</font><font color="#4000C0">,</font> <font color="#000000">opts2</font><font color="#4000C0">)</font>
    <font color="#000000">time</font><font color="#4000C0">.</font><font color="#000000">sleep</font><font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">dbname</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_rect2d_json_target_1.root&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Subset&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;domains&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;JSONOptions_extra_extra_options&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_rect2d_json_target_1.root&quot;</font><font color="#4000C0">)</font>

    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_rect2d_yaml_target_1.root&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Subset&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;domains&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;YAMLOptions_extra_extra_options&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_rect2d_yaml_target_1.root&quot;</font><font color="#4000C0">)</font>

    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_rect2d_override_target_1.root&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Subset&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;domains&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;OverrideOptions_extra_extra_options&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_rect2d_override_target_1.root&quot;</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">basic_test_case</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">,</font> <font color="#000000">varname</font> <font color="#4000C0">=</font> <font color="#008000">&quot;d&quot;</font><font color="#4000C0">,</font> <font color="#000000">dirname</font> <font color="#4000C0">=</font> <font color="#008000">&quot;.&quot;</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">for</font> <font color="#000000">out_type</font> <font color="#C00000">in</font> <font color="#4000C0">[</font><font color="#008000">&quot;HDF5&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;YAML&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;JSON&quot;</font><font color="#4000C0">]</font><font color="#4000C0">:</font>
        <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font><font color="#000000">varname</font><font color="#4000C0">)</font>
        <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;basic_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">case_name</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_input_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">out_type</font> <font color="#4000C0">+</font> <font color="#4000C0">(</font><font color="#008000">&quot;_output_dir&quot;</font> <font color="#C00000">if</font> <font color="#000000">dirname</font> <font color="#4000C0">!=</font> <font color="#008000">&quot;.&quot;</font> <font color="#C00000">else</font> <font color="#008000">&quot;&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
        <font color="#a02030"># export default</font>
        <font color="#000000">export_rfile_default</font> <font color="#4000C0">=</font> <font color="#000000">export_mesh_bp</font><font color="#4000C0">(</font><font color="#000000">case_name</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_default&quot;</font><font color="#4000C0">,</font> <font color="#000000">varname</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#000000">dirname</font><font color="#4000C0">,</font> <font color="#000000">output_type</font><font color="#4000C0">=</font><font color="#000000">out_type</font><font color="#4000C0">)</font> <font color="#4000C0">+</font> <font color="#008000">&quot;.cycle_000048.root&quot;</font>
        <font color="#a02030"># export post isosurface</font>
        <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">&quot;Isosurface&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;basic_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">case_name</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_isosurface_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">out_type</font> <font color="#4000C0">+</font> <font color="#4000C0">(</font><font color="#008000">&quot;_output_dir&quot;</font> <font color="#C00000">if</font> <font color="#000000">dirname</font> <font color="#4000C0">!=</font> <font color="#008000">&quot;.&quot;</font> <font color="#C00000">else</font> <font color="#008000">&quot;&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
        <font color="#000000">export_rfile_isos</font> <font color="#4000C0">=</font> <font color="#000000">export_mesh_bp</font><font color="#4000C0">(</font><font color="#000000">case_name</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_isosurface&quot;</font><font color="#4000C0">,</font> <font color="#000000">varname</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#000000">dirname</font><font color="#4000C0">,</font> <font color="#000000">output_type</font><font color="#4000C0">=</font><font color="#000000">out_type</font><font color="#4000C0">)</font> <font color="#4000C0">+</font> <font color="#008000">&quot;.cycle_000048.root&quot;</font>
        <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

        <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">export_rfile_default</font><font color="#4000C0">)</font>
        <font color="#a02030"># bp var names are qualified by topo</font>
        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;mesh_topo/&quot;</font> <font color="#4000C0">+</font> <font color="#000000">varname</font><font color="#4000C0">)</font>
        <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;basic_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">case_name</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_default_exported_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">out_type</font> <font color="#4000C0">+</font> <font color="#4000C0">(</font><font color="#008000">&quot;_output_dir&quot;</font> <font color="#C00000">if</font> <font color="#000000">dirname</font> <font color="#4000C0">!=</font> <font color="#008000">&quot;.&quot;</font> <font color="#C00000">else</font> <font color="#008000">&quot;&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">export_rfile_default</font><font color="#4000C0">)</font>

        <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">export_rfile_isos</font><font color="#4000C0">)</font>
        <font color="#a02030"># bp var names are qualified by topo</font>
        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_topo/&quot;</font> <font color="#4000C0">+</font> <font color="#000000">varname</font><font color="#4000C0">)</font>
        <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;basic_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">case_name</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_isosurface_exported_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">out_type</font> <font color="#4000C0">+</font> <font color="#4000C0">(</font><font color="#008000">&quot;_output_dir&quot;</font> <font color="#C00000">if</font> <font color="#000000">dirname</font> <font color="#4000C0">!=</font> <font color="#008000">&quot;.&quot;</font> <font color="#C00000">else</font> <font color="#008000">&quot;&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">export_rfile_isos</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">basic_test_case_extra_options</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">,</font> <font color="#000000">varname</font> <font color="#4000C0">=</font> <font color="#008000">&quot;d&quot;</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font><font color="#000000">varname</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;basic_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">case_name</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_extra_options_input&quot;</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test JSON</font>
    <font color="#000000">e0</font> <font color="#4000C0">=</font> <font color="#000000">ExportDBAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">e0</font><font color="#4000C0">.</font><font color="#000000">db_type</font> <font color="#4000C0">=</font> <font color="#008000">&quot;Blueprint&quot;</font>
    <font color="#000000">e0</font><font color="#4000C0">.</font><font color="#000000">filename</font> <font color="#4000C0">=</font> <font color="#000000">case_name</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_json&quot;</font>
    <font color="#000000">e0</font><font color="#4000C0">.</font><font color="#000000">variables</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#000000">varname</font><font color="#4000C0">,</font><font color="#4000C0">)</font>
    <font color="#000000">opts0</font> <font color="#4000C0">=</font> <font color="#000000">GetExportOptions</font><font color="#4000C0">(</font><font color="#008000">&quot;Blueprint&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">opts0</font><font color="#4000C0">[</font><font color="#008000">&quot;Blueprint Relay I/O extra options&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;&quot;&quot;{
    \&quot;file_style\&quot;: \&quot;multi_file\&quot;,
    \&quot;suffix\&quot;: \&quot;none\&quot;,
    \&quot;mesh_name\&quot;: \&quot;mesh1\&quot;,
    \&quot;number_of_files\&quot;: 2,
    \&quot;truncate\&quot;: \&quot;false\&quot;
}&quot;&quot;&quot;</font>
    <font color="#a02030"># opts0[&quot;Output type&quot;] = &quot;JSON&quot;</font>
    <font color="#000000">ExportDatabase</font><font color="#4000C0">(</font><font color="#000000">e0</font><font color="#4000C0">,</font> <font color="#000000">opts0</font><font color="#4000C0">)</font>
    <font color="#000000">time</font><font color="#4000C0">.</font><font color="#000000">sleep</font><font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test YAML</font>
    <font color="#000000">e1</font> <font color="#4000C0">=</font> <font color="#000000">ExportDBAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">e1</font><font color="#4000C0">.</font><font color="#000000">db_type</font> <font color="#4000C0">=</font> <font color="#008000">&quot;Blueprint&quot;</font>
    <font color="#000000">e1</font><font color="#4000C0">.</font><font color="#000000">filename</font> <font color="#4000C0">=</font> <font color="#000000">case_name</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_yaml&quot;</font>
    <font color="#000000">e1</font><font color="#4000C0">.</font><font color="#000000">variables</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#000000">varname</font><font color="#4000C0">,</font><font color="#4000C0">)</font>
    <font color="#000000">opts1</font> <font color="#4000C0">=</font> <font color="#000000">GetExportOptions</font><font color="#4000C0">(</font><font color="#008000">&quot;Blueprint&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">opts1</font><font color="#4000C0">[</font><font color="#008000">&quot;Blueprint Relay I/O extra options&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;&quot;&quot;file_style: \&quot;multi_file\&quot;
suffix: \&quot;none\&quot;
mesh_name: \&quot;mesh1\&quot;
number_of_files: 2
truncate: \&quot;false\&quot;&quot;&quot;&quot;</font>
    <font color="#a02030"># opts1[&quot;Output type&quot;] = &quot;YAML&quot;</font>
    <font color="#000000">ExportDatabase</font><font color="#4000C0">(</font><font color="#000000">e1</font><font color="#4000C0">,</font> <font color="#000000">opts1</font><font color="#4000C0">)</font>
    <font color="#000000">time</font><font color="#4000C0">.</font><font color="#000000">sleep</font><font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">)</font>

    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#000000">case_name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">case_name</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_json.root&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;mesh1_topo/&quot;</font> <font color="#4000C0">+</font> <font color="#000000">varname</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;BasicJSONOptions&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">case_name</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_json.root&quot;</font><font color="#4000C0">)</font>

    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">case_name</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_yaml.root&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;mesh1_topo/&quot;</font> <font color="#4000C0">+</font> <font color="#000000">varname</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;BasicYAMLOptions&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">case_name</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_yaml.root&quot;</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">test_basic</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">basic_test_case</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_rect3d.silo&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">basic_test_case</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_curv3d.silo&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">basic_test_case</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_curv2d.silo&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">basic_test_case</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_ucd3d.silo&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">basic_test_case</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_rect2d.silo&quot;</font><font color="#4000C0">)</font>

    <font color="#000000">basic_test_case</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_rect3d.silo&quot;</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#000000">export_test_save_location</font><font color="#4000C0">)</font>
    <font color="#000000">basic_test_case</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_curv3d.silo&quot;</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#000000">export_test_save_location</font><font color="#4000C0">)</font>
    <font color="#000000">basic_test_case</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_curv2d.silo&quot;</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#000000">export_test_save_location</font><font color="#4000C0">)</font>
    <font color="#000000">basic_test_case</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_ucd3d.silo&quot;</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#000000">export_test_save_location</font><font color="#4000C0">)</font>
    <font color="#000000">basic_test_case</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_rect2d.silo&quot;</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#000000">export_test_save_location</font><font color="#4000C0">)</font>

    <font color="#000000">basic_test_case_extra_options</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_rect3d.silo&quot;</font><font color="#4000C0">)</font>


<font color="#C00000">def</font> <font color="#000000">test_flatten</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">&quot;Blueprint flatten&quot;</font><font color="#4000C0">)</font>

    <font color="#000000">flatten_noise</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">flatten_multi_3d_case</font><font color="#4000C0">(</font><font color="#008000">&#x27;r&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">flatten_multi_3d_case</font><font color="#4000C0">(</font><font color="#008000">&#x27;s&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">flatten_multi_3d_case</font><font color="#4000C0">(</font><font color="#008000">&#x27;u&#x27;</font><font color="#4000C0">)</font>

    <font color="#000000">flatten_multi_2d_case</font><font color="#4000C0">(</font><font color="#008000">&#x27;r&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">flatten_multi_2d_case</font><font color="#4000C0">(</font><font color="#008000">&#x27;s&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">flatten_multi_2d_unstructured_case</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#a02030"># test setting the output directory</font>
    <font color="#000000">flatten_noise</font><font color="#4000C0">(</font><font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#000000">export_test_save_location</font><font color="#4000C0">)</font>
    <font color="#000000">flatten_multi_3d_case</font><font color="#4000C0">(</font><font color="#008000">&#x27;r&#x27;</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#000000">export_test_save_location</font><font color="#4000C0">)</font>
    <font color="#000000">flatten_multi_3d_case</font><font color="#4000C0">(</font><font color="#008000">&#x27;s&#x27;</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#000000">export_test_save_location</font><font color="#4000C0">)</font>
    <font color="#000000">flatten_multi_3d_case</font><font color="#4000C0">(</font><font color="#008000">&#x27;u&#x27;</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#000000">export_test_save_location</font><font color="#4000C0">)</font>

    <font color="#000000">flatten_multi_2d_case</font><font color="#4000C0">(</font><font color="#008000">&#x27;r&#x27;</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#000000">export_test_save_location</font><font color="#4000C0">)</font>
    <font color="#000000">flatten_multi_2d_case</font><font color="#4000C0">(</font><font color="#008000">&#x27;s&#x27;</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#000000">export_test_save_location</font><font color="#4000C0">)</font>
    <font color="#000000">flatten_multi_2d_unstructured_case</font><font color="#4000C0">(</font><font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#000000">export_test_save_location</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">test_partition</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">&quot;Blueprint partition&quot;</font><font color="#4000C0">)</font>

    <font color="#a02030"># Need a couple different views</font>
    <font color="#000000">rect3d_view</font> <font color="#4000C0">=</font> <font color="#000000">GetView3D</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">viewNormal</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#4000C0">-</font><font color="#0080C0">0.467474</font><font color="#4000C0">,</font> <font color="#0080C0">0.301847</font><font color="#4000C0">,</font> <font color="#0080C0">0.830877</font><font color="#4000C0">)</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">focus</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.5</font><font color="#4000C0">,</font> <font color="#0080C0">0.5</font><font color="#4000C0">,</font> <font color="#0080C0">0.5</font><font color="#4000C0">)</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">viewUp</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.140705</font><font color="#4000C0">,</font> <font color="#0080C0">0.953323</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">0.267166</font><font color="#4000C0">)</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">viewAngle</font> <font color="#4000C0">=</font> <font color="#0080C0">30</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">parallelScale</font> <font color="#4000C0">=</font> <font color="#0080C0">0.866025</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">nearPlane</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">1.73205</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">farPlane</font> <font color="#4000C0">=</font> <font color="#0080C0">1.73205</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">imagePan</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#4000C0">-</font><font color="#0080C0">0.0154649</font><font color="#4000C0">,</font> <font color="#0080C0">0.027457</font><font color="#4000C0">)</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">imageZoom</font> <font color="#4000C0">=</font> <font color="#0080C0">1.14276</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">perspective</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">eyeAngle</font> <font color="#4000C0">=</font> <font color="#0080C0">2</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">centerOfRotationSet</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">centerOfRotation</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.5</font><font color="#4000C0">,</font> <font color="#0080C0">0.5</font><font color="#4000C0">,</font> <font color="#0080C0">0.5</font><font color="#4000C0">)</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">axis3DScaleFlag</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">axis3DScales</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">shear</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">rect3d_view</font><font color="#4000C0">.</font><font color="#000000">windowValid</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>

    <font color="#000000">curv3d_view</font> <font color="#4000C0">=</font> <font color="#000000">GetView3D</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">viewNormal</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#4000C0">-</font><font color="#0080C0">0.254971</font><font color="#4000C0">,</font> <font color="#0080C0">0.246468</font><font color="#4000C0">,</font> <font color="#0080C0">0.93501</font><font color="#4000C0">)</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">focus</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">15</font><font color="#4000C0">)</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">viewUp</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.0453522</font><font color="#4000C0">,</font> <font color="#0080C0">0.968953</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">0.243049</font><font color="#4000C0">)</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">viewAngle</font> <font color="#4000C0">=</font> <font color="#0080C0">30</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">parallelScale</font> <font color="#4000C0">=</font> <font color="#0080C0">16.0078</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">nearPlane</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">32.0156</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">farPlane</font> <font color="#4000C0">=</font> <font color="#0080C0">32.0156</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">imagePan</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">imageZoom</font> <font color="#4000C0">=</font> <font color="#0080C0">1.21</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">perspective</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">eyeAngle</font> <font color="#4000C0">=</font> <font color="#0080C0">2</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">centerOfRotationSet</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">centerOfRotation</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">15</font><font color="#4000C0">)</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">axis3DScaleFlag</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">axis3DScales</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">shear</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">curv3d_view</font><font color="#4000C0">.</font><font color="#000000">windowValid</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>

    <font color="#a02030"># Run 3D tests</font>
    <font color="#000000">targets_3d</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">4</font><font color="#4000C0">,</font> <font color="#0080C0">19</font><font color="#4000C0">,</font> <font color="#0080C0">45</font><font color="#4000C0">)</font>
    <font color="#000000">partition_test_case</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_rect3d.silo&quot;</font><font color="#4000C0">,</font>
        <font color="#000000">targets_3d</font><font color="#4000C0">,</font> <font color="#000000">rect3d_view</font><font color="#4000C0">)</font>
    <font color="#000000">partition_test_case</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_curv3d.silo&quot;</font><font color="#4000C0">,</font>
        <font color="#000000">targets_3d</font><font color="#4000C0">,</font> <font color="#000000">curv3d_view</font><font color="#4000C0">)</font>
    <font color="#000000">partition_test_case</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_ucd3d.silo&quot;</font><font color="#4000C0">,</font>
        <font color="#000000">targets_3d</font><font color="#4000C0">,</font> <font color="#000000">curv3d_view</font><font color="#4000C0">)</font>

    <font color="#a02030"># Run 2D tests</font>
    <font color="#000000">targets_2d</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">4</font><font color="#4000C0">,</font> <font color="#0080C0">7</font><font color="#4000C0">,</font> <font color="#0080C0">13</font><font color="#4000C0">,</font> <font color="#0080C0">19</font><font color="#4000C0">)</font>
    <font color="#000000">partition_test_case</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_curv2d.silo&quot;</font><font color="#4000C0">,</font>
        <font color="#000000">targets_2d</font><font color="#4000C0">)</font>
    <font color="#000000">partition_test_case</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_rect2d.silo&quot;</font><font color="#4000C0">,</font>
        <font color="#000000">targets_2d</font><font color="#4000C0">)</font>

    <font color="#a02030"># different directory tests:</font>
    <font color="#a02030"># Run 3D tests</font>
    <font color="#000000">targets_3d</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">4</font><font color="#4000C0">,</font> <font color="#0080C0">19</font><font color="#4000C0">,</font> <font color="#0080C0">45</font><font color="#4000C0">)</font>
    <font color="#000000">partition_test_case</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_rect3d.silo&quot;</font><font color="#4000C0">,</font>
        <font color="#000000">targets_3d</font><font color="#4000C0">,</font> <font color="#000000">rect3d_view</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#000000">export_test_save_location</font><font color="#4000C0">)</font>
    <font color="#000000">partition_test_case</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_curv3d.silo&quot;</font><font color="#4000C0">,</font>
        <font color="#000000">targets_3d</font><font color="#4000C0">,</font> <font color="#000000">curv3d_view</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#000000">export_test_save_location</font><font color="#4000C0">)</font>
    <font color="#000000">partition_test_case</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_ucd3d.silo&quot;</font><font color="#4000C0">,</font>
        <font color="#000000">targets_3d</font><font color="#4000C0">,</font> <font color="#000000">curv3d_view</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#000000">export_test_save_location</font><font color="#4000C0">)</font>

    <font color="#a02030"># Run 2D tests</font>
    <font color="#000000">targets_2d</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">4</font><font color="#4000C0">,</font> <font color="#0080C0">7</font><font color="#4000C0">,</font> <font color="#0080C0">13</font><font color="#4000C0">,</font> <font color="#0080C0">19</font><font color="#4000C0">)</font>
    <font color="#000000">partition_test_case</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_curv2d.silo&quot;</font><font color="#4000C0">,</font>
        <font color="#000000">targets_2d</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#000000">export_test_save_location</font><font color="#4000C0">)</font>
    <font color="#000000">partition_test_case</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_rect2d.silo&quot;</font><font color="#4000C0">,</font>
        <font color="#000000">targets_2d</font><font color="#4000C0">,</font> <font color="#000000">dirname</font><font color="#4000C0">=</font><font color="#000000">export_test_save_location</font><font color="#4000C0">)</font>

    <font color="#a02030"># Test extra options</font>
    <font color="#000000">partition_test_extra_options</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">partition_test_extra_extra_options</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">roundtrip_simple_mixed_topo</font><font color="#4000C0">(</font><font color="#000000">mixed_topo</font><font color="#4000C0">,</font> <font color="#000000">export_name</font><font color="#4000C0">,</font> <font color="#000000">test_name</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">mixed_topo</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Mesh&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_topo&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_topo/ele_id&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">ResetView</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">outfilename</font> <font color="#4000C0">=</font> <font color="#000000">export_mesh_bp</font><font color="#4000C0">(</font><font color="#000000">export_name</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_topo/ele_id&quot;</font><font color="#4000C0">)</font> <font color="#4000C0">+</font> <font color="#008000">&quot;.cycle_000000.root&quot;</font>

    <font color="#000000">save_mesh</font> <font color="#4000C0">=</font> <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">Node</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">relay</font><font color="#4000C0">.</font><font color="#000000">io</font><font color="#4000C0">.</font><font color="#000000">blueprint</font><font color="#4000C0">.</font><font color="#000000">load_mesh</font><font color="#4000C0">(</font><font color="#000000">save_mesh</font><font color="#4000C0">,</font> <font color="#000000">mixed_topo</font><font color="#4000C0">)</font>

    <font color="#000000">load_mesh</font> <font color="#4000C0">=</font> <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">Node</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">relay</font><font color="#4000C0">.</font><font color="#000000">io</font><font color="#4000C0">.</font><font color="#000000">blueprint</font><font color="#4000C0">.</font><font color="#000000">load_mesh</font><font color="#4000C0">(</font><font color="#000000">load_mesh</font><font color="#4000C0">,</font> <font color="#000000">outfilename</font><font color="#4000C0">)</font>

    <font color="#a02030"># </font>
    <font color="#a02030"># make changes so the diff will pass</font>
    <font color="#a02030"># </font>

    <font color="#a02030"># grab the cycle and time which were added in</font>
    <font color="#000000">save_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;state&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;cycle&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">load_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;state&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;cycle&quot;</font><font color="#4000C0">]</font>
    <font color="#000000">save_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;state&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;time&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">load_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;state&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;time&quot;</font><font color="#4000C0">]</font>

    <font color="#a02030"># remove the pts topo</font>
    <font color="#000000">save_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;topologies&quot;</font><font color="#4000C0">]</font><font color="#4000C0">.</font><font color="#000000">remove_child</font><font color="#4000C0">(</font><font color="#008000">&quot;pts&quot;</font><font color="#4000C0">)</font>

    <font color="#a02030"># remove the pts_id field</font>
    <font color="#000000">save_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;fields&quot;</font><font color="#4000C0">]</font><font color="#4000C0">.</font><font color="#000000">remove_child</font><font color="#4000C0">(</font><font color="#008000">&quot;pts_id&quot;</font><font color="#4000C0">)</font>

    <font color="#a02030"># check ele_id field</font>
    <font color="#000000">save_mesh_element_ids</font> <font color="#4000C0">=</font> <font color="#000000">save_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;fields&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;ele_id&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;values&quot;</font><font color="#4000C0">]</font>
    <font color="#000000">load_mesh_element_ids</font> <font color="#4000C0">=</font> <font color="#000000">load_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;fields&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;ele_id&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;values&quot;</font><font color="#4000C0">]</font>
    <font color="#C00000">for</font> <font color="#000000">i</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">save_mesh_element_ids</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">&quot;Mixed_topo_simple_2d_export_field_vals&quot;</font><font color="#4000C0">,</font> <font color="#000000">save_mesh_element_ids</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">load_mesh_element_ids</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#000000">save_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;fields&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;ele_id&quot;</font><font color="#4000C0">]</font><font color="#4000C0">.</font><font color="#000000">remove_child</font><font color="#4000C0">(</font><font color="#008000">&quot;values&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">load_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;fields&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;ele_id&quot;</font><font color="#4000C0">]</font><font color="#4000C0">.</font><font color="#000000">remove_child</font><font color="#4000C0">(</font><font color="#008000">&quot;values&quot;</font><font color="#4000C0">)</font>

    <font color="#000000">info</font> <font color="#4000C0">=</font> <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">Node</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">diffval</font> <font color="#4000C0">=</font> <font color="#000000">load_mesh</font><font color="#4000C0">.</font><font color="#000000">diff</font><font color="#4000C0">(</font><font color="#000000">save_mesh</font><font color="#4000C0">,</font> <font color="#000000">info</font><font color="#4000C0">)</font>
    <font color="#000000">diff_str</font> <font color="#4000C0">=</font> <font color="#000000">info</font><font color="#4000C0">.</font><font color="#000000">to_yaml</font><font color="#4000C0">(</font><font color="#4000C0">)</font> <font color="#C00000">if</font> <font color="#000000">diffval</font> <font color="#C00000">else</font> <font color="#008000">&quot;&quot;</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">test_name</font><font color="#4000C0">,</font> <font color="#000000">diff_str</font><font color="#4000C0">,</font> <font color="#008000">&quot;&quot;</font><font color="#4000C0">)</font>

    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">mixed_topo</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">roundtrip_braid_mixed</font><font color="#4000C0">(</font><font color="#000000">mixed_topo</font><font color="#4000C0">,</font> <font color="#000000">export_name</font><font color="#4000C0">,</font> <font color="#000000">test_name</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">mixed_topo</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Mesh&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mixed_2d_mesh&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mixed_2d_mesh/braid&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">ResetView</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">outfilename</font> <font color="#4000C0">=</font> <font color="#000000">export_mesh_bp</font><font color="#4000C0">(</font><font color="#000000">export_name</font><font color="#4000C0">,</font> <font color="#008000">&quot;mixed_2d_mesh/braid&quot;</font><font color="#4000C0">,</font> <font color="#000000">varname2</font><font color="#4000C0">=</font><font color="#008000">&quot;mixed_2d_mesh/vel&quot;</font><font color="#4000C0">)</font> <font color="#4000C0">+</font> <font color="#008000">&quot;.cycle_000100.root&quot;</font>

    <font color="#000000">opts</font> <font color="#4000C0">=</font> <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">Node</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">opts</font><font color="#4000C0">[</font><font color="#008000">&quot;mesh_name&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;mixed_2d&quot;</font>
    <font color="#000000">save_mesh</font> <font color="#4000C0">=</font> <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">Node</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">relay</font><font color="#4000C0">.</font><font color="#000000">io</font><font color="#4000C0">.</font><font color="#000000">blueprint</font><font color="#4000C0">.</font><font color="#000000">load_mesh</font><font color="#4000C0">(</font><font color="#000000">save_mesh</font><font color="#4000C0">,</font> <font color="#000000">mixed_topo</font><font color="#4000C0">,</font> <font color="#000000">opts</font><font color="#4000C0">)</font>

    <font color="#000000">load_mesh</font> <font color="#4000C0">=</font> <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">Node</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">relay</font><font color="#4000C0">.</font><font color="#000000">io</font><font color="#4000C0">.</font><font color="#000000">blueprint</font><font color="#4000C0">.</font><font color="#000000">load_mesh</font><font color="#4000C0">(</font><font color="#000000">load_mesh</font><font color="#4000C0">,</font> <font color="#000000">outfilename</font><font color="#4000C0">)</font>

    <font color="#a02030"># </font>
    <font color="#a02030"># make changes so the diff will pass</font>
    <font color="#a02030"># </font>

    <font color="#a02030"># grab the domain_id which was added in</font>
    <font color="#000000">save_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;state&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;domain_id&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">load_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;state&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;domain_id&quot;</font><font color="#4000C0">]</font>
    <font color="#000000">save_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;state&quot;</font><font color="#4000C0">]</font><font color="#4000C0">.</font><font color="#000000">remove_child</font><font color="#4000C0">(</font><font color="#008000">&quot;cycle&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">save_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;state&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;cycle&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">load_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;state&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;cycle&quot;</font><font color="#4000C0">]</font>

    <font color="#a02030"># rename topo</font>
    <font color="#000000">save_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;topologies&quot;</font><font color="#4000C0">]</font><font color="#4000C0">.</font><font color="#000000">rename_child</font><font color="#4000C0">(</font><font color="#008000">&quot;mesh&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;topo&quot;</font><font color="#4000C0">)</font>

    <font color="#a02030"># rename fields</font>
    <font color="#000000">save_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;fields&quot;</font><font color="#4000C0">]</font><font color="#4000C0">.</font><font color="#000000">rename_child</font><font color="#4000C0">(</font><font color="#008000">&quot;braid&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mixed_2d_mesh_braid&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">save_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;fields&quot;</font><font color="#4000C0">]</font><font color="#4000C0">.</font><font color="#000000">rename_child</font><font color="#4000C0">(</font><font color="#008000">&quot;vel&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mixed_2d_mesh_vel&quot;</font><font color="#4000C0">)</font>

    <font color="#000000">save_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;fields&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;mixed_2d_mesh_braid&quot;</font><font color="#4000C0">]</font><font color="#4000C0">.</font><font color="#000000">remove_child</font><font color="#4000C0">(</font><font color="#008000">&quot;topology&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">save_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;fields&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;mixed_2d_mesh_braid&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;topology&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;topo&quot;</font>
    <font color="#000000">save_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;fields&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;mixed_2d_mesh_vel&quot;</font><font color="#4000C0">]</font><font color="#4000C0">.</font><font color="#000000">remove_child</font><font color="#4000C0">(</font><font color="#008000">&quot;topology&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">save_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;fields&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;mixed_2d_mesh_vel&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;topology&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;topo&quot;</font>

    <font color="#000000">save_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;fields&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;mixed_2d_mesh_vel&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;values&quot;</font><font color="#4000C0">]</font><font color="#4000C0">.</font><font color="#000000">rename_child</font><font color="#4000C0">(</font><font color="#008000">&quot;u&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;c0&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">save_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;fields&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;mixed_2d_mesh_vel&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;values&quot;</font><font color="#4000C0">]</font><font color="#4000C0">.</font><font color="#000000">rename_child</font><font color="#4000C0">(</font><font color="#008000">&quot;v&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;c1&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">save_mesh</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;fields&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;mixed_2d_mesh_vel&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;values&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;c2&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">]</font>

    <font color="#000000">info</font> <font color="#4000C0">=</font> <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">Node</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">diffval</font> <font color="#4000C0">=</font> <font color="#000000">load_mesh</font><font color="#4000C0">.</font><font color="#000000">diff</font><font color="#4000C0">(</font><font color="#000000">save_mesh</font><font color="#4000C0">,</font> <font color="#000000">info</font><font color="#4000C0">)</font>
    <font color="#000000">diff_str</font> <font color="#4000C0">=</font> <font color="#000000">info</font><font color="#4000C0">.</font><font color="#000000">to_yaml</font><font color="#4000C0">(</font><font color="#4000C0">)</font> <font color="#C00000">if</font> <font color="#000000">diffval</font> <font color="#C00000">else</font> <font color="#008000">&quot;&quot;</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">test_name</font><font color="#4000C0">,</font> <font color="#000000">diff_str</font><font color="#4000C0">,</font> <font color="#008000">&quot;&quot;</font><font color="#4000C0">)</font>

    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">mixed_topo</font><font color="#4000C0">)</font>


<font color="#000000">RequiredDatabasePlugin</font><font color="#4000C0">(</font><font color="#008000">&quot;Blueprint&quot;</font><font color="#4000C0">)</font>
<font color="#000000">test_basic</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">test_partition</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">test_flatten</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">bp_mixed_topos_dir</font> <font color="#4000C0">=</font> <font color="#008000">&quot;blueprint_v0.9.2_mixed_topo_data&quot;</font>
<font color="#000000">mixed_topo_2d</font> <font color="#4000C0">=</font> <font color="#000000">data_path</font><font color="#4000C0">(</font><font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">bp_mixed_topos_dir</font><font color="#4000C0">,</font> <font color="#008000">&quot;mixed_mesh_simple_2d_hdf5.root&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#a02030"># we can&#x27;t do the polygonal one because we are using generate_sides to get rid of the polygons,</font>
<font color="#a02030"># so round trip will fail.</font>
<font color="#a02030"># mixed_topo_2d_polygon = data_path(pjoin(bp_mixed_topos_dir, &quot;mixed_mesh_polygonal_2d_hdf5.root&quot;))</font>
<font color="#000000">mixed_topo_3d</font> <font color="#4000C0">=</font> <font color="#000000">data_path</font><font color="#4000C0">(</font><font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">bp_mixed_topos_dir</font><font color="#4000C0">,</font> <font color="#008000">&quot;mixed_mesh_simple_3d_hdf5.root&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">mixed_braid_2d</font> <font color="#4000C0">=</font> <font color="#000000">data_path</font><font color="#4000C0">(</font><font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">bp_mixed_topos_dir</font><font color="#4000C0">,</font> <font color="#008000">&quot;braid_2d_examples_hdf5.root&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#a02030"># we can&#x27;t do the polyhedral one because we are using generate_sides to get rid of the polyhedra,</font>
<font color="#a02030"># so round trip will fail.</font>
<font color="#a02030"># mixed_braid_3d = data_path(pjoin(bp_mixed_topos_dir, &quot;braid_3d_examples_hdf5.root&quot;))</font>

<font color="#000000">roundtrip_simple_mixed_topo</font><font color="#4000C0">(</font><font color="#000000">mixed_topo_2d</font><font color="#4000C0">,</font> <font color="#008000">&quot;mixed_topo_2d&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;Mixed_topo_simple_2d_export&quot;</font><font color="#4000C0">)</font>
<font color="#000000">roundtrip_simple_mixed_topo</font><font color="#4000C0">(</font><font color="#000000">mixed_topo_3d</font><font color="#4000C0">,</font> <font color="#008000">&quot;mixed_topo_3d&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;Mixed_topo_simple_3d_export&quot;</font><font color="#4000C0">)</font>
<font color="#000000">roundtrip_braid_mixed</font><font color="#4000C0">(</font><font color="#000000">mixed_braid_2d</font><font color="#4000C0">,</font> <font color="#008000">&quot;mixed_braid_2d&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;Mixed_topo_braid_2d_export&quot;</font><font color="#4000C0">)</font>

<font color="#000000">Exit</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000"></font></font></pre></body></html>