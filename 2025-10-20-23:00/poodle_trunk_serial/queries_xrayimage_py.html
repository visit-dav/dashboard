<html><body bgcolor="#e0e0e0"><head><title>queries/xrayimage.py</title></head><pre><font face="Lucida,Courier New"><font color="#a02030"># ----------------------------------------------------------------------------</font>
<font color="#a02030">#  CLASSES: nightly</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Test Case:  xrayimage.py</font>
<font color="#a02030">#  Tests:      queries     - xray imagel</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Programmer: Eric Brugger</font>
<font color="#a02030">#  Date:       July 13, 2010</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Modifications:</font>
<font color="#a02030">#    Kathleen Bonnell, Thu Jul 14 10:44:55 PDT 2011</font>
<font color="#a02030">#    Change most of code to use python dictionary to pass query parameters.</font>
<font color="#a02030">#    First call to &#x27;Query&#x27; still tests old-style argument passing.</font>
<font color="#a02030">#    Second call to &#x27;Query&#x27; creates a Python dictionary from scratch and</font>
<font color="#a02030">#    uses that.  Prior to third call to Query, retrieve default dictionary via</font>
<font color="#a02030">#    GetQueryParameters.  All subsequent calls to Query modify that dictionary </font>
<font color="#a02030">#    object as necessary and pass it.</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Kathleen Biagas, Wed Oct 17 14:25:05 PDT 2012</font>
<font color="#a02030">#    Show usage of new &#x27;up_vector&#x27; parameter.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Tue Jun 14 10:02:21 PDT 2022</font>
<font color="#a02030">#    Change tests to reflect new ability to send output directory to query.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Wed Jun 15 16:43:34 PDT 2022</font>
<font color="#a02030">#    Added tests for new blueprint output.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Wed Jul 20 13:54:06 PDT 2022</font>
<font color="#a02030">#    Added query output msg tests and tests for query errors.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Thu Sep  8 16:29:06 PDT 2022</font>
<font color="#a02030">#    Added new tests for blueprint output metadata.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Tue Sep 27 10:52:59 PDT 2022</font>
<font color="#a02030">#    Changed names of most output files to reflect new naming conventions.</font>
<font color="#a02030">#    Added tests for filenames, all output types, and result messages.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Fri Sep 30 15:54:40 PDT 2022</font>
<font color="#a02030">#    Changed location of temp output files.</font>
<font color="#a02030">#    os.remove is gone.</font>
<font color="#a02030">#    tmp/baddir is gone, replaced.</font>
<font color="#a02030">#    These changes were made so the tests no longer crash on windows.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Tue Nov 15 14:54:35 PST 2022</font>
<font color="#a02030">#    Added new tests for additional blueprint output metadata as well as</font>
<font color="#a02030">#    imaging plane topologies.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Tue Nov 22 14:56:04 PST 2022</font>
<font color="#a02030">#    Updated numbering on later tests.</font>
<font color="#a02030">#    Reorganized blueprint tests so they use a function. That function also</font>
<font color="#a02030">#    uses new and old query calls, doubling the number of blueprint tests.</font>
<font color="#a02030">#    It also tests energy group bin output for hdf5.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Mon Nov 28 15:38:25 PST 2022</font>
<font color="#a02030">#    Renamed energy group bins to energy group bounds.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Wed Nov 30 10:41:17 PST 2022</font>
<font color="#a02030">#    Added tests for always positive detector height and width in blueprint</font>
<font color="#a02030">#    metadata.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Wed Nov 30 17:43:48 PST 2022</font>
<font color="#a02030">#    Added tests for piping the units through the query.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Thu Dec  1 15:29:48 PST 2022</font>
<font color="#a02030">#    Tests for new location of units in blueprint output.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Wed Dec  7 16:16:16 PST 2022</font>
<font color="#a02030">#    Added tests for the blueprint ray output.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Mon Dec 12 13:28:55 PST 2022</font>
<font color="#a02030">#    Reworked some of the blueprint output tests to reflect changes in </font>
<font color="#a02030">#    output metadata.</font>
<font color="#a02030">#    Added new tests for path length and spatial extent images.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Tue Feb 14 17:02:43 PST 2023</font>
<font color="#a02030">#    Change all metadata to use pot_hole_case instead of camelCase.</font>
<font color="#a02030">#    Add test for image_topo_order_of_domain_variables.</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Justin Privitera, Wed Oct 12 11:38:11 PDT 2022</font>
<font color="#a02030">#    Changed output type for many tests since bmp output type is removed.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Fri Mar 10 19:06:49 PST 2023</font>
<font color="#a02030">#    Added tests for new spatial energy reduced topo and fields.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Wed Mar 15 17:51:13 PDT 2023</font>
<font color="#a02030">#    Added tests for new spectra topo and fields.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Wed Mar 22 16:09:52 PDT 2023</font>
<font color="#a02030">#     - Added logic for setting up and tearing down blueprint output type </font>
<font color="#a02030">#    tests.</font>
<font color="#a02030">#     - Added new query choices for blueprint output that can be passed down </font>
<font color="#a02030">#    into the various blueprint tests.</font>
<font color="#a02030">#     - Created a new class for storing these query options and passing them </font>
<font color="#a02030">#    around.</font>
<font color="#a02030">#     - Added a new function for making slices of plots to test specific </font>
<font color="#a02030">#    energy group bins.</font>
<font color="#a02030">#     - More consistent query args for blueprint tests</font>
<font color="#a02030">#     - Added slice tests for specific energy group bins.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Wed Apr 26 14:07:01 PDT 2023</font>
<font color="#a02030">#    The new conduit we are using for VisIt (0.8.7) can read in simple yaml</font>
<font color="#a02030">#    and json (w/o bp index?) (bug was fixed) so I am updating the x ray query</font>
<font color="#a02030">#    tests to take advantage of this and add tests back in for yaml and json</font>
<font color="#a02030">#    cases.</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Justin Privitera, Fri Jun 16 17:17:14 PDT 2023</font>
<font color="#a02030">#    Added tests for the new view width override and non square pixels </font>
<font color="#a02030">#    settings.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Fri Jul 14 17:33:07 PDT 2023</font>
<font color="#a02030">#    Updated tests to reflect the new reality that the complete camera spec</font>
<font color="#a02030">#    is now the default.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Tue Aug 22 12:30:01 PDT 2023</font>
<font color="#a02030">#    Sort filename list produced by os.listdir to prevent test suite failures.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Mon Oct 30 14:45:55 PDT 2023</font>
<font color="#a02030">#    Use conduit node diff to compare query results to baselines.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Tue Oct 31 13:20:23 PDT 2023</font>
<font color="#a02030">#    All output folders are created at the top of the file now.</font>
<font color="#a02030">#    Several visit expressions have been cleaned up or removed entirely.</font>
<font color="#a02030">#    Code cleanup for readability.</font>
<font color="#a02030">#    Lowered pixel resolution for query results where we are not testing the</font>
<font color="#a02030">#    images.</font>
<font color="#a02030">#    Use the python dictionary returned by the query to tell if the query was</font>
<font color="#a02030">#    successful or not.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Wed Nov 29 15:10:59 PST 2023</font>
<font color="#a02030">#    Use numpy.int64 to cast to wide types for diff.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Tue Feb 11 14:15:05 PST 2025</font>
<font color="#a02030">#    Added test for the far clipping plane actually clipping results.</font>
<font color="#a02030"># </font>
<font color="#a02030">#    Justin Privitera, Fri Oct 17 16:39:39 PDT 2025</font>
<font color="#a02030">#    Blueprint tests now use &quot;blueprint &lt;output type&gt;&quot; instead of just </font>
<font color="#a02030">#    &quot;&lt;output type&gt;&quot; to test the name change.</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Justin Privitera, Fri Oct 17 15:31:04 PDT 2025</font>
<font color="#a02030">#    Fixed array compose error in the setup blueprint test infrastructure, so</font>
<font color="#a02030">#    now parr is p1, p2, p3 instead of p1, p2, *d3*.</font>
<font color="#a02030">#    Turned off divide_emis_by_absorb for some blueprint tests, yielding much</font>
<font color="#a02030">#    more interesting slices that demonstrate the multiple energy group</font>
<font color="#a02030">#    output.</font>
<font color="#a02030">#    Added rotation to the 3d image topo and spatial topo mesh tests to</font>
<font color="#a02030">#    demonstrate the nature of the blueprint output like we do in Ascent.</font>
<font color="#a02030">#    Added divide_emis_by_absorb to the query_result_options class so that</font>
<font color="#a02030">#    tests can toggle it on and off in creating their conduit baselines.</font>
<font color="#a02030"># ----------------------------------------------------------------------------</font>

<font color="#C00000">import</font> <font color="#000000">os</font>
<font color="#C00000">import</font> <font color="#000000">conduit</font>
<font color="#C00000">import</font> <font color="#000000">numpy</font>

<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#008000">&quot;current&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;queries&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#008000">&quot;current&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;queries&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">out_base</font> <font color="#4000C0">=</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#008000">&quot;current&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;queries&quot;</font><font color="#4000C0">,</font><font color="#008000">&quot;xrayimage&quot;</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">)</font>

<font color="#000000">outdir_set</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;run_dir&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">&quot;testdir&quot;</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">)</font>

<font color="#000000">conduit_dir_hdf5</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">,</font> <font color="#008000">&quot;hdf5&quot;</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_hdf5</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_hdf5</font><font color="#4000C0">)</font>
<font color="#000000">conduit_dir_json</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">,</font> <font color="#008000">&quot;json&quot;</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_json</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_json</font><font color="#4000C0">)</font>
<font color="#000000">conduit_dir_yaml</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">,</font> <font color="#008000">&quot;yaml&quot;</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_yaml</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_yaml</font><font color="#4000C0">)</font>
<font color="#000000">conduit_dir_imaging_planes0</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">,</font> <font color="#008000">&quot;imaging_planes0&quot;</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_imaging_planes0</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_imaging_planes0</font><font color="#4000C0">)</font>
<font color="#000000">conduit_dir_imaging_planes1</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">,</font> <font color="#008000">&quot;imaging_planes1&quot;</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_imaging_planes1</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_imaging_planes1</font><font color="#4000C0">)</font>
<font color="#000000">conduit_dir_detector_dims</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">,</font> <font color="#008000">&quot;detector_dims&quot;</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_detector_dims</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_detector_dims</font><font color="#4000C0">)</font>
<font color="#000000">conduit_dir_nonsquare_pixels</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">,</font> <font color="#008000">&quot;nonsquare_pix&quot;</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_nonsquare_pixels</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_nonsquare_pixels</font><font color="#4000C0">)</font>
<font color="#000000">conduit_dir_far_plane_empty</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">,</font> <font color="#008000">&quot;far_plane_empty&quot;</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_far_plane_empty</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_far_plane_empty</font><font color="#4000C0">)</font>
<font color="#000000">conduit_dir_far_plane_non_empty</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">,</font> <font color="#008000">&quot;far_plane_non_empty&quot;</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_far_plane_non_empty</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_far_plane_non_empty</font><font color="#4000C0">)</font>

<font color="#000000">dir_dne</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">,</font> <font color="#008000">&quot;doesnotexist&quot;</font><font color="#4000C0">)</font>
<font color="#C00000">if</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">dir_dne</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rmdir</font><font color="#4000C0">(</font><font color="#000000">dir_dne</font><font color="#4000C0">)</font>

<font color="#a02030"># os.chmod does not work on windows</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">platform</font><font color="#4000C0">.</font><font color="#000000">system</font><font color="#4000C0">(</font><font color="#4000C0">)</font> <font color="#4000C0">==</font> <font color="#008000">&quot;Windows&quot;</font><font color="#4000C0">:</font>
    <font color="#000000">outdir_bad</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font><font color="#4000C0">,</font> <font color="#008000">&quot;baddir&quot;</font><font color="#4000C0">)</font>
    <font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">outdir_bad</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">outdir_bad</font><font color="#4000C0">)</font>
    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">chmod</font><font color="#4000C0">(</font><font color="#000000">outdir_bad</font><font color="#4000C0">,</font> <font color="#0080C0">0o444</font><font color="#4000C0">)</font>

<font color="#000000">output_types</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#008000">&quot;jpeg&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;png&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;tif&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;bof&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;bov&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;json&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;hdf5&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;yaml&quot;</font><font color="#4000C0">]</font>
<font color="#C00000">for</font> <font color="#000000">i</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">output_types</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">outdir_set_otype</font> <font color="#4000C0">=</font> <font color="#000000">outdir_set</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">output_types</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font>
    <font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">outdir_set_otype</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">outdir_set_otype</font><font color="#4000C0">)</font>

<font color="#000000">family_options</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">]</font>
<font color="#C00000">for</font> <font color="#000000">i</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">family_options</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">outdir_set_family</font> <font color="#4000C0">=</font> <font color="#000000">outdir_set</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_family_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">family_options</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">outdir_set_family</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">mkdir</font><font color="#4000C0">(</font><font color="#000000">outdir_set_family</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Test a single block structured grid with scalars.</font>
<font color="#a02030">#</font>
<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">&quot;curv3d.silo&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;d&quot;</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030"># old style argument passing</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#008000">&quot;.&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#008000">&quot;d&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;p&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">&quot;output.png&quot;</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">&quot;xrayimage00.png&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage00&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage01&quot;</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Test a multi block structured grid with an array variable.</font>
<font color="#a02030">#</font>
<font color="#000000">DefineArrayExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;da&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;array_compose(d,d)&quot;</font><font color="#4000C0">)</font>
<font color="#000000">DefineArrayExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;pa&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;array_compose(p,p)&quot;</font><font color="#4000C0">)</font>

<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_curv3d.silo&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;d&quot;</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030"># create our own dictionary</font>
<font color="#000000">params</font> <font color="#4000C0">=</font> <font color="#000000">dict</font><font color="#4000C0">(</font><font color="#000000">output_type</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font>
              <font color="#000000">output_dir</font><font color="#4000C0">=</font><font color="#008000">&quot;.&quot;</font><font color="#4000C0">,</font>
              <font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font>
              <font color="#000000">origin</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.0</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
              <font color="#000000">up_vector</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
              <font color="#000000">theta</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
              <font color="#000000">phi</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
              <font color="#000000">width</font> <font color="#4000C0">=</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font>
              <font color="#000000">height</font><font color="#4000C0">=</font><font color="#0080C0">10.</font><font color="#4000C0">,</font>
              <font color="#000000">image_size</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
              <font color="#000000">vars</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#008000">&quot;da&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;pa&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">&quot;output.00.png&quot;</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">&quot;xrayimage02.png&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">&quot;output.01.png&quot;</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">&quot;xrayimage03.png&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage02&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage03&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage04&quot;</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Test a 2d structured grid with scalars.</font>
<font color="#a02030">#</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">&quot;curv2d.silo&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;d&quot;</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">params</font> <font color="#4000C0">=</font> <font color="#000000">dict</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;image_size&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">)</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;divide_emis_by_absorb&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;width&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">10.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;height&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">10.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;vars&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">&quot;d&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;p&quot;</font><font color="#4000C0">)</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">&quot;output.png&quot;</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">&quot;xrayimage05.png&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage05&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage06&quot;</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;theta&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">90</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;phi&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font>  <font color="#0080C0">0</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">&quot;output.png&quot;</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">&quot;xrayimage07.png&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage07&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage08&quot;</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Test an unstructured grid with scalars.</font>
<font color="#a02030">#</font>
<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;u1&quot;</font><font color="#4000C0">,</font> <font color="#008000">&#x27;recenter(((u+10.)*0.01), &quot;zonal&quot;)&#x27;</font><font color="#4000C0">)</font>
<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;v1&quot;</font><font color="#4000C0">,</font> <font color="#008000">&#x27;recenter(((v+10.)*0.01*matvf(mat1,1)), &quot;zonal&quot;)&#x27;</font><font color="#4000C0">)</font>
<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;v2&quot;</font><font color="#4000C0">,</font> <font color="#008000">&#x27;recenter(((v+10.)*0.01*matvf(mat1,2)), &quot;zonal&quot;)&#x27;</font><font color="#4000C0">)</font>
<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;v3&quot;</font><font color="#4000C0">,</font> <font color="#008000">&#x27;recenter(((v+10.)*0.01*matvf(mat1,3)), &quot;zonal&quot;)&#x27;</font><font color="#4000C0">)</font>
<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;v4&quot;</font><font color="#4000C0">,</font> <font color="#008000">&#x27;recenter(((v+10.)*0.01*matvf(mat1,4)), &quot;zonal&quot;)&#x27;</font><font color="#4000C0">)</font>
<font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;w1&quot;</font><font color="#4000C0">,</font> <font color="#008000">&#x27;recenter(((w+10.)*0.01), &quot;zonal&quot;)&#x27;</font><font color="#4000C0">)</font>

<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">&quot;globe.silo&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;u&quot;</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030"># Do tets.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;theta&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;phi&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;width&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">1.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;height&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">1.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;vars&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">&quot;w1&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;v1&quot;</font><font color="#4000C0">)</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">&quot;output.png&quot;</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">&quot;xrayimage09.png&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage09&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage10&quot;</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;theta&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">90</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;width&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">4.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;height&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">4.</font>

<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">&quot;output.png&quot;</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">&quot;xrayimage11.png&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage11&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage12&quot;</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#a02030"># Do pyramids.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;theta&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;vars&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">&quot;w1&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;v2&quot;</font><font color="#4000C0">)</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">&quot;output.png&quot;</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">&quot;xrayimage13.png&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage13&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage14&quot;</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;theta&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">90</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">&quot;output.png&quot;</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">&quot;xrayimage15.png&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage15&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage16&quot;</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#a02030"># Do wedges.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;theta&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;width&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">8.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;height&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">8.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;vars&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">&quot;w1&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;v3&quot;</font><font color="#4000C0">)</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">&quot;output.png&quot;</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">&quot;xrayimage17.png&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage17&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>


<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage18&quot;</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;theta&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">90</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;width&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">20.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;height&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">20.</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">&quot;output.png&quot;</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">&quot;xrayimage19.png&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage19&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage20&quot;</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#a02030"># Do hexes.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;theta&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;vars&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">&quot;w1&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;v4&quot;</font><font color="#4000C0">)</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">&quot;output.png&quot;</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">&quot;xrayimage21.png&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage21&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage22&quot;</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&#x27;theta&#x27;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">90</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">&quot;output.png&quot;</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">&quot;xrayimage23.png&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage23&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage24&quot;</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Test with perspective.</font>
<font color="#a02030">#</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">&quot;multi_curv3d.silo&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;d&quot;</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">params</font> <font color="#4000C0">=</font> <font color="#000000">dict</font><font color="#4000C0">(</font><font color="#000000">output_type</font><font color="#4000C0">=</font><font color="#008000">&quot;png&quot;</font><font color="#4000C0">,</font>
              <font color="#000000">output_dir</font><font color="#4000C0">=</font><font color="#008000">&quot;.&quot;</font><font color="#4000C0">,</font>
              <font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font>
              <font color="#000000">focus</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">15.0</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
              <font color="#000000">view_up</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0.</font><font color="#4000C0">,</font> <font color="#0080C0">1.</font><font color="#4000C0">,</font> <font color="#0080C0">0.</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
              <font color="#000000">normal</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0.</font><font color="#4000C0">,</font> <font color="#0080C0">0.</font><font color="#4000C0">,</font> <font color="#0080C0">1.</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
              <font color="#000000">view_angle</font><font color="#4000C0">=</font><font color="#0080C0">30.</font><font color="#4000C0">,</font>
              <font color="#000000">parallel_scale</font> <font color="#4000C0">=</font> <font color="#0080C0">16.0078</font><font color="#4000C0">,</font>
              <font color="#000000">near_plane</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">32.0156</font><font color="#4000C0">,</font>
              <font color="#000000">far_plane</font> <font color="#4000C0">=</font> <font color="#0080C0">32.0156</font><font color="#4000C0">,</font>
              <font color="#000000">image_pan</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0.</font><font color="#4000C0">,</font> <font color="#0080C0">0.</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
              <font color="#000000">image_zoom</font> <font color="#4000C0">=</font> <font color="#0080C0">2.4</font><font color="#4000C0">,</font>
              <font color="#000000">perspective</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font><font color="#4000C0">,</font>
              <font color="#000000">image_size</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
              <font color="#000000">vars</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#008000">&quot;d&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;p&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">&quot;output.png&quot;</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">&quot;xrayimage25.png&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage25&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage26&quot;</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Test with background intensities.</font>
<font color="#a02030">#</font>
<font color="#000000">DefineArrayExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;wa&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;array_compose(w1,w1)&quot;</font><font color="#4000C0">)</font>
<font color="#000000">DefineArrayExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;va&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;array_compose(v4,v4)&quot;</font><font color="#4000C0">)</font>

<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">&quot;globe.silo&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;u&quot;</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">params</font> <font color="#4000C0">=</font> <font color="#000000">dict</font><font color="#4000C0">(</font><font color="#000000">output_type</font><font color="#4000C0">=</font><font color="#008000">&quot;png&quot;</font><font color="#4000C0">,</font>
              <font color="#000000">output_dir</font><font color="#4000C0">=</font><font color="#008000">&quot;.&quot;</font><font color="#4000C0">,</font>
              <font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font>
              <font color="#000000">theta</font><font color="#4000C0">=</font><font color="#0080C0">90.</font><font color="#4000C0">,</font>
              <font color="#000000">phi</font><font color="#4000C0">=</font><font color="#0080C0">0.</font><font color="#4000C0">,</font>
              <font color="#000000">width</font><font color="#4000C0">=</font><font color="#0080C0">20.</font><font color="#4000C0">,</font>
              <font color="#000000">height</font><font color="#4000C0">=</font><font color="#0080C0">20.</font><font color="#4000C0">,</font>
              <font color="#000000">image_size</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
              <font color="#000000">vars</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#008000">&quot;wa&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;va&quot;</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
              <font color="#000000">background_intensities</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0.05</font><font color="#4000C0">,</font> <font color="#0080C0">0.1</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">&quot;output.00.png&quot;</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">&quot;xrayimage27.png&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#008000">&quot;output.01.png&quot;</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font><font color="#008000">&quot;xrayimage28.png&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage27&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage28&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage29&quot;</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>

<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030"># </font>
<font color="#a02030"># test setting output directory</font>
<font color="#a02030"># </font>

<font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">&quot;curv3d.silo&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;d&quot;</font><font color="#4000C0">)</font>
<font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030"># old style argument passing</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;png&quot;</font><font color="#4000C0">,</font> <font color="#000000">outdir_set</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#008000">&quot;d&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;p&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">rename</font><font color="#4000C0">(</font><font color="#000000">outdir_set</font> <font color="#4000C0">+</font> <font color="#008000">&quot;/output.png&quot;</font><font color="#4000C0">,</font> <font color="#000000">out_path</font><font color="#4000C0">(</font><font color="#000000">out_base</font><font color="#4000C0">,</font> <font color="#008000">&quot;xrayimage30.png&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage30&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage31&quot;</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>
<font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">&quot;curv3d.silo&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># test blueprint output</font>
<font color="#a02030">#</font>

<font color="#C00000">def</font> <font color="#000000">setup_bp_test</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">&quot;curv3d.silo&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;d1&quot;</font><font color="#4000C0">,</font> <font color="#008000">&#x27;d&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;p1&quot;</font><font color="#4000C0">,</font> <font color="#008000">&#x27;p&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;d2&quot;</font><font color="#4000C0">,</font> <font color="#008000">&#x27;d * 6&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;p2&quot;</font><font color="#4000C0">,</font> <font color="#008000">&#x27;p * 6&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;d3&quot;</font><font color="#4000C0">,</font> <font color="#008000">&#x27;d * 3&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">DefineScalarExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;p3&quot;</font><font color="#4000C0">,</font> <font color="#008000">&#x27;p * 3&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">DefineArrayExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;darr&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;array_compose(d1,d2,d3)&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DefineArrayExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;parr&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;array_compose(p1,p2,p3)&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;d&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">teardown_bp_test</font><font color="#4000C0">(</font><font color="#000000">lite</font> <font color="#4000C0">=</font> <font color="#C00000">False</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">lite</font><font color="#4000C0">:</font>
        <font color="#000000">DeleteExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;d1&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;p1&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;d2&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;p2&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;d3&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;p3&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;darr&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;parr&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">&quot;curv3d.silo&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

<font color="#a02030"># In conduit python, int types are assumed to be int64</font>
<font color="#a02030"># The xray query saves bools out as int32s</font>
<font color="#a02030"># So the diff fails unless we take the int32 type and </font>
<font color="#a02030"># cast it to int64.</font>
<font color="#C00000">def</font> <font color="#000000">cast_to_wide_int_type_conduit</font><font color="#4000C0">(</font><font color="#000000">node</font><font color="#4000C0">,</font> <font color="#000000">leafname</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">val</font> <font color="#4000C0">=</font> <font color="#000000">numpy</font><font color="#4000C0">.</font><font color="#000000">int64</font><font color="#4000C0">(</font><font color="#000000">node</font><font color="#4000C0">[</font><font color="#000000">leafname</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#000000">node</font><font color="#4000C0">.</font><font color="#000000">remove_child</font><font color="#4000C0">(</font><font color="#000000">leafname</font><font color="#4000C0">)</font>
    <font color="#000000">node</font><font color="#4000C0">[</font><font color="#000000">leafname</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">val</font>

<font color="#C00000">def</font> <font color="#000000">test_bp_state_xray_view</font><font color="#4000C0">(</font><font color="#000000">testname</font><font color="#4000C0">,</font> <font color="#000000">xray_view</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">yaml_text</font> <font color="#4000C0">=</font> <font color="#008000">&quot;&quot;&quot;normal:
  x: 0.0
  y: 0.0
  z: 1.0
focus:
  x: 0.0
  y: 2.5
  z: 10.0
view_up:
  x: 0.0
  y: 1.0
  z: 0.0
view_angle: 30.0
parallel_scale: 5.0
view_width: 7.5
non_square_pixels: \&quot;yes\&quot;
near_plane: -100.0
far_plane: 100.0
image_pan:
  x: 0.0
  y: 0.0
image_zoom: 1.0
perspective: 0
perspective_str: \&quot;parallel\&quot;&quot;&quot;&quot;</font>

    <font color="#000000">xray_view_base</font> <font color="#4000C0">=</font> <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">Node</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">xray_view_base</font><font color="#4000C0">.</font><font color="#000000">parse</font><font color="#4000C0">(</font><font color="#000000">yaml_text</font><font color="#4000C0">,</font> <font color="#008000">&quot;yaml&quot;</font><font color="#4000C0">)</font>

    <font color="#a02030"># We must make changes so that the diff will pass:</font>
    <font color="#000000">cast_to_wide_int_type_conduit</font><font color="#4000C0">(</font><font color="#000000">xray_view</font><font color="#4000C0">,</font> <font color="#008000">&quot;perspective&quot;</font><font color="#4000C0">)</font>

    <font color="#000000">info</font> <font color="#4000C0">=</font> <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">Node</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">diffval</font> <font color="#4000C0">=</font> <font color="#000000">xray_view</font><font color="#4000C0">.</font><font color="#000000">diff</font><font color="#4000C0">(</font><font color="#000000">xray_view_base</font><font color="#4000C0">,</font> <font color="#000000">info</font><font color="#4000C0">)</font>
    <font color="#000000">diff_str</font> <font color="#4000C0">=</font> <font color="#000000">info</font><font color="#4000C0">.</font><font color="#000000">to_yaml</font><font color="#4000C0">(</font><font color="#4000C0">)</font> <font color="#C00000">if</font> <font color="#000000">diffval</font> <font color="#C00000">else</font> <font color="#008000">&quot;&quot;</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_xray_view&quot;</font><font color="#4000C0">,</font> <font color="#000000">diff_str</font><font color="#4000C0">,</font> <font color="#008000">&quot;&quot;</font><font color="#4000C0">)</font>

<font color="#000000">UNITS_OFF</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
<font color="#000000">UNITS_ON</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>

<font color="#C00000">def</font> <font color="#000000">test_bp_state_xray_query</font><font color="#4000C0">(</font><font color="#000000">testname</font><font color="#4000C0">,</font> <font color="#000000">xray_query</font><font color="#4000C0">,</font> <font color="#000000">num_bins</font><font color="#4000C0">,</font> <font color="#000000">abs_name</font><font color="#4000C0">,</font> <font color="#000000">emis_name</font><font color="#4000C0">,</font> <font color="#000000">units</font><font color="#4000C0">,</font> <font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">yaml_text</font> <font color="#4000C0">=</font> <font color="#008000">f&quot;&quot;&quot;divide_emis_by_absorb: {&quot;1&quot; if divide_emis_by_absorb else &quot;0&quot;}
divide_emis_by_absorb_str: {&quot;yes&quot; if divide_emis_by_absorb else &quot;no&quot;}
num_x_pixels: 300
num_y_pixels: 200
num_bins: {num_bins}
abs_var_name: {abs_name}
emis_var_name: {emis_name}
abs_units: {&quot;abs units&quot; if units == UNITS_ON else &quot;no units provided&quot;}
emis_units: {&quot;emis units&quot; if units == UNITS_ON else &quot;no units provided&quot;}&quot;&quot;&quot;</font>

    <font color="#000000">xray_query_base</font> <font color="#4000C0">=</font> <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">Node</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">xray_query_base</font><font color="#4000C0">.</font><font color="#000000">parse</font><font color="#4000C0">(</font><font color="#000000">yaml_text</font><font color="#4000C0">,</font> <font color="#008000">&quot;yaml&quot;</font><font color="#4000C0">)</font>

    <font color="#a02030"># We must make changes so that the diff will pass:</font>
    <font color="#000000">cast_to_wide_int_type_conduit</font><font color="#4000C0">(</font><font color="#000000">xray_query</font><font color="#4000C0">,</font> <font color="#008000">&quot;divide_emis_by_absorb&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">cast_to_wide_int_type_conduit</font><font color="#4000C0">(</font><font color="#000000">xray_query</font><font color="#4000C0">,</font> <font color="#008000">&quot;num_x_pixels&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">cast_to_wide_int_type_conduit</font><font color="#4000C0">(</font><font color="#000000">xray_query</font><font color="#4000C0">,</font> <font color="#008000">&quot;num_y_pixels&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">cast_to_wide_int_type_conduit</font><font color="#4000C0">(</font><font color="#000000">xray_query</font><font color="#4000C0">,</font> <font color="#008000">&quot;num_bins&quot;</font><font color="#4000C0">)</font>

    <font color="#000000">info</font> <font color="#4000C0">=</font> <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">Node</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">diffval</font> <font color="#4000C0">=</font> <font color="#000000">xray_query</font><font color="#4000C0">.</font><font color="#000000">diff</font><font color="#4000C0">(</font><font color="#000000">xray_query_base</font><font color="#4000C0">,</font> <font color="#000000">info</font><font color="#4000C0">)</font>
    <font color="#000000">diff_str</font> <font color="#4000C0">=</font> <font color="#000000">info</font><font color="#4000C0">.</font><font color="#000000">to_yaml</font><font color="#4000C0">(</font><font color="#4000C0">)</font> <font color="#C00000">if</font> <font color="#000000">diffval</font> <font color="#C00000">else</font> <font color="#008000">&quot;&quot;</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_xray_query&quot;</font><font color="#4000C0">,</font> <font color="#000000">diff_str</font><font color="#4000C0">,</font> <font color="#008000">&quot;&quot;</font><font color="#4000C0">)</font><font color="#4000C0">;</font>

<font color="#C00000">def</font> <font color="#000000">test_bp_state_xray_data</font><font color="#4000C0">(</font><font color="#000000">testname</font><font color="#4000C0">,</font> <font color="#000000">xray_data</font><font color="#4000C0">,</font> <font color="#000000">int_max</font><font color="#4000C0">,</font> <font color="#000000">pl_max</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">yaml_text</font> <font color="#4000C0">=</font> <font color="#008000">f&quot;&quot;&quot;detector_width: 15.0
detector_height: 10.0
intensity_max: {int_max}
intensity_min: 0.0
path_length_max: {pl_max}
path_length_min: 0.0
image_topo_order_of_domain_variables: \&quot;xyz\&quot;&quot;&quot;&quot;</font>

    <font color="#000000">xray_data_base</font> <font color="#4000C0">=</font> <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">Node</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">xray_data_base</font><font color="#4000C0">.</font><font color="#000000">parse</font><font color="#4000C0">(</font><font color="#000000">yaml_text</font><font color="#4000C0">,</font> <font color="#008000">&quot;yaml&quot;</font><font color="#4000C0">)</font>

    <font color="#000000">info</font> <font color="#4000C0">=</font> <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">Node</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">diffval</font> <font color="#4000C0">=</font> <font color="#000000">xray_data</font><font color="#4000C0">.</font><font color="#000000">diff</font><font color="#4000C0">(</font><font color="#000000">xray_data_base</font><font color="#4000C0">,</font> <font color="#000000">info</font><font color="#4000C0">)</font>
    <font color="#000000">diff_str</font> <font color="#4000C0">=</font> <font color="#000000">info</font><font color="#4000C0">.</font><font color="#000000">to_yaml</font><font color="#4000C0">(</font><font color="#4000C0">)</font> <font color="#C00000">if</font> <font color="#000000">diffval</font> <font color="#C00000">else</font> <font color="#008000">&quot;&quot;</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_xray_data&quot;</font><font color="#4000C0">,</font> <font color="#000000">diff_str</font><font color="#4000C0">,</font> <font color="#008000">&quot;&quot;</font><font color="#4000C0">)</font><font color="#4000C0">;</font>

<font color="#000000">NO_ENERGY_GROUP_BOUNDS</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
<font color="#000000">ENERGY_GROUP_BOUNDS_MISMATCH</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
<font color="#000000">ENERGY_GROUP_BOUNDS</font> <font color="#4000C0">=</font> <font color="#0080C0">2</font>

<font color="#C00000">class</font> <font color="#000000">query_result_options</font><font color="#4000C0">:</font>
    <font color="#C00000">def</font> <font color="#000000">__init__</font><font color="#4000C0">(</font><font color="#000000">self</font><font color="#4000C0">,</font> <font color="#000000">num_bins</font><font color="#4000C0">,</font> <font color="#000000">abs_name</font><font color="#4000C0">,</font> <font color="#000000">emis_name</font><font color="#4000C0">,</font> <font color="#000000">bin_state</font><font color="#4000C0">,</font> <font color="#000000">units</font><font color="#4000C0">,</font> <font color="#000000">int_max</font><font color="#4000C0">,</font> <font color="#000000">pl_max</font><font color="#4000C0">,</font> <font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">self</font><font color="#4000C0">.</font><font color="#000000">num_bins</font> <font color="#4000C0">=</font> <font color="#000000">num_bins</font>
        <font color="#000000">self</font><font color="#4000C0">.</font><font color="#000000">abs_name</font> <font color="#4000C0">=</font> <font color="#000000">abs_name</font>
        <font color="#000000">self</font><font color="#4000C0">.</font><font color="#000000">emis_name</font> <font color="#4000C0">=</font> <font color="#000000">emis_name</font>
        <font color="#000000">self</font><font color="#4000C0">.</font><font color="#000000">bin_state</font> <font color="#4000C0">=</font> <font color="#000000">bin_state</font>
        <font color="#000000">self</font><font color="#4000C0">.</font><font color="#000000">units</font> <font color="#4000C0">=</font> <font color="#000000">units</font>
        <font color="#000000">self</font><font color="#4000C0">.</font><font color="#000000">int_max</font> <font color="#4000C0">=</font> <font color="#000000">int_max</font>
        <font color="#000000">self</font><font color="#4000C0">.</font><font color="#000000">pl_max</font> <font color="#4000C0">=</font> <font color="#000000">pl_max</font>
        <font color="#000000">self</font><font color="#4000C0">.</font><font color="#000000">divide_emis_by_absorb</font> <font color="#4000C0">=</font> <font color="#000000">divide_emis_by_absorb</font>

<font color="#C00000">def</font> <font color="#000000">test_bp_data</font><font color="#4000C0">(</font><font color="#000000">testname</font><font color="#4000C0">,</font> <font color="#000000">conduit_db</font><font color="#4000C0">,</font> <font color="#000000">qro</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">xrayout</font> <font color="#4000C0">=</font> <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">Node</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">relay</font><font color="#4000C0">.</font><font color="#000000">io</font><font color="#4000C0">.</font><font color="#000000">blueprint</font><font color="#4000C0">.</font><font color="#000000">load_mesh</font><font color="#4000C0">(</font><font color="#000000">xrayout</font><font color="#4000C0">,</font> <font color="#000000">conduit_db</font><font color="#4000C0">)</font>

    <font color="#a02030"># test metadata</font>
    <font color="#000000">xray_state</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">&quot;domain_000000/state&quot;</font><font color="#4000C0">]</font>

    <font color="#000000">time</font> <font color="#4000C0">=</font> <font color="#000000">xray_state</font><font color="#4000C0">[</font><font color="#008000">&quot;time&quot;</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_Time&quot;</font><font color="#4000C0">,</font> <font color="#000000">time</font><font color="#4000C0">,</font> <font color="#0080C0">4.8</font><font color="#4000C0">)</font>

    <font color="#000000">cycle</font> <font color="#4000C0">=</font> <font color="#000000">xray_state</font><font color="#4000C0">[</font><font color="#008000">&quot;cycle&quot;</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_Cycle&quot;</font><font color="#4000C0">,</font> <font color="#000000">cycle</font><font color="#4000C0">,</font> <font color="#0080C0">48</font><font color="#4000C0">)</font>

    <font color="#000000">test_bp_state_xray_view</font><font color="#4000C0">(</font><font color="#000000">testname</font><font color="#4000C0">,</font> <font color="#000000">xray_state</font><font color="#4000C0">[</font><font color="#008000">&quot;xray_view&quot;</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#000000">test_bp_state_xray_query</font><font color="#4000C0">(</font><font color="#000000">testname</font><font color="#4000C0">,</font> <font color="#000000">xray_state</font><font color="#4000C0">[</font><font color="#008000">&quot;xray_query&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
        <font color="#000000">qro</font><font color="#4000C0">.</font><font color="#000000">num_bins</font><font color="#4000C0">,</font> <font color="#000000">qro</font><font color="#4000C0">.</font><font color="#000000">abs_name</font><font color="#4000C0">,</font> <font color="#000000">qro</font><font color="#4000C0">.</font><font color="#000000">emis_name</font><font color="#4000C0">,</font> <font color="#000000">qro</font><font color="#4000C0">.</font><font color="#000000">units</font><font color="#4000C0">,</font> <font color="#000000">qro</font><font color="#4000C0">.</font><font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">)</font>
    <font color="#000000">test_bp_state_xray_data</font><font color="#4000C0">(</font><font color="#000000">testname</font><font color="#4000C0">,</font> <font color="#000000">xray_state</font><font color="#4000C0">[</font><font color="#008000">&quot;xray_data&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">qro</font><font color="#4000C0">.</font><font color="#000000">int_max</font><font color="#4000C0">,</font> <font color="#000000">qro</font><font color="#4000C0">.</font><font color="#000000">pl_max</font><font color="#4000C0">)</font>

    <font color="#a02030"># test data embedded within the fields</font>

    <font color="#000000">xray_fields</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">&quot;domain_000000/fields&quot;</font><font color="#4000C0">]</font>

    <font color="#000000">intensityUnits</font> <font color="#4000C0">=</font> <font color="#000000">xray_fields</font><font color="#4000C0">[</font><font color="#008000">&quot;intensities/units&quot;</font><font color="#4000C0">]</font>
    <font color="#000000">pathLengthUnits</font> <font color="#4000C0">=</font> <font color="#000000">xray_fields</font><font color="#4000C0">[</font><font color="#008000">&quot;path_length/units&quot;</font><font color="#4000C0">]</font>

    <font color="#C00000">if</font> <font color="#4000C0">(</font><font color="#000000">qro</font><font color="#4000C0">.</font><font color="#000000">units</font> <font color="#4000C0">==</font> <font color="#000000">UNITS_ON</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_IntensityUnits&quot;</font><font color="#4000C0">,</font> <font color="#000000">intensityUnits</font><font color="#4000C0">,</font> <font color="#008000">&quot;intensity units&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_PathLengthUnits&quot;</font><font color="#4000C0">,</font> <font color="#000000">pathLengthUnits</font><font color="#4000C0">,</font> <font color="#008000">&quot;path length metadata&quot;</font><font color="#4000C0">)</font>
    <font color="#C00000">else</font><font color="#4000C0">:</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_IntensityUnits&quot;</font><font color="#4000C0">,</font> <font color="#000000">intensityUnits</font><font color="#4000C0">,</font> <font color="#008000">&quot;no units provided&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_PathLengthUnits&quot;</font><font color="#4000C0">,</font> <font color="#000000">pathLengthUnits</font><font color="#4000C0">,</font> <font color="#008000">&quot;no info provided&quot;</font><font color="#4000C0">)</font>

    <font color="#a02030"># test data embedded within the coordsets</font>

    <font color="#000000">xray_coordsets</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">&quot;domain_000000/coordsets&quot;</font><font color="#4000C0">]</font>

    <font color="#000000">spatial_coords_x</font> <font color="#4000C0">=</font> <font color="#000000">xray_coordsets</font><font color="#4000C0">[</font><font color="#008000">&quot;spatial_coords/values/x&quot;</font><font color="#4000C0">]</font>
    <font color="#000000">spatial_coords_y</font> <font color="#4000C0">=</font> <font color="#000000">xray_coordsets</font><font color="#4000C0">[</font><font color="#008000">&quot;spatial_coords/values/y&quot;</font><font color="#4000C0">]</font>
    <font color="#000000">energy_group_bounds</font> <font color="#4000C0">=</font> <font color="#000000">xray_coordsets</font><font color="#4000C0">[</font><font color="#008000">&quot;spatial_coords/values/z&quot;</font><font color="#4000C0">]</font>
    <font color="#000000">energy_group_info</font> <font color="#4000C0">=</font> <font color="#000000">xray_coordsets</font><font color="#4000C0">[</font><font color="#008000">&quot;spatial_coords/info&quot;</font><font color="#4000C0">]</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_data_SpatialExtents0&quot;</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#000000">spatial_coords_x</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">spatial_coords_y</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_data_SpatialExtents1&quot;</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#000000">spatial_coords_x</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">spatial_coords_y</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#0080C0">0.05</font><font color="#4000C0">,</font> <font color="#0080C0">0.05</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_data_SpatialExtents2&quot;</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#000000">spatial_coords_x</font><font color="#4000C0">[</font><font color="#0080C0">2</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">spatial_coords_y</font><font color="#4000C0">[</font><font color="#0080C0">2</font><font color="#4000C0">]</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#0080C0">0.1</font><font color="#4000C0">,</font> <font color="#0080C0">0.1</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_data_SpatialExtents3&quot;</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#000000">spatial_coords_x</font><font color="#4000C0">[</font><font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">spatial_coords_y</font><font color="#4000C0">[</font><font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#0080C0">15.0</font><font color="#4000C0">,</font> <font color="#0080C0">10.0</font><font color="#4000C0">]</font><font color="#4000C0">)</font>

    <font color="#C00000">if</font> <font color="#4000C0">(</font><font color="#000000">qro</font><font color="#4000C0">.</font><font color="#000000">bin_state</font> <font color="#4000C0">==</font> <font color="#000000">NO_ENERGY_GROUP_BOUNDS</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_data_EnergyGroupInfo&quot;</font><font color="#4000C0">,</font> <font color="#000000">energy_group_info</font><font color="#4000C0">,</font> <font color="#008000">&quot;Energy group bounds not provided.&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_data_EnergyGroupBounds&quot;</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#000000">energy_group_bounds</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">energy_group_bounds</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#C00000">elif</font> <font color="#4000C0">(</font><font color="#000000">qro</font><font color="#4000C0">.</font><font color="#000000">bin_state</font> <font color="#4000C0">==</font> <font color="#000000">ENERGY_GROUP_BOUNDS_MISMATCH</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">baseline_string</font> <font color="#4000C0">=</font> <font color="#008000">&quot;Energy group bounds size mismatch: provided 3 bounds, but 2 in query results.&quot;</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_data_EnergyGroupInfo&quot;</font><font color="#4000C0">,</font> <font color="#000000">energy_group_info</font><font color="#4000C0">,</font> <font color="#000000">baseline_string</font><font color="#4000C0">)</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_data_EnergyGroupBounds&quot;</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#000000">energy_group_bounds</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">energy_group_bounds</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#C00000">elif</font> <font color="#4000C0">(</font><font color="#000000">qro</font><font color="#4000C0">.</font><font color="#000000">bin_state</font> <font color="#4000C0">==</font> <font color="#000000">ENERGY_GROUP_BOUNDS</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_data_EnergyGroupBounds&quot;</font><font color="#4000C0">,</font> <font color="#000000">energy_group_bounds</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">2</font><font color="#4000C0">,</font> <font color="#0080C0">6</font><font color="#4000C0">,</font> <font color="#0080C0">8</font><font color="#4000C0">]</font><font color="#4000C0">)</font>

    <font color="#000000">yaml_text</font> <font color="#4000C0">=</font> <font color="#008000">f&quot;&quot;&quot;x: {&quot;cm&quot; if qro.units == UNITS_ON else &quot;no units provided&quot;}
y: {&quot;cm&quot; if qro.units == UNITS_ON else &quot;no units provided&quot;}
z: {&quot;kev&quot; if qro.units == UNITS_ON else &quot;no units provided&quot;}&quot;&quot;&quot;</font>

    <font color="#000000">spatial_units_base</font> <font color="#4000C0">=</font> <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">Node</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">spatial_units_base</font><font color="#4000C0">.</font><font color="#000000">parse</font><font color="#4000C0">(</font><font color="#000000">yaml_text</font><font color="#4000C0">,</font> <font color="#008000">&quot;yaml&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">spatial_units</font> <font color="#4000C0">=</font> <font color="#000000">xray_coordsets</font><font color="#4000C0">[</font><font color="#008000">&quot;spatial_coords/units&quot;</font><font color="#4000C0">]</font>

    <font color="#000000">info</font> <font color="#4000C0">=</font> <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">Node</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">diffval</font> <font color="#4000C0">=</font> <font color="#000000">spatial_units</font><font color="#4000C0">.</font><font color="#000000">diff</font><font color="#4000C0">(</font><font color="#000000">spatial_units_base</font><font color="#4000C0">,</font> <font color="#000000">info</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_spatial_units&quot;</font><font color="#4000C0">,</font> <font color="#000000">diffval</font><font color="#4000C0">,</font> <font color="#C00000">False</font><font color="#4000C0">)</font><font color="#4000C0">;</font>
    <font color="#C00000">if</font> <font color="#000000">diffval</font><font color="#4000C0">:</font>
        <font color="#000000">print</font><font color="#4000C0">(</font><font color="#000000">info</font><font color="#4000C0">.</font><font color="#000000">to_yaml</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#000000">xlabel</font> <font color="#4000C0">=</font> <font color="#000000">xray_coordsets</font><font color="#4000C0">[</font><font color="#008000">&quot;spatial_coords/labels/x&quot;</font><font color="#4000C0">]</font><font color="#4000C0">;</font>
    <font color="#000000">ylabel</font> <font color="#4000C0">=</font> <font color="#000000">xray_coordsets</font><font color="#4000C0">[</font><font color="#008000">&quot;spatial_coords/labels/y&quot;</font><font color="#4000C0">]</font><font color="#4000C0">;</font>
    <font color="#000000">zlabel</font> <font color="#4000C0">=</font> <font color="#000000">xray_coordsets</font><font color="#4000C0">[</font><font color="#008000">&quot;spatial_coords/labels/z&quot;</font><font color="#4000C0">]</font><font color="#4000C0">;</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_data_XLabels&quot;</font><font color="#4000C0">,</font> <font color="#000000">xlabel</font><font color="#4000C0">,</font> <font color="#008000">&quot;width&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_data_YLabels&quot;</font><font color="#4000C0">,</font> <font color="#000000">ylabel</font><font color="#4000C0">,</font> <font color="#008000">&quot;height&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_data_ZLabels&quot;</font><font color="#4000C0">,</font> <font color="#000000">zlabel</font><font color="#4000C0">,</font> <font color="#008000">&quot;energy_group&quot;</font><font color="#4000C0">)</font>

    <font color="#000000">xlabel</font> <font color="#4000C0">=</font> <font color="#000000">xray_coordsets</font><font color="#4000C0">[</font><font color="#008000">&quot;spatial_energy_reduced_coords/labels/x&quot;</font><font color="#4000C0">]</font><font color="#4000C0">;</font>
    <font color="#000000">ylabel</font> <font color="#4000C0">=</font> <font color="#000000">xray_coordsets</font><font color="#4000C0">[</font><font color="#008000">&quot;spatial_energy_reduced_coords/labels/y&quot;</font><font color="#4000C0">]</font><font color="#4000C0">;</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_data_ser_XLabels&quot;</font><font color="#4000C0">,</font> <font color="#000000">xlabel</font><font color="#4000C0">,</font> <font color="#008000">&quot;width&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_data_ser_YLabels&quot;</font><font color="#4000C0">,</font> <font color="#000000">ylabel</font><font color="#4000C0">,</font> <font color="#008000">&quot;height&quot;</font><font color="#4000C0">)</font>

    <font color="#000000">xlabel</font> <font color="#4000C0">=</font> <font color="#000000">xray_coordsets</font><font color="#4000C0">[</font><font color="#008000">&quot;spectra_coords/labels/x&quot;</font><font color="#4000C0">]</font><font color="#4000C0">;</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_data_spectra_XLabels&quot;</font><font color="#4000C0">,</font> <font color="#000000">xlabel</font><font color="#4000C0">,</font> <font color="#008000">&quot;energy_group&quot;</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">calc_midpoints</font><font color="#4000C0">(</font><font color="#000000">arr</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">midpts</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#4000C0">]</font>
    <font color="#C00000">for</font> <font color="#000000">i</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">arr</font><font color="#4000C0">)</font> <font color="#4000C0">-</font> <font color="#0080C0">1</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">midpts</font><font color="#4000C0">.</font><font color="#000000">append</font><font color="#4000C0">(</font><font color="#4000C0">(</font><font color="#000000">arr</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font> <font color="#4000C0">+</font> <font color="#000000">arr</font><font color="#4000C0">[</font><font color="#000000">i</font> <font color="#4000C0">+</font> <font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">)</font> <font color="#4000C0">/</font> <font color="#0080C0">2</font><font color="#4000C0">)</font>
    <font color="#C00000">return</font> <font color="#000000">midpts</font>

<font color="#C00000">def</font> <font color="#000000">z_slice</font><font color="#4000C0">(</font><font color="#000000">zval</font><font color="#4000C0">,</font> <font color="#000000">mesh_name</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">AddOperator</font><font color="#4000C0">(</font><font color="#008000">&quot;Slice&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">SetActivePlots</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">)</font>
    <font color="#000000">SliceAtts</font> <font color="#4000C0">=</font> <font color="#000000">SliceAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">SliceAtts</font><font color="#4000C0">.</font><font color="#000000">originType</font> <font color="#4000C0">=</font> <font color="#000000">SliceAtts</font><font color="#4000C0">.</font><font color="#000000">Point</font>  <font color="#a02030"># Point, Intercept, Percent, Zone, Node</font>
    <font color="#000000">SliceAtts</font><font color="#4000C0">.</font><font color="#000000">originPoint</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">zval</font><font color="#4000C0">)</font>
    <font color="#000000">SliceAtts</font><font color="#4000C0">.</font><font color="#000000">axisType</font> <font color="#4000C0">=</font> <font color="#000000">SliceAtts</font><font color="#4000C0">.</font><font color="#000000">ZAxis</font>  <font color="#a02030"># XAxis, YAxis, ZAxis, Arbitrary, ThetaPhi</font>
    <font color="#000000">SliceAtts</font><font color="#4000C0">.</font><font color="#000000">project2d</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">SliceAtts</font><font color="#4000C0">.</font><font color="#000000">interactive</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">SliceAtts</font><font color="#4000C0">.</font><font color="#000000">meshName</font> <font color="#4000C0">=</font> <font color="#000000">mesh_name</font>
    <font color="#000000">SetOperatorOptions</font><font color="#4000C0">(</font><font color="#000000">SliceAtts</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">full_mesh_rotated_view</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">View3DAtts</font> <font color="#4000C0">=</font> <font color="#000000">View3DAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">viewNormal</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.67</font><font color="#4000C0">,</font> <font color="#0080C0">0.33</font><font color="#4000C0">,</font> <font color="#0080C0">0.67</font><font color="#4000C0">)</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">focus</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">150</font><font color="#4000C0">,</font> <font color="#0080C0">100</font><font color="#4000C0">,</font> <font color="#0080C0">1.5</font><font color="#4000C0">)</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">viewUp</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#4000C0">-</font><font color="#0080C0">0.2</font><font color="#4000C0">,</font> <font color="#0080C0">0.95</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">0.2</font><font color="#4000C0">)</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">viewAngle</font> <font color="#4000C0">=</font> <font color="#0080C0">30</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">parallelScale</font> <font color="#4000C0">=</font> <font color="#0080C0">180</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">nearPlane</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">360</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">farPlane</font> <font color="#4000C0">=</font> <font color="#0080C0">360</font>
    <font color="#000000">SetView3D</font><font color="#4000C0">(</font><font color="#000000">View3DAtts</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">spatial_mesh_rotated_view</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">View3DAtts</font> <font color="#4000C0">=</font> <font color="#000000">View3DAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">viewNormal</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.67</font><font color="#4000C0">,</font> <font color="#0080C0">0.33</font><font color="#4000C0">,</font> <font color="#0080C0">0.67</font><font color="#4000C0">)</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">focus</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">7.5</font><font color="#4000C0">,</font> <font color="#0080C0">5</font><font color="#4000C0">,</font> <font color="#0080C0">0.5</font><font color="#4000C0">)</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">viewUp</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#4000C0">-</font><font color="#0080C0">0.2</font><font color="#4000C0">,</font> <font color="#0080C0">0.95</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">0.2</font><font color="#4000C0">)</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">viewAngle</font> <font color="#4000C0">=</font> <font color="#0080C0">30</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">parallelScale</font> <font color="#4000C0">=</font> <font color="#0080C0">15.</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">nearPlane</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">18</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">farPlane</font> <font color="#4000C0">=</font> <font color="#0080C0">18</font>
    <font color="#000000">SetView3D</font><font color="#4000C0">(</font><font color="#000000">View3DAtts</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">blueprint_test</font><font color="#4000C0">(</font><font color="#000000">output_type</font><font color="#4000C0">,</font> <font color="#000000">outdir</font><font color="#4000C0">,</font> <font color="#000000">testtextnumber</font><font color="#4000C0">,</font> <font color="#000000">testname</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">for</font> <font color="#000000">i</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">2</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">setup_bp_test</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

        <font color="#a02030"># common place for args</font>
        <font color="#000000">divide_emis_by_absorb</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
        <font color="#000000">origin</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.0</font><font color="#4000C0">)</font>
        <font color="#000000">theta</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
        <font color="#000000">phi</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
        <font color="#000000">width</font> <font color="#4000C0">=</font> <font color="#0080C0">15</font>
        <font color="#000000">height</font> <font color="#4000C0">=</font> <font color="#0080C0">10</font>
        <font color="#000000">image_size</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">200</font><font color="#4000C0">)</font>

        <font color="#000000">energy_group_bounds</font>      <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">2</font><font color="#4000C0">,</font> <font color="#0080C0">6</font><font color="#4000C0">,</font> <font color="#0080C0">8</font><font color="#4000C0">]</font>
        <font color="#000000">fake_energy_group_bounds</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">2</font><font color="#4000C0">,</font> <font color="#0080C0">3</font><font color="#4000C0">]</font>

        <font color="#000000">energy_group_midpts</font>      <font color="#4000C0">=</font> <font color="#000000">calc_midpoints</font><font color="#4000C0">(</font><font color="#000000">energy_group_bounds</font><font color="#4000C0">)</font>
        <font color="#000000">fake_energy_group_midpts</font> <font color="#4000C0">=</font> <font color="#000000">calc_midpoints</font><font color="#4000C0">(</font><font color="#000000">fake_energy_group_bounds</font><font color="#4000C0">)</font>

        <font color="#000000">calltype</font> <font color="#4000C0">=</font> <font color="#008000">&quot;legacy&quot;</font> <font color="#C00000">if</font> <font color="#000000">i</font> <font color="#4000C0">==</font> <font color="#0080C0">0</font> <font color="#C00000">else</font> <font color="#008000">&quot;modern&quot;</font>

        <font color="#a02030"># run query</font>
        <font color="#C00000">if</font> <font color="#4000C0">(</font><font color="#000000">i</font> <font color="#4000C0">==</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
            <font color="#a02030"># test legacy call</font>
            <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font>
                  <font color="#000000">output_type</font><font color="#4000C0">,</font>
                  <font color="#000000">outdir</font><font color="#4000C0">,</font>
                  <font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">,</font>
                  <font color="#000000">origin</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
                  <font color="#000000">origin</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
                  <font color="#000000">origin</font><font color="#4000C0">[</font><font color="#0080C0">2</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
                  <font color="#000000">theta</font><font color="#4000C0">,</font>
                  <font color="#000000">phi</font><font color="#4000C0">,</font>
                  <font color="#000000">width</font><font color="#4000C0">,</font>
                  <font color="#000000">height</font><font color="#4000C0">,</font>
                  <font color="#000000">image_size</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
                  <font color="#000000">image_size</font><font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
                  <font color="#4000C0">(</font><font color="#008000">&quot;darr&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;parr&quot;</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
                  <font color="#000000">energy_group_bounds</font><font color="#4000C0">)</font>
        <font color="#C00000">elif</font> <font color="#4000C0">(</font><font color="#000000">i</font> <font color="#4000C0">==</font> <font color="#0080C0">1</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
            <font color="#a02030"># test modern call</font>
            <font color="#000000">params</font> <font color="#4000C0">=</font> <font color="#000000">dict</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;output_type&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">output_type</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;output_dir&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">outdir</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;divide_emis_by_absorb&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">divide_emis_by_absorb</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;origin&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">origin</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;theta&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">theta</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;phi&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">phi</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;width&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">width</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;height&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">height</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;image_size&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">image_size</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;vars&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">&quot;darr&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;parr&quot;</font><font color="#4000C0">)</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;energy_group_bounds&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">energy_group_bounds</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;spatial_units&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;cm&quot;</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;energy_units&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;kev&quot;</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;abs_units&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;abs units&quot;</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;emis_units&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;emis units&quot;</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;intensity_units&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;intensity units&quot;</font>
            <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;path_length_info&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;path length metadata&quot;</font>
            <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

        <font color="#a02030"># test output message</font>
        <font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputString</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage&quot;</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">testtextnumber</font> <font color="#4000C0">+</font> <font color="#000000">i</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">s</font><font color="#4000C0">)</font>
        <font color="#000000">teardown_bp_test</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

        <font color="#a02030"># test opening the bp output and visualizing in visit</font>
        <font color="#000000">conduit_db</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">outdir</font><font color="#4000C0">,</font> <font color="#008000">&quot;output.root&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">conduit_db</font><font color="#4000C0">)</font>

        <font color="#a02030"># </font>
        <font color="#a02030"># image topo</font>
        <font color="#a02030"># </font>

        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_image_topo/intensities&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">full_mesh_rotated_view</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_image_topo_intensities_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">calltype</font><font color="#4000C0">)</font>
        <font color="#000000">ResetView</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

        <font color="#a02030"># test some slices</font>
        <font color="#C00000">for</font> <font color="#000000">j</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">fake_energy_group_midpts</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
            <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_image_topo/intensities&quot;</font><font color="#4000C0">)</font>
            <font color="#000000">z_slice</font><font color="#4000C0">(</font><font color="#000000">fake_energy_group_midpts</font><font color="#4000C0">[</font><font color="#000000">j</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_image_topo&quot;</font><font color="#4000C0">)</font>
            <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
            <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_image_topo_intensities_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">calltype</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_slice&quot;</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">j</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
            <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_image_topo/path_length&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">full_mesh_rotated_view</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_image_topo_path_length_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">calltype</font><font color="#4000C0">)</font>
        <font color="#000000">ResetView</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

        <font color="#a02030"># test some slices</font>
        <font color="#C00000">for</font> <font color="#000000">j</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">fake_energy_group_midpts</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
            <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_image_topo/path_length&quot;</font><font color="#4000C0">)</font>
            <font color="#000000">z_slice</font><font color="#4000C0">(</font><font color="#000000">fake_energy_group_midpts</font><font color="#4000C0">[</font><font color="#000000">j</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_image_topo&quot;</font><font color="#4000C0">)</font>
            <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
            <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_image_topo_path_length_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">calltype</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_slice&quot;</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">j</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
            <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

        <font color="#a02030"># </font>
        <font color="#a02030"># spatial topo</font>
        <font color="#a02030"># </font>

        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_spatial_topo/intensities_spatial&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">spatial_mesh_rotated_view</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_spatial_topo_intensities_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">calltype</font><font color="#4000C0">)</font>
        <font color="#000000">ResetView</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

        <font color="#a02030"># test some slices</font>
        <font color="#C00000">for</font> <font color="#000000">j</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">energy_group_midpts</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
            <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_spatial_topo/intensities_spatial&quot;</font><font color="#4000C0">)</font>
            <font color="#000000">z_slice</font><font color="#4000C0">(</font><font color="#000000">energy_group_midpts</font><font color="#4000C0">[</font><font color="#000000">j</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_spatial_topo&quot;</font><font color="#4000C0">)</font>
            <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
            <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_spatial_topo_intensities_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">calltype</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_slice&quot;</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">j</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
            <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_spatial_topo/path_length_spatial&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">spatial_mesh_rotated_view</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_spatial_topo_path_length_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">calltype</font><font color="#4000C0">)</font>
        <font color="#000000">ResetView</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

        <font color="#a02030"># test some slices</font>
        <font color="#C00000">for</font> <font color="#000000">j</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">energy_group_midpts</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
            <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_spatial_topo/path_length_spatial&quot;</font><font color="#4000C0">)</font>
            <font color="#000000">z_slice</font><font color="#4000C0">(</font><font color="#000000">energy_group_midpts</font><font color="#4000C0">[</font><font color="#000000">j</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_spatial_topo&quot;</font><font color="#4000C0">)</font>
            <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
            <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_spatial_topo_path_length_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">calltype</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_slice&quot;</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">j</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
            <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

        <font color="#a02030"># </font>
        <font color="#a02030"># spatial energy reduced topo</font>
        <font color="#a02030"># </font>

        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_spatial_energy_reduced_topo/intensities_spatial_energy_reduced&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_spatial_energy_reduced_topo_intensities_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">calltype</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_spatial_energy_reduced_topo/path_length_spatial_energy_reduced&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_spatial_energy_reduced_topo_path_length_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">calltype</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

        <font color="#a02030"># </font>
        <font color="#a02030"># spectra topo</font>
        <font color="#a02030"># </font>

        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Curve&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_spectra_topo/intensities_spectra&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_spectra_topo_intensities_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">calltype</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Curve&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_spectra_topo/path_length_spectra&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_spectra_topo_path_length_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">calltype</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

        <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">conduit_db</font><font color="#4000C0">)</font>

    <font color="#000000">units</font> <font color="#4000C0">=</font> <font color="#000000">UNITS_OFF</font> <font color="#C00000">if</font> <font color="#000000">i</font> <font color="#4000C0">==</font> <font color="#0080C0">0</font> <font color="#C00000">else</font> <font color="#000000">UNITS_ON</font>

    <font color="#000000">qro</font> <font color="#4000C0">=</font> <font color="#000000">query_result_options</font><font color="#4000C0">(</font><font color="#000000">num_bins</font><font color="#4000C0">=</font><font color="#0080C0">3</font><font color="#4000C0">,</font> <font color="#000000">abs_name</font><font color="#4000C0">=</font><font color="#008000">&quot;darr&quot;</font><font color="#4000C0">,</font> <font color="#000000">emis_name</font><font color="#4000C0">=</font><font color="#008000">&quot;parr&quot;</font><font color="#4000C0">,</font> \
        <font color="#000000">bin_state</font><font color="#4000C0">=</font><font color="#000000">ENERGY_GROUP_BOUNDS</font><font color="#4000C0">,</font> <font color="#000000">units</font><font color="#4000C0">=</font><font color="#000000">units</font><font color="#4000C0">,</font> \
        <font color="#000000">int_max</font><font color="#4000C0">=</font><font color="#0080C0">2.94868183135986</font><font color="#4000C0">,</font> <font color="#000000">pl_max</font><font color="#4000C0">=</font><font color="#0080C0">892.02587890625</font><font color="#4000C0">,</font> <font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">=</font><font color="#C00000">False</font><font color="#4000C0">)</font>
    <font color="#000000">test_bp_data</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">i</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">conduit_db</font><font color="#4000C0">,</font> <font color="#000000">qro</font><font color="#4000C0">)</font> <font color="#a02030"># bounds</font>

    <font color="#000000">setup_bp_test</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">output_type</font><font color="#4000C0">,</font> <font color="#000000">outdir</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">15.</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">200</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#008000">&quot;d&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;p&quot;</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#4000C0">[</font><font color="#0080C0">1</font><font color="#4000C0">,</font><font color="#0080C0">2</font><font color="#4000C0">,</font><font color="#0080C0">3</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#000000">qro</font> <font color="#4000C0">=</font> <font color="#000000">query_result_options</font><font color="#4000C0">(</font><font color="#000000">num_bins</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#000000">abs_name</font><font color="#4000C0">=</font><font color="#008000">&quot;d&quot;</font><font color="#4000C0">,</font> <font color="#000000">emis_name</font><font color="#4000C0">=</font><font color="#008000">&quot;p&quot;</font><font color="#4000C0">,</font> \
        <font color="#000000">bin_state</font><font color="#4000C0">=</font><font color="#000000">ENERGY_GROUP_BOUNDS_MISMATCH</font><font color="#4000C0">,</font> <font color="#000000">units</font><font color="#4000C0">=</font><font color="#000000">UNITS_OFF</font><font color="#4000C0">,</font> \
        <font color="#000000">int_max</font><font color="#4000C0">=</font><font color="#0080C0">0.241531997919083</font><font color="#4000C0">,</font> <font color="#000000">pl_max</font><font color="#4000C0">=</font><font color="#0080C0">148.670989990234</font><font color="#4000C0">,</font> <font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">=</font><font color="#C00000">True</font><font color="#4000C0">)</font>
    <font color="#000000">test_bp_data</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">i</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">conduit_db</font><font color="#4000C0">,</font> <font color="#000000">qro</font><font color="#4000C0">)</font> <font color="#a02030"># bounds mismatch</font>

    <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">output_type</font><font color="#4000C0">,</font> <font color="#000000">outdir</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">15.</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">200</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#008000">&quot;d&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;p&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">qro</font> <font color="#4000C0">=</font> <font color="#000000">query_result_options</font><font color="#4000C0">(</font><font color="#000000">num_bins</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#000000">abs_name</font><font color="#4000C0">=</font><font color="#008000">&quot;d&quot;</font><font color="#4000C0">,</font> <font color="#000000">emis_name</font><font color="#4000C0">=</font><font color="#008000">&quot;p&quot;</font><font color="#4000C0">,</font> \
        <font color="#000000">bin_state</font><font color="#4000C0">=</font><font color="#000000">NO_ENERGY_GROUP_BOUNDS</font><font color="#4000C0">,</font> <font color="#000000">units</font><font color="#4000C0">=</font><font color="#000000">UNITS_OFF</font><font color="#4000C0">,</font> \
        <font color="#000000">int_max</font><font color="#4000C0">=</font><font color="#0080C0">0.241531997919083</font><font color="#4000C0">,</font> <font color="#000000">pl_max</font><font color="#4000C0">=</font><font color="#0080C0">148.670989990234</font><font color="#4000C0">,</font> <font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">=</font><font color="#C00000">True</font><font color="#4000C0">)</font>
    <font color="#000000">test_bp_data</font><font color="#4000C0">(</font><font color="#000000">testname</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">i</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">conduit_db</font><font color="#4000C0">,</font> <font color="#000000">qro</font><font color="#4000C0">)</font> <font color="#a02030"># no bounds</font>

    <font color="#000000">teardown_bp_test</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">blueprint_test</font><font color="#4000C0">(</font><font color="#008000">&quot;blueprint hdf5&quot;</font><font color="#4000C0">,</font> <font color="#000000">conduit_dir_hdf5</font><font color="#4000C0">,</font> <font color="#0080C0">32</font><font color="#4000C0">,</font> <font color="#008000">&quot;Blueprint_HDF5_X_Ray_Output&quot;</font><font color="#4000C0">)</font>
<font color="#000000">blueprint_test</font><font color="#4000C0">(</font><font color="#008000">&quot;blueprint json&quot;</font><font color="#4000C0">,</font> <font color="#000000">conduit_dir_json</font><font color="#4000C0">,</font> <font color="#0080C0">34</font><font color="#4000C0">,</font> <font color="#008000">&quot;Blueprint_JSON_X_Ray_Output&quot;</font><font color="#4000C0">)</font>
<font color="#000000">blueprint_test</font><font color="#4000C0">(</font><font color="#008000">&quot;blueprint yaml&quot;</font><font color="#4000C0">,</font> <font color="#000000">conduit_dir_yaml</font><font color="#4000C0">,</font> <font color="#0080C0">36</font><font color="#4000C0">,</font> <font color="#008000">&quot;Blueprint_YAML_X_Ray_Output&quot;</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># test detector height and width are always positive in blueprint output</font>
<font color="#a02030">#</font>

<font color="#000000">setup_bp_test</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">params</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryParameters</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">)</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;image_size&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">4</font><font color="#4000C0">,</font> <font color="#0080C0">3</font><font color="#4000C0">)</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;output_type&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;hdf5&quot;</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;output_dir&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">conduit_dir_detector_dims</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;focus&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">)</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;perspective&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;near_plane&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">50.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;far_plane&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">50.</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;vars&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">&quot;d&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;p&quot;</font><font color="#4000C0">)</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;energy_group_bounds&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#0080C0">3.7</font><font color="#4000C0">,</font> <font color="#0080C0">4.2</font><font color="#4000C0">]</font><font color="#4000C0">;</font>
<font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;parallel_scale&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">5.</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

<font color="#000000">teardown_bp_test</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">conduit_db</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_detector_dims</font><font color="#4000C0">,</font> <font color="#008000">&quot;output.root&quot;</font><font color="#4000C0">)</font>
<font color="#000000">xrayout</font> <font color="#4000C0">=</font> <font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">Node</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">conduit</font><font color="#4000C0">.</font><font color="#000000">relay</font><font color="#4000C0">.</font><font color="#000000">io</font><font color="#4000C0">.</font><font color="#000000">blueprint</font><font color="#4000C0">.</font><font color="#000000">load_mesh</font><font color="#4000C0">(</font><font color="#000000">xrayout</font><font color="#4000C0">,</font> <font color="#000000">conduit_db</font><font color="#4000C0">)</font>

<font color="#000000">detector_width</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">&quot;domain_000000/state/xray_data/detector_width&quot;</font><font color="#4000C0">]</font>
<font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">&quot;Blueprint_Positive_Detector_width&quot;</font><font color="#4000C0">,</font> <font color="#000000">detector_width</font><font color="#4000C0">,</font> <font color="#0080C0">22.3932263237838</font><font color="#4000C0">)</font>

<font color="#000000">detector_height</font> <font color="#4000C0">=</font> <font color="#000000">xrayout</font><font color="#4000C0">[</font><font color="#008000">&quot;domain_000000/state/xray_data/detector_height&quot;</font><font color="#4000C0">]</font>
<font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">&quot;Blueprint_Positive_Detector_height&quot;</font><font color="#4000C0">,</font> <font color="#000000">detector_height</font><font color="#4000C0">,</font> <font color="#0080C0">16.7949192423103</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># test imaging plane topos and ray output</font>
<font color="#a02030">#</font>

<font color="#C00000">def</font> <font color="#000000">test_imaging_planes_and_rays</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">for</font> <font color="#000000">i</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">2</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">setup_bp_test</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

        <font color="#000000">params</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryParameters</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;image_size&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">400</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">)</font>
        <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;output_dir&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">conduit_dir_imaging_planes0</font> <font color="#C00000">if</font> <font color="#000000">i</font> <font color="#4000C0">==</font> <font color="#0080C0">0</font> <font color="#C00000">else</font> <font color="#000000">conduit_dir_imaging_planes1</font>
        <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;output_type&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;hdf5&quot;</font>
        <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;focus&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">)</font>
        <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;perspective&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
        <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;near_plane&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">50.</font>
        <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;far_plane&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">50.</font>
        <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;vars&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">&quot;d&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;p&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;parallel_scale&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">5.</font>
        <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

        <font color="#000000">conduit_db</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_imaging_planes0</font> <font color="#C00000">if</font> <font color="#000000">i</font> <font color="#4000C0">==</font> <font color="#0080C0">0</font> <font color="#C00000">else</font> <font color="#000000">conduit_dir_imaging_planes1</font><font color="#4000C0">,</font> <font color="#008000">&quot;output.root&quot;</font><font color="#4000C0">)</font>

        <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">conduit_db</font><font color="#4000C0">)</font>

        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_far_plane_topo/far_plane_field&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_view_plane_topo/view_plane_field&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_near_plane_topo/near_plane_field&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
        <font color="#C00000">if</font> <font color="#000000">i</font> <font color="#4000C0">==</font> <font color="#0080C0">0</font><font color="#4000C0">:</font>
            <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_ray_corners_topo/ray_corners_field&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
        <font color="#C00000">else</font><font color="#4000C0">:</font>
            <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_ray_topo/ray_field&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
        <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

        <font color="#000000">SetActivePlots</font><font color="#4000C0">(</font><font color="#0080C0">4</font><font color="#4000C0">)</font>
        <font color="#000000">PseudocolorAtts</font> <font color="#4000C0">=</font> <font color="#000000">PseudocolorAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">PseudocolorAtts</font><font color="#4000C0">.</font><font color="#000000">invertColorTable</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
        <font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">PseudocolorAtts</font><font color="#4000C0">)</font>

        <font color="#000000">View3DAtts</font> <font color="#4000C0">=</font> <font color="#000000">View3DAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">viewNormal</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#4000C0">-</font><font color="#0080C0">0.519145</font><font color="#4000C0">,</font> <font color="#0080C0">0.199692</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">0.831031</font><font color="#4000C0">)</font>
        <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">focus</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10</font><font color="#4000C0">)</font>
        <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">viewUp</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#4000C0">-</font><font color="#0080C0">0.0954901</font><font color="#4000C0">,</font> <font color="#0080C0">0.952683</font><font color="#4000C0">,</font> <font color="#0080C0">0.288577</font><font color="#4000C0">)</font>
        <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">viewAngle</font> <font color="#4000C0">=</font> <font color="#0080C0">30</font>
        <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">parallelScale</font> <font color="#4000C0">=</font> <font color="#0080C0">58.6531</font>
        <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">nearPlane</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">117.306</font>
        <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">farPlane</font> <font color="#4000C0">=</font> <font color="#0080C0">117.306</font>
        <font color="#000000">SetView3D</font><font color="#4000C0">(</font><font color="#000000">View3DAtts</font><font color="#4000C0">)</font>

        <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;Blueprint_HDF5_Imaging_Planes&quot;</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">i</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

        <font color="#000000">teardown_bp_test</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">conduit_db</font><font color="#4000C0">)</font>

<font color="#000000">test_imaging_planes_and_rays</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">test_non_square_pixels</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">setup_bp_test</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">params</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryParameters</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">)</font>

    <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;vars&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#008000">&quot;d&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;p&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;image_size&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">)</font>
    <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;energy_group_bounds&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#0080C0">2.7</font><font color="#4000C0">,</font> <font color="#0080C0">6.2</font><font color="#4000C0">]</font>

    <font color="#a02030"># filename, directory, and output type choices</font>
    <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;output_dir&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#000000">conduit_dir_nonsquare_pixels</font>
    <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;filename_scheme&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;family&quot;</font> <font color="#a02030"># &quot;none&quot;, &quot;family&quot;, or &quot;cycle&quot; </font>
    <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;output_type&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#008000">&quot;hdf5&quot;</font>

    <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;focus&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">)</font>
    <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;parallel_scale&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">10.</font>
    <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;near_plane&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">25.</font>
    <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;far_plane&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">25.</font>
    <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;view_angle&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">30</font>
    <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;perspective&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font> <font color="#a02030"># 0 parallel, 1 perspective</font>

    <font color="#a02030"># default</font>
    <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>
    <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;image_size&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">4</font><font color="#4000C0">,</font> <font color="#0080C0">4</font><font color="#4000C0">)</font>
    <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>
    <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;image_size&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">)</font>

    <font color="#a02030"># view width is set but is equal to what it would have been if it were calculated</font>
    <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;view_width&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">10.</font>
    <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>
    <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;image_size&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">4</font><font color="#4000C0">,</font> <font color="#0080C0">4</font><font color="#4000C0">)</font>
    <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>
    <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;image_size&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">)</font>

    <font color="#a02030"># view width is twice the length of the parallel scale</font>
    <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;view_width&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">20.</font>
    <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>
    <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;image_size&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">4</font><font color="#4000C0">,</font> <font color="#0080C0">4</font><font color="#4000C0">)</font>
    <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>
    <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;image_size&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">)</font>

    <font color="#a02030"># view width is half the length of the parallel scale</font>
    <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;view_width&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#0080C0">5.</font>
    <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>
    <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;image_size&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">4</font><font color="#4000C0">,</font> <font color="#0080C0">4</font><font color="#4000C0">)</font>
    <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>

    <font color="#000000">conduit_db</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_nonsquare_pixels</font><font color="#4000C0">,</font> <font color="#008000">&quot;output.*.root database&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">conduit_db</font><font color="#4000C0">)</font>

    <font color="#a02030"># first we test the imaging planes and rays look as we expect</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_near_plane_topo/near_plane_field&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_view_plane_topo/view_plane_field&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_far_plane_topo/far_plane_field&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#a02030"># Make the plot of the near plane active</font>
    <font color="#000000">SetActivePlots</font><font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">PseudocolorAtts</font> <font color="#4000C0">=</font> <font color="#000000">PseudocolorAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#a02030"># We invert the color table so that it is a different color from the far plane</font>
    <font color="#000000">PseudocolorAtts</font><font color="#4000C0">.</font><font color="#000000">invertColorTable</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">PseudocolorAtts</font><font color="#4000C0">)</font>

    <font color="#a02030"># Make the plot of the view plane active</font>
    <font color="#000000">SetActivePlots</font><font color="#4000C0">(</font><font color="#0080C0">2</font><font color="#4000C0">)</font>
    <font color="#000000">PseudocolorAtts</font> <font color="#4000C0">=</font> <font color="#000000">PseudocolorAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">PseudocolorAtts</font><font color="#4000C0">.</font><font color="#000000">colorTableName</font> <font color="#4000C0">=</font> <font color="#008000">&quot;hot_and_cold&quot;</font>
    <font color="#000000">PseudocolorAtts</font><font color="#4000C0">.</font><font color="#000000">invertColorTable</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">PseudocolorAtts</font><font color="#4000C0">.</font><font color="#000000">opacityType</font> <font color="#4000C0">=</font> <font color="#000000">PseudocolorAtts</font><font color="#4000C0">.</font><font color="#000000">Constant</font>  <font color="#a02030"># ColorTable, FullyOpaque, Constant, Ramp, VariableRange</font>
    <font color="#a02030"># We lower the opacity so that the view plane does not obstruct our view of anything.</font>
    <font color="#000000">PseudocolorAtts</font><font color="#4000C0">.</font><font color="#000000">opacity</font> <font color="#4000C0">=</font> <font color="#0080C0">0.7</font>
    <font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">PseudocolorAtts</font><font color="#4000C0">)</font>

    <font color="#a02030"># leave the far plane as is</font>

    <font color="#a02030"># add ray corners topo</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Mesh&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_ray_corners_topo&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">MeshAtts</font> <font color="#4000C0">=</font> <font color="#000000">MeshAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">MeshAtts</font><font color="#4000C0">.</font><font color="#000000">lineWidth</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">SetPlotOptions</font><font color="#4000C0">(</font><font color="#000000">MeshAtts</font><font color="#4000C0">)</font>

    <font color="#a02030"># set view</font>
    <font color="#000000">View3DAtts</font> <font color="#4000C0">=</font> <font color="#000000">View3DAttributes</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">viewNormal</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#4000C0">-</font><font color="#0080C0">0.350116</font><font color="#4000C0">,</font> <font color="#0080C0">0.224905</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">0.909306</font><font color="#4000C0">)</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">focus</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10</font><font color="#4000C0">)</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">viewUp</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0.0306245</font><font color="#4000C0">,</font> <font color="#0080C0">0.972977</font><font color="#4000C0">,</font> <font color="#0080C0">0.228862</font><font color="#4000C0">)</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">viewAngle</font> <font color="#4000C0">=</font> <font color="#0080C0">30</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">parallelScale</font> <font color="#4000C0">=</font> <font color="#0080C0">34.3903</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">nearPlane</font> <font color="#4000C0">=</font> <font color="#4000C0">-</font><font color="#0080C0">68.7807</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">farPlane</font> <font color="#4000C0">=</font> <font color="#0080C0">68.7807</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">imagePan</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">imageZoom</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">perspective</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">eyeAngle</font> <font color="#4000C0">=</font> <font color="#0080C0">2</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">centerOfRotationSet</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">centerOfRotation</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10</font><font color="#4000C0">)</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">axis3DScaleFlag</font> <font color="#4000C0">=</font> <font color="#0080C0">0</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">axis3DScales</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">shear</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">View3DAtts</font><font color="#4000C0">.</font><font color="#000000">windowValid</font> <font color="#4000C0">=</font> <font color="#0080C0">1</font>
    <font color="#000000">SetView3D</font><font color="#4000C0">(</font><font color="#000000">View3DAtts</font><font color="#4000C0">)</font>

    <font color="#a02030"># take pictures of all the ray setups</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_Ray_trace_setup_1&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_ray_topo/ray_field&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_Ray_trace_setup_2&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_Ray_trace_setup_3&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_Ray_trace_setup_4&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_Ray_trace_setup_5&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_Ray_trace_setup_6&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_Ray_trace_setup_7&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_Ray_trace_setup_8&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#a02030"># cleanup</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#a02030"># take pictures of the hi-res images</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_image_topo/intensities&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">ResetView</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_spatial_topo/intensities_spatial&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">SetActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_hi_res_images1&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_hi_res_images2&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_hi_res_images3&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_hi_res_images4&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_hi_res_images5&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_hi_res_images6&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_hi_res_images7&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_hi_res_images8&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#a02030"># cleanup</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#a02030"># take pictures of the low res images</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_image_topo/intensities&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Mesh&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_image_topo&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_spatial_topo/intensities_spatial&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Mesh&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_spatial_topo&quot;</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">SetActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">(</font><font color="#0080C0">2</font><font color="#4000C0">,</font> <font color="#0080C0">3</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">ResetView</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">SetActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">2</font><font color="#4000C0">,</font> <font color="#0080C0">3</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">SetActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">2</font><font color="#4000C0">,</font> <font color="#0080C0">3</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_low_res_mesh_plots1&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_low_res_mesh_plots2&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">ResetView</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_low_res_mesh_plots3&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_low_res_mesh_plots4&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">ResetView</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_low_res_mesh_plots5&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_low_res_mesh_plots6&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">TimeSliderNextState</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">ResetView</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_low_res_mesh_plots7&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;NonSquare_Pixels_low_res_mesh_plots8&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">HideActivePlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">teardown_bp_test</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">conduit_db</font><font color="#4000C0">)</font>

<font color="#000000">test_non_square_pixels</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030"># </font>
<font color="#a02030"># test catching failures</font>
<font color="#a02030"># </font>

<font color="#a02030"># write to dir that does not exist</font>

<font color="#000000">setup_bp_test</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;hdf5&quot;</font><font color="#4000C0">,</font> <font color="#000000">dir_dne</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#008000">&quot;d&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;p&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#000000">output_obj</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputObject</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage38&quot;</font><font color="#4000C0">,</font> <font color="#000000">output_obj</font><font color="#4000C0">,</font> <font color="#C00000">None</font><font color="#4000C0">)</font>
<font color="#000000">teardown_bp_test</font><font color="#4000C0">(</font><font color="#C00000">True</font><font color="#4000C0">)</font>

<font color="#a02030"># os.chmod does not work on windows</font>
<font color="#C00000">if</font> <font color="#C00000">not</font> <font color="#000000">platform</font><font color="#4000C0">.</font><font color="#000000">system</font><font color="#4000C0">(</font><font color="#4000C0">)</font> <font color="#4000C0">==</font> <font color="#008000">&quot;Windows&quot;</font><font color="#4000C0">:</font>
    <font color="#a02030"># write to dir w/ read only permissions</font>
    <font color="#000000">setup_bp_test</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;hdf5&quot;</font><font color="#4000C0">,</font> <font color="#000000">outdir_bad</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#008000">&quot;d&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;p&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">output_obj</font> <font color="#4000C0">=</font> <font color="#000000">GetQueryOutputObject</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">TestValueEQ</font><font color="#4000C0">(</font><font color="#008000">&quot;xrayimage39&quot;</font><font color="#4000C0">,</font> <font color="#000000">output_obj</font><font color="#4000C0">,</font> <font color="#C00000">None</font><font color="#4000C0">)</font>
    <font color="#000000">teardown_bp_test</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030"># </font>
<font color="#a02030"># Test filenames and output types</font>
<font color="#a02030"># </font>

<font color="#000000">setup_bp_test</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">DefineArrayExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;da&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;array_compose(d,d)&quot;</font><font color="#4000C0">)</font>
<font color="#000000">DefineArrayExpression</font><font color="#4000C0">(</font><font color="#008000">&quot;pa&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;array_compose(p,p)&quot;</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">query_variety</font><font color="#4000C0">(</font><font color="#000000">otype</font><font color="#4000C0">,</font> <font color="#000000">scheme</font><font color="#4000C0">,</font> <font color="#000000">thevars</font><font color="#4000C0">,</font> <font color="#000000">outdir</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">SetQueryFloatFormat</font><font color="#4000C0">(</font><font color="#008000">&quot;%g&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font>
        <font color="#000000">background_intensity</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
        <font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
        <font color="#000000">far_plane</font><font color="#4000C0">=</font><font color="#0080C0">20</font><font color="#4000C0">,</font>
        <font color="#000000">filename_scheme</font><font color="#4000C0">=</font><font color="#000000">scheme</font><font color="#4000C0">,</font>
        <font color="#000000">family_files</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#a02030"># this is to test that family_files is ignored when filename_scheme is set</font>
        <font color="#000000">focus</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
        <font color="#000000">image_pan</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
        <font color="#000000">image_size</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">3</font><font color="#4000C0">,</font> <font color="#0080C0">3</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
        <font color="#000000">image_zoom</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font>
        <font color="#000000">near_plane</font><font color="#4000C0">=</font><font color="#4000C0">-</font><font color="#0080C0">20</font><font color="#4000C0">,</font>
        <font color="#000000">normal</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
        <font color="#000000">output_dir</font><font color="#4000C0">=</font><font color="#000000">outdir</font><font color="#4000C0">,</font>
        <font color="#000000">output_ray_bounds</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
        <font color="#000000">output_type</font><font color="#4000C0">=</font><font color="#000000">otype</font><font color="#4000C0">,</font>
        <font color="#000000">parallel_scale</font><font color="#4000C0">=</font><font color="#0080C0">10</font><font color="#4000C0">,</font>
        <font color="#000000">perspective</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
        <font color="#000000">view_angle</font><font color="#4000C0">=</font><font color="#0080C0">30</font><font color="#4000C0">,</font>
        <font color="#000000">view_up</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
        <font color="#000000">vars</font><font color="#4000C0">=</font><font color="#000000">thevars</font><font color="#4000C0">)</font>
    <font color="#C00000">return</font> <font color="#000000">GetQueryOutputObject</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">query_family_backwards_compat</font><font color="#4000C0">(</font><font color="#000000">family</font><font color="#4000C0">,</font> <font color="#000000">thevars</font><font color="#4000C0">,</font> <font color="#000000">outdir</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">SetQueryFloatFormat</font><font color="#4000C0">(</font><font color="#008000">&quot;%g&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font>
        <font color="#000000">background_intensity</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
        <font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
        <font color="#000000">far_plane</font><font color="#4000C0">=</font><font color="#0080C0">20</font><font color="#4000C0">,</font>
        <font color="#000000">family_files</font><font color="#4000C0">=</font><font color="#000000">family</font><font color="#4000C0">,</font>
        <font color="#000000">focus</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
        <font color="#000000">image_pan</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
        <font color="#000000">image_size</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">3</font><font color="#4000C0">,</font> <font color="#0080C0">3</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
        <font color="#000000">image_zoom</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font>
        <font color="#000000">near_plane</font><font color="#4000C0">=</font><font color="#4000C0">-</font><font color="#0080C0">20</font><font color="#4000C0">,</font>
        <font color="#000000">normal</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
        <font color="#000000">output_dir</font><font color="#4000C0">=</font><font color="#000000">outdir</font><font color="#4000C0">,</font>
        <font color="#000000">output_ray_bounds</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
        <font color="#000000">output_type</font><font color="#4000C0">=</font><font color="#008000">&quot;png&quot;</font><font color="#4000C0">,</font>
        <font color="#000000">parallel_scale</font><font color="#4000C0">=</font><font color="#0080C0">10</font><font color="#4000C0">,</font>
        <font color="#000000">perspective</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
        <font color="#000000">view_angle</font><font color="#4000C0">=</font><font color="#0080C0">30</font><font color="#4000C0">,</font>
        <font color="#000000">view_up</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
        <font color="#000000">vars</font><font color="#4000C0">=</font><font color="#000000">thevars</font><font color="#4000C0">)</font>
    <font color="#C00000">return</font> <font color="#000000">GetQueryOutputObject</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#000000">filename_schemes</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#008000">&quot;family&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;family&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;cycle&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;none&quot;</font><font color="#4000C0">]</font>
<font color="#000000">vars_options</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#4000C0">(</font><font color="#008000">&quot;d&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;p&quot;</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#4000C0">(</font><font color="#008000">&quot;da&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;pa&quot;</font><font color="#4000C0">)</font><font color="#4000C0">]</font>

<font color="#C00000">for</font> <font color="#000000">i</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">output_types</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">outdir_set_otype</font> <font color="#4000C0">=</font> <font color="#000000">outdir_set</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">output_types</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font>
    <font color="#C00000">if</font> <font color="#000000">output_types</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font> <font color="#4000C0">==</font> <font color="#008000">&quot;jpeg&quot;</font><font color="#4000C0">:</font>
        <font color="#a02030"># create a dummy file to test the file familying</font>
        <font color="#000000">open</font><font color="#4000C0">(</font><font color="#000000">outdir_set_otype</font> <font color="#4000C0">+</font> <font color="#008000">&quot;/output.0000.jpg&quot;</font><font color="#4000C0">,</font> <font color="#008000">&#x27;w&#x27;</font><font color="#4000C0">)</font><font color="#4000C0">.</font><font color="#000000">close</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">info</font> <font color="#4000C0">=</font> <font color="#008000">&quot;&quot;</font>
    <font color="#C00000">for</font> <font color="#000000">j</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">filename_schemes</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#C00000">for</font> <font color="#000000">k</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">vars_options</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
            <font color="#000000">info</font> <font color="#4000C0">+=</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">query_variety</font><font color="#4000C0">(</font><font color="#000000">output_types</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
                                      <font color="#000000">filename_schemes</font><font color="#4000C0">[</font><font color="#000000">j</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
                                      <font color="#000000">vars_options</font><font color="#4000C0">[</font><font color="#000000">k</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
                                      <font color="#000000">outdir_set_otype</font><font color="#4000C0">)</font><font color="#4000C0">)</font> <font color="#4000C0">+</font> <font color="#008000">&quot;\n&quot;</font>
    <font color="#000000">info</font> <font color="#4000C0">+=</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">sorted</font><font color="#4000C0">(</font><font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">listdir</font><font color="#4000C0">(</font><font color="#000000">outdir_set_otype</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">)</font> <font color="#4000C0">+</font> <font color="#008000">&quot;\n&quot;</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;Test_filenames_for_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">output_types</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_outputs&quot;</font><font color="#4000C0">,</font> <font color="#000000">info</font><font color="#4000C0">)</font>

<font color="#a02030"># test backwards compatibility with family_files option</font>
<font color="#C00000">for</font> <font color="#000000">i</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">family_options</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">outdir_set_family</font> <font color="#4000C0">=</font> <font color="#000000">outdir_set</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_family_&quot;</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">family_options</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#000000">info</font> <font color="#4000C0">=</font> <font color="#008000">&quot;&quot;</font>
    <font color="#C00000">for</font> <font color="#000000">j</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">vars_options</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">info</font> <font color="#4000C0">+=</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">query_family_backwards_compat</font><font color="#4000C0">(</font><font color="#000000">family_options</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
                                                  <font color="#000000">vars_options</font><font color="#4000C0">[</font><font color="#000000">j</font><font color="#4000C0">]</font><font color="#4000C0">,</font>
                                                  <font color="#000000">outdir_set_family</font><font color="#4000C0">)</font><font color="#4000C0">)</font> <font color="#4000C0">+</font> <font color="#008000">&quot;\n&quot;</font>
    <font color="#000000">info</font> <font color="#4000C0">+=</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">sorted</font><font color="#4000C0">(</font><font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">listdir</font><font color="#4000C0">(</font><font color="#000000">outdir_set_family</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">)</font> <font color="#4000C0">+</font> <font color="#008000">&quot;\n&quot;</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;Test_filenames_for_family&quot;</font> <font color="#4000C0">+</font> <font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">family_options</font><font color="#4000C0">[</font><font color="#000000">i</font><font color="#4000C0">]</font><font color="#4000C0">)</font> <font color="#4000C0">+</font> <font color="#008000">&quot;_outputs&quot;</font><font color="#4000C0">,</font> <font color="#000000">info</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Test that the far plane actually clips the result</font>
<font color="#a02030">#</font>
<font color="#C00000">def</font> <font color="#000000">test_far_plane_clipping</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">&quot;curv3d.silo&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;d&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font>
          <font color="#000000">background_intensity</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
          <font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
          <font color="#000000">far_plane</font><font color="#4000C0">=</font><font color="#0080C0">5</font><font color="#4000C0">,</font>
          <font color="#000000">filename_scheme</font><font color="#4000C0">=</font><font color="#008000">&quot;none&quot;</font><font color="#4000C0">,</font>
          <font color="#000000">focus</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">10</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
          <font color="#000000">image_pan</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
          <font color="#000000">image_size</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">200</font><font color="#4000C0">,</font> <font color="#0080C0">200</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
          <font color="#000000">image_zoom</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font>
          <font color="#000000">near_plane</font><font color="#4000C0">=</font><font color="#4000C0">-</font><font color="#0080C0">5</font><font color="#4000C0">,</font>
          <font color="#000000">normal</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
          <font color="#000000">output_dir</font><font color="#4000C0">=</font><font color="#000000">conduit_dir_far_plane_empty</font><font color="#4000C0">,</font>
          <font color="#000000">output_ray_bounds</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font>
          <font color="#000000">output_type</font><font color="#4000C0">=</font><font color="#008000">&quot;hdf5&quot;</font><font color="#4000C0">,</font>
          <font color="#000000">parallel_scale</font><font color="#4000C0">=</font><font color="#0080C0">10</font><font color="#4000C0">,</font>
          <font color="#000000">perspective</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
          <font color="#000000">view_angle</font><font color="#4000C0">=</font><font color="#0080C0">30</font><font color="#4000C0">,</font>
          <font color="#000000">view_up</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
          <font color="#000000">vars</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#008000">&quot;d&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;p&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font>
          <font color="#000000">background_intensity</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
          <font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
          <font color="#000000">far_plane</font><font color="#4000C0">=</font><font color="#0080C0">25</font><font color="#4000C0">,</font> <font color="#a02030"># we changed the far plane</font>
          <font color="#000000">filename_scheme</font><font color="#4000C0">=</font><font color="#008000">&quot;none&quot;</font><font color="#4000C0">,</font>
          <font color="#000000">focus</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#4000C0">-</font><font color="#0080C0">10</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
          <font color="#000000">image_pan</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
          <font color="#000000">image_size</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">200</font><font color="#4000C0">,</font> <font color="#0080C0">200</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
          <font color="#000000">image_zoom</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font>
          <font color="#000000">near_plane</font><font color="#4000C0">=</font><font color="#4000C0">-</font><font color="#0080C0">5</font><font color="#4000C0">,</font>
          <font color="#000000">normal</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
          <font color="#000000">output_dir</font><font color="#4000C0">=</font><font color="#000000">conduit_dir_far_plane_non_empty</font><font color="#4000C0">,</font>
          <font color="#000000">output_ray_bounds</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font>
          <font color="#000000">output_type</font><font color="#4000C0">=</font><font color="#008000">&quot;hdf5&quot;</font><font color="#4000C0">,</font>
          <font color="#000000">parallel_scale</font><font color="#4000C0">=</font><font color="#0080C0">10</font><font color="#4000C0">,</font>
          <font color="#000000">perspective</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font>
          <font color="#000000">view_angle</font><font color="#4000C0">=</font><font color="#0080C0">30</font><font color="#4000C0">,</font>
          <font color="#000000">view_up</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font>
          <font color="#000000">vars</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#008000">&quot;d&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;p&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">&quot;curv3d.silo&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#000000">conduit_db_empty</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_far_plane_empty</font><font color="#4000C0">,</font> <font color="#008000">&quot;output.root&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">conduit_db_empty</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_image_topo/intensities&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;far_plane_clipping_image_topo_intensities1&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_image_topo/path_length&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;far_plane_clipping_image_topo_path_length1&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">conduit_db_empty</font><font color="#4000C0">)</font>

    <font color="#000000">conduit_db_nonempty</font> <font color="#4000C0">=</font> <font color="#000000">pjoin</font><font color="#4000C0">(</font><font color="#000000">conduit_dir_far_plane_non_empty</font><font color="#4000C0">,</font> <font color="#008000">&quot;output.root&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">conduit_db_nonempty</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_image_topo/intensities&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;far_plane_clipping_image_topo_intensities2&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Pseudocolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;mesh_image_topo/path_length&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;far_plane_clipping_image_topo_path_length2&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">conduit_db_nonempty</font><font color="#4000C0">)</font>

<font color="#000000">test_far_plane_clipping</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

<font color="#a02030">#</font>
<font color="#a02030"># Test that we get decent error messages for common cases</font>
<font color="#a02030">#</font>
<font color="#C00000">import</font> <font color="#000000">numpy</font>

<font color="#000000">nporig</font> <font color="#4000C0">=</font> <font color="#000000">numpy</font><font color="#4000C0">.</font><font color="#000000">array</font><font color="#4000C0">(</font><font color="#4000C0">[</font><font color="#0080C0">0.0</font><font color="#4000C0">,</font> <font color="#0080C0">2.5</font><font color="#4000C0">,</font> <font color="#0080C0">10.0</font><font color="#4000C0">]</font><font color="#4000C0">)</font>

<font color="#000000">params</font> <font color="#4000C0">=</font> <font color="#000000">dict</font><font color="#4000C0">(</font><font color="#000000">output_type</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#000000">output_dir</font><font color="#4000C0">=</font><font color="#008000">&quot;.&quot;</font><font color="#4000C0">,</font> <font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font> \
    <font color="#000000">origin</font><font color="#4000C0">=</font><font color="#000000">nporig</font><font color="#4000C0">,</font> <font color="#000000">up_vector</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">theta</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">phi</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font> \
    <font color="#000000">width</font> <font color="#4000C0">=</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#000000">height</font><font color="#4000C0">=</font><font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#000000">image_size</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">vars</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#008000">&quot;da&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;pa&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#C00000">try</font><font color="#4000C0">:</font>
    <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>
<font color="#C00000">except</font> <font color="#4000C0">(</font><font color="#000000">visit</font><font color="#4000C0">.</font><font color="#000000">VisItException</font><font color="#4000C0">,</font> <font color="#000000">VisItException</font><font color="#4000C0">)</font> <font color="#C00000">as</font> <font color="#000000">e</font><font color="#4000C0">:</font>
    <font color="#C00000">if</font> <font color="#008000">&#x27;&quot;origin&quot;&#x27;</font> <font color="#C00000">in</font> <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">args</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font> <font color="#C00000">and</font> <font color="#008000">&quot;position 4&quot;</font> <font color="#C00000">in</font> <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">args</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font> <font color="#C00000">and</font> <font color="#008000">&quot;type numpy.ndarray&quot;</font> <font color="#C00000">in</font> <font color="#000000">e</font><font color="#4000C0">.</font><font color="#000000">args</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font><font color="#4000C0">:</font>
        <font color="#000000">TestPOA</font><font color="#4000C0">(</font><font color="#008000">&#x27;detect and warn numpy array as query param&#x27;</font><font color="#4000C0">)</font>
    <font color="#C00000">else</font><font color="#4000C0">:</font>
        <font color="#000000">TestFOA</font><font color="#4000C0">(</font><font color="#008000">&#x27;detect and warn numpy array as query param&#x27;</font><font color="#4000C0">,</font> <font color="#000000">LINE</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#C00000">pass</font>
<font color="#C00000">except</font><font color="#4000C0">:</font>
    <font color="#000000">TestFOA</font><font color="#4000C0">(</font><font color="#008000">&#x27;detect and warn numpy array as query param&#x27;</font><font color="#4000C0">,</font> <font color="#000000">LINE</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#C00000">pass</font>

<font color="#000000">params</font> <font color="#4000C0">=</font> <font color="#000000">dict</font><font color="#4000C0">(</font><font color="#000000">output_type</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#000000">output_dir</font><font color="#4000C0">=</font><font color="#008000">&quot;.&quot;</font><font color="#4000C0">,</font> <font color="#000000">divide_emis_by_absorb</font><font color="#4000C0">=</font><font color="#0080C0">1</font><font color="#4000C0">,</font> \
    <font color="#000000">origin</font><font color="#4000C0">=</font><font color="#000000">nporig</font><font color="#4000C0">.</font><font color="#000000">tolist</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">up_vector</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">1</font><font color="#4000C0">,</font> <font color="#0080C0">0</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">theta</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#000000">phi</font><font color="#4000C0">=</font><font color="#0080C0">0</font><font color="#4000C0">,</font> \
    <font color="#000000">width</font> <font color="#4000C0">=</font> <font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#000000">height</font><font color="#4000C0">=</font><font color="#0080C0">10.</font><font color="#4000C0">,</font> <font color="#000000">image_size</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#0080C0">300</font><font color="#4000C0">,</font> <font color="#0080C0">300</font><font color="#4000C0">)</font><font color="#4000C0">,</font> <font color="#000000">vars</font><font color="#4000C0">=</font><font color="#4000C0">(</font><font color="#008000">&quot;da&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;pa&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
<font color="#C00000">try</font><font color="#4000C0">:</font>
    <font color="#000000">Query</font><font color="#4000C0">(</font><font color="#008000">&quot;XRay Image&quot;</font><font color="#4000C0">,</font> <font color="#000000">params</font><font color="#4000C0">)</font>
    <font color="#000000">TestPOA</font><font color="#4000C0">(</font><font color="#008000">&#x27;numpy array converted to list works as query param&#x27;</font><font color="#4000C0">)</font>
<font color="#C00000">except</font><font color="#4000C0">:</font>
    <font color="#000000">TestFOA</font><font color="#4000C0">(</font><font color="#008000">&#x27;numpy array converted to list works as query param&#x27;</font><font color="#4000C0">,</font> <font color="#000000">LINE</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#C00000">pass</font>

<font color="#000000">Exit</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000"></font></font></pre></body></html>