<html><body bgcolor="#e0e0e0"><head><title>hybrid/cinema-a.py</title></head><pre><font face="Lucida,Courier New"><font color="#a02030"># ----------------------------------------------------------------------------</font>
<font color="#a02030">#  CLASSES: nightly</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Test Case:  cinema-a.py</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Tests:      Tests various aspects of &quot;visit -cinema&quot;.</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Notes:      </font>
<font color="#a02030">#</font>
<font color="#a02030">#  Programmer: Brad Whitlock</font>
<font color="#a02030">#  Date:       Thu Feb 15 16:37:20 PST 2018</font>
<font color="#a02030">#</font>
<font color="#a02030">#  Modifications:</font>
<font color="#a02030">#    Kathleen Biagas, Friday December 14, 2018</font>
<font color="#a02030">#    Fixes for running on Windows: Use abs_path for short_wave.visit, and cdb,</font>
<font color="#a02030">#    use &#x27;repr(db)&#x27; when writing script file to preserve &#x27;\&#x27; escapes.</font>
<font color="#a02030">#    Replace forward-slash with back-slash in pattern.</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Kathleen Biagas, Tue Jun 11 11:44:14 PDT 2019</font>
<font color="#a02030">#    Pass &#x27;-noconfig&#x27; to generated command line in GenerateCinema.</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Kathleen Biagas, Tue Sep 14 09:51:45 PDT 2021</font>
<font color="#a02030">#    Added call to CloseComputeEngine to GenerateCinema method, since the</font>
<font color="#a02030">#    cinema script launches its own. Prevents a hang when run in parallel.</font>
<font color="#a02030">#</font>
<font color="#a02030">#    Kathleen Biagas, Tue Sep 21 17:22:58 PDT 2021</font>
<font color="#a02030">#    Removed CloseComputeEngine, it prevented the non-cinema-generation parts</font>
<font color="#a02030">#    of the test from running in parallel.  If the nightlies use srun,</font>
<font color="#a02030">#    add &quot;--overlap&quot; srun option.  This allows cinema test to succeed in</font>
<font color="#a02030">#    parallel with recent changes to slurm.</font>
<font color="#a02030">#</font>
<font color="#a02030"># ----------------------------------------------------------------------------</font>
<font color="#C00000">import</font> <font color="#000000">os</font>
<font color="#C00000">import</font> <font color="#000000">subprocess</font>

<font color="#C00000">def</font> <font color="#000000">GenerateCinema</font><font color="#4000C0">(</font><font color="#000000">cinemaArgs</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">args</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;visit_bin&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">&quot;-noconfig&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-cinema&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">+</font> <font color="#000000">cinemaArgs</font>
    <font color="#C00000">if</font> <font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;parallel&quot;</font><font color="#4000C0">]</font><font color="#4000C0">:</font>
        <font color="#000000">args</font> <font color="#4000C0">=</font> <font color="#000000">args</font> <font color="#4000C0">+</font> <font color="#4000C0">[</font><font color="#008000">&quot;-np&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;2&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-l&quot;</font><font color="#4000C0">,</font> <font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;parallel_launch&quot;</font><font color="#4000C0">]</font><font color="#4000C0">]</font>
        <font color="#C00000">if</font> <font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;parallel_launch&quot;</font><font color="#4000C0">]</font> <font color="#4000C0">==</font> <font color="#008000">&quot;srun&quot;</font><font color="#4000C0">:</font>
            <font color="#000000">args</font> <font color="#4000C0">=</font> <font color="#000000">args</font> <font color="#4000C0">+</font> <font color="#4000C0">[</font><font color="#008000">&quot;-la&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;--overlap&quot;</font><font color="#4000C0">]</font>
    <font color="#000000">p</font> <font color="#4000C0">=</font> <font color="#000000">subprocess</font><font color="#4000C0">.</font><font color="#000000">check_output</font><font color="#4000C0">(</font><font color="#000000">args</font><font color="#4000C0">)</font>
    <font color="#C00000">return</font> <font color="#000000">p</font>

<font color="#C00000">def</font> <font color="#000000">GetFileList</font><font color="#4000C0">(</font><font color="#000000">path0</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">def</font> <font color="#000000">gfl</font><font color="#4000C0">(</font><font color="#000000">path</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">outfiles</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#4000C0">]</font>
        <font color="#000000">files</font> <font color="#4000C0">=</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">listdir</font><font color="#4000C0">(</font><font color="#000000">path</font><font color="#4000C0">)</font>
        <font color="#C00000">for</font> <font color="#000000">f</font> <font color="#C00000">in</font> <font color="#000000">sorted</font><font color="#4000C0">(</font><font color="#000000">files</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
            <font color="#000000">fpath</font> <font color="#4000C0">=</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">path</font><font color="#4000C0">,</font> <font color="#000000">f</font><font color="#4000C0">)</font>
            <font color="#C00000">if</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">isdir</font><font color="#4000C0">(</font><font color="#000000">fpath</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
                <font color="#000000">outfiles</font> <font color="#4000C0">=</font> <font color="#000000">outfiles</font> <font color="#4000C0">+</font> <font color="#000000">gfl</font><font color="#4000C0">(</font><font color="#000000">fpath</font><font color="#4000C0">)</font>
            <font color="#C00000">else</font><font color="#4000C0">:</font>
                <font color="#000000">outfiles</font> <font color="#4000C0">=</font> <font color="#000000">outfiles</font> <font color="#4000C0">+</font> <font color="#4000C0">[</font><font color="#000000">fpath</font><font color="#4000C0">[</font><font color="#000000">lpath0</font><font color="#4000C0">+</font><font color="#0080C0">1</font><font color="#4000C0">:</font><font color="#4000C0">]</font><font color="#4000C0">]</font>
        <font color="#C00000">return</font> <font color="#000000">outfiles</font>
    <font color="#000000">lpath0</font> <font color="#4000C0">=</font> <font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">path0</font><font color="#4000C0">)</font>
    <font color="#C00000">return</font> <font color="#000000">gfl</font><font color="#4000C0">(</font><font color="#000000">path0</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">ListToString</font><font color="#4000C0">(</font><font color="#000000">files</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#008000">&quot;&quot;</font>
    <font color="#C00000">for</font> <font color="#000000">f</font> <font color="#C00000">in</font> <font color="#000000">files</font><font color="#4000C0">:</font>
        <font color="#000000">s</font> <font color="#4000C0">+=</font> <font color="#000000">f</font>
        <font color="#000000">s</font> <font color="#4000C0">+=</font> <font color="#008000">&quot;\n&quot;</font>
    <font color="#C00000">return</font> <font color="#000000">s</font>

<font color="#C00000">def</font> <font color="#000000">GetFile</font><font color="#4000C0">(</font><font color="#000000">manyfilenames</font><font color="#4000C0">,</font> <font color="#000000">filename</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#C00000">for</font> <font color="#000000">f</font> <font color="#C00000">in</font> <font color="#000000">manyfilenames</font><font color="#4000C0">:</font>
        <font color="#C00000">if</font> <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">find</font><font color="#4000C0">(</font><font color="#000000">filename</font><font color="#4000C0">)</font> <font color="#4000C0">!=</font> <font color="#4000C0">-</font><font color="#0080C0">1</font><font color="#4000C0">:</font>
            <font color="#C00000">return</font> <font color="#000000">f</font>
    <font color="#C00000">return</font> <font color="#008000">&quot;&quot;</font>

<font color="#C00000">def</font> <font color="#000000">ReadTextFile</font><font color="#4000C0">(</font><font color="#000000">filename</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">lines</font> <font color="#4000C0">=</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#000000">filename</font><font color="#4000C0">,</font> <font color="#008000">&quot;rt&quot;</font><font color="#4000C0">)</font><font color="#4000C0">.</font><font color="#000000">readlines</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">s</font> <font color="#4000C0">=</font> <font color="#008000">&quot;&quot;</font>
    <font color="#C00000">for</font> <font color="#000000">line</font> <font color="#C00000">in</font> <font color="#000000">lines</font><font color="#4000C0">:</font>
        <font color="#000000">s</font> <font color="#4000C0">+=</font> <font color="#000000">line</font>
    <font color="#C00000">return</font> <font color="#000000">s</font>

<font color="#C00000">def</font> <font color="#000000">test0</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">&quot;Cinema spec A static camera&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font> <font color="#4000C0">=</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#008000">&quot;test0.py&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;wt&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&quot;OpenDatabase(%s)\n&quot;</font> <font color="#4000C0">%</font> <font color="#000000">repr</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;AddPlot(&quot;Pseudocolor&quot;, &quot;pressure&quot;)\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;DrawPlots()\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;v = GetView3D()\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;v.viewNormal = (-0.569392, 0.672931, 0.472183)\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;v.focus = (5, 0.353448, 2.5)\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;v.viewUp = (0.562941, 0.737756, -0.372577)\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;v.viewAngle = 30\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;v.parallelScale = 5.6009\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;v.nearPlane = -11.2018\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;v.farPlane = 11.2018\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;v.imagePan = (0.0431021, 0.0442006)\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;v.imageZoom = 1.06444\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;v.perspective = 1\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;v.eyeAngle = 2\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;v.centerOfRotationSet = 0\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;v.centerOfRotation = (5, 0.353448, 2.5)\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;v.axis3DScaleFlag = 0\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;v.axis3DScales = (1, 1, 1)\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;v.shear = (0, 0, 1)\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;v.windowValid = 1\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;SetView3D(v)\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;a = GetAnnotationAttributes()\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;a.axes3D.visible = 0\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;a.axes3D.bboxFlag = 0\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;a.axes3D.triadFlag = 0\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;a.legendInfoFlag = 0\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;a.databaseInfoFlag = 0\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;a.userInfoFlag = 0\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;SetAnnotationAttributes(a)\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">close</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">cdb</font> <font color="#4000C0">=</font> <font color="#000000">abs_path</font><font color="#4000C0">(</font><font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;run_dir&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">&quot;test0.cdb&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">sz</font> <font color="#4000C0">=</font> <font color="#008000">&quot;%dx%d&quot;</font> <font color="#4000C0">%</font> <font color="#4000C0">(</font><font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;width&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;height&quot;</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#000000">args</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#008000">&quot;-specification&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;A&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-scriptfile&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;test0.py&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-output&quot;</font><font color="#4000C0">,</font> <font color="#000000">cdb</font><font color="#4000C0">,</font> <font color="#008000">&quot;-format&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;png&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-geometry&quot;</font><font color="#4000C0">,</font> <font color="#000000">sz</font><font color="#4000C0">,</font> <font color="#008000">&quot;-camera&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;static&quot;</font><font color="#4000C0">]</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;cinema_0_00&quot;</font><font color="#4000C0">,</font> <font color="#000000">ListToString</font><font color="#4000C0">(</font><font color="#000000">args</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#000000">output</font> <font color="#4000C0">=</font> <font color="#000000">GenerateCinema</font><font color="#4000C0">(</font><font color="#000000">args</font><font color="#4000C0">)</font>

    <font color="#000000">files</font> <font color="#4000C0">=</font> <font color="#000000">GetFileList</font><font color="#4000C0">(</font><font color="#000000">cdb</font><font color="#4000C0">)</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;cinema_0_01&quot;</font><font color="#4000C0">,</font> <font color="#000000">ListToString</font><font color="#4000C0">(</font><font color="#000000">files</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#000000">json</font> <font color="#4000C0">=</font> <font color="#000000">ReadTextFile</font><font color="#4000C0">(</font><font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">cdb</font><font color="#4000C0">,</font> <font color="#000000">GetFile</font><font color="#4000C0">(</font><font color="#000000">files</font><font color="#4000C0">,</font> <font color="#008000">&quot;info.json&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;cinema_0_02&quot;</font><font color="#4000C0">,</font> <font color="#000000">json</font><font color="#4000C0">)</font>

    <font color="#000000">firstimg</font> <font color="#4000C0">=</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">cdb</font><font color="#4000C0">,</font> <font color="#000000">GetFile</font><font color="#4000C0">(</font><font color="#000000">files</font><font color="#4000C0">,</font> <font color="#008000">&quot;.png&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">firstimg</font><font color="#4000C0">)</font>
    <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Truecolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;color&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">v</font> <font color="#4000C0">=</font> <font color="#000000">GetView2D</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">v</font><font color="#4000C0">.</font><font color="#000000">viewportCoords</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">,</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">)</font>
    <font color="#000000">SetView2D</font><font color="#4000C0">(</font><font color="#000000">v</font><font color="#4000C0">)</font>
    <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;cinema_0_03&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">firstimg</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">test1</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">TestSection</font><font color="#4000C0">(</font><font color="#008000">&quot;Cinema spec A phi-theta camera&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font> <font color="#4000C0">=</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#008000">&quot;test1.py&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;wt&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&quot;OpenDatabase(%s)\n&quot;</font> <font color="#4000C0">%</font> <font color="#000000">repr</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;AddPlot(&quot;Pseudocolor&quot;, &quot;pressure&quot;)\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;DrawPlots()\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;a = GetAnnotationAttributes()\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;a.axes3D.visible = 0\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;a.axes3D.bboxFlag = 0\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;a.axes3D.triadFlag = 0\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;a.legendInfoFlag = 0\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;a.databaseInfoFlag = 0\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;a.userInfoFlag = 0\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#008000">&#x27;SetAnnotationAttributes(a)\n&#x27;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">close</font><font color="#4000C0">(</font><font color="#4000C0">)</font>

    <font color="#000000">cdb</font> <font color="#4000C0">=</font> <font color="#000000">abs_path</font><font color="#4000C0">(</font><font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;run_dir&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#008000">&quot;test1.cdb&quot;</font><font color="#4000C0">)</font>

    <font color="#000000">sz</font> <font color="#4000C0">=</font> <font color="#008000">&quot;%dx%d&quot;</font> <font color="#4000C0">%</font> <font color="#4000C0">(</font><font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;width&quot;</font><font color="#4000C0">]</font><font color="#4000C0">,</font> <font color="#000000">TestEnv</font><font color="#4000C0">.</font><font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;height&quot;</font><font color="#4000C0">]</font><font color="#4000C0">)</font>
    <font color="#000000">args</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#008000">&quot;-specification&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;A&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-scriptfile&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;test1.py&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-output&quot;</font><font color="#4000C0">,</font> <font color="#000000">cdb</font><font color="#4000C0">,</font> <font color="#008000">&quot;-format&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;png&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-geometry&quot;</font><font color="#4000C0">,</font> <font color="#000000">sz</font><font color="#4000C0">,</font> <font color="#008000">&quot;-camera&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;phi-theta&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-phi&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;6&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-theta&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;5&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;-stride&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;3&quot;</font><font color="#4000C0">]</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;cinema_1_00&quot;</font><font color="#4000C0">,</font> <font color="#000000">ListToString</font><font color="#4000C0">(</font><font color="#000000">args</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#000000">output</font> <font color="#4000C0">=</font> <font color="#000000">GenerateCinema</font><font color="#4000C0">(</font><font color="#000000">args</font><font color="#4000C0">)</font>

    <font color="#000000">files</font> <font color="#4000C0">=</font> <font color="#000000">GetFileList</font><font color="#4000C0">(</font><font color="#000000">cdb</font><font color="#4000C0">)</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;cinema_1_01&quot;</font><font color="#4000C0">,</font> <font color="#000000">ListToString</font><font color="#4000C0">(</font><font color="#000000">files</font><font color="#4000C0">)</font><font color="#4000C0">)</font>

    <font color="#000000">json</font> <font color="#4000C0">=</font> <font color="#000000">ReadTextFile</font><font color="#4000C0">(</font><font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">cdb</font><font color="#4000C0">,</font> <font color="#000000">GetFile</font><font color="#4000C0">(</font><font color="#000000">files</font><font color="#4000C0">,</font> <font color="#008000">&quot;info.json&quot;</font><font color="#4000C0">)</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
    <font color="#000000">TestText</font><font color="#4000C0">(</font><font color="#008000">&quot;cinema_1_02&quot;</font><font color="#4000C0">,</font> <font color="#000000">json</font><font color="#4000C0">)</font>

    <font color="#a02030"># Use the JSON to come up with some filenames to plot. We will vary phi.</font>
    <font color="#000000">params</font> <font color="#4000C0">=</font> <font color="#000000">eval</font><font color="#4000C0">(</font><font color="#000000">json</font><font color="#4000C0">)</font>
    <font color="#000000">theta_values</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">x</font><font color="#4000C0">)</font> <font color="#C00000">for</font> <font color="#000000">x</font> <font color="#C00000">in</font> <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;arguments&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;theta&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;values&quot;</font><font color="#4000C0">]</font><font color="#4000C0">]</font>
    <font color="#000000">phi_values</font> <font color="#4000C0">=</font> <font color="#4000C0">[</font><font color="#000000">str</font><font color="#4000C0">(</font><font color="#000000">x</font><font color="#4000C0">)</font> <font color="#C00000">for</font> <font color="#000000">x</font> <font color="#C00000">in</font>  <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;arguments&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;phi&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;values&quot;</font><font color="#4000C0">]</font><font color="#4000C0">]</font>
    <font color="#000000">time_values</font> <font color="#4000C0">=</font> <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;arguments&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;time&quot;</font><font color="#4000C0">]</font><font color="#4000C0">[</font><font color="#008000">&quot;values&quot;</font><font color="#4000C0">]</font>

    <font color="#000000">theta</font> <font color="#4000C0">=</font> <font color="#000000">theta_values</font><font color="#4000C0">[</font><font color="#000000">len</font><font color="#4000C0">(</font><font color="#000000">theta_values</font><font color="#4000C0">)</font><font color="#4000C0">//</font><font color="#0080C0">4</font><font color="#4000C0">]</font>
    <font color="#000000">time</font> <font color="#4000C0">=</font> <font color="#000000">time_values</font><font color="#4000C0">[</font><font color="#0080C0">0</font><font color="#4000C0">]</font>
    <font color="#000000">i</font> <font color="#4000C0">=</font> <font color="#0080C0">3</font>
    <font color="#C00000">for</font> <font color="#000000">phi</font> <font color="#C00000">in</font> <font color="#000000">phi_values</font><font color="#4000C0">:</font>
        <font color="#000000">pattern</font> <font color="#4000C0">=</font> <font color="#000000">params</font><font color="#4000C0">[</font><font color="#008000">&quot;name_pattern&quot;</font><font color="#4000C0">]</font>
        <font color="#C00000">if</font> <font color="#000000">sys</font><font color="#4000C0">.</font><font color="#000000">platform</font><font color="#4000C0">.</font><font color="#000000">startswith</font><font color="#4000C0">(</font><font color="#008000">&quot;win&quot;</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
            <font color="#000000">pattern</font> <font color="#4000C0">=</font> <font color="#000000">pattern</font><font color="#4000C0">.</font><font color="#000000">replace</font><font color="#4000C0">(</font><font color="#008000">&quot;/&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;\\&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">name</font> <font color="#4000C0">=</font> <font color="#000000">pattern</font><font color="#4000C0">.</font><font color="#000000">replace</font><font color="#4000C0">(</font><font color="#008000">&quot;{phi}&quot;</font><font color="#4000C0">,</font> <font color="#000000">phi</font><font color="#4000C0">)</font>
        <font color="#000000">name</font> <font color="#4000C0">=</font> <font color="#000000">name</font><font color="#4000C0">.</font><font color="#000000">replace</font><font color="#4000C0">(</font><font color="#008000">&quot;{theta}&quot;</font><font color="#4000C0">,</font> <font color="#000000">theta</font><font color="#4000C0">)</font>
        <font color="#000000">name</font> <font color="#4000C0">=</font> <font color="#000000">name</font><font color="#4000C0">.</font><font color="#000000">replace</font><font color="#4000C0">(</font><font color="#008000">&quot;{time}&quot;</font><font color="#4000C0">,</font> <font color="#000000">time</font><font color="#4000C0">)</font>

        <font color="#000000">img</font> <font color="#4000C0">=</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">join</font><font color="#4000C0">(</font><font color="#000000">cdb</font><font color="#4000C0">,</font> <font color="#000000">GetFile</font><font color="#4000C0">(</font><font color="#000000">files</font><font color="#4000C0">,</font> <font color="#000000">name</font><font color="#4000C0">)</font><font color="#4000C0">)</font>
        <font color="#000000">OpenDatabase</font><font color="#4000C0">(</font><font color="#000000">img</font><font color="#4000C0">)</font>
        <font color="#000000">AddPlot</font><font color="#4000C0">(</font><font color="#008000">&quot;Truecolor&quot;</font><font color="#4000C0">,</font> <font color="#008000">&quot;color&quot;</font><font color="#4000C0">)</font>
        <font color="#000000">DrawPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">v</font> <font color="#4000C0">=</font> <font color="#000000">GetView2D</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">v</font><font color="#4000C0">.</font><font color="#000000">viewportCoords</font> <font color="#4000C0">=</font> <font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">,</font><font color="#0080C0">0</font><font color="#4000C0">,</font><font color="#0080C0">1</font><font color="#4000C0">)</font>
        <font color="#000000">SetView2D</font><font color="#4000C0">(</font><font color="#000000">v</font><font color="#4000C0">)</font>
        <font color="#000000">Test</font><font color="#4000C0">(</font><font color="#008000">&quot;cinema_1_%02d&quot;</font> <font color="#4000C0">%</font> <font color="#000000">i</font><font color="#4000C0">)</font>
        <font color="#000000">DeleteAllPlots</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
        <font color="#000000">CloseDatabase</font><font color="#4000C0">(</font><font color="#000000">img</font><font color="#4000C0">)</font>
        <font color="#000000">i</font> <font color="#4000C0">=</font> <font color="#000000">i</font> <font color="#4000C0">+</font> <font color="#0080C0">1</font>

<font color="#C00000">def</font> <font color="#000000">MakeShortWave</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">db</font> <font color="#4000C0">=</font> <font color="#000000">abs_path</font><font color="#4000C0">(</font><font color="#008000">&quot;short_wave.visit&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font> <font color="#4000C0">=</font> <font color="#000000">open</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">,</font> <font color="#008000">&quot;wt&quot;</font><font color="#4000C0">)</font>
    <font color="#C00000">for</font> <font color="#000000">i</font> <font color="#C00000">in</font> <font color="#000000">range</font><font color="#4000C0">(</font><font color="#0080C0">0</font><font color="#4000C0">,</font> <font color="#0080C0">700</font><font color="#4000C0">,</font> <font color="#0080C0">100</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
        <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">write</font><font color="#4000C0">(</font><font color="#000000">silo_data_path</font><font color="#4000C0">(</font><font color="#008000">&quot;wave%04d.silo&quot;</font> <font color="#4000C0">%</font> <font color="#000000">i</font><font color="#4000C0">)</font> <font color="#4000C0">+</font> <font color="#008000">&quot;\n&quot;</font><font color="#4000C0">)</font>
    <font color="#000000">f</font><font color="#4000C0">.</font><font color="#000000">close</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#C00000">return</font> <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">path</font><font color="#4000C0">.</font><font color="#000000">abspath</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">)</font>

<font color="#C00000">def</font> <font color="#000000">main</font><font color="#4000C0">(</font><font color="#4000C0">)</font><font color="#4000C0">:</font>
    <font color="#000000">db</font> <font color="#4000C0">=</font> <font color="#000000">MakeShortWave</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
    <font color="#000000">test0</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">)</font>
    <font color="#000000">test1</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">)</font>

    <font color="#000000">os</font><font color="#4000C0">.</font><font color="#000000">unlink</font><font color="#4000C0">(</font><font color="#000000">db</font><font color="#4000C0">)</font>

<font color="#000000">main</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000">Exit</font><font color="#4000C0">(</font><font color="#4000C0">)</font>
<font color="#000000"></font></font></pre></body></html>